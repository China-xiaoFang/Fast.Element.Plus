"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),l=require("element-plus"),a=require("../../select/src/select.js"),t=require("../../tree/src/tree.props.js"),r=require("@fast-china/utils"),o=require("@vueuse/core"),n=require("lodash-unified"),i={...a.SelectProps,...t.treeProps,loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},nodeKey:{type:String,default:"value"},defaultExpandAll:{type:Boolean,default:!0},checkOnClickNode:{type:Boolean,default:!0},highlightCurrent:{type:Boolean,default:!0},expandOnClickNode:Boolean,collapseOnClickNode:Boolean,cacheData:{type:Array,default:()=>[]},modelValue:{type:r.definePropType([String,Number,Boolean,Object,Array]),default:void 0},label:r.definePropType([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,lazy:{type:Boolean,default:!0},defaultSelected:Boolean,props:{type:r.definePropType(Object),default:()=>({label:"label",hide:"hide",disabled:"disabled",children:"children"})},data:{type:r.definePropType(Array),default:()=>[]},requestApi:{type:r.definePropType(Function)},initParam:r.definePropType([String,Number,Object])},d={"update:modelValue":e=>n.isString(e)||n.isNumber(e)||n.isBoolean(e)||n.isObject(e)||n.isArray(e)||n.isNull(e),"update:label":e=>n.isString(e)||n.isArray(e)||n.isNull(e),dataChangeCallBack:e=>n.isArray(e),change:(e,l)=>(n.isObject(e)||n.isArray(e)||n.isNull(e))&&(n.isString(l)||n.isNumber(l)||n.isBoolean(l)||n.isObject(l)||n.isArray(l)||n.isNull(l)),visibleChange:e=>n.isBoolean(e),removeTag:e=>n.isString(e)||n.isNumber(e)||n.isBoolean(e)||n.isObject(e)||n.isArray(e),clear:()=>!0,blur:e=>e instanceof FocusEvent,focus:e=>e instanceof FocusEvent,nodeClick:(e,l,a)=>n.isObject(e)&&n.isObject(l)&&n.isObject(a),nodeContextmenu:(e,l,a,t)=>e instanceof Event&&n.isObject(l)&&n.isObject(a)&&n.isObject(t),checkChange:(e,l,a)=>n.isObject(e)&&n.isBoolean(l)&&n.isBoolean(a),check:(e,l)=>n.isObject(e)&&n.isObject(l),currentChange:(e,l)=>n.isObject(e)&&n.isObject(l),nodeExpand:(e,l,a)=>n.isObject(e)&&n.isObject(l)&&n.isObject(a),nodeCollapse:(e,l,a)=>n.isObject(e)&&n.isObject(l)&&n.isObject(a),nodeDragStart:(e,l)=>n.isObject(e)&&l instanceof DragEvent,nodeDragEnter:(e,l,a)=>n.isObject(e)&&n.isObject(l)&&a instanceof DragEvent,nodeDragLeave:(e,l,a)=>n.isObject(e)&&n.isObject(l)&&a instanceof DragEvent,nodeDragOver:(e,l,a)=>n.isObject(e)&&n.isObject(l)&&a instanceof DragEvent,nodeDragEnd:(e,l,a,t)=>n.isObject(e)&&n.isObject(l)&&n.isString(a)&&t instanceof DragEvent,nodeDrop:(e,l,a,t)=>n.isObject(e)&&n.isObject(l)&&n.isString(a)&&t instanceof DragEvent},u=e.defineComponent({name:"FaTreeSelect",props:i,emits:d,slots:r.makeSlots(),setup(i,{attrs:d,slots:u,emit:s,expose:c}){var p;const v=o.useVModel(i,"label",s,{passive:!0}),f=e.reactive({value:r.withDefineType(),loading:!1,selectorData:r.withDefineType([]),debut:!0,echo:!((null==(p=i.data)?void 0:p.length)>0),nextRefresh:!1}),g=e.ref(),h=e=>null==e?void 0:e.map(e=>({...e,value:e[i.nodeKey],label:n.isFunction(i.props.label)?i.props.label(e):e[i.props.label??"label"],hide:n.isFunction(i.props.hide)?i.props.hide(e):e[i.props.hide??"hide"],disabled:n.isFunction(i.props.disabled)?i.props.disabled(e):e[i.props.disabled??"disabled"],children:n.isFunction(i.props.children)?h(i.props.children(e)):h(e[i.props.children??"children"])})).filter(e=>!e.hide),b=async()=>{if(i.requestApi){f.loading=!0;const l=i.initParam??{};try{const e=await i.requestApi(l);f.echo=!1,f.selectorData=h(e),s("dataChangeCallBack",f.selectorData)}catch(e){r.consoleError("FaTreeSelect",e),f.selectorData=[]}finally{f.loading=!1}}else f.selectorData=h(i.data)},m=(e,l,a)=>{if(!e)return!0;let t=a.parent,r=[a.label],o=1;for(;o<a.level;)r=[...r,t.label],t=t.parent,o++;const n=r.some(l=>-1!==l.indexOf(e));return i.filterNodeMethod?n&&i.filterNodeMethod(e,l,a):n},y=(e,l)=>{if(i.multiple){const l=e;if(0===(null==l?void 0:l.length))return f.value=null,v.value=null,s("update:modelValue",null),void s("change",null,null);const a=f.selectorData.filter(e=>l.includes(e.value));f.value=e,v.value=a.map(e=>e.label),s("update:modelValue",e),s("change",a,e)}else{if(n.isNil(e))return f.value=null,v.value=null,s("update:modelValue",null),void s("change",null,null);l??(l=f.selectorData.find(l=>l.value===e)),f.value=e,v.value=l.label,s("update:modelValue",e),s("change",l,e)}},C=()=>{f.value=null,v.value=null,s("clear")},N=(e,l,a,t)=>{i.expandOnClickNode&&(l.expanded?l.expanded&&i.collapseOnClickNode&&l.collapse():l.expand()),(i.checkStrictly||l.isLeaf)&&y(e.value,e),s("nodeClick",e,l,a)},O=async e=>{e&&(f.debut?(f.debut=!1,i.lazy&&await b()):f.nextRefresh&&(f.nextRefresh=!1,await b())),s("visibleChange",e)};e.watch(()=>i.modelValue,e=>{if(f.echo&&!n.isNil(e)){const l=!n.isNil(i.label);if(i.multiple){if(!n.isArray(e))return void r.consoleError("FaTreeSelect","当启用 multiple 时，传入的 modelValue 必须是Array。");if(l&&!n.isArray(i.label))return void r.consoleError("FaTreeSelect","当启用 multiple 时，传入的 modelValue:label 必须是Array。");f.selectorData=e.slice(0,i.multipleLimit>0?i.multipleLimit:e.length).map((e,a)=>({value:e,label:l?i.label[a]:void 0}))}else{if(n.isArray(e))return void r.consoleError("FaTreeSelect","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(l&&n.isArray(i.label))return void r.consoleError("FaTreeSelect","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");f.selectorData=[{value:e,label:i.label}]}}f.value=e},{immediate:!0}),e.onMounted(async()=>{var l;i.defaultSelected?(await b(),f.selectorData.length>0&&(i.multiple?y([f.selectorData[0].value]):y(f.selectorData[0].value,f.selectorData[0]))):!i.requestApi&&(null==(l=i.data)?void 0:l.length)>0?(f.debut=!1,await b()):i.lazy||await b(),e.watch(()=>i.initParam,(e,l)=>{n.isEqual(e,l)||(f.nextRefresh=!0,n.isNil(f.value)||y())}),e.watch(()=>i.data,async()=>{i.requestApi||await b()},{deep:!0})});const D=r.useProps(i,{...a.SelectProps,...t.treeProps},["modelValue","popperClass","loading","expandOnClickNode","filterNodeMethod"]);return r.useRender(()=>e.createVNode(l.ElTreeSelect,e.mergeProps(D.value,{ref:g,class:"fa-tree-select",popperClass:`fa-tree-select-dropdown ${i.popperClass}`,style:{width:r.addUnit(i.width)},modelValue:f.value,"onUpdate:modelValue":e=>f.value=e,loading:f.loading,data:f.selectorData,expandOnClickNode:!i.checkOnClickNode&&i.expandOnClickNode,filterNodeMethod:m,onNodeClick:N,onClear:C,onVisibleChange:O,onRemoveTag:e=>s("removeTag",e),onBlur:e=>s("blur",e),onFocus:e=>s("focus",e),onNodeContextmenu:(e,l,a,t)=>s("nodeContextmenu",e,l,a,t),onCheckChange:(e,l,a)=>s("checkChange",e,l,a),onCheck:(e,l)=>s("check",e,l),onCurrentChange:(e,l)=>s("currentChange",e,l),onNodeExpand:(e,l,a)=>s("nodeExpand",e,l,a),onNodeCollapse:(e,l,a)=>s("nodeCollapse",e,l,a),onNodeDragStart:(e,l)=>s("nodeDragStart",e,l),onNodeDragEnter:(e,l,a)=>s("nodeDragEnter",e,l,a),onNodeDragLeave:(e,l,a)=>s("nodeDragLeave",e,l,a),onNodeDragOver:(e,l,a)=>s("nodeDragOver",e,l,a),onNodeDragEnd:(e,l,a,t)=>s("nodeDragEnd",e,l,a,t),onNodeDrop:(e,l,a,t)=>s("nodeDrop",e,l,a,t)}),{...u.default&&{default:({node:e,data:l})=>u.default({node:e,data:l})},...u.header&&{header:()=>u.header()},...u.footer&&{footer:()=>u.footer()},...u.prefix&&{prefix:()=>u.prefix()},...u.empty&&{empty:()=>u.empty()},...u.tag&&{tag:()=>u.tag()},...u.loading&&{loading:()=>u.loading()},...u.label&&{label:({label:e,value:l})=>u.label({label:e,value:l})}})),r.useExpose(c,{focus:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.focus}),blur:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.blur}),selectedLabel:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.selectedLabel}),filter:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.filter}),updateKeyChildren:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.updateKeyChildren}),getCheckedNodes:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.getCheckedNodes}),setCheckedNodes:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.setCheckedNodes}),getCheckedKeys:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.getCheckedKeys}),setCheckedKeys:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.setCheckedKeys}),setChecked:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.setChecked}),getHalfCheckedNodes:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.getHalfCheckedNodes}),getHalfCheckedKeys:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.getHalfCheckedKeys}),getCurrentKey:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.getCurrentKey}),getCurrentNode:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.getCurrentNode}),setCurrentKey:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.setCurrentKey}),setCurrentNode:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.setCurrentNode}),getNode:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.getNode}),remove:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.remove}),append:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.append}),insertBefore:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.insertBefore}),insertAfter:e.computed(()=>{var e;return null==(e=g.value)?void 0:e.insertAfter}),loading:e.computed(()=>f.loading),refresh:b,setSelection:e=>y(e),clearSelection:()=>y(null)})}});exports.default=u,exports.faTreeSelectEmits=d,exports.faTreeSelectProps=i;
//# sourceMappingURL=treeSelect.js.map
