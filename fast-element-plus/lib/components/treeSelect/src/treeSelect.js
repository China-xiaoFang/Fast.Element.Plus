"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),l=require("element-plus"),a=require("../../select/src/select.js"),t=require("../../tree/src/tree.props.js"),r=require("@fast-china/utils"),o=require("@vueuse/core"),i=require("lodash-unified"),d={...a.SelectProps,...t.treeProps,cacheData:{type:r.definePropType(Array),default:[]},disabled:{type:Boolean,default:void 0},loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},nodeKey:{type:String,default:"value"},defaultExpandAll:{type:Boolean,default:!0},checkOnClickNode:{type:Boolean,default:!0},highlightCurrent:{type:Boolean,default:!0},expandOnClickNode:Boolean,collapseOnClickNode:Boolean,modelValue:{type:r.definePropType([String,Number,Boolean,Object,Array]),default:void 0},label:r.definePropType([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,lazy:{type:Boolean,default:!0},defaultSelected:Boolean,props:{type:r.definePropType(Object),default:()=>({label:"label",hide:"hide",disabled:"disabled",children:"children"})},data:{type:r.definePropType(Array),default:()=>[]},requestApi:{type:r.definePropType(Function)},initParam:r.definePropType([String,Number,Object])},n={...l.selectEmits,...l.treeEmits,"update:modelValue":e=>i.isString(e)||i.isNumber(e)||i.isBoolean(e)||i.isObject(e)||i.isArray(e)||i.isNull(e),"update:label":e=>i.isString(e)||i.isArray(e)||i.isNull(e),dataChangeCallBack:e=>i.isArray(e),change:(e,l)=>!0},s=e.defineComponent({name:"FaTreeSelect",props:d,emits:n,slots:r.makeSlots(),setup(d,{attrs:n,slots:s,emit:u,expose:p}){const c=o.useVModel(d,"label",u),f=e.reactive({value:r.withDefineType(),loading:!1,selectorData:r.withDefineType([]),debut:!0,echo:!(d.data?.length>0),nextRefresh:!1}),h=e.ref(),y=e=>e?.map(e=>({...e,value:e[d.nodeKey],label:i.isFunction(d.props.label)?d.props.label(e):e[d.props.label??"label"],hide:i.isFunction(d.props.hide)?d.props.hide(e):e[d.props.hide??"hide"],disabled:i.isFunction(d.props.disabled)?d.props.disabled(e):e[d.props.disabled??"disabled"],children:i.isFunction(d.props.children)?y(d.props.children(e)):y(e[d.props.children??"children"])})).filter(e=>!e.hide),m=async()=>{if(d.requestApi){f.loading=!0;const l=d.initParam??{};try{const e=await d.requestApi(l);f.echo=!1,f.selectorData=y(e),u("dataChangeCallBack",f.selectorData)}catch(e){r.consoleError("FaTreeSelect",e),f.selectorData=[]}finally{f.loading=!1}}else f.echo=!1,f.selectorData=y(d.data)},b=(e,l,a)=>{if(!e)return!0;let t=a.parent,r=[a.label],o=1;for(;o<a.level;)r=[...r,t.label],t=t.parent,o++;const i=r.some(l=>-1!==l.indexOf(e));return d.filterNodeMethod?i&&d.filterNodeMethod(e,l,a):i},g=(e,l)=>{if(d.multiple){const l=e;if(0===l?.length)return f.value=null,c.value=null,u("update:modelValue",null),void u("change",null,null);const a=f.selectorData.filter(e=>l.includes(e.value));f.value=e,c.value=a.map(e=>e.label),u("update:modelValue",e),u("change",a,e)}else{if(i.isNil(e))return f.value=null,c.value=null,u("update:modelValue",null),void u("change",null,null);l??=f.selectorData.find(l=>l.value===e),f.value=e,c.value=l.label,u("update:modelValue",e),u("change",l,e)}},v=()=>{f.value=null,c.value=null,u("update:modelValue",null),u("clear")},S=(e,l,a,t)=>{d.expandOnClickNode&&(l.expanded?l.expanded&&d.collapseOnClickNode&&l.collapse():l.expand()),(d.checkStrictly||l.isLeaf)&&g(e.value,e),u("node-click",e,l,a,t)},x=async e=>{e&&(f.debut?(f.debut=!1,d.lazy&&await m()):f.nextRefresh&&(f.nextRefresh=!1,await m())),u("visible-change",e)};e.watch(()=>d.modelValue,e=>{if(f.echo&&!i.isNil(e)){const l=!i.isNil(d.label);if(d.multiple){if(!i.isArray(e))return void r.consoleError("FaTreeSelect","当启用 multiple 时，传入的 modelValue 必须是Array。");if(l&&!i.isArray(d.label))return void r.consoleError("FaTreeSelect","当启用 multiple 时，传入的 modelValue:label 必须是Array。");f.selectorData=e.slice(0,d.multipleLimit>0?d.multipleLimit:e.length).map((e,a)=>({value:e,label:l?d.label[a]:void 0}))}else{if(i.isArray(e))return void r.consoleError("FaTreeSelect","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(l&&i.isArray(d.label))return void r.consoleError("FaTreeSelect","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");f.selectorData=[{value:e,label:d.label}]}}f.value=e},{immediate:!0}),e.onMounted(async()=>{d.defaultSelected?(await m(),f.selectorData.length>0&&(d.multiple?g([f.selectorData[0].value]):g(f.selectorData[0].value,f.selectorData[0]))):!d.requestApi&&d.data?.length>0?(f.debut=!1,await m()):d.lazy||await m(),e.watch(()=>d.initParam,(e,l)=>{i.isEqual(e,l)||(f.nextRefresh=!0,i.isNil(f.value)||g())}),e.watch(()=>d.data,async()=>{d.requestApi||await m()},{deep:!0})});const N=r.useProps(d,{...a.SelectProps,...t.treeProps},["modelValue","popperClass","lazy","loading","expandOnClickNode","filterNodeMethod"]),T=r.useEmits({...l.selectEmits,...l.treeEmits},u,["update:modelValue","clear","visible-change","node-click"]);return r.useRender(()=>e.createVNode(l.ElTreeSelect,e.mergeProps(N.value,T.value,{ref:h,class:"fa-tree-select",popperClass:`fa-tree-select-dropdown ${d.popperClass}`,style:{width:r.addUnit(d.width)},modelValue:f.value,"onUpdate:modelValue":e=>f.value=e,lazy:!1,loading:f.loading,data:f.selectorData,expandOnClickNode:!d.checkOnClickNode&&d.expandOnClickNode,filterNodeMethod:b,onNodeClick:S,onClear:v,onVisibleChange:x}),{...s.default&&{default:({node:e,data:l})=>s.default({node:e,data:l})},...s.header&&{header:()=>s.header()},...s.footer&&{footer:()=>s.footer()},...s.prefix&&{prefix:()=>s.prefix()},...s.empty&&{empty:()=>s.empty()},...s.tag&&{tag:()=>s.tag()},...s.loading&&{loading:()=>s.loading()},...s.label&&{label:({label:e,value:l})=>s.label({label:e,value:l})}})),r.useExpose(p,{loading:e.computed(()=>f.loading),refresh:m,setSelection:e=>g(e),clearSelection:()=>g(null)})}});exports.default=s,exports.faTreeSelectEmits=n,exports.faTreeSelectProps=d;
//# sourceMappingURL=treeSelect.js.map
