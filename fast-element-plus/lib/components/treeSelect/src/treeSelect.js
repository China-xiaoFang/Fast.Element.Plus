"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),l=require("element-plus"),a=require("../../select/src/select.js"),t=require("../../tree/src/tree.props.js"),o=require("@fast-china/utils"),r=require("@vueuse/core"),n=require("lodash-unified"),i={...a.SelectProps,...t.treeProps,loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},nodeKey:{type:String,default:"value"},defaultExpandAll:{type:Boolean,default:!0},checkOnClickNode:{type:Boolean,default:!0},highlightCurrent:{type:Boolean,default:!0},expandOnClickNode:Boolean,collapseOnClickNode:Boolean,cacheData:{type:Array,default:()=>[]},modelValue:{type:o.definePropType([String,Number,Boolean,Object,Array]),default:void 0},label:o.definePropType([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,lazy:{type:Boolean,default:!0},defaultSelected:Boolean,props:{type:o.definePropType(Object),default:()=>({label:"label",hide:"hide",disabled:"disabled",children:"children"})},data:{type:o.definePropType(Array),default:()=>[]},requestApi:{type:o.definePropType(Function)},initParam:o.definePropType([String,Number,Object])},d={"update:modelValue":e=>n.isString(e)||n.isNumber(e)||n.isBoolean(e)||n.isObject(e)||n.isArray(e)||n.isNull(e),"update:label":e=>n.isString(e)||n.isArray(e)||n.isNull(e),dataChangeCallBack:e=>n.isArray(e),change:(e,l)=>(n.isObject(e)||n.isArray(e)||n.isNull(e))&&(n.isString(l)||n.isNumber(l)||n.isBoolean(l)||n.isObject(l)||n.isArray(l)||n.isNull(l)),visibleChange:e=>n.isBoolean(e),removeTag:e=>n.isString(e)||n.isNumber(e)||n.isBoolean(e)||n.isObject(e)||n.isArray(e),clear:()=>!0,blur:e=>e instanceof FocusEvent,focus:e=>e instanceof FocusEvent,nodeClick:(e,l,a)=>n.isObject(e)&&n.isObject(l)&&n.isObject(a),nodeContextmenu:(e,l,a,t)=>e instanceof Event&&n.isObject(l)&&n.isObject(a)&&n.isObject(t),checkChange:(e,l,a)=>n.isObject(e)&&n.isBoolean(l)&&n.isBoolean(a),check:(e,l)=>n.isObject(e)&&n.isObject(l),currentChange:(e,l)=>n.isObject(e)&&n.isObject(l),nodeExpand:(e,l,a)=>n.isObject(e)&&n.isObject(l)&&n.isObject(a),nodeCollapse:(e,l,a)=>n.isObject(e)&&n.isObject(l)&&n.isObject(a),nodeDragStart:(e,l)=>n.isObject(e)&&l instanceof DragEvent,nodeDragEnter:(e,l,a)=>n.isObject(e)&&n.isObject(l)&&a instanceof DragEvent,nodeDragLeave:(e,l,a)=>n.isObject(e)&&n.isObject(l)&&a instanceof DragEvent,nodeDragOver:(e,l,a)=>n.isObject(e)&&n.isObject(l)&&a instanceof DragEvent,nodeDragEnd:(e,l,a,t)=>n.isObject(e)&&n.isObject(l)&&n.isString(a)&&t instanceof DragEvent,nodeDrop:(e,l,a,t)=>n.isObject(e)&&n.isObject(l)&&n.isString(a)&&t instanceof DragEvent},s=e.defineComponent({name:"FaTreeSelect",props:i,emits:d,slots:o.makeSlots(),setup(i,{attrs:d,slots:s,emit:u,expose:c}){const p=r.useVModel(i,"label",u,{passive:!0}),f=e.reactive({value:o.withDefineType(),loading:!1,selectorData:o.withDefineType([]),debut:!0,echo:!(i.data?.length>0),nextRefresh:!1}),g=e.ref(),h=e=>e?.map(e=>({...e,value:e[i.nodeKey],label:n.isFunction(i.props.label)?i.props.label(e):e[i.props.label??"label"],hide:n.isFunction(i.props.hide)?i.props.hide(e):e[i.props.hide??"hide"],disabled:n.isFunction(i.props.disabled)?i.props.disabled(e):e[i.props.disabled??"disabled"],children:n.isFunction(i.props.children)?h(i.props.children(e)):h(e[i.props.children??"children"])})).filter(e=>!e.hide),b=async()=>{if(i.requestApi){f.loading=!0;const l=i.initParam??{};try{const e=await i.requestApi(l);f.echo=!1,f.selectorData=h(e),u("dataChangeCallBack",f.selectorData)}catch(e){o.consoleError("FaTreeSelect",e),f.selectorData=[]}finally{f.loading=!1}}else f.echo=!1,f.selectorData=h(i.data)},v=(e,l,a)=>{if(!e)return!0;let t=a.parent,o=[a.label],r=1;for(;r<a.level;)o=[...o,t.label],t=t.parent,r++;const n=o.some(l=>-1!==l.indexOf(e));return i.filterNodeMethod?n&&i.filterNodeMethod(e,l,a):n},m=(e,l)=>{if(i.multiple){const l=e;if(0===l?.length)return f.value=null,p.value=null,u("update:modelValue",null),void u("change",null,null);const a=f.selectorData.filter(e=>l.includes(e.value));f.value=e,p.value=a.map(e=>e.label),u("update:modelValue",e),u("change",a,e)}else{if(n.isNil(e))return f.value=null,p.value=null,u("update:modelValue",null),void u("change",null,null);l??=f.selectorData.find(l=>l.value===e),f.value=e,p.value=l.label,u("update:modelValue",e),u("change",l,e)}},y=()=>{f.value=null,p.value=null,u("clear")},C=(e,l,a,t)=>{i.expandOnClickNode&&(l.expanded?l.expanded&&i.collapseOnClickNode&&l.collapse():l.expand()),(i.checkStrictly||l.isLeaf)&&m(e.value,e),u("nodeClick",e,l,a)},N=async e=>{e&&(f.debut?(f.debut=!1,i.lazy&&await b()):f.nextRefresh&&(f.nextRefresh=!1,await b())),u("visibleChange",e)};e.watch(()=>i.modelValue,e=>{if(f.echo&&!n.isNil(e)){const l=!n.isNil(i.label);if(i.multiple){if(!n.isArray(e))return void o.consoleError("FaTreeSelect","当启用 multiple 时，传入的 modelValue 必须是Array。");if(l&&!n.isArray(i.label))return void o.consoleError("FaTreeSelect","当启用 multiple 时，传入的 modelValue:label 必须是Array。");f.selectorData=e.slice(0,i.multipleLimit>0?i.multipleLimit:e.length).map((e,a)=>({value:e,label:l?i.label[a]:void 0}))}else{if(n.isArray(e))return void o.consoleError("FaTreeSelect","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(l&&n.isArray(i.label))return void o.consoleError("FaTreeSelect","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");f.selectorData=[{value:e,label:i.label}]}}f.value=e},{immediate:!0}),e.onMounted(async()=>{i.defaultSelected?(await b(),f.selectorData.length>0&&(i.multiple?m([f.selectorData[0].value]):m(f.selectorData[0].value,f.selectorData[0]))):!i.requestApi&&i.data?.length>0?(f.debut=!1,await b()):i.lazy||await b(),e.watch(()=>i.initParam,(e,l)=>{n.isEqual(e,l)||(f.nextRefresh=!0,n.isNil(f.value)||m())}),e.watch(()=>i.data,async()=>{i.requestApi||await b()},{deep:!0})});const O=o.useProps(i,{...a.SelectProps,...t.treeProps},["modelValue","popperClass","loading","expandOnClickNode","filterNodeMethod"]);return o.useRender(()=>e.createVNode(l.ElTreeSelect,e.mergeProps(O.value,{ref:g,class:"fa-tree-select",popperClass:`fa-tree-select-dropdown ${i.popperClass}`,style:{width:o.addUnit(i.width)},modelValue:f.value,"onUpdate:modelValue":e=>f.value=e,loading:f.loading,data:f.selectorData,expandOnClickNode:!i.checkOnClickNode&&i.expandOnClickNode,filterNodeMethod:v,onNodeClick:C,onClear:y,onVisibleChange:N,onRemoveTag:e=>u("removeTag",e),onBlur:e=>u("blur",e),onFocus:e=>u("focus",e),onNodeContextmenu:(e,l,a,t)=>u("nodeContextmenu",e,l,a,t),onCheckChange:(e,l,a)=>u("checkChange",e,l,a),onCheck:(e,l)=>u("check",e,l),onCurrentChange:(e,l)=>u("currentChange",e,l),onNodeExpand:(e,l,a)=>u("nodeExpand",e,l,a),onNodeCollapse:(e,l,a)=>u("nodeCollapse",e,l,a),onNodeDragStart:(e,l)=>u("nodeDragStart",e,l),onNodeDragEnter:(e,l,a)=>u("nodeDragEnter",e,l,a),onNodeDragLeave:(e,l,a)=>u("nodeDragLeave",e,l,a),onNodeDragOver:(e,l,a)=>u("nodeDragOver",e,l,a),onNodeDragEnd:(e,l,a,t)=>u("nodeDragEnd",e,l,a,t),onNodeDrop:(e,l,a,t)=>u("nodeDrop",e,l,a,t)}),{...s.default&&{default:({node:e,data:l})=>s.default({node:e,data:l})},...s.header&&{header:()=>s.header()},...s.footer&&{footer:()=>s.footer()},...s.prefix&&{prefix:()=>s.prefix()},...s.empty&&{empty:()=>s.empty()},...s.tag&&{tag:()=>s.tag()},...s.loading&&{loading:()=>s.loading()},...s.label&&{label:({label:e,value:l})=>s.label({label:e,value:l})}})),o.useExpose(c,{focus:e.computed(()=>g.value?.focus),blur:e.computed(()=>g.value?.blur),selectedLabel:e.computed(()=>g.value?.selectedLabel),filter:e.computed(()=>g.value?.filter),updateKeyChildren:e.computed(()=>g.value?.updateKeyChildren),getCheckedNodes:e.computed(()=>g.value?.getCheckedNodes),setCheckedNodes:e.computed(()=>g.value?.setCheckedNodes),getCheckedKeys:e.computed(()=>g.value?.getCheckedKeys),setCheckedKeys:e.computed(()=>g.value?.setCheckedKeys),setChecked:e.computed(()=>g.value?.setChecked),getHalfCheckedNodes:e.computed(()=>g.value?.getHalfCheckedNodes),getHalfCheckedKeys:e.computed(()=>g.value?.getHalfCheckedKeys),getCurrentKey:e.computed(()=>g.value?.getCurrentKey),getCurrentNode:e.computed(()=>g.value?.getCurrentNode),setCurrentKey:e.computed(()=>g.value?.setCurrentKey),setCurrentNode:e.computed(()=>g.value?.setCurrentNode),getNode:e.computed(()=>g.value?.getNode),remove:e.computed(()=>g.value?.remove),append:e.computed(()=>g.value?.append),insertBefore:e.computed(()=>g.value?.insertBefore),insertAfter:e.computed(()=>g.value?.insertAfter),loading:e.computed(()=>f.loading),refresh:b,setSelection:e=>m(e),clearSelection:()=>m(null)})}});exports.default=s,exports.faTreeSelectEmits=d,exports.faTreeSelectProps=i;
//# sourceMappingURL=treeSelect.js.map
