{"version":3,"file":"upload.js","sources":["../../../../../packages/components/upload/src/upload.tsx"],"sourcesContent":["import { Fragment, computed, defineComponent, ref } from \"vue\";\nimport { ElIcon, ElUpload, uploadProps } from \"element-plus\";\nimport { UploadFilled } from \"@element-plus/icons-vue\";\nimport { definePropType, makeSlots, useExpose, useProps, useRender } from \"@fast-china/utils\";\nimport { isArray, isNull, isString } from \"lodash-unified\";\nimport { useUpload } from \"./useUpload\";\nimport type { UploadFile, UploadInstance, UploadProps, UploadUserFile } from \"element-plus\";\nimport type { VNode } from \"vue\";\n\nexport const faUploadProps = {\n\t...uploadProps,\n\t/** @description whether to activate drag and drop mode */\n\tdrag: {\n\t\ttype: Boolean,\n\t\tdefault: true,\n\t},\n\t/** @description maximum number of uploads allowed */\n\tlimit: {\n\t\ttype: Number,\n\t\tdefault: 1,\n\t},\n\t/** @description v-model绑定值 */\n\tmodelValue: definePropType<string | string[]>([String, Array]),\n\t/** @description 大小限制，单位kb */\n\tmaxSize: {\n\t\ttype: definePropType<string | number>([String, Number]),\n\t\tdefault: 5120,\n\t},\n\t/** @description 图片上传接口，优先级最高 */\n\tuploadApi: {\n\t\ttype: definePropType<(formData: FormData) => Promise<string>>(Function),\n\t},\n\t/** @description 图片上传地址 */\n\tuploadUrl: String,\n};\n\nexport const faUploadEmits = {\n\t/** @description v-model 回调 */\n\t\"update:modelValue\": (value: string | string[]): boolean => isString(value) || isArray(value) || isNull(value),\n\t/** @description v-model:fileList 回调 */\n\t\"update:fileList\": (value: UploadUserFile[]): boolean => isArray(value),\n\t/** @description 改变 */\n\tchange: (value: string | string[]): boolean => isString(value) || isArray(value) || isNull(value),\n};\n\ntype FaUploadSlots = {\n\t/** @description 默认内容插槽 */\n\tdefault: never;\n\t/** @description 触发文件选择框的内容 */\n\ttrigger: never;\n\t/** @description 提示说明文字 */\n\ttip: never;\n\t/** @description 缩略图模板的内容 */\n\tfile: { file: UploadFile; index: number };\n};\n\nexport default defineComponent({\n\tname: \"FaUpload\",\n\tprops: faUploadProps,\n\temits: faUploadEmits,\n\tslots: makeSlots<FaUploadSlots>(),\n\tsetup(props, { attrs, slots, emit, expose }) {\n\t\tconst { fileList, loading, formContext, maxSizeMB, handleHttpRequest, handleOnSuccess, handleOnError, handleOnExceed, handleOnUpload } =\n\t\t\tuseUpload(\"FaUpload\", \"文件\", props, emit, {\n\t\t\t\tmaxSize: props.maxSize,\n\t\t\t\tuploadApi: props.uploadApi,\n\t\t\t\tuploadUrl: props.uploadUrl,\n\t\t\t});\n\n\t\tconst disabled = computed(() => {\n\t\t\treturn props.disabled || formContext?.disabled;\n\t\t});\n\n\t\tconst uploadRef = ref<UploadInstance>();\n\n\t\tconst handleOnChange: UploadProps[\"onChange\"] = (uploadFile, uploadFiles) => {\n\t\t\tif (uploadFile.status !== \"ready\") return;\n\n\t\t\tif (!handleOnUpload(uploadFile)) {\n\t\t\t\tfileList.value = fileList.value.slice(0, -1);\n\t\t\t} else {\n\t\t\t\tprops.onChange && props.onChange(uploadFile, uploadFiles);\n\t\t\t}\n\t\t};\n\n\t\tconst elUploadProps = useProps(props, uploadProps, [\"fileList\", \"disabled\", \"httpRequest\", \"onExceed\", \"onSuccess\", \"onError\", \"onChange\"]);\n\n\t\tuseRender(() => (\n\t\t\t<ElUpload\n\t\t\t\t{...elUploadProps.value}\n\t\t\t\tref={uploadRef}\n\t\t\t\tclass=\"fa-upload\"\n\t\t\t\tvLoading={loading.value}\n\t\t\t\tvModel:fileList={fileList.value}\n\t\t\t\tdisabled={disabled.value}\n\t\t\t\thttpRequest={handleHttpRequest}\n\t\t\t\tonExceed={handleOnExceed}\n\t\t\t\tonSuccess={handleOnSuccess}\n\t\t\t\tonError={handleOnError}\n\t\t\t\tonChange={handleOnChange}\n\t\t\t>\n\t\t\t\t{{\n\t\t\t\t\tdefault: () =>\n\t\t\t\t\t\tslots.default ? (\n\t\t\t\t\t\t\tslots.default()\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t<ElIcon class=\"el-icon--upload\">\n\t\t\t\t\t\t\t\t\t<UploadFilled />\n\t\t\t\t\t\t\t\t</ElIcon>\n\t\t\t\t\t\t\t\t<div class=\"el-upload__text\">\n\t\t\t\t\t\t\t\t\tDrop file here or <em>click to upload</em>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t),\n\t\t\t\t\t...(slots.trigger && { trigger: (): VNode | VNode[] => slots.trigger() }),\n\t\t\t\t\ttip: () =>\n\t\t\t\t\t\tslots.tip ? (\n\t\t\t\t\t\t\tslots.tip()\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t<div class=\"el-upload__tip\">files with a size less than {maxSizeMB.toString()}MB</div>\n\t\t\t\t\t\t\t\t{!props.showFileList && fileList.value.length > 0 && (\n\t\t\t\t\t\t\t\t\t<div class=\"el-upload__tip\">\n\t\t\t\t\t\t\t\t\t\t{fileList.value.map((item, index) => (\n\t\t\t\t\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t\t\t\t\t{item.name}\n\t\t\t\t\t\t\t\t\t\t\t\t{fileList.value.length <= index && <br />}\n\t\t\t\t\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t),\n\t\t\t\t\t...(slots.file && {\n\t\t\t\t\t\tfile: ({ file, index }: { file: UploadFile; index: number }): VNode | VNode[] => slots.file({ file, index }),\n\t\t\t\t\t}),\n\t\t\t\t}}\n\t\t\t</ElUpload>\n\t\t));\n\n\t\treturn useExpose(expose, {\n\t\t\t/** @description 取消上传请求 */\n\t\t\tabort: computed(() => uploadRef.value?.abort),\n\t\t\t/** @description 手动上传文件列表 */\n\t\t\tsubmit: computed(() => uploadRef.value?.submit),\n\t\t\t/** @description 清空已上传的文件列表（该方法不支持在 before-upload 中调用） */\n\t\t\tclearFiles: computed(() => uploadRef.value?.clearFiles),\n\t\t\t/** @description 手动选择文件 */\n\t\t\thandleStart: computed(() => uploadRef.value?.handleStart),\n\t\t\t/** @description 手动移除文件。 file 和rawFile 已被合并。 rawFile 将在 v2.2.0 中移除 */\n\t\t\thandleRemove: computed(() => uploadRef.value?.handleRemove),\n\t\t\t/** @description 加载状态 */\n\t\t\tloading,\n\t\t\t/** @description 文件集合 */\n\t\t\tfileList,\n\t\t});\n\t},\n});\n"],"names":["faUploadProps","uploadProps","drag","type","Boolean","default","limit","Number","modelValue","definePropType","String","Array","maxSize","uploadApi","Function","uploadUrl","faUploadEmits","value","isString","isArray","isNull","change","Upload","name","props","emits","slots","makeSlots","setup","attrs","emit","expose","fileList","loading","formContext","maxSizeMB","handleHttpRequest","handleOnSuccess","handleOnError","handleOnExceed","handleOnUpload","useUpload","disabled","computed","uploadRef","ref","handleOnChange","uploadFile","uploadFiles","status","onChange","slice","elUploadProps","useProps","useRender","_withDirectives","_createVNode","ElUpload","_mergeProps","class","$event","httpRequest","onExceed","onSuccess","onError","_Fragment","ElIcon","UploadFilled","_createTextVNode","trigger","tip","toString","showFileList","length","map","item","index","file","_resolveDirective","useExpose","abort","submit","clearFiles","handleStart","handleRemove"],"mappings":"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"}