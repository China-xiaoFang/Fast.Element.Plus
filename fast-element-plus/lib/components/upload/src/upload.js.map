{"version":3,"file":"upload.js","sources":["../../../../../packages/components/upload/src/upload.tsx"],"sourcesContent":["import type { VNode } from \"vue\";\nimport { Fragment, computed, defineComponent, ref } from \"vue\";\nimport { UploadFilled } from \"@element-plus/icons-vue\";\nimport { FastApp } from \"@fast-element-plus/settings\";\nimport { definePropType, makeSlots, useExpose, useProps, useRender } from \"@fast-element-plus/utils\";\nimport type { UploadFile, UploadInstance, UploadProps, UploadUserFile } from \"element-plus\";\nimport { ElIcon, ElUpload, uploadProps } from \"element-plus\";\nimport { isArray, isString } from \"lodash-unified\";\nimport { useUpload } from \"./useUpload\";\n\nexport const faUploadProps = {\n\t...uploadProps,\n\t/** @description whether to activate drag and drop mode */\n\tdrag: {\n\t\ttype: Boolean,\n\t\tdefault: true,\n\t},\n\t/** @description maximum number of uploads allowed */\n\tlimit: {\n\t\ttype: Number,\n\t\tdefault: 1,\n\t},\n\t/** @description v-model绑定值 */\n\tmodelValue: definePropType<string | string[]>([String, Array]),\n\t/** @description 大小限制，单位kb */\n\tmaxSize: {\n\t\ttype: definePropType<string | number>([String, Number]),\n\t\tdefault: 5120,\n\t},\n\t/** @description 图片上传地址 */\n\tuploadUrl: {\n\t\ttype: String,\n\t\tdefault: (): string => FastApp.state.upload.url,\n\t},\n\t/** @description 文件类型 */\n\tfileType: Number,\n};\n\nexport const faUploadEmits = {\n\t/** @description v-model 回调 */\n\t\"update:modelValue\": (value: string | string[]): boolean => isString(value) || isArray(value),\n\t/** @description v-model:fileList 回调 */\n\t\"update:fileList\": (value: UploadUserFile[]): boolean => isArray(value),\n\t/** @description 改变 */\n\tchange: (value: string | string[]): boolean => isString(value) || isArray(value),\n};\n\ntype FaUploadSlots = {\n\t/** @description 默认内容插槽 */\n\tdefault: never;\n\t/** @description 触发文件选择框的内容 */\n\ttrigger: never;\n\t/** @description 提示说明文字 */\n\ttip: never;\n\t/** @description 缩略图模板的内容 */\n\tfile: { file: UploadFile; index: number };\n};\n\nexport default defineComponent({\n\tname: \"FaUpload\",\n\tprops: faUploadProps,\n\temits: faUploadEmits,\n\tslots: makeSlots<FaUploadSlots>(),\n\tsetup(props, { attrs, slots, emit, expose }) {\n\t\tconst { fileList, loading, formContext, maxSizeMB, handleHttpRequest, handleOnSuccess, handleOnError, handleOnExceed, handleOnUpload } =\n\t\t\tuseUpload(\"FaUpload\", \"文件\", props, emit, {\n\t\t\t\tmaxSize: props.maxSize,\n\t\t\t\tuploadUrl: props.uploadUrl,\n\t\t\t});\n\n\t\tconst disabled = computed(() => {\n\t\t\treturn props.disabled || formContext?.disabled;\n\t\t});\n\n\t\tconst uploadRef = ref<UploadInstance>();\n\n\t\tconst handleOnChange: UploadProps[\"onChange\"] = (uploadFile, uploadFiles) => {\n\t\t\tif (uploadFile.status !== \"ready\") return;\n\n\t\t\tif (!handleOnUpload(uploadFile)) {\n\t\t\t\tfileList.value = fileList.value.slice(0, -1);\n\t\t\t} else {\n\t\t\t\tprops.onChange && props.onChange(uploadFile, uploadFiles);\n\t\t\t}\n\t\t};\n\n\t\tconst elUploadProps = useProps(props, uploadProps, [\"fileList\", \"disabled\", \"httpRequest\", \"onExceed\", \"onSuccess\", \"onError\", \"onChange\"]);\n\n\t\tuseRender(() => (\n\t\t\t<ElUpload\n\t\t\t\t{...elUploadProps.value}\n\t\t\t\tref={uploadRef}\n\t\t\t\tclass=\"fa-upload\"\n\t\t\t\tvLoading={loading.value}\n\t\t\t\tvModel:fileList={fileList.value}\n\t\t\t\tdisabled={disabled.value}\n\t\t\t\thttpRequest={handleHttpRequest}\n\t\t\t\tonExceed={handleOnExceed}\n\t\t\t\tonSuccess={handleOnSuccess}\n\t\t\t\tonError={handleOnError}\n\t\t\t\tonChange={handleOnChange}\n\t\t\t>\n\t\t\t\t{{\n\t\t\t\t\tdefault: () =>\n\t\t\t\t\t\tslots.default ? (\n\t\t\t\t\t\t\tslots.default()\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t<ElIcon class=\"el-icon--upload\">\n\t\t\t\t\t\t\t\t\t<UploadFilled />\n\t\t\t\t\t\t\t\t</ElIcon>\n\t\t\t\t\t\t\t\t<div class=\"el-upload__text\">\n\t\t\t\t\t\t\t\t\tDrop file here or <em>click to upload</em>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t),\n\t\t\t\t\t...(slots.trigger && { trigger: (): VNode | VNode[] => slots.trigger() }),\n\t\t\t\t\ttip: () =>\n\t\t\t\t\t\tslots.tip ? (\n\t\t\t\t\t\t\tslots.tip()\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t<div class=\"el-upload__tip\">files with a size less than {maxSizeMB.toString()}MB</div>\n\t\t\t\t\t\t\t\t{!props.showFileList && fileList.value.length > 0 && (\n\t\t\t\t\t\t\t\t\t<div class=\"el-upload__tip\">\n\t\t\t\t\t\t\t\t\t\t{fileList.value.map((item, index) => (\n\t\t\t\t\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t\t\t\t\t{item.name}\n\t\t\t\t\t\t\t\t\t\t\t\t{fileList.value.length <= index && <br />}\n\t\t\t\t\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t),\n\t\t\t\t\t...(slots.file && {\n\t\t\t\t\t\tfile: ({ file, index }: { file: UploadFile; index: number }): VNode | VNode[] => slots.file({ file, index }),\n\t\t\t\t\t}),\n\t\t\t\t}}\n\t\t\t</ElUpload>\n\t\t));\n\n\t\treturn useExpose(expose, {\n\t\t\t...computed(() => ({\n\t\t\t\t/** @description cancel upload request */\n\t\t\t\tabort: uploadRef.value?.abort,\n\t\t\t\t/** @description upload the file list manually */\n\t\t\t\tsubmit: uploadRef.value?.submit,\n\t\t\t\t/** @description clear the file list  */\n\t\t\t\tclearFiles: uploadRef.value?.clearFiles,\n\t\t\t\t/** @description select the file manually */\n\t\t\t\thandleStart: uploadRef.value?.handleStart,\n\t\t\t\t/** @description remove the file manually */\n\t\t\t\thandleRemove: uploadRef.value?.handleRemove,\n\t\t\t})).value,\n\t\t\t/** @description 加载状态 */\n\t\t\tloading,\n\t\t\t/** @description 文件集合 */\n\t\t\tfileList,\n\t\t});\n\t},\n});\n"],"names":["faUploadProps","uploadProps","drag","type","Boolean","default","limit","Number","modelValue","definePropType","String","Array","maxSize","uploadUrl","FastApp","state","upload","url","fileType","faUploadEmits","isString","value","isArray","change","defineComponent","name","props","emits","slots","makeSlots","setup","attrs","emit","expose","fileList","loading","formContext","maxSizeMB","handleHttpRequest","handleOnSuccess","handleOnError","handleOnExceed","handleOnUpload","useUpload","disabled","computed","uploadRef","ref","handleOnChange","uploadFile","uploadFiles","status","onChange","slice","elUploadProps","useProps","useExpose","useRender","_withDirectives","_createVNode","createVNode","ElUpload","_mergeProps","mergeProps","class","$event","httpRequest","onExceed","onSuccess","onError","_Fragment","ElIcon","UploadFilled","_createTextVNode","createTextVNode","trigger","tip","toString","showFileList","length","map","item","index","file","_resolveDirective","abort","submit","clearFiles","handleStart","handleRemove"],"mappings":"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"}