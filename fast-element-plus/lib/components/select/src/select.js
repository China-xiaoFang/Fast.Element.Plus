"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),l=require("element-plus"),a=require("@element-plus/icons-vue"),t=require("@fast-china/utils"),o=require("@vueuse/core"),r=require("lodash-unified"),i=require("./selectOption.js"),n={name:String,id:String,modelValue:{type:[Array,String,Number,Boolean,Object],default:void 0},autocomplete:{type:String,default:"off"},automaticDropdown:Boolean,size:l.useSizeProp,effect:{type:t.definePropType(String),default:"light"},disabled:Boolean,clearable:Boolean,filterable:Boolean,allowCreate:Boolean,loading:Boolean,popperClass:{type:String,default:""},popperOptions:{type:t.definePropType(Object),default:()=>({})},remote:Boolean,loadingText:String,noMatchText:String,noDataText:String,remoteMethod:Function,filterMethod:Function,multiple:Boolean,multipleLimit:{type:Number,default:0},placeholder:{type:String},defaultFirstOption:Boolean,reserveKeyword:{type:Boolean,default:!0},valueKey:{type:String,default:"value"},collapseTags:Boolean,collapseTagsTooltip:Boolean,maxCollapseTags:{type:Number,default:1},teleported:l.useTooltipContentProps.teleported,persistent:{type:Boolean,default:!0},clearIcon:{type:t.definePropType([String,Object,Function]),default:a.CircleClose},fitInputWidth:Boolean,suffixIcon:{type:t.definePropType([String,Object,Function]),default:a.ArrowDown},tagType:{...l.tagProps.type,default:"info"},tagEffect:{...l.tagProps.effect,default:"light"},validateEvent:{type:Boolean,default:!0},remoteShowSuffix:Boolean,placement:{type:t.definePropType(String),default:"bottom-start"},fallbackPlacements:{type:t.definePropType(Array),default:["bottom-start","top-start","right","left"]},...l.useEmptyValuesProps,...l.useAriaProps(["ariaLabel"])},u={...n,disabled:{type:Boolean,default:void 0},loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},modelValue:{type:t.definePropType([String,Number,Boolean,Object,Array]),default:void 0},label:t.definePropType([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,lazy:{type:Boolean,default:!0},defaultSelected:Boolean,props:{type:t.definePropType(Object),default:()=>({label:"label",hide:"hide",disabled:"disabled",children:"children"})},data:{type:t.definePropType(Array),default:()=>[]},requestApi:{type:t.definePropType(Function)},initParam:t.definePropType([String,Number,Object])},d={...l.selectEmits,"update:modelValue":e=>r.isString(e)||r.isNumber(e)||r.isBoolean(e)||r.isObject(e)||r.isArray(e)||r.isNull(e),"update:label":e=>r.isString(e)||r.isArray(e)||r.isNull(e),dataChangeCallBack:e=>r.isArray(e),change:(e,l)=>!0},s=e.defineComponent({name:"FaSelect",props:u,emits:d,slots:t.makeSlots(),setup(a,{attrs:u,slots:d,emit:s,expose:p}){const c=o.useVModel(a,"label",s),f=l.useGlobalSize(),m=e.reactive({value:t.withDefineType(),loading:!1,selectorData:t.withDefineType([]),debut:!0,echo:!(a.data?.length>0),nextRefresh:!1}),y=e.ref(),g=e=>e?.map(e=>({...e,value:e[a.valueKey],label:r.isFunction(a.props.label)?a.props.label(e):e[a.props.label??"label"],hide:r.isFunction(a.props.hide)?a.props.hide(e):e[a.props.hide??"hide"],disabled:r.isFunction(a.props.disabled)?a.props.disabled(e):e[a.props.disabled??"disabled"],children:r.isFunction(a.props.children)?g(a.props.children(e)):g(e[a.props.children??"children"])})).filter(e=>!e.hide),b=async()=>{if(a.requestApi){m.loading=!0;const l=a.initParam??{};try{const e=await a.requestApi(l);m.echo=!1,m.selectorData=g(e),s("dataChangeCallBack",m.selectorData)}catch(e){t.consoleError("FaSelect",e),m.selectorData=[]}finally{m.loading=!1}}else m.echo=!1,m.selectorData=g(a.data)},h=e=>{if(a.multiple){const l=e;if(0===l?.length)return m.value=null,c.value=null,s("update:modelValue",null),void s("change",null,null);const a=m.selectorData.filter(e=>l.includes(e.value));m.value=e,c.value=a.map(e=>e.label),s("update:modelValue",e),s("change",a,e)}else{if(r.isNil(e))return m.value=null,c.value=null,s("update:modelValue",null),void s("change",null,null);const l=m.selectorData.find(l=>l.value===e);m.value=e,c.value=l.label,s("update:modelValue",e),s("change",l,e)}},v=()=>{m.value=null,c.value=null,s("update:modelValue",null),s("clear")},S=async e=>{e&&(m.debut?(m.debut=!1,!a.defaultSelected&&a.lazy&&await b()):m.nextRefresh&&(m.nextRefresh=!1,await b())),s("visible-change",e)};e.watch(()=>a.modelValue,e=>{if(m.echo&&!r.isNil(e)){const l=!r.isNil(a.label);if(a.multiple){if(!r.isArray(e))return void t.consoleError("FaSelect","当启用 multiple 时，传入的 modelValue 必须是Array。");if(l&&!r.isArray(a.label))return void t.consoleError("FaSelect","当启用 multiple 时，传入的 modelValue:label 必须是Array。");m.selectorData=e.slice(0,a.multipleLimit>0?a.multipleLimit:e.length).map((e,t)=>({value:e,label:l?a.label[t]:void 0}))}else{if(r.isArray(e))return void t.consoleError("FaSelect","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(l&&r.isArray(a.label))return void t.consoleError("FaSelect","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");m.selectorData=[{value:e,label:a.label}]}}m.value=e},{immediate:!0}),e.onMounted(async()=>{a.defaultSelected?(await b(),m.selectorData.length>0&&h(a.multiple?[m.selectorData[0].value]:m.selectorData[0].value)):!a.requestApi&&a.data?.length>0?(m.debut=!1,await b()):a.lazy||await b(),e.watch(()=>a.initParam,(e,l)=>{r.isEqual(e,l)||(m.nextRefresh=!0,r.isNil(m.value)||h())}),e.watch(()=>a.data,async()=>{a.requestApi||await b()},{deep:!0})});const T=t.useProps(a,n,["modelValue","popperClass","loading"]),B=t.useEmits(l.selectEmits,s,["update:modelValue","change","clear","visible-change"]),P=e.computed(()=>{let e=`fa-select-dropdown ${a.popperClass}`;return a.moreDetail&&(e+=` fa-select-dropdown__more-detail fa-select-dropdown__more-detail-${f.value}`),e});return t.useRender(()=>e.createVNode(l.ElSelect,e.mergeProps(T.value,B.value,{ref:y,class:"fa-select",popperClass:P.value,style:{width:t.addUnit(a.width)},modelValue:m.value,"onUpdate:modelValue":e=>m.value=e,loading:m.loading,onChange:h,onClear:v,onVisibleChange:S}),{default:()=>m.selectorData.map(l=>e.createVNode(i.default,{data:l,moreDetail:a.moreDetail},{default:d.default})),...d.header&&{header:()=>d.header()},...d.footer&&{footer:()=>d.footer()},...d.prefix&&{prefix:()=>d.prefix()},...d.empty&&{empty:()=>d.empty()},...d.tag&&{tag:()=>d.tag()},...d.loading&&{loading:()=>d.loading()},...d.label&&{label:({label:e,value:l})=>d.label({label:e,value:l})}})),t.useExpose(p,{focus:e.computed(()=>y.value?.focus),blur:e.computed(()=>y.value?.blur),selectedLabel:e.computed(()=>y.value?.selectedLabel),loading:e.computed(()=>m.loading),refresh:b,setSelection:e=>h(e),clearSelection:()=>h(null)})}});exports.SelectProps=n,exports.default=s,exports.faSelectEmits=d,exports.faSelectProps=u;
//# sourceMappingURL=select.js.map
