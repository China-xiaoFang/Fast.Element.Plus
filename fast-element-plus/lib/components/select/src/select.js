"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),l=require("element-plus"),a=require("@element-plus/icons-vue"),t=require("@fast-china/utils"),o=require("@vueuse/core"),r=require("lodash-unified"),i=require("./selectOption.js"),n={name:String,id:String,modelValue:{type:[Array,String,Number,Boolean,Object],default:void 0},autocomplete:{type:String,default:"off"},automaticDropdown:Boolean,size:l.useSizeProp,effect:{type:t.definePropType(String),default:"light"},disabled:Boolean,clearable:Boolean,filterable:Boolean,allowCreate:Boolean,loading:Boolean,popperClass:{type:String,default:""},popperOptions:{type:t.definePropType(Object),default:()=>({})},remote:Boolean,loadingText:String,noMatchText:String,noDataText:String,remoteMethod:Function,filterMethod:Function,multiple:Boolean,multipleLimit:{type:Number,default:0},placeholder:{type:String},defaultFirstOption:Boolean,reserveKeyword:{type:Boolean,default:!0},valueKey:{type:String,default:"value"},collapseTags:Boolean,collapseTagsTooltip:Boolean,maxCollapseTags:{type:Number,default:1},teleported:l.useTooltipContentProps.teleported,persistent:{type:Boolean,default:!0},clearIcon:{type:t.definePropType([String,Object,Function]),default:a.CircleClose},fitInputWidth:Boolean,suffixIcon:{type:t.definePropType([String,Object,Function]),default:a.ArrowDown},tagType:{...l.tagProps.type,default:"info"},tagEffect:{...l.tagProps.effect,default:"light"},validateEvent:{type:Boolean,default:!0},remoteShowSuffix:Boolean,placement:{type:t.definePropType(String),default:"bottom-start"},fallbackPlacements:{type:t.definePropType(Array),default:["bottom-start","top-start","right","left"]},...l.useEmptyValuesProps,...l.useAriaProps(["ariaLabel"])},s={...n,loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},modelValue:{type:t.definePropType([String,Number,Boolean,Object,Array]),default:void 0},label:t.definePropType([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,lazy:{type:Boolean,default:!0},defaultSelected:Boolean,props:{type:t.definePropType(Object),default:()=>({label:"label",hide:"hide",disabled:"disabled",children:"children"})},data:{type:t.definePropType(Array),default:()=>[]},requestApi:{type:t.definePropType(Function)},initParam:t.definePropType([String,Number,Object])},u={"update:modelValue":e=>r.isString(e)||r.isNumber(e)||r.isBoolean(e)||r.isObject(e)||r.isArray(e)||r.isNull(e),"update:label":e=>r.isString(e)||r.isArray(e)||r.isNull(e),dataChangeCallBack:e=>r.isArray(e),change:(e,l)=>(r.isObject(e)||r.isArray(e)||r.isNull(e))&&(r.isString(l)||r.isNumber(l)||r.isBoolean(l)||r.isObject(l)||r.isArray(l)||r.isNull(l)),visibleChange:e=>r.isBoolean(e),removeTag:e=>r.isString(e)||r.isNumber(e)||r.isBoolean(e)||r.isObject(e)||r.isArray(e),clear:()=>!0,blur:e=>e instanceof FocusEvent,focus:e=>e instanceof FocusEvent},p=e.defineComponent({name:"FaSelect",props:s,emits:u,slots:t.makeSlots(),setup(a,{attrs:s,slots:u,emit:p,expose:d}){const c=o.useVModel(a,"label",p,{passive:!0}),f=e.reactive({value:t.withDefineType(),loading:!1,selectorData:t.withDefineType([]),debut:!0,echo:!(a.data?.length>0),nextRefresh:!1}),m=e.ref(),y=e=>e?.map(e=>({...e,value:e[a.valueKey],label:r.isFunction(a.props.label)?a.props.label(e):e[a.props.label??"label"],hide:r.isFunction(a.props.hide)?a.props.hide(e):e[a.props.hide??"hide"],disabled:r.isFunction(a.props.disabled)?a.props.disabled(e):e[a.props.disabled??"disabled"],children:r.isFunction(a.props.children)?y(a.props.children(e)):y(e[a.props.children??"children"])})).filter(e=>!e.hide),g=async()=>{if(a.requestApi){f.loading=!0;const l=a.initParam??{};try{const e=await a.requestApi(l);f.echo=!1,f.selectorData=y(e),p("dataChangeCallBack",f.selectorData)}catch(e){t.consoleError("FaSelect",e),f.selectorData=[]}finally{f.loading=!1}}else f.echo=!1,f.selectorData=y(a.data)},b=e=>{if(a.multiple){const l=e;if(0===l?.length)return f.value=null,c.value=null,p("update:modelValue",null),void p("change",null,null);const a=f.selectorData.filter(e=>l.includes(e.value));f.value=e,c.value=a.map(e=>e.label),p("update:modelValue",e),p("change",a,e)}else{if(r.isNil(e))return f.value=null,c.value=null,p("update:modelValue",null),void p("change",null,null);const l=f.selectorData.find(l=>l.value===e);f.value=e,c.value=l.label,p("update:modelValue",e),p("change",l,e)}},h=()=>{f.value=null,c.value=null,p("clear")},v=async e=>{e&&(f.debut?(f.debut=!1,!a.defaultSelected&&a.lazy&&await g()):f.nextRefresh&&(f.nextRefresh=!1,await g())),p("visibleChange",e)};e.watch(()=>a.modelValue,e=>{if(f.echo&&!r.isNil(e)){const l=!r.isNil(a.label);if(a.multiple){if(!r.isArray(e))return void t.consoleError("FaSelect","当启用 multiple 时，传入的 modelValue 必须是Array。");if(l&&!r.isArray(a.label))return void t.consoleError("FaSelect","当启用 multiple 时，传入的 modelValue:label 必须是Array。");f.selectorData=e.slice(0,a.multipleLimit>0?a.multipleLimit:e.length).map((e,t)=>({value:e,label:l?a.label[t]:void 0}))}else{if(r.isArray(e))return void t.consoleError("FaSelect","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(l&&r.isArray(a.label))return void t.consoleError("FaSelect","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");f.selectorData=[{value:e,label:a.label}]}}f.value=e},{immediate:!0}),e.onMounted(async()=>{a.defaultSelected?(await g(),f.selectorData.length>0&&b(a.multiple?[f.selectorData[0].value]:f.selectorData[0].value)):!a.requestApi&&a.data?.length>0?(f.debut=!1,await g()):a.lazy||await g(),e.watch(()=>a.initParam,(e,l)=>{r.isEqual(e,l)||(f.nextRefresh=!0,r.isNil(f.value)||b())}),e.watch(()=>a.data,async()=>{a.requestApi||await g()},{deep:!0})});const S=t.useProps(a,n,["modelValue","popperClass","loading"]);return t.useRender(()=>e.createVNode(l.ElSelect,e.mergeProps(S.value,{ref:m,class:"fa-select",popperClass:`fa-select-dropdown ${a.popperClass}`,style:{width:t.addUnit(a.width)},modelValue:f.value,"onUpdate:modelValue":e=>f.value=e,loading:f.loading,onChange:b,onClear:h,onVisibleChange:v,onRemoveTag:e=>p("removeTag",e),onBlur:e=>p("blur",e),onFocus:e=>p("focus",e)}),{default:()=>f.selectorData.map(l=>e.createVNode(i.default,{data:l,moreDetail:a.moreDetail},{default:u.default})),...u.header&&{header:()=>u.header()},...u.footer&&{footer:()=>u.footer()},...u.prefix&&{prefix:()=>u.prefix()},...u.empty&&{empty:()=>u.empty()},...u.tag&&{tag:()=>u.tag()},...u.loading&&{loading:()=>u.loading()},...u.label&&{label:({label:e,value:l})=>u.label({label:e,value:l})}})),t.useExpose(d,{focus:e.computed(()=>m.value?.focus),blur:e.computed(()=>m.value?.blur),selectedLabel:e.computed(()=>m.value?.selectedLabel),loading:e.computed(()=>f.loading),refresh:g,setSelection:e=>b(e),clearSelection:()=>b(null)})}});exports.SelectProps=n,exports.default=p,exports.faSelectEmits=u,exports.faSelectProps=s;
//# sourceMappingURL=select.js.map
