"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),l=require("element-plus"),a=require("@element-plus/icons-vue"),t=require("../../select/index.js"),o=require("@fast-china/utils"),i=require("@vueuse/core"),r=require("lodash-unified"),s=require("../../select/src/select.js"),n={...s.SelectProps,loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},modelValue:{type:o.definePropType([String,Number,Boolean,Object,Array]),default:void 0},label:o.definePropType([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,props:{type:o.definePropType(Object),default:()=>({label:"label",hide:"hide",disabled:"disabled",children:"children"})},requestApi:{type:o.definePropType(Function)},initParam:o.definePropType([String,Number,Object])},u={"update:modelValue":e=>r.isString(e)||r.isNumber(e)||r.isBoolean(e)||r.isObject(e)||r.isArray(e)||r.isNull(e),"update:label":e=>r.isString(e)||r.isArray(e)||r.isNull(e),dataChangeCallBack:e=>r.isArray(e),change:(e,l)=>(r.isObject(e)||r.isArray(e)||r.isNull(e))&&(r.isString(l)||r.isNumber(l)||r.isBoolean(l)||r.isObject(l)||r.isArray(l)||r.isNull(l)),visibleChange:e=>r.isBoolean(e),removeTag:e=>r.isString(e)||r.isNumber(e)||r.isBoolean(e)||r.isObject(e)||r.isArray(e),clear:()=>!0,blur:e=>e instanceof FocusEvent,focus:e=>e instanceof FocusEvent},d=e.defineComponent({name:"FaSelectPage",props:n,emits:u,slots:o.makeSlots(),setup(n,{attrs:u,slots:d,emit:c,expose:p}){const g=i.useVModel(n,"label",c,{passive:!0}),f=l.useGlobalSize(),b=e.reactive({value:o.withDefineType(),loading:!1,selectorData:o.withDefineType([]),selectedList:o.withDefineType([]),debut:!0,echo:!0,nextRefresh:!1,pageIndex:1,pageSize:15,totalRows:0,searchValue:void 0,defaultSelectorData:o.withDefineType()}),m=e.ref(),v=e=>null==e?void 0:e.map(e=>({...e,value:e[n.valueKey],label:r.isFunction(n.props.label)?n.props.label(e):e[n.props.label??"label"],hide:r.isFunction(n.props.hide)?n.props.hide(e):e[n.props.hide??"hide"],disabled:r.isFunction(n.props.disabled)?n.props.disabled(e):e[n.props.disabled??"disabled"],children:r.isFunction(n.props.children)?v(n.props.children(e)):v(e[n.props.children??"children"])})).filter(e=>!e.hide),h=async e=>{b.loading=!0,b.pageIndex=e??b.pageIndex;const l={...n.initParam??{},pageIndex:b.pageIndex,pageSize:b.pageSize,searchValue:b.searchValue};try{const e=await n.requestApi(l);b.echo=!1,b.totalRows=e.totalRows,b.selectorData=v(e.rows),c("dataChangeCallBack",b.selectorData)}catch(a){o.consoleError("FaSelectPage",a),b.pageIndex=1,b.totalRows=0,b.selectorData=[]}finally{b.loading=!1}},y=e=>{if(n.multiple){const l=e;if(0===(null==l?void 0:l.length))return b.value=null,g.value=null,b.selectedList=[],c("update:modelValue",null),void c("change",null,null);const a=b.selectorData.filter(e=>l.includes(e.value));b.value=e,g.value=a.map(e=>e.label),b.selectedList=[...b.selectedList.filter(e=>!a.some(l=>l.value===e.value)),...a].filter(e=>l.includes(e.value)),c("update:modelValue",e),c("change",a,e)}else{if(r.isNil(e))return b.value=null,g.value=null,b.selectedList=[],c("update:modelValue",null),void c("change",null,null);const l=b.selectorData.find(l=>l.value===e);b.value=e,g.value=l.label,b.selectedList.some(l=>l.value===e)||(b.selectedList=[l]),c("update:modelValue",e),c("change",l,e)}},S=()=>{b.value=null,g.value=null,b.selectedList=[],c("clear")},V=async e=>{e&&(b.debut?(b.debut=!1,await h()):b.nextRefresh&&(b.nextRefresh=!1,await h())),c("visibleChange",e)};e.watch(()=>n.modelValue,e=>{if(b.echo&&!r.isNil(e)){const l=!r.isNil(n.label);if(n.multiple){if(!r.isArray(e))return void o.consoleError("FaSelectPage","当启用 multiple 时，传入的 modelValue 必须是Array。");if(l&&!r.isArray(n.label))return void o.consoleError("FaSelectPage","当启用 multiple 时，传入的 modelValue:label 必须是Array。");b.selectedList=e.slice(0,n.multipleLimit>0?n.multipleLimit:e.length).map((e,a)=>({value:e,label:l?n.label[a]:void 0}))}else{if(r.isArray(e))return void o.consoleError("FaSelectPage","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(l&&r.isArray(n.label))return void o.consoleError("FaSelectPage","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");b.defaultSelectorData={value:e,label:n.label}}}b.value=e},{immediate:!0}),e.onMounted(()=>{e.watch(()=>n.initParam,(e,l)=>{r.isEqual(e,l)||(b.nextRefresh=!0,r.isNil(b.value)||y())})});const x=o.useProps(n,s.SelectProps,["modelValue","popperClass","loading"]);return o.useRender(()=>e.createVNode(l.ElSelect,e.mergeProps(x.value,{ref:m,class:"fa-select-page",popperClass:`fa-select-page-dropdown fa-select-page-dropdown-${f.value} ${n.popperClass}`,style:{width:o.addUnit(n.width)},modelValue:b.value,"onUpdate:modelValue":e=>b.value=e,loading:b.loading,onChange:y,onClear:S,onVisibleChange:V,onRemoveTag:e=>c("removeTag",e),onBlur:e=>c("blur",e),onFocus:e=>c("focus",e)}),{default:()=>b.selectorData.map(l=>e.createVNode(t.FaSelectOption,{data:l,moreDetail:n.moreDetail},{default:d.default})),header:()=>e.createVNode(e.Fragment,null,[b.defaultSelectorData&&e.createVNode(l.ElOption,{class:"fa-select-page-dropdown__default-selector",value:b.defaultSelectorData.value,label:b.defaultSelectorData.label,disabled:!0},{default:()=>[e.createVNode("span",null,[b.defaultSelectorData.label]),e.createVNode("span",null,[e.createTextVNode("Default")])]}),e.createVNode(l.ElInput,{class:"fa-select-page-dropdown__search-input",clearable:!0,placeholder:"请输入关键字搜索",modelValue:b.searchValue,modelModifiers:{trim:!0},"onUpdate:modelValue":e=>b.searchValue=e,onKeyup:e=>{"Enter"===e.key&&h(1)}},{append:()=>e.createVNode(l.ElButton,{loading:b.loading,icon:a.Search,onClick:()=>h(1)},null)}),d.header&&d.header()]),footer:()=>e.createVNode(e.Fragment,null,[e.createVNode(l.ElPagination,{class:"fa-select-page-dropdown__pagination",size:"small",currentPage:b.pageIndex,pageSize:b.pageSize,total:b.totalRows,layout:"prev, pager, next, total",pagerCount:5,onCurrentChange:h},null),d.footer&&d.footer()]),...d.prefix&&{prefix:()=>d.prefix()},...d.empty&&{empty:()=>d.empty()},...d.tag&&{tag:()=>d.tag()},...d.loading&&{loading:()=>d.loading()},...n.multiple?{label:({label:l,value:a})=>{const t=b.selectedList.find(e=>e.value===a);return d.label?d.label({label:null==t?void 0:t.label,value:r.isNil(t)?a:null==t?void 0:t.value}):t&&e.createVNode("span",{class:"el-select__tags-text"},[t.label])}}:d.label&&{label:({label:e,value:l})=>d.label({label:e,value:l})}})),o.useExpose(p,{focus:e.computed(()=>{var e;return null==(e=m.value)?void 0:e.focus}),blur:e.computed(()=>{var e;return null==(e=m.value)?void 0:e.blur}),selectedLabel:e.computed(()=>{var e;return null==(e=m.value)?void 0:e.selectedLabel}),loading:e.computed(()=>b.loading),selectedList:e.computed(()=>b.selectedList),refresh:h,setSelection:e=>y(e),clearSelection:()=>y(null)})}});exports.default=d,exports.faSelectPageEmits=u,exports.faSelectPageProps=n;
//# sourceMappingURL=selectPage.js.map
