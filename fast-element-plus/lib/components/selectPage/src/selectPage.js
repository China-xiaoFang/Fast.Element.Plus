"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),l=require("element-plus"),a=require("@element-plus/icons-vue"),t=require("../../select/index.js"),o=require("@fast-china/utils"),r=require("@vueuse/core"),i=require("lodash-unified"),s=require("../../select/src/select.js"),d={...s.SelectProps,disabled:{type:Boolean,default:void 0},loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},modelValue:{type:o.definePropType([String,Number,Boolean,Object,Array]),default:void 0},label:o.definePropType([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,props:{type:o.definePropType(Object),default:()=>({label:"label",hide:"hide",disabled:"disabled",children:"children"})},requestApi:{type:o.definePropType(Function)},initParam:o.definePropType([String,Number,Object])},u={...l.selectEmits,"update:modelValue":e=>i.isString(e)||i.isNumber(e)||i.isBoolean(e)||i.isObject(e)||i.isArray(e)||i.isNull(e),"update:label":e=>i.isString(e)||i.isArray(e)||i.isNull(e),dataChangeCallBack:e=>i.isArray(e),change:(e,l)=>!0},n=e.defineComponent({name:"FaSelectPage",props:d,emits:u,slots:o.makeSlots(),setup(d,{attrs:u,slots:n,emit:c,expose:p}){const g=r.useVModel(d,"label",c),f=l.useGlobalSize(),m=e.reactive({value:o.withDefineType(),loading:!1,selectorData:o.withDefineType([]),selectedList:o.withDefineType([]),debut:!0,echo:!0,nextRefresh:!1,pageIndex:1,pageSize:15,totalRows:0,searchValue:void 0,defaultSelectorData:o.withDefineType()}),b=e.ref(),h=e=>e?.map(e=>({...e,value:e[d.valueKey],label:i.isFunction(d.props.label)?d.props.label(e):e[d.props.label??"label"],hide:i.isFunction(d.props.hide)?d.props.hide(e):e[d.props.hide??"hide"],disabled:i.isFunction(d.props.disabled)?d.props.disabled(e):e[d.props.disabled??"disabled"],children:i.isFunction(d.props.children)?h(d.props.children(e)):h(e[d.props.children??"children"])})).filter(e=>!e.hide),v=async e=>{m.loading=!0,m.pageIndex=e??m.pageIndex;const l={...d.initParam??{},pageIndex:m.pageIndex,pageSize:m.pageSize,searchValue:m.searchValue};try{const e=await d.requestApi(l);m.echo=!1,m.totalRows=e.totalRows,m.selectorData=h(e.rows),c("dataChangeCallBack",m.selectorData)}catch(a){o.consoleError("FaSelectPage",a),m.pageIndex=1,m.totalRows=0,m.selectorData=[]}finally{m.loading=!1}},y=e=>{if(d.multiple){const l=e;if(0===l?.length)return m.value=null,g.value=null,m.selectedList=[],c("update:modelValue",null),void c("change",null,null);const a=m.selectorData.filter(e=>l.includes(e.value));m.value=e,g.value=a.map(e=>e.label),m.selectedList=[...m.selectedList.filter(e=>!a.some(l=>l.value===e.value)),...a].filter(e=>l.includes(e.value)),c("update:modelValue",e),c("change",a,e)}else{if(i.isNil(e))return m.value=null,g.value=null,m.selectedList=[],c("update:modelValue",null),void c("change",null,null);const l=m.selectorData.find(l=>l.value===e);m.value=e,g.value=l.label,m.selectedList.some(l=>l.value===e)||(m.selectedList=[l]),c("update:modelValue",e),c("change",l,e)}},S=()=>{m.value=null,g.value=null,m.selectedList=[],c("update:modelValue",null),c("clear")},V=async e=>{e&&(m.debut?(m.debut=!1,await v()):m.nextRefresh&&(m.nextRefresh=!1,await v())),c("visible-change",e)};e.watch(()=>d.modelValue,e=>{if(m.echo&&!i.isNil(e)){const l=!i.isNil(d.label);if(d.multiple){if(!i.isArray(e))return void o.consoleError("FaSelectPage","当启用 multiple 时，传入的 modelValue 必须是Array。");if(l&&!i.isArray(d.label))return void o.consoleError("FaSelectPage","当启用 multiple 时，传入的 modelValue:label 必须是Array。");m.selectedList=e.slice(0,d.multipleLimit>0?d.multipleLimit:e.length).map((e,a)=>({value:e,label:l?d.label[a]:void 0}))}else{if(i.isArray(e))return void o.consoleError("FaSelectPage","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(l&&i.isArray(d.label))return void o.consoleError("FaSelectPage","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");m.defaultSelectorData={value:e,label:d.label}}}m.value=e},{immediate:!0}),e.onMounted(()=>{e.watch(()=>d.initParam,(e,l)=>{i.isEqual(e,l)||(m.nextRefresh=!0,i.isNil(m.value)||y())})});const x=o.useProps(d,s.SelectProps,["modelValue","popperClass","loading"]),w=o.useEmits(l.selectEmits,c,["update:modelValue","change","clear","visible-change"]),P=e.computed(()=>{let e=`fa-select-page-dropdown fa-select-page-dropdown-${f.value} ${d.popperClass}`;return d.moreDetail&&(e+=` fa-select-dropdown__more-detail fa-select-dropdown__more-detail-${f.value}`),e});return o.useRender(()=>e.createVNode(l.ElSelect,e.mergeProps(x.value,w.value,{ref:b,class:"fa-select-page",popperClass:P.value,style:{width:o.addUnit(d.width)},modelValue:m.value,"onUpdate:modelValue":e=>m.value=e,loading:m.loading,onChange:y,onClear:S,onVisibleChange:V}),{default:()=>m.selectorData.map(l=>e.createVNode(t.FaSelectOption,{data:l,moreDetail:d.moreDetail},{default:n.default})),header:()=>e.createVNode(e.Fragment,null,[m.defaultSelectorData&&e.createVNode(l.ElOption,{class:"fa-select-page-dropdown__default-selector",value:m.defaultSelectorData.value,label:m.defaultSelectorData.label,disabled:!0},{default:()=>[e.createVNode("span",null,[m.defaultSelectorData.label]),e.createVNode("span",null,[e.createTextVNode("Default")])]}),e.createVNode(l.ElInput,{class:"fa-select-page-dropdown__search-input",clearable:!0,placeholder:"请输入关键字搜索",modelValue:m.searchValue,modelModifiers:{trim:!0},"onUpdate:modelValue":e=>m.searchValue=e,onKeyup:e=>{"Enter"===e.key&&v(1)}},{append:()=>e.createVNode(l.ElButton,{loading:m.loading,icon:a.Search,onClick:()=>v(1)},null)}),n.header&&n.header()]),footer:()=>e.createVNode(e.Fragment,null,[e.createVNode(l.ElPagination,{class:"fa-select-page-dropdown__pagination",size:"small",currentPage:m.pageIndex,pageSize:m.pageSize,total:m.totalRows,layout:"prev, pager, next, total",pagerCount:5,onCurrentChange:v},null),n.footer&&n.footer()]),...n.prefix&&{prefix:()=>n.prefix()},...n.empty&&{empty:()=>n.empty()},...n.tag&&{tag:()=>n.tag()},...n.loading&&{loading:()=>n.loading()},...d.multiple?{label:({label:l,value:a})=>{const t=m.selectedList.find(e=>e.value===a);return n.label?n.label({label:t?.label,value:i.isNil(t)?a:t?.value}):t&&e.createVNode("span",{class:"el-select__tags-text"},[t.label])}}:n.label&&{label:({label:e,value:l})=>n.label({label:e,value:l})}})),o.useExpose(p,{focus:e.computed(()=>b.value?.focus),blur:e.computed(()=>b.value?.blur),selectedLabel:e.computed(()=>b.value?.selectedLabel),loading:e.computed(()=>m.loading),selectedList:e.computed(()=>m.selectedList),refresh:v,setSelection:e=>y(e),clearSelection:()=>y(null)})}});exports.default=n,exports.faSelectPageEmits=u,exports.faSelectPageProps=d;
//# sourceMappingURL=selectPage.js.map
