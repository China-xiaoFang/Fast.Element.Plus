"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),t=require("element-plus"),a=require("@element-plus/icons-vue"),l=require("@fast-element-plus/icons-vue"),n=require("@fast-china/utils"),o=require("lodash-unified"),r=require("./table.type.js"),i=require("./tableColumn.js"),s=require("./tableColumnSettingDialog.js"),c=require("./tablePagination.js"),d=require("./tableSearchForm.js"),u=require("./useTable.js");const m={data:{type:Array,default:()=>[]},size:t.useSizeProp,width:[String,Number],height:[String,Number],maxHeight:[String,Number],fit:{type:Boolean,default:!0},stripe:Boolean,border:Boolean,rowKey:[String,Function],showHeader:{type:Boolean,default:!0},showSummary:Boolean,sumText:String,summaryMethod:Function,rowClassName:[String,Function],rowStyle:[Object,Function],cellClassName:[String,Function],cellStyle:[Object,Function],headerRowClassName:[String,Function],headerRowStyle:[Object,Function],headerCellClassName:[String,Function],headerCellStyle:[Object,Function],highlightCurrentRow:Boolean,currentRowKey:[String,Number],emptyText:String,expandRowKeys:Array,defaultExpandAll:Boolean,defaultSort:Object,tooltipEffect:String,tooltipOptions:Object,spanMethod:Function,selectOnIndeterminate:{type:Boolean,default:!0},indent:{type:Number,default:16},treeProps:{type:Object,default:()=>({hasChildren:"hasChildren",children:"children",checkStrictly:!1})},lazy:Boolean,load:Function,style:{type:Object,default:()=>({})},className:{type:String,default:""},tableLayout:{type:String,default:"fixed"},scrollbarAlwaysOn:Boolean,flexible:Boolean,showOverflowTooltip:[Boolean,Object],scrollbarTabindex:{type:[Number,String],default:void 0}},p={...m,border:{type:Boolean,default:!0},highlightCurrentRow:{type:Boolean,default:!0},rowKey:{type:[String,Function],default:"id"},spanMethod:{type:Function,validator:()=>(n.consoleWarn("FaTable","'spanMethod' 属性，组件已经封装，外部使用会失效。"),!1)},tableKey:{type:String,default:()=>n.stringUtil.generateRandomString(8)},data:{type:n.definePropType(Array),default:()=>[]},requestApi:{type:n.definePropType(Function)},dataCallback:{type:n.definePropType(Function)},initParam:n.definePropType([String,Number,Object]),columns:{type:n.definePropType([Array,Boolean]),default:()=>[]},columnsChange:{type:n.definePropType(Function)},showSearch:Boolean,searchFormCols:{type:n.definePropType([String,Number,Object]),default:()=>({xs:3,sm:3,md:4,lg:5,xl:6})},searchForm:{type:Boolean,default:!0},headerCard:{type:Boolean,default:!0},refreshBtn:{type:Boolean,default:!0},searchBtn:{type:Boolean,default:!0},columnSettingBtn:{type:Boolean,default:!0},toolBtn:{type:Boolean,default:!0},hideSearchTime:Boolean,dataSearchRange:{type:n.definePropType(String),default:"Past3D"},pagination:{type:Boolean,default:!0},hideImage:Boolean,single:Boolean,rowClickSelection:Boolean,treeData:Boolean,props:{type:n.definePropType(Object),default:()=>({span:void 0,children:"children"})},autoRefresh:{type:Boolean,default:!0},rowSelectable:Function},h={select:(e,t)=>o.isArray(e)&&o.isObject(t),selectAll:e=>o.isArray(e),selectionChange:e=>o.isArray(e),cellMouseEnter:(e,t,a,l)=>o.isObject(e)&&o.isObject(t)&&a instanceof HTMLTableCellElement&&l instanceof Event,cellMouseLeave:(e,t,a,l)=>o.isObject(e)&&o.isObject(t)&&a instanceof HTMLTableCellElement&&l instanceof Event,cellClick:(e,t,a,l)=>o.isObject(e)&&o.isObject(t)&&a instanceof HTMLTableCellElement&&l instanceof Event,cellDblclick:(e,t,a,l)=>o.isObject(e)&&o.isObject(t)&&a instanceof HTMLTableCellElement&&l instanceof Event,cellContextmenu:(e,t,a,l)=>o.isObject(e)&&o.isObject(t)&&a instanceof HTMLTableCellElement&&l instanceof Event,rowClick:(e,t,a)=>o.isObject(e)&&o.isObject(t)&&a instanceof Event,rowContextmenu:(e,t,a)=>o.isObject(e)&&o.isObject(t)&&a instanceof Event,rowDblclick:(e,t,a)=>o.isObject(e)&&o.isObject(t)&&a instanceof Event,headerClick:(e,t)=>o.isObject(e)&&t instanceof Event,headerContextmenu:(e,t)=>o.isObject(e)&&t instanceof Event,sortChange:e=>o.isObject(e),filterChange:e=>o.isString(e)||o.isNumber(e)||o.isBoolean(e)||o.isObject(e),currentChange:(e,t)=>o.isObject(e)&&(o.isNull(t)||o.isObject(t)),headerDragend:(e,t,a,l)=>o.isNumber(e)&&o.isNumber(t)&&o.isObject(a)&&l instanceof MouseEvent,expandChange:(e,t)=>o.isObject(e)&&(o.isBoolean(t)||o.isArray(t)),refresh:e=>o.isObject(e),reset:e=>o.isObject(e),sizeChange:e=>o.isNumber(e),paginationChange:(e,t)=>o.isNumber(e)&&o.isNumber(t),customCellClick:(e,{row:t,column:a,$index:l})=>o.isString(e)&&o.isObject(t)&&o.isObject(a)&&o.isNumber(l)},g=e.defineComponent({name:"FaTable",props:p,emits:h,slots:n.makeSlots(),setup(p,{attrs:h,slots:g,emit:b,expose:f}){const{_globalSize:v,state:C,elementRef:S,tableRef:w,handleTableColumnAutoWidth:y,loadTableColumns:_,handleSizeChange:N,handlePaginationChange:x,defaultSearchTime:P,tableSearch:O,tableReset:T,doRender:V,doLoading:j,handleCustomCellClick:E}=u.useTable(p,g,b),I=e.ref();let L=0;const B=e=>{var t;if(0===e&&(L=0),(null==(t=C.spanColumns)?void 0:t.length)>0){return 0===Number(C.tableSpanData["__table-index"][e])?L+(C.tablePagination.pageIndex-1)*C.tablePagination.pageSize+1:(L++,L+(C.tablePagination.pageIndex-1)*C.tablePagination.pageSize)}return e+(C.tablePagination.pageIndex-1)*C.tablePagination.pageSize+1},F=(e,t)=>{p.single&&(w.value.clearSelection(),e.length>0&&t&&w.value.toggleRowSelection(t)),b("select",e,t)},D=e=>{p.single&&(C.selected?C.tableData.length>0&&(w.value.clearSelection(),w.value.toggleRowSelection(C.tableData[0])):w.value.clearSelection()),b("selectAll",e)},R=e=>{0===e.length?C.selected=!1:C.selected=!0,p.single&&e.length>0?C.selectedList=[e[e.length-1]]:C.selectedList=e,C.indeterminateSelectedListIds=C.indeterminateSelectedListIds.filter(e=>C.selectedListIds.some(t=>t===e)),b("selectionChange",C.selectedList)},k=({column:e,prop:t,order:a})=>{var l,n;e.multiOrder?"descending"===e.multiOrder?e.multiOrder="ascending":e.multiOrder=null:e.multiOrder="descending",C.searchParam.sortList=[...new Set([...(null==(l=p.initParam)?void 0:l.sortList)??[],...(null==(n=C.searchParam)?void 0:n.sortList)??[]])];const o=C.orgColumns.find(e=>e.prop===t),r=o.sortableField??o.prop??o.property,i=C.searchParam.sortList.findIndex(e=>e.enField===r);e.multiOrder?-1===i?C.searchParam.sortList.push({enField:r,cnField:o.label,mode:e.multiOrder}):C.searchParam.sortList[i].mode=e.multiOrder:C.searchParam.sortList.splice(i,1),0===C.searchParam.sortList.length&&delete C.searchParam.sortList,b("sortChange",{column:e,prop:t,order:e.multiOrder}),O()},M=(e,t)=>{e&&(p.rowClickSelection&&(p.single&&t&&w.value.toggleRowSelection(t),w.value.toggleRowSelection(e)),b("currentChange",e,t))},A=({row:e,column:t,rowIndex:a,columnIndex:l})=>{let n=null;if("selection"===t.type){const t=o.isFunction(p.rowKey)?p.rowKey(e):e[p.rowKey];C.indeterminateSelectedListIds.some(e=>e===t)&&(n="fa-table__selection-column__indeterminate")}const r=C.tableColumns.find(e=>e.prop===t.property);if((null==r?void 0:r.dataDeleteField)&&e&&!0===e[r.dataDeleteField]&&(n?n+=" fa-table__data-delete-column":n="fa-table__data-delete-column"),"submitInfo"===(null==r?void 0:r.type)&&(n?n+=" fa-table__line-height-normal-column":n="fa-table__line-height-normal-column"),"date"!==(null==r?void 0:r.type)&&"time"!==(null==r?void 0:r.type)&&"dateTime"!==(null==r?void 0:r.type)||(null==r?void 0:r.dateFix)&&(n?n+=" fa-table__line-height-normal-column":n="fa-table__line-height-normal-column"),p.cellClassName){let r=null;return r=o.isString(p.cellClassName)?p.cellClassName:p.cellClassName({row:e,column:t,rowIndex:a,columnIndex:l}),r?n?`${n} ${r}`:r:n}return n},z=({row:e,column:t,rowIndex:a,columnIndex:l})=>(t.order=t.multiOrder,p.headerCellClassName?o.isFunction(p.headerCellClassName)?p.headerCellClassName({row:e,column:t,rowIndex:a,columnIndex:l}):p.headerCellClassName:null),K=({row:e,column:t,rowIndex:a,columnIndex:l})=>{const n=t.property??t.columnKey;if(-1!==C.spanColumns.findIndex(e=>e.prop===n)){const e=Number(C.tableSpanData[n][a]);return e>0?{rowspan:e,colspan:1}:{rowspan:0,colspan:0}}return{rowspan:1,colspan:1}},H=async(e,t,a,l)=>{C.orgColumns.forEach(t=>{a.property===t.prop&&(t.width=e,t.smallWidth=e)}),b("headerDragend",e,t,a,l),await n.clickUtil.debounceAsync(I.value.change,500)},q=e=>{C.previewList=[e],C.imagePreview=!0};e.onMounted(async()=>{C.initParam=p.initParam,_(),P(),Object.keys(p.initParam??{}).forEach(e=>{C.searchParam[e]=p.initParam[e]}),await O(),e.watch(()=>p.initParam,()=>{Object.keys(p.initParam??{}).forEach(e=>{C.searchParam[e]=p.initParam[e]})},{deep:!0}),e.watch(()=>p.data,async()=>{!p.requestApi&&p.autoRefresh&&await O()},{deep:!0,immediate:!0}),e.watchEffect(async()=>{const e=S.value;if(e){const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:a}=t.contentRect;C.tableWidth=e,C.tableHeight=a}n.clickUtil.debounceAsync(async()=>{await y()},100)});return t.observe(e),()=>{t.disconnect()}}})}),e.onActivated(async()=>{await y()});const $=e.computed(()=>C.searchColumns.filter(e=>e.search.slot).map(e=>e.search.slot)),U=e.computed(()=>C.tableColumns.filter(e=>e.slot).map(e=>e.slot)),W=["multiOrder","columnID","order","sortableField","disabledSortable","spanProp","pureSearch","search"],Y=n.useProps(p,m,["data","spanMethod","headerCellClassName","cellClassName"]);return n.useRender(()=>e.createVNode("div",{ref:S,class:["fa-table",`fa-table-${v.value}`,`fa-table__${p.tableKey??"notFound"}`,{fa__click__disabled:C.loading}],style:{"--fa-table-width":""+(C.tableWidth?`${C.tableWidth}px`:""),"--fa-table-height":""+(C.tableHeight?`${C.tableHeight}px`:"")}},[e.createVNode(d.default,{show:p.searchForm&&C.showSearch,cols:p.searchFormCols,search:O,reset:T},o.pick(g,$.value)),g.topHeader&&e.createVNode("div",{class:"el-card fa-table__header"},[g.topHeader({search:O,...r.getTableDefaultSlots(C)})]),e.createVNode("div",{class:"el-card fa-table__main"},[p.headerCard&&e.createVNode("div",{class:"fa-table__main-header"},[e.createVNode("div",{class:"fa-table__main-header-left"},[g.header&&g.header({search:O,...r.getTableDefaultSlots(C)})]),e.createVNode("div",{class:"fa-table__main-header-right"},[p.toolBtn&&e.createVNode(e.Fragment,null,[e.createVNode("div",{class:"fa-table__main-header-right__div-search"},[e.createVNode(t.ElInput,{class:"fa-table__main-header-right__input-search",disabled:C.loading,prefixIcon:a.Search,placeholder:"关键字搜索",modelValue:C.searchParam.searchValue,modelModifiers:{trim:!0},"onUpdate:modelValue":e=>C.searchParam.searchValue=e,clearable:!0,onCompositionupdate:e=>{C.searchValueUpdate=e.data},onCompositionend:e=>{C.searchValueUpdate=""},onChange:()=>O()},null),e.createVNode("div",{class:"fa-table__main-header-right__div-search__hidden"},[C.searchParam.searchValue,C.searchValueUpdate])]),p.requestApi&&!p.hideSearchTime&&e.createVNode(t.ElDatePicker,{class:"fa-table__main-header-right__data-search",popperClass:"fa-table__main-header-right__data-search__popper",disabled:C.loading,type:"daterange",modelValue:C.searchParam.searchTimeList,"onUpdate:modelValue":e=>C.searchParam.searchTimeList=e,defaultTime:n.dateUtil.getDefaultTime(),shortcuts:n.dateUtil.getShortcuts(),valueFormat:"YYYY-MM-DD HH:mm:ss",disabledDate:n.dateUtil.getDisabledDate,clearable:!1,teleported:!1,unlinkPanels:!0,onChange:()=>O()},null),g.toolButton&&g.toolButton({search:O,...r.getTableDefaultSlots(C)}),p.refreshBtn&&e.createVNode(t.ElButton,{loading:C.loading,loadingIcon:a.Eleme,title:"刷新",circle:!0,icon:a.Refresh,onClick:()=>O()},null),p.searchBtn&&C.searchColumns.length>0&&e.createVNode(t.ElButton,{loading:C.loading,loadingIcon:a.Eleme,title:C.showSearch?"隐藏搜索栏":"显示搜索栏",circle:!0,icon:a.Search,onClick:()=>C.showSearch=!C.showSearch},null),p.columnSettingBtn&&!p.columns&&e.createVNode(t.ElButton,{loading:C.loading,loadingIcon:a.Eleme,title:"表格列配置",circle:!0,icon:a.Setting,onClick:()=>I.value.open()},null),g.toolButtonAdv&&e.createVNode(t.ElDropdown,{title:"高级操作",trigger:"click"},{default:()=>e.createVNode(t.ElButton,{loading:C.loading,loadingIcon:a.Eleme,circle:!0,icon:a.More},null),dropdown:()=>{let a;return e.createVNode(t.ElDropdownMenu,null,"function"==typeof(l=a=g.toolButtonAdv({search:O,...r.getTableDefaultSlots(C)}))||"[object Object]"===Object.prototype.toString.call(l)&&!e.isVNode(l)?a:{default:()=>[a]});var l}})])])]),e.withDirectives(e.createVNode(t.ElTable,e.mergeProps(Y.value,{ref:w,"element-loading-text":C.loadingText,data:C.tableData,spanMethod:K,headerCellClassName:z,cellClassName:A,onSelectionChange:R,onSortChange:k,onSelect:F,onSelectAll:D,onCurrentChange:M,onHeaderDragend:H,onCellMouseEnter:(e,t,a,l)=>b("cellMouseEnter",e,t,a,l),onCellMouseLeave:(e,t,a,l)=>b("cellMouseLeave",e,t,a,l),onCellClick:(e,t,a,l)=>b("cellClick",e,t,a,l),onCellDblclick:(e,t,a,l)=>b("cellDblclick",e,t,a,l),onCellContextmenu:(e,t,a,l)=>b("cellContextmenu",e,t,a,l),onRowClick:(e,t,a)=>b("rowClick",e,t,a),onRowContextmenu:(e,t,a)=>b("rowContextmenu",e,t,a),onRowDblclick:(e,t,a)=>b("rowDblclick",e,t,a),onHeaderClick:(e,t)=>b("headerClick",e,t),onHeaderContextmenu:(e,t)=>b("headerContextmenu",e,t),onFilterChange:e=>b("filterChange",e),onExpandChange:(e,t)=>b("expandChange",e,t)}),{append:()=>g.append&&g.append(),empty:()=>e.createVNode("div",{class:"fa-table__empty"},[g.empty?g.empty():e.createVNode(e.Fragment,null,[e.createVNode(t.ElIcon,null,{default:()=>[e.createVNode(l.NotData,null,null)]}),e.createVNode("div",null,[e.createTextVNode("暂无数据")])])]),default:()=>{var a;return e.createVNode(e.Fragment,null,[e.createVNode(t.ElTableColumn,{className:"fa-table__index-column",type:"index",fixed:"left",width:C.tablePagination.pageIndex*C.tablePagination.pageSize>=100?C.tablePagination.pageIndex*C.tablePagination.pageSize>=1e3?50:40:30,align:"center",index:B,showOverflowTooltip:!1,resizable:!1,columnKey:"__table-index"},null),e.createVNode(t.ElTableColumn,{className:"fa-table__selection-column",type:"selection",fixed:"left",width:35,align:"center",reserveSelection:!0,showOverflowTooltip:!1,resizable:!1,columnKey:"__table-selection",selectable:p.rowSelectable},null),g.operation&&e.createVNode(t.ElTableColumn,{fixed:"right",width:C.operationColumnWidth,headerAlign:"center",align:"center",showOverflowTooltip:!1,className:"fa-table__operation-column",resizable:!1,columnKey:"__table-operation"},{header:()=>e.createVNode("div",{class:"fa-table__auto-width-column__cell-header __fa-table__auto-width-column__cell-header____table-operation"},[e.createVNode("span",null,[e.createTextVNode("操作")])]),default:({row:t,column:a,$index:l})=>e.createVNode("div",{class:"fa-table__auto-width-column__cell __fa-table__auto-width-column__cell____table-operation"},[g.operation({row:t,column:a,$index:l,search:O,...r.getTableDefaultSlots(C)})])}),0===(null==(a=C.tableColumns)?void 0:a.length)?g.default&&g.default():C.tableColumns.map(a=>a.show&&("expand"===a.type?e.createVNode(t.ElTableColumn,e.mergeProps(a,{width:35,fixed:a.fixed??"left",resizable:!1}),{default:({row:t,column:l,$index:n})=>e.createVNode(e.Fragment,null,[a.render&&a.render({row:t,column:l,$index:n,...r.getTableDefaultSlots(C)}),a.slot&&g[a.slot]&&g[a.slot]({row:t,column:l,$index:n,...r.getTableDefaultSlots(C)})])}):a.prop&&e.createVNode(i.default,e.mergeProps(o.omit(a,W),{resizable:!0,onImagePreview:q,onCustomCellClick:E}),o.pick(g,U.value))))])}}),[[e.resolveDirective("loading"),C.loading]]),e.createVNode("div",{class:"fa-table__main-footer"},[e.createVNode("div",{class:"fa-table__main-footer__left"},[g.footer&&g.footer({search:O,...r.getTableDefaultSlots(C)})]),g.pagination?g.pagination({pageIndex:C.tablePagination.pageIndex,pageSize:C.tablePagination.pageSize,totalRows:C.tablePagination.totalRows,handleSizeChange:N,handlePaginationChange:x}):e.createVNode(e.Fragment,null,[p.pagination?e.createVNode(c.default,{sizeChange:N,currentChange:x},null):e.createVNode(t.ElPagination,{class:"fa-table-pagination",size:"small",layout:"total",total:C.tableData.length},null)])])]),C.imagePreview&&e.createVNode(t.ElImageViewer,{closeOnPressEscape:!0,hideOnClickModal:!0,teleported:!0,onClose:()=>C.imagePreview=!1,urlList:C.previewList},null),e.createVNode(s.default,{ref:I,save:p.columnsChange},null)])),n.useExpose(f,{clearSelection:e.computed(()=>{var e;return null==(e=w.value)?void 0:e.clearSelection}),getSelectionRows:e.computed(()=>{var e;return null==(e=w.value)?void 0:e.getSelectionRows}),toggleRowSelection:e.computed(()=>{var e;return null==(e=w.value)?void 0:e.toggleRowSelection}),toggleAllSelection:e.computed(()=>{var e;return null==(e=w.value)?void 0:e.toggleAllSelection}),toggleRowExpansion:e.computed(()=>{var e;return null==(e=w.value)?void 0:e.toggleRowExpansion}),setCurrentRow:e.computed(()=>{var e;return null==(e=w.value)?void 0:e.setCurrentRow}),clearSort:e.computed(()=>{var e;return null==(e=w.value)?void 0:e.clearSort}),clearFilter:e.computed(()=>{var e;return null==(e=w.value)?void 0:e.clearFilter}),doLayout:e.computed(()=>{var e;return null==(e=w.value)?void 0:e.doLayout}),sort:e.computed(()=>{var e;return null==(e=w.value)?void 0:e.sort}),scrollTo:e.computed(()=>{var e;return null==(e=w.value)?void 0:e.scrollTo}),setScrollTop:e.computed(()=>{var e;return null==(e=w.value)?void 0:e.setScrollTop}),setScrollLeft:e.computed(()=>{var e;return null==(e=w.value)?void 0:e.setScrollLeft}),columns:e.computed(()=>{var e;return null==(e=w.value)?void 0:e.columns}),updateKeyChildren:e.computed(()=>{var e;return null==(e=w.value)?void 0:e.updateKeyChildren}),loading:e.computed(()=>C.loading),tableData:e.computed(()=>C.tableData),tablePagination:e.computed(()=>C.tablePagination),searchParam:e.computed(()=>C.searchParam),selected:e.computed(()=>C.selected),selectedList:e.computed(()=>C.selectedList),selectedListIds:e.computed(()=>C.selectedListIds),indeterminateSelectedListIds:e.computed(()=>C.indeterminateSelectedListIds),tableWidth:e.computed(()=>C.tableWidth),tableHeight:e.computed(()=>C.tableHeight),toggleRowIndeterminateSelection:(e,t)=>{const a=o.isFunction(p.rowKey)?p.rowKey(e):e[p.rowKey],l=C.tableData.find(e=>o.isFunction(p.rowKey)?p.rowKey(e):e[p.rowKey]===a);if(!0===t)C.indeterminateSelectedListIds.some(e=>e===a)||C.indeterminateSelectedListIds.push(a),w.value.toggleRowSelection(l,!0);else if(!1===t){const e=C.indeterminateSelectedListIds.findIndex(e=>e===a);e>=0&&C.indeterminateSelectedListIds.splice(e,1),w.value.toggleRowSelection(l,!1)}else{const e=C.indeterminateSelectedListIds.findIndex(e=>e===a);e>=0?C.indeterminateSelectedListIds.splice(e,1):C.indeterminateSelectedListIds.push(a),w.value.toggleRowSelection(l)}},refresh:O,reset:T,doRender:V,doLoading:j})}});exports.default=g,exports.faTableEmits=h,exports.faTableProps=p,exports.tableProps=m;
//# sourceMappingURL=table.js.map
