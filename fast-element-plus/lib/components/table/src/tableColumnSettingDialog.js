"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),l=require("element-plus"),a=require("../../dialog/index.js"),o=require("@fast-china/utils"),t=require("sortablejs"),d=require("./useTable.js"),r=e.defineComponent({name:"FaTableColumnsSettingDialog",props:{change:{type:o.definePropType(Function)}},setup(r,{expose:n}){const i=e.inject(d.tableStateKey),u=e.reactive({tableKey:o.stringUtil.generateRandomString(8),sortableInstance:void 0,change:!1}),c=e.ref(),s=e=>e+1,m=async()=>{r.change&&(u.change?(await r.change(i.orgColumns.map(e=>{var l,a;return{columnID:e.columnID,label:e.label,fixed:e.fixed,width:e.width,smallWidth:e.smallWidth,order:e.order,sortable:e.sortable,copy:e.copy,autoWidth:e.autoWidth,show:e.show,search:{label:null==(l=e.search)?void 0:l.label,order:null==(a=e.search)?void 0:a.order}}})),l.ElMessage.success("保存列配置成功")):l.ElMessage.info("列配置未发生变化"))},p=()=>{c.value.close(async()=>{await m()})},h=()=>{u.change=!0;let e=i.orgColumns.filter(e=>!(null==e?void 0:e.pureSearch));e=e.sort((l,a)=>l.order!==a.order?l.order-a.order:e.indexOf(a)-e.indexOf(l)),i.orgColumns=[...e,...i.orgColumns.filter(e=>null==e?void 0:e.pureSearch)],i.orgColumns.forEach((e,l)=>{e.order=l+1})},b=()=>{u.change=!0},V=(e,l=!1)=>{const a={modelValue:void 0,disabled:!1,placeholder:void 0};if(null==e?void 0:e.type)switch(null==e?void 0:e.type){case"expand":a.disabled=!0,a.placeholder="暂不支持宽度配置";break;case"image":a.disabled=!0,a.placeholder="图片列无需配置";break;case"date":case"time":case"dateTime":a.disabled=!0,a.placeholder="时间/日期列无需配置";break;case"submitInfo":a.disabled=!0,a.placeholder="当前列无需配置"}else(null==e?void 0:e.tag)?(a.disabled=!0,a.placeholder="标签列无需配置"):(null==e?void 0:e.autoWidth)&&(a.disabled=!0,a.placeholder="自动列宽无需配置");return a.disabled||(delete a.disabled,delete a.modelValue,delete a.placeholder),l&&delete a.placeholder,a},g=(e,l=!1,a=!1,o=!1)=>{const t={modelValue:void 0,disabled:!1,placeholder:void 0};return(null==e?void 0:e.pureSearch)&&(t.disabled=!0,t.placeholder="搜索列无需配置"),t.disabled?o&&delete t.modelValue:(delete t.disabled,delete t.modelValue,delete t.placeholder),l&&delete t.placeholder,a&&(t.placeholder="999"),t};return o.useRender(()=>e.createVNode(a.FaDialog,{ref:c,class:"fa-table__column-setting-dialog",onConfirmClick:p,showFullscreen:!1,confirmButtonText:u.change?"保存更改":"确认",fillHeight:!0},{header:()=>e.createVNode(e.Fragment,null,[e.createTextVNode("列表配置（留空则恢复默认配置）"),e.createVNode(e.resolveComponent("el-text"),{type:"info"},{default:()=>[e.createTextVNode("点击保存才会进行数据缓存，点击取消为本此生效")]})]),default:()=>e.createVNode(l.ElTable,{class:["fa-table__column-setting",`fa-table__column-setting-${u.tableKey}`],data:i.orgColumns,rowKey:"prop",border:!0},{default:()=>e.createVNode(e.Fragment,null,[e.createVNode(l.ElTableColumn,{type:"index",fixed:"left",align:"center",width:45,index:s},null),e.createVNode(l.ElTableColumn,{label:"列显示名称",minWidth:200},{default:({row:a})=>"image"===a.type?e.createVNode(l.ElInput,{disabled:!0,readonly:!0,modelValue:a.label,"onUpdate:modelValue":e=>a.label=e,placeholder:"请输入列显示名称",onChange:b},null):e.createVNode(l.ElInput,e.mergeProps({modelValue:a.label,"onUpdate:modelValue":e=>a.label=e,placeholder:"请输入列显示名称"},g(a),{onChange:b}),null)}),e.createVNode(l.ElTableColumn,{label:"固定",width:230},{default:({row:a})=>e.createVNode(l.ElRadioGroup,e.mergeProps({modelValue:a.fixed,"onUpdate:modelValue":e=>a.fixed=e},g(a,!1,!1,!0),{onChange:b}),{default:()=>[e.createVNode(l.ElRadio,{value:!1},{default:()=>[e.createTextVNode("无")]}),e.createVNode(l.ElRadio,{value:"left"},{default:()=>[e.createTextVNode("左侧")]}),e.createVNode(l.ElRadio,{value:"right"},{default:()=>[e.createTextVNode("右侧")]})]})}),e.createVNode(l.ElTableColumn,{label:"宽度",width:200},{default:({row:a})=>e.createVNode(l.ElInputNumber,e.mergeProps({modelValue:a.width,"onUpdate:modelValue":e=>a.width=e,min:1,max:999,stepStrictly:!0,controls:!1,clearable:!0,placeholder:"请输入宽度"},V(a),g(a),{onChange:b}),null)}),e.createVNode(l.ElTableColumn,{label:"小的宽度",width:200},{default:({row:a})=>e.createVNode(l.ElInputNumber,e.mergeProps({modelValue:a.smallWidth,"onUpdate:modelValue":e=>a.smallWidth=e,min:1,max:999,stepStrictly:!0,controls:!1,clearable:!0,placeholder:"请输入小的宽度"},V(a),g(a),{onChange:b}),null)}),e.createVNode(l.ElTableColumn,{label:"顺序",width:100},{default:({row:a})=>e.createVNode(l.ElInputNumber,e.mergeProps({modelValue:a.order,"onUpdate:modelValue":e=>a.order=e,min:1,max:999,stepStrictly:!0,controls:!1,clearable:!0,placeholder:"请输入顺序"},g(a,!1,!0),{onChange:h}),null)}),e.createVNode(l.ElTableColumn,{label:"排序",width:65},{default:({row:a})=>e.createVNode(l.ElSwitch,e.mergeProps({modelValue:a.sortable,"onUpdate:modelValue":e=>a.sortable=e,inlinePrompt:!0,activeText:"是",inactiveText:"否",disabled:a.disabledSortable||"image"===(null==a?void 0:a.type)},g(a,!0),{onChange:b}),null)}),e.createVNode(l.ElTableColumn,{label:"复制",width:65},{default:({row:a})=>e.createVNode(l.ElSwitch,e.mergeProps({modelValue:a.copy,"onUpdate:modelValue":e=>a.copy=e,inlinePrompt:!0,activeText:"是",inactiveText:"否",disabled:!!(null==a?void 0:a.type)||!!(null==a?void 0:a.slot)},g(a,!0),{onChange:b}),null)}),e.createVNode(l.ElTableColumn,{label:"自动宽度",width:85},{default:({row:a})=>e.createVNode(l.ElSwitch,e.mergeProps({modelValue:a.autoWidth,"onUpdate:modelValue":e=>a.autoWidth=e,inlinePrompt:!0,activeText:"是",inactiveText:"否",disabled:!!(null==a?void 0:a.type)},g(a,!0),{onChange:b}),null)}),e.createVNode(l.ElTableColumn,{label:"显示",width:75},{default:({row:a})=>e.createVNode(l.ElSwitch,{modelValue:a.show,"onUpdate:modelValue":e=>a.show=e,inlinePrompt:!0,activeText:"显示",inactiveText:"隐藏",onChange:b},null)}),e.createVNode(l.ElTableColumn,{label:"搜索框名称",minWidth:200},{default:({row:a})=>a.search?e.createVNode(l.ElInput,{modelValue:a.search.label,"onUpdate:modelValue":e=>a.search.label=e,placeholder:"请输入搜索框名称",onChange:b},null):e.createVNode(l.ElInput,{disabled:!0,placeholder:"当前列暂无搜索项配置"},null)}),e.createVNode(l.ElTableColumn,{label:"搜索框顺序",width:200},{default:({row:a})=>a.search?e.createVNode(l.ElInputNumber,{modelValue:a.search.order,"onUpdate:modelValue":e=>a.search.order=e,min:1,max:999,stepStrictly:!0,controls:!1,clearable:!0,placeholder:"请输入搜索框顺序",onChange:b},null):e.createVNode(l.ElInputNumber,{disabled:!0,min:1,max:999,stepStrictly:!0,controls:!1,clearable:!0,placeholder:"当前列暂无搜索项配置"},null)})])})})),o.useExpose(n,{open:()=>{c.value.open(()=>{(()=>{const e=document.querySelector(`.fa-table__column-setting-${u.tableKey} .el-table__body-wrapper tbody`);u.sortableInstance&&u.sortableInstance.destroy(),u.sortableInstance=new t(e,{animation:150,delay:0,onEnd(e){const{newIndex:l,oldIndex:a}=e;if(l!==a){u.change=!0;const e=i.orgColumns.splice(a,1)[0];i.orgColumns.splice(l,0,e),i.orgColumns=i.orgColumns.map((e,l)=>({...e,order:l+1}))}}})})(),l.ElNotification({message:"点击保存才会进行数据缓存，点击取消为本此生效",type:"info"})})},change:m})}});exports.default=r;
//# sourceMappingURL=tableColumnSettingDialog.js.map
