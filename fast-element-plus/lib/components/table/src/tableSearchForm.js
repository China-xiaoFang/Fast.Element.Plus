"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),l=require("element-plus"),a=require("@element-plus/icons-vue"),o=require("../../drawer/index.js"),r=require("../../layoutGrid/index.js"),t=require("@fast-element-plus/icons-vue"),s=require("@fast-china/utils"),c=require("./table.type.js"),n=require("./tableSearchFormItem.js"),d=require("./useTable.js");const i=e.defineComponent({name:"FaTableSearchForm",props:{show:{type:Boolean,required:!0},collapsedSearch:{type:Boolean,required:!0},advancedSearchDrawer:{type:Boolean,required:!0},cols:{type:s.definePropType([String,Number,Object]),default:()=>({xs:2,sm:3,md:4,lg:5,xl:6})},search:{type:s.definePropType(Function),required:!0},reset:{type:s.definePropType(Function),required:!0}},slots:s.makeSlots(),setup(i,{slots:u,expose:h}){const m=l.useGlobalSize(),f=e.ref(),p=e.inject(d.tableStateKey),v=e.computed(()=>{var e;return null==(e=f.value)?void 0:e.breakPoint}),b=e.reactive({refreshing:!1,height:"auto",collapsed:!0,showCollapsed:e.computed(()=>{let e=!1;return p.searchColumns.reduce((l,a)=>{var o,r,t,s;return l+=((null==(o=a.search[v.value])?void 0:o.span)??(null==(r=a.search)?void 0:r.span)??1)+((null==(t=a.search[v.value])?void 0:t.offset)??(null==(s=a.search)?void 0:s.offset)??0),"number"!=typeof i.cols?l>=i.cols[v.value]&&(e=!0):l>=i.cols&&(e=!0),l},0),e}),searchColumns:s.withDefineType([]),advancedSearchColumns:s.withDefineType([]),breakPoint:void 0}),g=e.ref(),y=e.ref(),C=e=>({span:null==e?void 0:e.span,offset:(null==e?void 0:e.offset)??0,xs:null==e?void 0:e.xs,sm:null==e?void 0:e.sm,md:null==e?void 0:e.md,lg:null==e?void 0:e.lg,xl:null==e?void 0:e.xl}),N=({breakPoint:e})=>{b.breakPoint=i.cols[e]-1,b.searchColumns=p.searchColumns.filter(e=>null==e?void 0:e.show).slice(0,b.breakPoint),b.advancedSearchColumns=p.searchColumns.filter(e=>null==e?void 0:e.show).slice(b.breakPoint)};e.watch(()=>p.searchColumns,()=>{b.breakPoint&&(b.searchColumns=p.searchColumns.filter(e=>null==e?void 0:e.show).slice(0,b.breakPoint),b.advancedSearchColumns=p.searchColumns.filter(e=>null==e?void 0:e.show).slice(b.breakPoint))});const V=e.computed(()=>i.advancedSearchDrawer?b.searchColumns:p.searchColumns);e.watch(()=>i.advancedSearchDrawer,e=>{b.collapsed=!!e||i.collapsedSearch,b.refreshing=!0,setTimeout(()=>{b.refreshing=!1},1)}),e.watch(()=>i.collapsedSearch,e=>{i.collapsedSearch?b.collapsed=!0:b.collapsed=e},{immediate:!0}),s.useRender(()=>{let s;return p.searchColumns.length>0&&e.createVNode("div",{ref:g,class:["el-card fa-table__search",{"fa-table__search-hidden":!i.show,"fa-table__search__disable":p.loading}]},[e.createVNode("form",{class:"el-form el-form--default el-form--label-right"},[!b.refreshing&&e.createVNode(r.FaLayoutGrid,{ref:f,collapsed:b.collapsed,gap:"small"===m.value?[20,0]:[20,10],cols:i.cols,onBreakPointChange:N},{default:()=>[V.value.map((l,a)=>{var o;return e.createVNode(r.FaLayoutGridItem,e.mergeProps({key:(null==(o=null==l?void 0:l.search)?void 0:o.key)??l.prop},C(l.search),{index:a}),{default:()=>{var a;return[e.createVNode("div",{class:"el-form-item el-form-item--default el-form-item--label-right"},[e.createVNode("label",{class:"el-form-item__label"},[l.search.label]),e.createVNode("div",{class:"el-form-item__content"},[(null==(a=l.search)?void 0:a.slot)?u[l.search.slot]&&u[l.search.slot]({column:l,search:i.search,...c.getTableDefaultSlots(p)}):e.createVNode(n.default,{column:l,search:i.search},null)])])]}})}),e.createVNode(r.FaLayoutGridItem,{suffix:!0},{default:()=>[e.createVNode("div",{class:"fa-table__search-operation"},[e.createVNode(l.ElButton,{loading:p.loading,loadingIcon:a.Eleme,title:"搜索",type:"primary",plain:!0,icon:a.Refresh,onClick:()=>i.search()},{default:()=>[e.createTextVNode("搜索")]}),e.createVNode(l.ElButton,{loading:p.loading,loadingIcon:a.Eleme,title:"重置",icon:t.Brush,onClick:()=>i.reset()},{default:()=>[e.createTextVNode("重置")]}),i.advancedSearchDrawer?b.advancedSearchColumns.length>0&&e.createVNode(l.ElButton,{loading:p.loading,loadingIcon:a.Eleme,title:"高级搜索",type:"info",plain:!0,icon:a.Search,onClick:()=>y.value.open()},{default:()=>[e.createTextVNode("高级搜索")]}):b.showCollapsed&&e.createVNode(l.ElButton,{loading:p.loading,loadingIcon:a.Eleme,title:b.collapsed?"展开":"折叠",link:!0,type:"primary",onClick:()=>{b.collapsed=!b.collapsed}},{default:()=>[b.collapsed?"展开":"折叠",e.createVNode(l.ElIcon,null,{default:()=>[b.collapsed?e.createVNode(a.ArrowDown,null,null):e.createVNode(a.ArrowUp,null,null)]})]})])]})]})]),i.advancedSearchDrawer&&b.advancedSearchColumns.length>0&&e.createVNode(o.FaDrawer,{ref:y,class:"fa-table__search-advanced",size:"20%",title:"高级搜索",appendToBody:!1,showCloseButton:!1,showConfirmButton:!1,showFullscreen:!1,showRefresh:!1,onConfirmClick:()=>i.search()},{default:()=>{return[e.createVNode("form",{class:"el-form el-form--default el-form--label-top"},[e.createVNode(r.FaLayoutGrid,{gap:[20,0],cols:{xs:2,sm:3,md:4,lg:5,xl:6}},(l=s=b.advancedSearchColumns.map((l,a)=>{var o;return e.createVNode(r.FaLayoutGridItem,e.mergeProps({key:l.prop??(null==(o=null==l?void 0:l.search)?void 0:o.key)},C(l.search),{index:a}),{default:()=>[e.createVNode("div",{class:"el-form-item el-form-item--default el-form-item--label-top"},[e.createVNode("label",{class:"el-form-item__label"},[l.search.label]),e.createVNode("div",{class:"el-form-item__content"},[l.search.slot?u[l.search.slot]&&u[l.search.slot]({column:l,search:i.search,...c.getTableDefaultSlots(p)}):e.createVNode(n.default,{column:l,search:i.search},null)])])]})}),"function"==typeof l||"[object Object]"===Object.prototype.toString.call(l)&&!e.isVNode(l)?s:{default:()=>[s]}))])];var l}})])})}});exports.default=i;
//# sourceMappingURL=tableSearchForm.js.map
