"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),a=require("element-plus"),l=require("@element-plus/icons-vue"),r=require("../../drawer/index.js"),o=require("../../layoutGrid/index.js"),t=require("@fast-element-plus/icons-vue"),s=require("@fast-china/utils"),c=require("./table.type.js"),n=require("./tableSearchFormItem.js"),d=require("./useTable.js");const i=e.defineComponent({name:"FaTableSearchForm",props:{show:{type:Boolean,required:!0},collapsedSearch:{type:Boolean,default:!0},advancedSearchDrawer:{type:Boolean,default:!1},cols:{type:s.definePropType([String,Number,Object]),default:()=>({xs:2,sm:3,md:4,lg:5,xl:6})},search:{type:s.definePropType(Function),required:!0},reset:{type:s.definePropType(Function),required:!0}},slots:s.makeSlots(),setup(i,{slots:u,expose:h}){const m=a.useGlobalSize(),f=e.ref(),p=e.inject(d.tableStateKey),b=e.computed(()=>f.value?.breakPoint),g=e.reactive({refreshing:!1,height:"auto",collapsed:!0,showCollapsed:e.computed(()=>{let e=!1;return p.searchColumns.reduce((a,l)=>(a+=(l.search[b.value]?.span??l.search?.span??1)+(l.search[b.value]?.offset??l.search?.offset??0),"number"!=typeof i.cols?a>=i.cols[b.value]&&(e=!0):a>=i.cols&&(e=!0),a),0),e}),searchColumns:s.withDefineType([]),advancedSearchColumns:s.withDefineType([]),breakPoint:void 0}),v=e.ref(),y=e.ref(),C=e=>({span:e?.span,offset:e?.offset??0,xs:e?.xs,sm:e?.sm,md:e?.md,lg:e?.lg,xl:e?.xl}),N=({breakPoint:e})=>{g.breakPoint=i.cols[e]-1,g.searchColumns=p.searchColumns.filter(e=>e?.show).slice(0,g.breakPoint),g.advancedSearchColumns=p.searchColumns.filter(e=>e?.show).slice(g.breakPoint)};e.watch(()=>p.searchColumns,()=>{g.breakPoint&&(g.searchColumns=p.searchColumns.filter(e=>e?.show).slice(0,g.breakPoint),g.advancedSearchColumns=p.searchColumns.filter(e=>e?.show).slice(g.breakPoint))});const V=e.computed(()=>i.advancedSearchDrawer?g.searchColumns:p.searchColumns);e.watch(()=>i.advancedSearchDrawer,e=>{g.collapsed=!!e||i.collapsedSearch,g.refreshing=!0,setTimeout(()=>{g.refreshing=!1},1)}),e.watch(()=>i.collapsedSearch,e=>{i.collapsedSearch?g.collapsed=!0:g.collapsed=e},{immediate:!0}),s.useRender(()=>{let s;return p.searchColumns.length>0&&e.createVNode("div",{ref:v,class:["el-card fa-table__search",{"fa-table__search-hidden":!i.show,"fa-table__search__disable":p.loading}]},[e.createVNode("form",{class:"el-form el-form--default el-form--label-right"},[!g.refreshing&&e.createVNode(o.FaLayoutGrid,{ref:f,collapsed:g.collapsed,gap:"small"===m.value?[20,0]:[20,10],cols:i.cols,onBreakPointChange:N},{default:()=>[V.value.map((a,l)=>e.createVNode(o.FaLayoutGridItem,e.mergeProps({key:a?.search?.key??a.prop},C(a.search),{index:l}),{default:()=>[e.createVNode("div",{class:"el-form-item el-form-item--default el-form-item--label-right"},[e.createVNode("label",{class:"el-form-item__label"},[a.search.label]),e.createVNode("div",{class:"el-form-item__content"},[a.search?.slot?u[a.search.slot]&&u[a.search.slot]({column:a,search:i.search,...c.getTableDefaultSlots(p)}):e.createVNode(n.default,{column:a,search:i.search},null)])])]})),e.createVNode(o.FaLayoutGridItem,{suffix:!0},{default:()=>[e.createVNode("div",{class:"fa-table__search-operation"},[e.createVNode(a.ElButton,{loading:p.loading,loadingIcon:l.Eleme,title:"搜索",type:"primary",plain:!0,icon:l.Refresh,onClick:()=>i.search()},{default:()=>[e.createTextVNode("搜索")]}),e.createVNode(a.ElButton,{loading:p.loading,loadingIcon:l.Eleme,title:"重置",icon:t.Brush,onClick:()=>i.reset()},{default:()=>[e.createTextVNode("重置")]}),i.advancedSearchDrawer?g.advancedSearchColumns.length>0&&e.createVNode(a.ElButton,{loading:p.loading,loadingIcon:l.Eleme,title:"高级搜索",type:"info",plain:!0,icon:l.Search,onClick:()=>y.value.open()},{default:()=>[e.createTextVNode("高级搜索")]}):g.showCollapsed&&e.createVNode(a.ElButton,{loading:p.loading,loadingIcon:l.Eleme,title:g.collapsed?"展开":"折叠",link:!0,type:"primary",onClick:()=>{g.collapsed=!g.collapsed}},{default:()=>[g.collapsed?"展开":"折叠",e.createVNode(a.ElIcon,null,{default:()=>[g.collapsed?e.createVNode(l.ArrowDown,null,null):e.createVNode(l.ArrowUp,null,null)]})]})])]})]})]),i.advancedSearchDrawer&&g.advancedSearchColumns.length>0&&e.createVNode(r.FaDrawer,{ref:y,class:"fa-table__search-advanced",size:"20%",title:"高级搜索",appendToBody:!1,showCloseButton:!1,showConfirmButton:!1,showFullscreen:!1,showRefresh:!1,onConfirmClick:()=>i.search()},{default:()=>{return[e.createVNode("form",{class:"el-form el-form--default el-form--label-top"},[e.createVNode(o.FaLayoutGrid,{gap:[20,0],cols:{xs:2,sm:3,md:4,lg:5,xl:6}},(a=s=g.advancedSearchColumns.map((a,l)=>e.createVNode(o.FaLayoutGridItem,e.mergeProps({key:a.prop??a?.search?.key},C(a.search),{index:l}),{default:()=>[e.createVNode("div",{class:"el-form-item el-form-item--default el-form-item--label-top"},[e.createVNode("label",{class:"el-form-item__label"},[a.search.label]),e.createVNode("div",{class:"el-form-item__content"},[a.search.slot?u[a.search.slot]&&u[a.search.slot]({column:a,search:i.search,...c.getTableDefaultSlots(p)}):e.createVNode(n.default,{column:a,search:i.search},null)])])]})),"function"==typeof a||"[object Object]"===Object.prototype.toString.call(a)&&!e.isVNode(a)?s:{default:()=>[s]}))])];var a}})])})}});exports.default=i;
//# sourceMappingURL=tableSearchForm.js.map
