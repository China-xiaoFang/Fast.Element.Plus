"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),t=require("element-plus"),l=require("@element-plus/icons-vue"),r=require("../../image/index.js"),a=require("@fast-china/utils"),o=require("lodash-unified"),n=require("../images/artwork.png.js"),i=require("../images/notImage.png.js"),d=require("../utils/table.js"),s=require("./table.type.js"),u=require("./useTable.js");function c(t){return"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!e.isVNode(t)}const m={type:{type:String,default:"default"},label:String,className:String,labelClassName:String,property:String,prop:String,width:{type:[String,Number],default:""},minWidth:{type:[String,Number],default:""},renderHeader:Function,sortable:{type:[Boolean,String],default:!1},sortMethod:Function,sortBy:[String,Function,Array],resizable:{type:Boolean,default:!0},columnKey:String,align:String,headerAlign:String,showOverflowTooltip:{type:[Boolean,Object],default:void 0},fixed:[Boolean,String],formatter:Function,selectable:Function,reserveSelection:Boolean,filterMethod:Function,filteredValue:Array,filters:Array,filterPlacement:String,filterMultiple:{type:Boolean,default:!0},filterClassName:String,index:[Number,Function],sortOrders:{type:Array,default:()=>["ascending","descending",null],validator:e=>e.every(e=>["ascending","descending",null].includes(e))}},p=e.defineComponent({name:"FaTableColumn",props:{...m,type:{type:a.definePropType(String),default:"default"},width:{type:[String,Number],default:"auto"},align:{type:String,default:"left"},headerAlign:{type:String,default:"left"},show:Boolean,smallWidth:{type:[String,Number]},autoWidth:Boolean,slot:String,headerSlot:String,headerRender:{type:a.definePropType(Function)},render:{type:a.definePropType(Function)},_children:{type:a.definePropType(Array)},hideImage:Boolean,copy:Boolean,link:Boolean,spanProp:String,click:{type:a.definePropType(Function)},clickEmit:String,originalImage:Boolean,dateFix:Boolean,dateFormat:{type:a.definePropType(String)},tag:Boolean,enum:{type:a.definePropType([Array,Function])},dataDeleteField:String,timeInfoField:{type:a.definePropType(Object),default:()=>({userName:"createdUserName",time:"createdTime"})}},emits:{imagePreview:e=>o.isString(e),customCellClick:(e,{row:t,column:l,$index:r})=>(o.isNil(e)||o.isString(e))&&o.isObject(t)&&o.isObject(l)&&o.isNumber(r)},slots:a.makeSlots(),setup(p,{slots:g,emit:f}){const y=t.useGlobalSize(),h=e.inject(u.tableStateKey),b=e.inject(u.enumMapKey),S=e.computed(()=>p),w=()=>{let e="";return"timeInfo"===p.type&&(e+="fa-table__line-height-normal-column"),"date"!==p.type&&"time"!==p.type&&"dateTime"!==p.type||p.dateFix&&(e+="fa-table__line-height-normal-column"),p.className?`${e} ${p.className}`:e||void 0},N=t=>p.autoWidth?e.computed(()=>{const e=h.autoColumnWidth.find(e=>e.prop===p.prop);return e?`${e.width}px`:"auto"}).value:"small"===y.value?p.smallWidth??p.width??p.minWidth??t??"auto":p.width??p.minWidth??t??"auto",T=t=>p.autoWidth?e.createVNode("div",{class:["fa-table__auto-width-column__cell-header",`__fa-table__auto-width-column__cell-header__${p.prop}`]},[t]):t,x=t=>p.autoWidth?e.createVNode("div",{class:["fa-table__auto-width-column__cell",`__fa-table__auto-width-column__cell__${p.prop}`]},[t]):t,_=({column:t,$index:l})=>p.headerRender?T(p.headerRender({column:t,$index:l,...s.getTableDefaultSlots(h)})):p.headerSlot?T(g[p.headerSlot]&&g[p.headerSlot]({column:t,$index:l,...s.getTableDefaultSlots(h)})):T(e.createVNode("span",null,[p.label])),v=(r,o)=>(p.copy||o)&&r&&e.createVNode(t.ElIcon,{class:"fa__copy-icon",title:"复制",onClick:async()=>{try{await a.stringUtil.copy(String(r)),t.ElMessage({type:"success",message:"复制成功"})}catch(e){a.consoleError("FaTableColumn",e),t.ElMessage({type:"error",message:"复制失败"})}}},{default:()=>[e.createVNode(l.CopyDocument,null,null)]}),F=(e,t,l,r)=>t.formatter?t.formatter(e,t,l,r):l,V=(l,r,a)=>{const n=F(l,r,(({row:e})=>{const t=d.tableUtil.handleRowAccordingToProp(e,p.prop);let l,r=p.prop;return o.isString(p.enum)?(r=p.enum,l=b.get(r)):o.isArray(p.enum)?l=p.enum:o.isFunction(p.enum)&&(l=p.enum({row:e})),l?d.tableUtil.filterEnum(t,l):d.tableUtil.formatValue(t)})({row:l}),a);let i=p.prop;o.isString(p.enum)&&(i=p.enum);const s=b.get(i),u=d.tableUtil.filterEnum(d.tableUtil.handleRowAccordingToProp(l,p.prop),s,null,"tag");return e.createVNode(e.Fragment,null,[v(n),n?e.createVNode(t.ElTag,{type:u},c(n)?n:{default:()=>[n]}):null])},O=({row:l,column:r,$index:n})=>{if("timeInfo"===p.type)return(l=>{let r;const o=l[p.timeInfoField?.userName??"createdUserName"],n=l[p.timeInfoField?.time??"createdTime"];return e.createVNode(e.Fragment,null,[e.createVNode("div",{style:"white-space: nowrap; overflow: hidden; text-overflow:  ellipsis;",title:n},[o&&e.createVNode("span",{style:"margin-right: 5px;"},[o]),e.createVNode("span",null,[n])]),n&&e.createVNode(t.ElTag,{type:"info",round:!0,effect:"light",size:"small"},c(r=a.dateUtil.dateTimeFix(String(n)))?r:{default:()=>[r]})])})(l);if(p.tag)return V(l,r,n);if("date"===p.type||"time"===p.type||"dateTime"===p.type)return((l,r,o)=>{let n,i;switch(p.type){case"date":i="YYYY-MM-DD";break;case"time":i="HH:mm:ss";break;case"dateTime":i="YYYY-MM-DD HH:mm:ss"}const d=l[p.prop]?F(l,r,t.dayjs(l[p.prop]).format(p.dateFormat??i),o):null;return e.createVNode(e.Fragment,null,[v(d),d,p.dateFix&&d&&e.createVNode(e.Fragment,null,[e.createVNode("br",null,null),e.createVNode(t.ElTag,{type:"info",round:!0,effect:"light",size:"small"},c(n=a.dateUtil.dateTimeFix(String(d)))?n:{default:()=>[n]})])])})(l,r,n);if("d2"===p.type||"d4"===p.type||"d6"===p.type||"gd2"===p.type||"gd4"===p.type||"gd6"===p.type)return((e,t,l)=>{const r=e[p.prop];if(!r||!o.isNumber(r))return F(e,t,r,l);let a,n=!1;switch(p.type){case"d2":a=2;break;case"d4":a=4;break;case"d6":a=6;break;case"gd2":a=2,n=!0;break;case"gd4":a=4,n=!0;break;case"gd6":a=6,n=!0}return F(e,t,r.toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:a,useGrouping:n}),l)})(l,r,n);if(p.link)return((l,r,a)=>{const o=F(l,r,l[p.prop],a);return x(e.createVNode(e.Fragment,null,[v(o),o&&e.createVNode(t.ElText,{class:"el-link is-hover-underline fa-table__link-column__text",onClick:()=>{p.dataDeleteField&&!0===l[p.dataDeleteField]||(p.click?p.click({row:l,$index:a}):f("customCellClick",p.clickEmit,{row:l,column:S.value,$index:a}))}},c(o)?o:{default:()=>[o]})]))})(l,r,n);if(p.render)return x(p.render({row:l,column:S.value,$index:n,...s.getTableDefaultSlots(h)}));if(p.slot)return x(g[p.slot]&&g[p.slot]({row:l,column:S.value,$index:n,...s.getTableDefaultSlots(h)}));const i=F(l,r,l[p.prop],n);return x(e.createVNode(e.Fragment,null,[v(i),i]))};let $=a.useProps(p,m,["type","width","minWidth","sortable","sortOrders","resizable","showOverflowTooltip"]);e.watch(()=>p,()=>{$=a.useProps(p,m,["type","className","minWidth","sortable","sortOrders","resizable","showOverflowTooltip"])}),a.useRender(()=>e.createVNode(e.Fragment,null,[p._children?.length?e.createVNode(t.ElTableColumn,e.mergeProps($.value,{className:w(),minWidth:N("auto"),sortable:!!p.sortable&&"custom",sortOrders:p.sortOrders??["descending","ascending",null],resizable:p.resizable&&!p.autoWidth,showOverflowTooltip:(p.showOverflowTooltip??!0)&&!p.autoWidth&&"default"==p.type}),{header:({column:e,$index:t})=>_({column:e,$index:t}),default:()=>p._children.map(t=>e.h(e.resolveComponent("FaTableColumn"),{...t},g))}):"image"===p.type?e.createVNode(t.ElTableColumn,e.mergeProps($.value,{align:"center",className:"fa-table__image-column",minWidth:"50px",sortable:!1,resizable:!1,showOverflowTooltip:!1}),{header:({column:e,$index:t})=>_({column:e,$index:t}),default:({row:l})=>l[p.prop]?p.hideImage?e.createVNode(t.ElImage,{class:"fa-image",lazy:!0,src:n.default,fit:"cover",previewSrcList:[l[p.prop]],closeOnPressEscape:!0,hideOnClickModal:!0,previewTeleported:!0},null):e.createVNode(r.FaImage,{lazy:!0,src:l[p.prop],fit:"cover",original:p.originalImage,thumb:!0},null):e.createVNode(t.ElImage,{class:"fa-image",lazy:!0,src:i.default,fit:"cover"},null)}):e.createVNode(t.ElTableColumn,e.mergeProps($.value,{className:w(),minWidth:N("auto"),sortable:!!p.sortable&&"custom",sortOrders:p.sortOrders??["descending","ascending",null],resizable:p.resizable&&!p.autoWidth,showOverflowTooltip:(p.showOverflowTooltip??!0)&&!p.autoWidth&&"default"==p.type}),{header:({column:e,$index:t})=>g.header?g.header({column:S.value,$index:t,...s.getTableDefaultSlots(h)}):_({column:e,$index:t}),default:({row:e,column:t,$index:l})=>g.default?g.default({row:e,column:S.value,$index:l,...s.getTableDefaultSlots(h)}):O({row:e,column:t,$index:l}),filterIcon:({filterOpened:e})=>g.filterIcon&&g.filterIcon({filterOpened:e,...s.getTableDefaultSlots(h)}),expand:({expanded:e})=>g.expand&&g.expand({expanded:e,...s.getTableDefaultSlots(h)})})]))}});exports.default=p,exports.tableColumnProps=m;
//# sourceMappingURL=tableColumn.js.map
