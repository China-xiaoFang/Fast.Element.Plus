"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),t=require("element-plus"),l=require("@element-plus/icons-vue"),r=require("../../image/index.js"),a=require("@fast-china/utils"),o=require("lodash-unified"),i=require("../images/artwork.png.js"),n=require("../images/notImage.png.js"),d=require("../utils/table.js"),s=require("./table.type.js"),u=require("./useTable.js");function c(t){return"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!e.isVNode(t)}const p={type:{type:String,default:"default"},label:String,className:String,labelClassName:String,property:String,prop:String,width:{type:[String,Number],default:""},minWidth:{type:[String,Number],default:""},renderHeader:Function,sortable:{type:[Boolean,String],default:!1},sortMethod:Function,sortBy:[String,Function,Array],resizable:{type:Boolean,default:!0},columnKey:String,align:String,headerAlign:String,showOverflowTooltip:{type:[Boolean,Object],default:void 0},fixed:[Boolean,String],formatter:Function,selectable:Function,reserveSelection:Boolean,filterMethod:Function,filteredValue:Array,filters:Array,filterPlacement:String,filterMultiple:{type:Boolean,default:!0},filterClassName:String,index:[Number,Function],sortOrders:{type:Array,default:()=>["ascending","descending",null],validator:e=>e.every(e=>["ascending","descending",null].includes(e))}},m=e.defineComponent({name:"FaTableColumn",props:{...p,type:{type:a.definePropType(String),default:"default"},width:{type:[String,Number],default:"auto"},align:{type:String,default:"left"},headerAlign:{type:String,default:"left"},show:Boolean,smallWidth:{type:[String,Number]},autoWidth:Boolean,slot:String,headerSlot:String,headerRender:{type:a.definePropType(Function)},render:{type:a.definePropType(Function)},_children:{type:a.definePropType(Array)},hideImage:Boolean,copy:Boolean,link:Boolean,spanProp:String,click:{type:a.definePropType(Function)},clickEmit:String,dateFix:Boolean,dateFormat:{type:a.definePropType(String)},tag:Boolean,enum:{type:a.definePropType([Array,Function])},dataDeleteField:String,timeInfoField:{type:a.definePropType(Object),default:()=>({userName:"createdUserName",time:"createdTime"})}},emits:{imagePreview:e=>o.isString(e),customCellClick:(e,{row:t,column:l,$index:r})=>o.isString(e)&&o.isObject(t)&&o.isObject(l)&&o.isNumber(r)},slots:a.makeSlots(),setup(m,{slots:g,emit:f}){const y=t.useGlobalSize(),h=e.inject(u.tableStateKey),b=e.inject(u.enumMapKey),w=e.computed(()=>m),S=({row:e})=>{let t=m.prop;o.isString(m.enum)&&(t=m.enum);const l=b.get(t);return d.tableUtil.filterEnum(d.tableUtil.handleRowAccordingToProp(e,m.prop),l,null,"tag")},T=t=>m.autoWidth?e.computed(()=>{const e=h.autoColumnWidth.find(e=>e.prop===m.prop);return e?`${e.width}px`:"auto"}).value:"small"===y.value?m.smallWidth??m.width??m.minWidth??t??"auto":m.width??m.minWidth??t??"auto",N=t=>m.autoWidth?e.createVNode("div",{class:["fa-table__auto-width-column__cell-header",`__fa-table__auto-width-column__cell-header__${m.prop}`]},[t]):t,x=({column:t,$index:l})=>m.headerRender?N(m.headerRender({column:t,$index:l,...s.getTableDefaultSlots(h)})):m.headerSlot?N(g[m.headerSlot]&&g[m.headerSlot]({column:t,$index:l,...s.getTableDefaultSlots(h)})):N(e.createVNode("span",null,[m.label])),v=t=>m.autoWidth?e.createVNode("div",{class:["fa-table__auto-width-column__cell",`__fa-table__auto-width-column__cell__${m.prop}`]},[t]):t,_=(r,o)=>(m.copy||o)&&r&&e.createVNode(t.ElIcon,{class:"fa__copy-icon",title:"复制",onClick:()=>(async e=>{try{await a.stringUtil.copy(String(e)),t.ElMessage({type:"success",message:"复制成功"})}catch(l){a.consoleError("FaTableColumn",l),t.ElMessage({type:"error",message:"复制失败"})}})(r)},{default:()=>[e.createVNode(l.CopyDocument,null,null)]}),F=(e,t,l,r)=>t.formatter?t.formatter(e,t,l,r):l,V=({row:l,column:r,$index:i})=>{if("timeInfo"===m.type){let r;const o=l[m.timeInfoField?.userName??"createdUserName"],i=l[m.timeInfoField?.time??"createdTime"];return e.createVNode(e.Fragment,null,[e.createVNode("div",{style:"white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",title:i},[o&&e.createVNode("span",{style:"margin-right: 5px;"},[o]),e.createVNode("span",null,[i])]),i&&e.createVNode(t.ElTag,{type:"info",round:!0,effect:"light",size:"small"},c(r=a.dateUtil.dateTimeFix(String(i)))?r:{default:()=>[r]})])}if(m.tag){const a=F(l,r,(({row:e})=>{let t=m.prop;o.isString(m.enum)&&(t=m.enum);const l=b.get(t);return l?d.tableUtil.filterEnum(d.tableUtil.handleRowAccordingToProp(e,m.prop),l):d.tableUtil.formatValue(d.tableUtil.handleRowAccordingToProp(e,m.prop))})({row:l}),i);return e.createVNode(e.Fragment,null,[_(a),a?e.createVNode(t.ElTag,{type:S({row:l})},c(a)?a:{default:()=>[a]}):null])}if("date"===m.type||"time"===m.type||"dateTime"===m.type){let o,n;switch(m.type){case"date":n="YYYY-MM-DD";break;case"time":n="HH:mm:ss";break;case"dateTime":n="YYYY-MM-DD HH:mm:ss"}const d=l[m.prop]?F(l,r,t.dayjs(l[m.prop]).format(m.dateFormat??n),i):null;return e.createVNode(e.Fragment,null,[_(d),d,m.dateFix&&d&&e.createVNode(e.Fragment,null,[e.createVNode("br",null,null),e.createVNode(t.ElTag,{type:"info",round:!0,effect:"light",size:"small"},c(o=a.dateUtil.dateTimeFix(String(d)))?o:{default:()=>[o]})])])}if("d2"===m.type||"d4"===m.type||"d6"===m.type||"gd2"===m.type||"gd4"===m.type||"gd6"===m.type){const e=l[m.prop];if(e&&o.isNumber(e)){let t,l=!1;switch(m.type){case"d2":t=2;break;case"d4":t=4;break;case"d6":t=6;break;case"gd2":t=2,l=!0;break;case"gd4":t=4,l=!0;break;case"gd6":t=6,l=!0}return e.toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:t,useGrouping:l})}return e}if(m.link){const a=F(l,r,l[m.prop],i);return v(e.createVNode(e.Fragment,null,[_(a),a&&e.createVNode(t.ElText,{class:"el-link is-hover-underline fa-table__link-column__text",onClick:()=>{m.dataDeleteField&&!0===l[m.dataDeleteField]||(m.click?m.click({row:l,$index:i}):f("customCellClick",m.clickEmit,{row:l,column:w.value,$index:i}))}},c(a)?a:{default:()=>[a]})]))}if(m.render)return v(m.render({row:l,column:w.value,$index:i,...s.getTableDefaultSlots(h)}));if(m.slot)return v(g[m.slot]&&g[m.slot]({row:l,column:w.value,$index:i,...s.getTableDefaultSlots(h)}));{const t=F(l,r,l[m.prop],i);return v(e.createVNode(e.Fragment,null,[_(t),t]))}};let O=a.useProps(m,p,["type","width","minWidth","sortable","sortOrders","resizable","showOverflowTooltip"]);e.watch(()=>m,()=>{O=a.useProps(m,p,["type","minWidth","sortable","sortOrders","resizable","showOverflowTooltip"])}),a.useRender(()=>e.createVNode(e.Fragment,null,[m._children?.length?e.createVNode(t.ElTableColumn,e.mergeProps(O.value,{minWidth:T("auto"),sortable:!!m.sortable&&"custom",sortOrders:m.sortOrders??["descending","ascending",null],resizable:m.resizable&&!m.autoWidth,showOverflowTooltip:(m.showOverflowTooltip??!0)&&!m.autoWidth&&"default"==m.type}),{header:({column:e,$index:t})=>x({column:e,$index:t}),default:()=>m._children.map(t=>e.h(e.resolveComponent("FaTableColumn"),{...t},g))}):"image"===m.type?e.createVNode(t.ElTableColumn,e.mergeProps(O.value,{align:"center",className:"fa-table__image-column",minWidth:"50px",sortable:!1,resizable:!1,showOverflowTooltip:!1}),{header:({column:e,$index:t})=>x({column:e,$index:t}),default:({row:l})=>l[m.prop]?m.hideImage?e.createVNode(t.ElImage,{class:"fa-image",lazy:!0,src:i.default,fit:"cover",previewSrcList:[l[m.prop]],closeOnPressEscape:!0,hideOnClickModal:!0,previewTeleported:!0},null):e.createVNode(r.FaImage,{lazy:!0,src:l[m.prop],fit:"cover",original:!0},null):e.createVNode(t.ElImage,{class:"fa-image",lazy:!0,src:n.default,fit:"cover"},null)}):e.createVNode(t.ElTableColumn,e.mergeProps(O.value,{minWidth:T("auto"),sortable:!!m.sortable&&"custom",sortOrders:m.sortOrders??["descending","ascending",null],resizable:m.resizable&&!m.autoWidth,showOverflowTooltip:(m.showOverflowTooltip??!0)&&!m.autoWidth&&"default"==m.type}),{header:({column:e,$index:t})=>g.header?g.header({column:w.value,$index:t,...s.getTableDefaultSlots(h)}):x({column:e,$index:t}),default:({row:e,column:t,$index:l})=>g.default?g.default({row:e,column:w.value,$index:l,...s.getTableDefaultSlots(h)}):V({row:e,column:t,$index:l}),filterIcon:({filterOpened:e})=>g.filterIcon&&g.filterIcon({filterOpened:e,...s.getTableDefaultSlots(h)}),expand:({expanded:e})=>g.expand&&g.expand({expanded:e,...s.getTableDefaultSlots(h)})})]))}});exports.default=m,exports.tableColumnProps=p;
//# sourceMappingURL=tableColumn.js.map
