{"version":3,"file":"layoutGrid.js","sources":["../../../../../packages/components/layoutGrid/src/layoutGrid.tsx"],"sourcesContent":["import type { VNode, VNodeArrayChildren } from \"vue\";\nimport { computed, defineComponent, nextTick, onActivated, onDeactivated, onMounted, onUnmounted, provide, ref, watch } from \"vue\";\nimport { consoleWarn, definePropType, makeSlots, useRender } from \"@fast-element-plus/utils\";\nimport { isArray, isNumber, isObject } from \"lodash-unified\";\nimport type { FaLayoutGridBreakPoint } from \"./layoutGrid.type\";\n\ntype FaLayoutGridSlots = {\n\t/** @description 默认内容插槽 */\n\tdefault: never;\n};\n\nexport default defineComponent({\n\tname: \"FaLayoutGrid\",\n\tprops: {\n\t\t/** @description Grid布局列配置 */\n\t\tcols: {\n\t\t\ttype: definePropType<string | number | Record<FaLayoutGridBreakPoint, number>>([String, Number, Object]),\n\t\t\tdefault: (): Record<FaLayoutGridBreakPoint, number> => ({ xs: 1, sm: 2, md: 3, lg: 4, xl: 5 }),\n\t\t},\n\t\t/** @description 折叠 */\n\t\tcollapsed: Boolean,\n\t\t/** @description 折叠行数 */\n\t\tcollapsedRows: {\n\t\t\ttype: [String, Number],\n\t\t\tdefault: 1,\n\t\t},\n\t\t/** @description 间距，偏移 */\n\t\tgap: {\n\t\t\ttype: definePropType<number | [number, number]>([Number, Array]),\n\t\t\tdefault: 0,\n\t\t},\n\t},\n\temits: {\n\t\t/** @description 断点变化事件 */\n\t\tbreakPointChange: ({ breakPoint }: { breakPoint: FaLayoutGridBreakPoint }) => true,\n\t},\n\tslots: makeSlots<FaLayoutGridSlots>(),\n\tsetup(props, { slots, emit, expose }) {\n\t\tconst divElRef = ref<HTMLElement>();\n\n\t\t// 注入 gap 间距\n\t\tprovide(\"gap\", isArray(props.gap) ? props.gap[0] : props.gap);\n\n\t\t// 注入响应式断点\n\t\tconst breakPoint = ref<FaLayoutGridBreakPoint>(\"xl\");\n\t\tprovide(\"breakPoint\", breakPoint);\n\n\t\t// 注入要开始折叠的 index\n\t\tconst hiddenIndex = ref(-1);\n\t\tprovide(\"shouldHiddenIndex\", hiddenIndex);\n\n\t\t// 注入 cols\n\t\tconst cols = computed(() => {\n\t\t\tif (isObject(props.cols)) return props.cols[breakPoint.value] ?? props.cols;\n\t\t\treturn props.cols;\n\t\t});\n\t\tprovide(\"cols\", cols);\n\n\t\tconst collapsedRows = isNumber(props.collapsedRows) ? props.collapsedRows : Number(props.collapsedRows);\n\n\t\t// 断点映射\n\t\tconst breakpoints = {\n\t\t\t// 小于480屏幕（如手机）\n\t\t\txs: { min: 0, max: 479 },\n\t\t\t// 平板竖屏\n\t\t\tsm: { min: 480, max: 768 },\n\t\t\t// 平板横屏\n\t\t\tmd: { min: 768, max: 1024 },\n\t\t\t// 小型桌面\n\t\t\tlg: { min: 1024, max: 1440 },\n\t\t\t// 大型桌面\n\t\t\txl: { min: 1440, max: Infinity },\n\t\t};\n\n\t\t// 监听屏幕变化\n\t\tconst resize = (e: ResizeObserverEntry[]): void => {\n\t\t\t// 这里肯定只有一个\n\t\t\tif (e.length !== 1) throw new Error(\"未知的多个El\");\n\t\t\tconst curEl = e[0];\n\t\t\tconst width = curEl.target.scrollWidth;\n\n\t\t\tfor (const [key, { min, max }] of Object.entries(breakpoints)) {\n\t\t\t\tif (width >= min && width <= max) {\n\t\t\t\t\tbreakPoint.value = key as FaLayoutGridBreakPoint;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst findIndex = (): void => {\n\t\t\tconst fields: VNodeArrayChildren = [];\n\t\t\tlet suffix: VNode = null;\n\t\t\tconst slotContent = divElRef.value?.children;\n\t\t\tif (slotContent) {\n\t\t\t\tfor (let i = 0; i < slotContent.length; i++) {\n\t\t\t\t\tconst slotNode = slotContent[i][\"__vueParentComponent\"]?.vnode;\n\t\t\t\t\tif (typeof slotNode?.type === \"object\" && slotNode?.type.name === \"FaLayoutGridItem\" && slotNode?.props?.suffix !== undefined)\n\t\t\t\t\t\tsuffix = slotNode;\n\t\t\t\t\tif (typeof slotNode?.type === \"symbol\" && Array.isArray(slotNode?.children))\n\t\t\t\t\t\tslotNode?.children.forEach((child: VNode) => fields.push(child));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// 计算 suffix 所占用的列\n\t\t\tlet suffixCols = 0;\n\t\t\tif (suffix) {\n\t\t\t\tsuffixCols =\n\t\t\t\t\t(suffix.props[breakPoint.value]?.span ?? suffix.props?.span ?? 1) +\n\t\t\t\t\t(suffix.props[breakPoint.value]?.offset ?? suffix.props?.offset ?? 0);\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tlet find = false;\n\t\t\t\tfields.reduce((prev = 0, current, index) => {\n\t\t\t\t\tprev +=\n\t\t\t\t\t\t((current as VNode).props[breakPoint.value]?.span ?? (current as VNode).props?.span ?? 1) +\n\t\t\t\t\t\t((current as VNode).props[breakPoint.value]?.offset ?? (current as VNode).props?.offset ?? 0);\n\t\t\t\t\tif ((prev as number) > collapsedRows * (cols.value as number) - suffixCols) {\n\t\t\t\t\t\thiddenIndex.value = index;\n\t\t\t\t\t\tfind = true;\n\t\t\t\t\t\t// throw \"find it\";\n\t\t\t\t\t}\n\t\t\t\t\treturn prev;\n\t\t\t\t}, 0);\n\t\t\t\tif (!find) hiddenIndex.value = -1;\n\t\t\t} catch (error) {\n\t\t\t\tconsoleWarn(\"FaLayoutGrid\", error);\n\t\t\t}\n\t\t};\n\n\t\tlet resizeObserver: ResizeObserver = null;\n\n\t\tonMounted(() => {\n\t\t\tnextTick(() => {\n\t\t\t\tresizeObserver = new ResizeObserver(resize);\n\t\t\t\tresizeObserver.observe(divElRef.value);\n\t\t\t});\n\t\t});\n\n\t\tonActivated(() => {\n\t\t\tnextTick(() => {\n\t\t\t\tresizeObserver = new ResizeObserver(resize);\n\t\t\t\tresizeObserver.observe(divElRef.value);\n\t\t\t});\n\t\t});\n\n\t\tonUnmounted(() => {\n\t\t\tresizeObserver?.disconnect();\n\t\t});\n\n\t\tonDeactivated(() => {\n\t\t\tresizeObserver?.disconnect();\n\t\t});\n\n\t\tonMounted(() => {\n\t\t\t// 断点变化时 执行 findIndex\n\t\t\twatch(\n\t\t\t\t() => breakPoint.value,\n\t\t\t\t() => {\n\t\t\t\t\tif (props.collapsed) {\n\t\t\t\t\t\temit(\"breakPointChange\", { breakPoint: breakPoint.value });\n\t\t\t\t\t\tfindIndex();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\timmediate: true,\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t\t// 监听 collapsed\n\t\twatch(\n\t\t\t() => props.collapsed,\n\t\t\t(value) => {\n\t\t\t\tif (value) return findIndex();\n\t\t\t\thiddenIndex.value = -1;\n\t\t\t}\n\t\t);\n\n\t\t// 设置间距\n\t\tconst gap = computed(() => {\n\t\t\tif (isNumber(props.gap)) return `${props.gap}px`;\n\t\t\tif (isArray(props.gap)) return `${props.gap[1]}px ${props.gap[0]}px`;\n\t\t\treturn \"unset\";\n\t\t});\n\n\t\t// 设置 style\n\t\tconst style = computed(() => {\n\t\t\treturn {\n\t\t\t\tdisplay: \"grid\",\n\t\t\t\tgridGap: gap.value,\n\t\t\t\tgridTemplateColumns: `repeat(${cols.value}, minmax(0, 1fr))`,\n\t\t\t};\n\t\t});\n\n\t\tuseRender(() => (\n\t\t\t<div ref={divElRef} style={style.value}>\n\t\t\t\t{slots.default && slots.default()}\n\t\t\t</div>\n\t\t));\n\t},\n});\n"],"names":["defineComponent","name","props","cols","type","definePropType","String","Number","Object","default","xs","sm","md","lg","xl","collapsed","Boolean","collapsedRows","gap","Array","emits","breakPointChange","breakPoint","slots","makeSlots","setup","emit","expose","divElRef","ref","provide","isArray","hiddenIndex","computed","isObject","value","isNumber","breakpoints","min","max","Infinity","resize","e","length","Error","curEl","width","target","scrollWidth","key","entries","findIndex","fields","suffix","slotContent","children","i","slotNode","vnode","undefined","forEach","push","child","suffixCols","span","offset","find","reduce","prev","current","index","error","resizeObserver","onMounted","nextTick","ResizeObserver","observe","onActivated","onUnmounted","disconnect","onDeactivated","watch","immediate","style","display","gridGap","gridTemplateColumns","useRender","_createVNode","createVNode"],"mappings":"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"}