"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),l=require("@element-plus/icons-vue"),t=require("../../upload/src/useUpload.js");require("../../../constants/index.js");const a=require("../../../settings/index.js");require("../../../utils/index.js");const i=require("element-plus"),o=require("lodash-unified"),r=require("../../../constants/mime.js"),u=require("../../../utils/vue/props.js"),s=require("../../../utils/vue/slots.js"),d=require("../../../utils/string.js"),n=require("../../../utils/vue/useRender.js"),p=require("../../../utils/vue/expose.js"),c={...i.uploadProps,accept:{type:String,default:()=>r.FaMimeType.Image},listType:{type:u.definePropType(String),default:"picture"},showFileList:{type:Boolean,default:!1},modelValue:String,maxSize:{type:u.definePropType([String,Number]),default:2048},uploadUrl:{type:String,default:()=>a.FastApp.state.upload.url},width:{type:u.definePropType([String,Number]),default:150},height:{type:u.definePropType([String,Number]),default:150},fileType:Number},m={"update:modelValue":e=>o.isString(e)||o.isArray(e),"update:fileList":e=>o.isArray(e),change:e=>o.isString(e)||o.isArray(e)},v=e.defineComponent({name:"FaUploadImage",props:c,emits:m,slots:s.makeSlots(),setup(a,{attrs:r,slots:s,emit:c,expose:m}){const{fileList:v,loading:f,formContext:g,maxSizeMB:h,handleValue:N,handleHttpRequest:V,handleOnSuccess:x,handleOnError:y,handleOnExceed:S,handleOnUpload:w}=t.useUpload("FaUploadImage","图片",a,c,{maxSize:a.maxSize,uploadUrl:a.uploadUrl}),b=e.computed((()=>a.disabled||(null==g?void 0:g.disabled))),_=e.reactive({uploadKey:`fa-upload-image__${d.stringUtil.generateRandomString(8)}`,preview:!1,previewList:[],style:e.computed((()=>{const e={};return o.isNumber(a.width)?e["--fa-upload-image-width"]=`${a.width}px`:e["--fa-upload-image-width"]=a.width,o.isNumber(a.height)?e["--fa-upload-image-height"]=`${a.height}px`:e["--fa-upload-image-height"]=a.height,e}))}),q=e.ref(),E=()=>{const e=document.querySelector(`.${_.uploadKey} .el-upload__input`);e&&e.dispatchEvent(new MouseEvent("click"))},U=e=>!!w(e)&&(!a.beforeUpload||a.beforeUpload(e)),L=u.useProps(a,i.uploadProps,["fileList","disabled","httpRequest","beforeUpload","onExceed","onSuccess","onError"]);return n.useRender((()=>e.createVNode(e.Fragment,null,[e.withDirectives(e.createVNode(i.ElUpload,e.mergeProps(L.value,{ref:q,class:["fa-upload-image",_.uploadKey],style:_.style,fileList:v.value,"onUpdate:fileList":e=>v.value=e,disabled:b.value,httpRequest:V,beforeUpload:U,onExceed:S,onSuccess:x,onError:y}),{default:()=>v.value.length>0?e.createVNode(e.Fragment,null,[e.createVNode("img",{class:"el-upload-list__item-thumbnail",src:v.value[0].url},null),e.createVNode("span",{class:"el-upload-list__item-actions",onClick:e.withModifiers((()=>{}),["stop"])},[e.createVNode("span",{class:"el-upload-list__item-icon",onClick:()=>(_.previewList=[v.value[0].url],void(_.preview=!0)),title:"查看"},[e.createVNode(i.ElIcon,null,{default:()=>[e.createVNode(l.ZoomIn,null,null)]})]),!b.value&&e.createVNode(e.Fragment,null,[e.createVNode("span",{class:"el-upload-list__item-icon",onClick:E,title:"编辑"},[e.createVNode(i.ElIcon,null,{default:()=>[e.createVNode(l.Edit,null,null)]})]),e.createVNode("span",{class:"el-upload-list__item-icon",onClick:()=>(v.value=[],void N()),title:"删除"},[e.createVNode(i.ElIcon,null,{default:()=>[e.createVNode(l.Delete,null,null)]})])])])]):s.default?s.default():e.createVNode(e.Fragment,null,[e.createVNode(i.ElIcon,{class:"el-icon--upload"},{default:()=>[e.createVNode(l.UploadFilled,null,null)]}),e.createVNode("div",{class:"el-upload__text"},[e.createTextVNode("Drop file here "),e.createVNode("br",null,null),e.createVNode("em",null,[e.createTextVNode("click to upload")])])]),tip:()=>e.createVNode("div",{class:"el-upload__tip"},[e.createTextVNode("file with a size less than "),h.toString(),e.createTextVNode("MB")])}),[[e.resolveDirective("loading"),f.value]]),_.preview?e.createVNode(i.ElImageViewer,{closeOnPressEscape:!0,hideOnClickModal:!0,teleported:!0,onClose:()=>_.preview=!1,urlList:_.previewList},null):null]))),p.useExpose(m,{...e.computed((()=>{var e,l,t,a,i;return{abort:null==(e=q.value)?void 0:e.abort,submit:null==(l=q.value)?void 0:l.submit,clearFiles:null==(t=q.value)?void 0:t.clearFiles,handleStart:null==(a=q.value)?void 0:a.handleStart,handleRemove:null==(i=q.value)?void 0:i.handleRemove}})).value,loading:f,fileList:v,preview:_.preview,previewList:_.previewList})}});exports.default=v,exports.faUploadImageEmits=m,exports.faUploadImageProps=c;
//# sourceMappingURL=uploadImage.js.map
