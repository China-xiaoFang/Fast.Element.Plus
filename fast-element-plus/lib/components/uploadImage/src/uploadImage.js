"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),l=require("element-plus"),t=require("@element-plus/icons-vue"),a=require("../../upload/src/useUpload.js");require("../../../constants/index.js");const o=require("@fast-china/utils"),i=require("lodash-unified"),r=require("../../../constants/mime.js"),d={...l.uploadProps,drag:{type:Boolean,default:!0},accept:{type:String,default:()=>r.FaMimeType.Image},listType:{type:o.definePropType(String),default:"picture"},showFileList:{type:Boolean,default:!1},modelValue:o.definePropType([String,Array]),maxSize:{type:[String,Number],default:2048},uploadApi:{type:o.definePropType(Function)},uploadUrl:String,width:{type:[String,Number],default:150},height:{type:[String,Number],default:150}},u={"update:modelValue":e=>i.isString(e)||i.isArray(e)||i.isNull(e),"update:fileList":e=>i.isArray(e),change:e=>i.isString(e)||i.isArray(e)||i.isNull(e)},s=e.defineComponent({name:"FaUploadImage",props:d,emits:u,slots:o.makeSlots(),setup(i,{attrs:r,slots:d,emit:u,expose:s}){const{fileList:n,loading:p,formContext:c,maxSizeMB:m,handleValue:f,handleHttpRequest:v,handleOnSuccess:g,handleOnError:h,handleOnExceed:N,handleOnUpload:V}=a.useUpload("FaUploadImage","图片",i,u,{maxSize:i.maxSize,uploadApi:i.uploadApi,uploadUrl:i.uploadUrl}),S=e.computed(()=>i.disabled||c?.disabled),y=e.reactive({uploadKey:`fa-upload-image__${o.stringUtil.generateRandomString(8)}`,preview:!1,previewList:[]}),w=e.ref(),x=()=>{const e=document.querySelector(`.${y.uploadKey} .el-upload__input`);e&&e.dispatchEvent(new MouseEvent("click"))},U=e=>!!V(e)&&(!i.beforeUpload||i.beforeUpload(e)),_=o.useProps(i,l.uploadProps,["fileList","disabled","httpRequest","beforeUpload","onExceed","onSuccess","onError"]);return o.useRender(()=>e.createVNode(e.Fragment,null,[e.withDirectives(e.createVNode(l.ElUpload,e.mergeProps(_.value,{ref:w,class:["fa-upload-image",y.uploadKey],style:{"--width":o.addUnit(i.width),"--height":o.addUnit(i.height)},fileList:n.value,"onUpdate:fileList":e=>n.value=e,disabled:S.value,httpRequest:v,beforeUpload:U,onExceed:N,onSuccess:g,onError:h}),{default:()=>n.value.length>0?e.createVNode(e.Fragment,null,[e.createVNode("img",{class:"el-upload-list__item-thumbnail",src:n.value[0].url},null),e.createVNode("span",{class:"el-upload-list__item-actions",onClick:e.withModifiers(()=>{},["stop"])},[e.createVNode("span",{class:"el-upload-list__item-icon",onClick:()=>(y.previewList=[n.value[0].url],void(y.preview=!0)),title:"查看"},[e.createVNode(l.ElIcon,null,{default:()=>[e.createVNode(t.ZoomIn,null,null)]})]),!S.value&&e.createVNode(e.Fragment,null,[e.createVNode("span",{class:"el-upload-list__item-icon",onClick:x,title:"编辑"},[e.createVNode(l.ElIcon,null,{default:()=>[e.createVNode(t.Edit,null,null)]})]),e.createVNode("span",{class:"el-upload-list__item-icon",onClick:()=>(n.value=[],void f()),title:"删除"},[e.createVNode(l.ElIcon,null,{default:()=>[e.createVNode(t.Delete,null,null)]})])])])]):d.default?d.default():e.createVNode(e.Fragment,null,[e.createVNode(l.ElIcon,{class:"el-icon--upload"},{default:()=>[e.createVNode(t.UploadFilled,null,null)]}),e.createVNode("div",{class:"el-upload__text"},[e.createTextVNode("Drop file here "),e.createVNode("br",null,null),e.createVNode("em",null,[e.createTextVNode("click to upload")])])]),tip:()=>e.createVNode("div",{class:"el-upload__tip"},[e.createTextVNode("file with a size less than "),m.toString(),e.createTextVNode("MB")])}),[[e.resolveDirective("loading"),p.value]]),y.preview&&e.createVNode(l.ElImageViewer,{closeOnPressEscape:!0,hideOnClickModal:!0,teleported:!0,onClose:()=>y.preview=!1,urlList:y.previewList},null)])),o.useExpose(s,{abort:e.computed(()=>w.value?.abort),submit:e.computed(()=>w.value?.submit),clearFiles:e.computed(()=>w.value?.clearFiles),handleStart:e.computed(()=>w.value?.handleStart),handleRemove:e.computed(()=>w.value?.handleRemove),loading:p,fileList:n,preview:e.computed(()=>y.preview),previewList:e.computed(()=>y.previewList)})}});exports.default=s,exports.faUploadImageEmits=u,exports.faUploadImageProps=d;
//# sourceMappingURL=uploadImage.js.map
