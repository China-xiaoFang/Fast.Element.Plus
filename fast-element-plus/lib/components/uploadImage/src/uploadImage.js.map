{"version":3,"file":"uploadImage.js","sources":["../../../../../packages/components/uploadImage/src/uploadImage.tsx"],"sourcesContent":["import { Fragment, computed, defineComponent, reactive, ref, withModifiers } from \"vue\";\nimport { Delete, Edit, UploadFilled, ZoomIn } from \"@element-plus/icons-vue\";\nimport { useUpload } from \"@fast-element-plus/components/upload/src/useUpload\";\nimport { FaMimeType } from \"@fast-element-plus/constants\";\nimport { FastApp } from \"@fast-element-plus/settings\";\nimport { definePropType, makeSlots, stringUtil, useExpose, useProps, useRender } from \"@fast-element-plus/utils\";\nimport { ElIcon, ElImageViewer, ElUpload, uploadProps } from \"element-plus\";\nimport type { UploadInstance, UploadProps, UploadUserFile, uploadListTypes } from \"element-plus\";\nimport { isArray, isNumber, isString } from \"lodash-unified\";\n\nexport const faUploadImageProps = {\n\t...uploadProps,\n\t/** @description accepted [file types](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#attr-accept), will not work when `thumbnail-mode === true` */\n\taccept: {\n\t\ttype: String,\n\t\tdefault: (): string => FaMimeType.Image,\n\t},\n\t/** @description type of file list */\n\tlistType: {\n\t\ttype: definePropType<(typeof uploadListTypes)[number]>(String),\n\t\tdefault: \"picture\",\n\t},\n\t/** @description whether to show the uploaded file list */\n\tshowFileList: {\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t},\n\t/** @description v-model绑定值 */\n\tmodelValue: String,\n\t/** @description 大小限制，单位kb */\n\tmaxSize: {\n\t\ttype: definePropType<string | number>([String, Number]),\n\t\tdefault: 2048,\n\t},\n\t/** @description 图片上传地址 */\n\tuploadUrl: {\n\t\ttype: String,\n\t\tdefault: (): string => FastApp.state.upload.url,\n\t},\n\t/** @description 宽度 */\n\twidth: {\n\t\ttype: definePropType<string | number>([String, Number]),\n\t\tdefault: 150,\n\t},\n\t/** @description 高度 */\n\theight: {\n\t\ttype: definePropType<string | number>([String, Number]),\n\t\tdefault: 150,\n\t},\n\t/** @description 文件类型 */\n\tfileType: Number,\n};\n\nexport const faUploadImageEmits = {\n\t/** @description v-model 回调 */\n\t\"update:modelValue\": (value: string): boolean => isString(value) || isArray(value),\n\t/** @description v-model:fileList 回调 */\n\t\"update:fileList\": (value: UploadUserFile[]): boolean => isArray(value),\n\t/** @description 改变 */\n\tchange: (value: string): boolean => isString(value) || isArray(value),\n};\n\ntype FaUploadImageSlots = {\n\t/** @description 默认内容插槽 */\n\tdefault: never;\n};\n\nexport default defineComponent({\n\tname: \"FaUploadImage\",\n\tprops: faUploadImageProps,\n\temits: faUploadImageEmits,\n\tslots: makeSlots<FaUploadImageSlots>(),\n\tsetup(props, { attrs, slots, emit, expose }) {\n\t\tconst {\n\t\t\tfileList,\n\t\t\tloading,\n\t\t\tformContext,\n\t\t\tmaxSizeMB,\n\t\t\thandleValue,\n\t\t\thandleHttpRequest,\n\t\t\thandleOnSuccess,\n\t\t\thandleOnError,\n\t\t\thandleOnExceed,\n\t\t\thandleOnUpload,\n\t\t} = useUpload(\"FaUploadImage\", \"图片\", props, emit, {\n\t\t\tmaxSize: props.maxSize,\n\t\t\tuploadUrl: props.uploadUrl,\n\t\t});\n\n\t\tconst disabled = computed(() => {\n\t\t\treturn props.disabled || formContext?.disabled;\n\t\t});\n\n\t\tconst state = reactive({\n\t\t\tuploadKey: `fa-upload-image__${stringUtil.generateRandomString(8)}`,\n\t\t\tpreview: false,\n\t\t\tpreviewList: [],\n\t\t\tstyle: computed(() => {\n\t\t\t\tconst result = {};\n\t\t\t\tif (isNumber(props.width)) {\n\t\t\t\t\tresult[\"--fa-upload-image-width\"] = `${props.width}px`;\n\t\t\t\t} else {\n\t\t\t\t\tresult[\"--fa-upload-image-width\"] = props.width;\n\t\t\t\t}\n\t\t\t\tif (isNumber(props.height)) {\n\t\t\t\t\tresult[\"--fa-upload-image-height\"] = `${props.height}px`;\n\t\t\t\t} else {\n\t\t\t\t\tresult[\"--fa-upload-image-height\"] = props.height;\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t}),\n\t\t});\n\n\t\tconst uploadRef = ref<UploadInstance>();\n\n\t\tconst handleEdit = (): void => {\n\t\t\tconst uploadInputEl = document.querySelector(`.${state.uploadKey} .el-upload__input`);\n\t\t\tuploadInputEl && uploadInputEl.dispatchEvent(new MouseEvent(\"click\"));\n\t\t};\n\n\t\tconst handlePreview = (): void => {\n\t\t\tstate.previewList = [fileList.value[0].url];\n\t\t\tstate.preview = true;\n\t\t};\n\n\t\tconst handleRemove = (): void => {\n\t\t\tfileList.value = [];\n\t\t\thandleValue();\n\t\t};\n\n\t\tconst handleBeforeUpload: UploadProps[\"beforeUpload\"] = (rawFile) => {\n\t\t\tif (!handleOnUpload(rawFile)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (props.beforeUpload) {\n\t\t\t\treturn props.beforeUpload(rawFile);\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\n\t\tconst elUploadProps = useProps(props, uploadProps, [\n\t\t\t\"fileList\",\n\t\t\t\"disabled\",\n\t\t\t\"httpRequest\",\n\t\t\t\"beforeUpload\",\n\t\t\t\"onExceed\",\n\t\t\t\"onSuccess\",\n\t\t\t\"onError\",\n\t\t]);\n\n\t\tuseRender(() => (\n\t\t\t<Fragment>\n\t\t\t\t<ElUpload\n\t\t\t\t\t{...elUploadProps.value}\n\t\t\t\t\tref={uploadRef}\n\t\t\t\t\tclass={[\"fa-upload-image\", state.uploadKey]}\n\t\t\t\t\tstyle={state.style}\n\t\t\t\t\tvLoading={loading.value}\n\t\t\t\t\tvModel:fileList={fileList.value}\n\t\t\t\t\tdisabled={disabled.value}\n\t\t\t\t\thttpRequest={handleHttpRequest}\n\t\t\t\t\tbeforeUpload={handleBeforeUpload}\n\t\t\t\t\tonExceed={handleOnExceed}\n\t\t\t\t\tonSuccess={handleOnSuccess}\n\t\t\t\t\tonError={handleOnError}\n\t\t\t\t>\n\t\t\t\t\t{{\n\t\t\t\t\t\tdefault: () =>\n\t\t\t\t\t\t\tfileList.value.length > 0 ? (\n\t\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t\t<img class=\"el-upload-list__item-thumbnail\" src={fileList.value[0].url} />\n\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\tclass=\"el-upload-list__item-actions\"\n\t\t\t\t\t\t\t\t\t\tonClick={withModifiers(() => {\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}, [\"stop\"])}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<span class=\"el-upload-list__item-icon\" onClick={() => handlePreview()} title=\"查看\">\n\t\t\t\t\t\t\t\t\t\t\t<ElIcon>\n\t\t\t\t\t\t\t\t\t\t\t\t<ZoomIn />\n\t\t\t\t\t\t\t\t\t\t\t</ElIcon>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t{!disabled.value && (\n\t\t\t\t\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"el-upload-list__item-icon\" onClick={handleEdit} title=\"编辑\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<ElIcon>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Edit />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</ElIcon>\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"el-upload-list__item-icon\" onClick={() => handleRemove()} title=\"删除\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<ElIcon>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Delete />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</ElIcon>\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t\t) : slots.default ? (\n\t\t\t\t\t\t\t\tslots.default()\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t\t<ElIcon class=\"el-icon--upload\">\n\t\t\t\t\t\t\t\t\t\t<UploadFilled />\n\t\t\t\t\t\t\t\t\t</ElIcon>\n\t\t\t\t\t\t\t\t\t<div class=\"el-upload__text\">\n\t\t\t\t\t\t\t\t\t\tDrop file here <br />\n\t\t\t\t\t\t\t\t\t\t<em>click to upload</em>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\ttip: () => <div class=\"el-upload__tip\">file with a size less than {maxSizeMB.toString()}MB</div>,\n\t\t\t\t\t}}\n\t\t\t\t</ElUpload>\n\t\t\t\t{state.preview ? (\n\t\t\t\t\t<ElImageViewer\n\t\t\t\t\t\tcloseOnPressEscape\n\t\t\t\t\t\thideOnClickModal\n\t\t\t\t\t\tteleported\n\t\t\t\t\t\tonClose={() => (state.preview = false)}\n\t\t\t\t\t\turlList={state.previewList}\n\t\t\t\t\t/>\n\t\t\t\t) : null}\n\t\t\t</Fragment>\n\t\t));\n\n\t\treturn useExpose(expose, {\n\t\t\t...computed(() => ({\n\t\t\t\t/** @description cancel upload request */\n\t\t\t\tabort: uploadRef.value?.abort,\n\t\t\t\t/** @description upload the file list manually */\n\t\t\t\tsubmit: uploadRef.value?.submit,\n\t\t\t\t/** @description clear the file list  */\n\t\t\t\tclearFiles: uploadRef.value?.clearFiles,\n\t\t\t\t/** @description select the file manually */\n\t\t\t\thandleStart: uploadRef.value?.handleStart,\n\t\t\t\t/** @description remove the file manually */\n\t\t\t\thandleRemove: uploadRef.value?.handleRemove,\n\t\t\t})).value,\n\t\t\t/** @description 加载状态 */\n\t\t\tloading,\n\t\t\t/** @description 文件集合 */\n\t\t\tfileList,\n\t\t\t/** @description 预览 */\n\t\t\tpreview: state.preview,\n\t\t\t/** @description 预览集合 */\n\t\t\tpreviewList: state.previewList,\n\t\t});\n\t},\n});\n"],"names":["faUploadImageProps","uploadProps","accept","type","String","default","FaMimeType","Image","listType","definePropType","showFileList","Boolean","modelValue","maxSize","Number","uploadUrl","FastApp","state","upload","url","width","height","fileType","faUploadImageEmits","isString","value","isArray","change","defineComponent","name","props","emits","slots","makeSlots","setup","attrs","emit","expose","fileList","loading","formContext","maxSizeMB","handleValue","handleHttpRequest","handleOnSuccess","handleOnError","handleOnExceed","handleOnUpload","useUpload","disabled","computed","reactive","uploadKey","stringUtil","generateRandomString","preview","previewList","style","result","isNumber","uploadRef","ref","handleEdit","uploadInputEl","document","querySelector","dispatchEvent","MouseEvent","handleBeforeUpload","rawFile","beforeUpload","elUploadProps","useProps","useExpose","useRender","_createVNode","_Fragment","Fragment","_withDirectives","ElUpload","_mergeProps","class","$event","httpRequest","onExceed","onSuccess","onError","length","createVNode","src","onClick","withModifiers","title","ElIcon","ZoomIn","Edit","Delete","UploadFilled","_createTextVNode","createTextVNode","tip","toString","_resolveDirective","ElImageViewer","closeOnPressEscape","hideOnClickModal","teleported","onClose","urlList","abort","submit","clearFiles","handleStart","handleRemove"],"mappings":"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"}