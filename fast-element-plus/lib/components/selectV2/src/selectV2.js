"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),l=require("element-plus"),t=require("@element-plus/icons-vue"),a=require("@fast-china/utils"),o=require("@vueuse/core"),r=require("lodash-unified"),i={allowCreate:Boolean,autocomplete:{type:a.definePropType(String),default:"none"},automaticDropdown:Boolean,clearable:Boolean,clearIcon:{type:a.definePropType([String,Object,Function]),default:t.CircleClose},effect:{type:a.definePropType(String),default:"light"},collapseTags:Boolean,collapseTagsTooltip:Boolean,maxCollapseTags:{type:Number,default:1},defaultFirstOption:Boolean,disabled:Boolean,estimatedOptionHeight:{type:Number,default:void 0},filterable:Boolean,filterMethod:Function,height:{type:Number,default:274},itemHeight:{type:Number,default:34},id:String,loading:Boolean,loadingText:String,modelValue:{type:a.definePropType([Array,String,Number,Boolean,Object])},multiple:Boolean,multipleLimit:{type:Number,default:0},name:String,noDataText:String,noMatchText:String,remoteMethod:Function,reserveKeyword:{type:Boolean,default:!0},options:{type:a.definePropType(Array)},placeholder:{type:String},teleported:l.useTooltipContentProps.teleported,persistent:{type:Boolean,default:!0},popperClass:{type:String,default:""},popperOptions:{type:a.definePropType(Object),default:()=>({})},remote:Boolean,size:l.useSizeProp,props:{type:a.definePropType(Object),default:()=>({label:"label",value:"value",disabled:"disabled",options:"options"})},valueKey:{type:String,default:"value"},scrollbarAlwaysOn:Boolean,validateEvent:{type:Boolean,default:!0},offset:{type:Number,default:12},showArrow:{type:Boolean,default:!0},placement:{type:a.definePropType(String),default:"bottom-start"},fallbackPlacements:{type:a.definePropType(Array),default:["bottom-start","top-start","right","left"]},tagType:{...l.tagProps.type,default:"info"},tagEffect:{...l.tagProps.effect,default:"light"},tabindex:{type:[String,Number],default:0},appendTo:String,...l.useEmptyValuesProps,...l.useAriaProps(["ariaLabel"])},u={"update:modelValue":e=>!0,change:e=>!0,"remove-tag":e=>!0,"visible-change":e=>!0,focus:e=>!0,blur:e=>!0,clear:()=>!0},n={...i,disabled:{type:Boolean,default:void 0},loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},modelValue:{type:a.definePropType([String,Number,Boolean,Object,Array]),default:void 0},label:a.definePropType([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,lazy:{type:Boolean,default:!0},defaultSelected:Boolean,data:{type:a.definePropType(Array),default:()=>[]},pageResult:Boolean,requestApi:{type:a.definePropType(Function)},initParam:a.definePropType([String,Number,Object])},s={...u,"update:modelValue":e=>r.isString(e)||r.isNumber(e)||r.isBoolean(e)||r.isObject(e)||r.isArray(e)||r.isNull(e),"update:label":e=>r.isString(e)||r.isArray(e)||r.isNull(e),dataChangeCallBack:e=>r.isArray(e),change:(e,l)=>!0},d=e.defineComponent({name:"FaSelectV2",props:n,emits:s,slots:a.makeSlots(),setup(t,{attrs:u,slots:n,emit:d,expose:p}){const c=o.useVModel(t,"label",d),f=l.useGlobalSize(),m=e.reactive({value:a.withDefineType(),loading:!1,selectorData:a.withDefineType([]),debut:!0,echo:!(t.data?.length>0),nextRefresh:!1}),y=e.ref(),g=async()=>{if(t.requestApi){m.loading=!0;const l=t.initParam??{};try{const e=await t.requestApi(l);m.echo=!1,t.pageResult?m.selectorData=e.rows:m.selectorData=e,d("dataChangeCallBack",m.selectorData)}catch(e){a.consoleError("FaSelect",e),m.selectorData=[]}finally{m.loading=!1}}else m.echo=!1,m.selectorData=t.data},b=e=>{if(t.multiple){const l=e;if(0===l?.length)return m.value=null,c.value=null,d("update:modelValue",null),void d("change",null,null);const t=m.selectorData.filter(e=>l.includes(e.value));m.value=e,c.value=t.map(e=>e.label),d("update:modelValue",e),d("change",t,e)}else{if(r.isNil(e))return m.value=null,c.value=null,d("update:modelValue",null),void d("change",null,null);const l=m.selectorData.find(l=>l.value===e);m.value=e,c.value=l.label,d("update:modelValue",e),d("change",l,e)}},v=()=>{m.value=null,c.value=null,d("update:modelValue",null),d("clear")},h=async e=>{e&&(m.debut?(m.debut=!1,!t.defaultSelected&&t.lazy&&await g()):m.nextRefresh&&(m.nextRefresh=!1,await g())),d("visible-change",e)};e.watch(()=>t.modelValue,e=>{if(m.echo&&!r.isNil(e)){const l=!r.isNil(t.label);if(t.multiple){if(!r.isArray(e))return void a.consoleError("FaSelectV2","当启用 multiple 时，传入的 modelValue 必须是Array。");if(l&&!r.isArray(t.label))return void a.consoleError("FaSelectV2","当启用 multiple 时，传入的 modelValue:label 必须是Array。");m.selectorData=e.slice(0,t.multipleLimit>0?t.multipleLimit:e.length).map((e,a)=>({value:e,label:l?t.label[a]:void 0}))}else{if(r.isArray(e))return void a.consoleError("FaSelectV2","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(l&&r.isArray(t.label))return void a.consoleError("FaSelectV2","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");m.selectorData=[{value:e,label:t.label}]}}m.value=e},{immediate:!0}),e.onMounted(async()=>{t.defaultSelected?(await g(),m.selectorData.length>0&&b(t.multiple?[m.selectorData[0].value]:m.selectorData[0].value)):!t.requestApi&&t.data?.length>0?(m.debut=!1,await g()):t.lazy||await g(),e.watch(()=>t.initParam,(e,l)=>{r.isEqual(e,l)||(m.nextRefresh=!0,r.isNil(m.value)||b())}),e.watch(()=>t.data,async()=>{t.requestApi||await g()},{deep:!0})});const S=a.useProps(t,i,["modelValue","popperClass","loading","options","itemHeight"]),T=a.useEmits(s,d,["update:modelValue","change","clear","visible-change"]),V=e.computed(()=>{let e=`fa-select-v2-dropdown ${t.popperClass}`;return t.moreDetail&&(e+=` fa-select-dropdown__more-detail fa-select-dropdown__more-detail-${f.value}`),e});return a.useRender(()=>e.createVNode(l.ElSelectV2,e.mergeProps(S.value,T.value,{ref:y,class:"fa-select-v2",popperClass:V.value,style:{width:a.addUnit(t.width)},modelValue:m.value,"onUpdate:modelValue":e=>m.value=e,loading:m.loading,options:m.selectorData,itemHeight:t.itemHeight+("small"===f.value?0:8),onChange:b,onClear:v,onVisibleChange:h}),{...n.default&&{default:({item:e,index:l,disabled:t})=>n.default({item:e,index:l,disabled:t})},...n.header&&{header:()=>n.header()},...n.footer&&{footer:()=>n.footer()},...n.prefix&&{prefix:()=>n.prefix()},...n.empty&&{empty:()=>n.empty()},...n.tag&&{tag:()=>n.tag()},...n.loading&&{loading:()=>n.loading()},...n.label&&{label:({label:e,value:l})=>n.label({label:e,value:l})}})),a.useExpose(p,{focus:e.computed(()=>y.value?.focus),blur:e.computed(()=>y.value?.blur),selectedLabel:e.computed(()=>y.value?.selectedLabel),loading:e.computed(()=>m.loading),refresh:g,setSelection:e=>b(e),clearSelection:()=>b(null)})}});exports.SelectV2Props=i,exports.default=d,exports.faSelectV2Emits=s,exports.faSelectV2Props=n,exports.selectV2Emits=u;
//# sourceMappingURL=selectV2.js.map
