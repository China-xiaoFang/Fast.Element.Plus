"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),l=require("element-plus"),t=require("@element-plus/icons-vue"),a=require("@fast-china/utils"),o=require("@vueuse/core"),i=require("lodash-unified"),r={allowCreate:Boolean,autocomplete:{type:a.definePropType(String),default:"none"},automaticDropdown:Boolean,clearable:Boolean,clearIcon:{type:a.definePropType([String,Object,Function]),default:t.CircleClose},effect:{type:a.definePropType(String),default:"light"},collapseTags:Boolean,collapseTagsTooltip:Boolean,maxCollapseTags:{type:Number,default:1},defaultFirstOption:Boolean,disabled:Boolean,estimatedOptionHeight:{type:Number,default:void 0},filterable:Boolean,filterMethod:Function,height:{type:Number,default:274},itemHeight:{type:Number,default:34},id:String,loading:Boolean,loadingText:String,modelValue:{type:a.definePropType([Array,String,Number,Boolean,Object])},multiple:Boolean,multipleLimit:{type:Number,default:0},name:String,noDataText:String,noMatchText:String,remoteMethod:Function,reserveKeyword:{type:Boolean,default:!0},options:{type:a.definePropType(Array)},placeholder:{type:String},teleported:l.useTooltipContentProps.teleported,persistent:{type:Boolean,default:!0},popperClass:{type:String,default:""},popperOptions:{type:a.definePropType(Object),default:()=>({})},remote:Boolean,size:l.useSizeProp,props:{type:a.definePropType(Object),default:()=>({label:"label",value:"value",disabled:"disabled",options:"options"})},valueKey:{type:String,default:"value"},scrollbarAlwaysOn:Boolean,validateEvent:{type:Boolean,default:!0},offset:{type:Number,default:12},showArrow:{type:Boolean,default:!0},placement:{type:a.definePropType(String),default:"bottom-start"},fallbackPlacements:{type:a.definePropType(Array),default:["bottom-start","top-start","right","left"]},tagType:{...l.tagProps.type,default:"info"},tagEffect:{...l.tagProps.effect,default:"light"},tabindex:{type:[String,Number],default:0},appendTo:String,...l.useEmptyValuesProps,...l.useAriaProps(["ariaLabel"])},n={...r,loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},modelValue:{type:a.definePropType([String,Number,Boolean,Object,Array]),default:void 0},label:a.definePropType([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,lazy:{type:Boolean,default:!0},defaultSelected:Boolean,data:{type:a.definePropType(Array),default:()=>[]},pageResult:Boolean,requestApi:{type:a.definePropType(Function)},initParam:a.definePropType([String,Number,Object])},u={"update:modelValue":e=>i.isString(e)||i.isNumber(e)||i.isBoolean(e)||i.isObject(e)||i.isArray(e)||i.isNull(e),"update:label":e=>i.isString(e)||i.isArray(e)||i.isNull(e),dataChangeCallBack:e=>i.isArray(e),change:(e,l)=>(i.isObject(e)||i.isArray(e)||i.isNull(e))&&(i.isString(l)||i.isNumber(l)||i.isBoolean(l)||i.isObject(l)||i.isArray(l)||i.isNull(l)),visibleChange:e=>i.isBoolean(e),removeTag:e=>i.isString(e)||i.isNumber(e)||i.isBoolean(e)||i.isObject(e)||i.isArray(e),clear:()=>!0,blur:e=>e instanceof FocusEvent,focus:e=>e instanceof FocusEvent},s=e.defineComponent({name:"FaSelectV2",props:n,emits:u,slots:a.makeSlots(),setup(t,{attrs:n,slots:u,emit:s,expose:p}){const d=o.useVModel(t,"label",s,{passive:!0}),c=l.useGlobalSize(),f=e.reactive({value:a.withDefineType(),loading:!1,selectorData:a.withDefineType([]),debut:!0,echo:!(t.data?.length>0),nextRefresh:!1}),m=e.ref(),y=async()=>{if(t.requestApi){f.loading=!0;const l=t.initParam??{};try{const e=await t.requestApi(l);f.echo=!1,t.pageResult?f.selectorData=e.rows:f.selectorData=e,s("dataChangeCallBack",f.selectorData)}catch(e){a.consoleError("FaSelect",e),f.selectorData=[]}finally{f.loading=!1}}else f.echo=!1,f.selectorData=t.data},g=e=>{if(t.multiple){const l=e;if(0===l?.length)return f.value=null,d.value=null,s("update:modelValue",null),void s("change",null,null);const t=f.selectorData.filter(e=>l.includes(e.value));f.value=e,d.value=t.map(e=>e.label),s("update:modelValue",e),s("change",t,e)}else{if(i.isNil(e))return f.value=null,d.value=null,s("update:modelValue",null),void s("change",null,null);const l=f.selectorData.find(l=>l.value===e);f.value=e,d.value=l.label,s("update:modelValue",e),s("change",l,e)}},b=()=>{f.value=null,d.value=null,s("clear")},v=async e=>{e&&(f.debut?(f.debut=!1,!t.defaultSelected&&t.lazy&&await y()):f.nextRefresh&&(f.nextRefresh=!1,await y())),s("visibleChange",e)};e.watch(()=>t.modelValue,e=>{if(f.echo&&!i.isNil(e)){const l=!i.isNil(t.label);if(t.multiple){if(!i.isArray(e))return void a.consoleError("FaSelectV2","当启用 multiple 时，传入的 modelValue 必须是Array。");if(l&&!i.isArray(t.label))return void a.consoleError("FaSelectV2","当启用 multiple 时，传入的 modelValue:label 必须是Array。");f.selectorData=e.slice(0,t.multipleLimit>0?t.multipleLimit:e.length).map((e,a)=>({value:e,label:l?t.label[a]:void 0}))}else{if(i.isArray(e))return void a.consoleError("FaSelectV2","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(l&&i.isArray(t.label))return void a.consoleError("FaSelectV2","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");f.selectorData=[{value:e,label:t.label}]}}f.value=e},{immediate:!0}),e.onMounted(async()=>{t.defaultSelected?(await y(),f.selectorData.length>0&&g(t.multiple?[f.selectorData[0].value]:f.selectorData[0].value)):!t.requestApi&&t.data?.length>0?(f.debut=!1,await y()):t.lazy||await y(),e.watch(()=>t.initParam,(e,l)=>{i.isEqual(e,l)||(f.nextRefresh=!0,i.isNil(f.value)||g())}),e.watch(()=>t.data,async()=>{t.requestApi||await y()},{deep:!0})});const h=a.useProps(t,r,["modelValue","popperClass","loading","options","itemHeight"]);return a.useRender(()=>e.createVNode(l.ElSelectV2,e.mergeProps(h.value,{ref:m,class:"fa-select-v2",popperClass:`${t.moreDetail&&"fa-select-v2-dropdown__more-detail"} ${t.popperClass}`,style:{width:a.addUnit(t.width)},modelValue:f.value,"onUpdate:modelValue":e=>f.value=e,loading:f.loading,options:f.selectorData,itemHeight:t.itemHeight+("small"===c.value?0:8),onChange:g,onClear:b,onVisibleChange:v,onRemoveTag:e=>s("removeTag",e),onBlur:e=>s("blur",e),onFocus:e=>s("focus",e)}),{...u.default&&{default:({item:e,index:l,disabled:t})=>u.default({item:e,index:l,disabled:t})},...u.header&&{header:()=>u.header()},...u.footer&&{footer:()=>u.footer()},...u.prefix&&{prefix:()=>u.prefix()},...u.empty&&{empty:()=>u.empty()},...u.tag&&{tag:()=>u.tag()},...u.loading&&{loading:()=>u.loading()},...u.label&&{label:({label:e,value:l})=>u.label({label:e,value:l})}})),a.useExpose(p,{focus:e.computed(()=>m.value?.focus),blur:e.computed(()=>m.value?.blur),selectedLabel:e.computed(()=>m.value?.selectedLabel),loading:e.computed(()=>f.loading),refresh:y,setSelection:e=>g(e),clearSelection:()=>g(null)})}});exports.SelectV2Props=r,exports.default=s,exports.faSelectV2Emits=u,exports.faSelectV2Props=n;
//# sourceMappingURL=selectV2.js.map
