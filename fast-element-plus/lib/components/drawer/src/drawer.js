"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),o=require("element-plus"),l=require("@element-plus/icons-vue"),a=require("@fast-element-plus/icons-vue"),t=require("@fast-china/utils"),r=require("lodash-unified"),n={...o.drawerProps,appendToBody:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},destroyOnClose:{type:Boolean,default:!0},showRefresh:{type:Boolean,default:!0},showFullscreen:{type:Boolean,default:!0},showCloseButton:{type:Boolean,default:!0},showConfirmButton:{type:Boolean,default:!0},disabledConfirmButton:Boolean,closeButtonText:{type:String,default:"取消"},confirmButtonText:{type:String,default:"确认"},hideFooter:Boolean,showBeforeClose:Boolean,afterOpen:{type:t.definePropType(Function)}},i={...o.drawerEmits,"update:modelValue":e=>r.isBoolean(e),confirmClick:()=>!0},s=e.defineComponent({name:"FaDrawer",props:n,emits:i,slots:t.makeSlots(),setup(r,{attrs:n,slots:i,emit:s,expose:d}){const c=o.useGlobalSize(),u=e.reactive({loading:!1,visible:!1,fullscreen:!1,size:r.size??"30%",dragging:!1,refreshing:!1}),f=e.ref();let _;const g=o=>{u.visible=!0,_=o,e.nextTick(()=>{u.loading=!0,t.execFunction(r.afterOpen??o).then(()=>{s("open")}).catch(e=>{t.consoleError("FaDrawer",e),u.visible=!1}).finally(()=>{u.loading=!1})})},m=e=>{u.loading=!0,t.execFunction(e).then(()=>{s("close"),u.visible=!1}).catch(e=>{t.consoleError("FaDrawer",e)}).finally(()=>{u.loading=!1})},p=()=>{u.refreshing=!0,u.loading=!0,setTimeout(()=>{u.refreshing=!1,g(_),o.ElMessage.success("刷新成功")},500)},h=e=>{if(u.loading)return;if(document.querySelector(".el-image-viewer__wrapper"))return;const l=()=>{t.execFunction(r.beforeClose).then(()=>{s("close"),e()}).catch(e=>{t.consoleError("FaDialog",e)})};r.showBeforeClose?o.ElMessageBox.confirm("确定关闭？",{type:"warning"}).then(()=>{l()}):l()},w=()=>{u.loading||(u.fullscreen=!u.fullscreen)},v=()=>{u.loading||s("confirmClick")},b=()=>{u.loading||m()};e.watch(()=>u.visible,e=>{s("update:modelValue",e)});const B=()=>{document.onmousemove=e=>{let o=document.body.clientWidth-e.pageX;const l=.2*document.body.clientWidth,a=.95*document.body.clientWidth;o=o>a?a:o<l?l:o,u.size=`${o}px`},document.onmouseup=()=>{document.onmousemove=document.onmouseup=null}},C=t.useProps(r,o.drawerProps,["modelValue","size","showClose","beforeClose"]),V=t.useEmits(o.drawerEmits,s,["update:modelValue"]);return t.useRender(()=>e.createVNode(o.ElDrawer,e.mergeProps(C.value,V.value,{ref:f,class:["fa-drawer",`fa-drawer-${c.value}`,{"fa-drawer__fullscreen":u.fullscreen}],modelValue:u.visible,"onUpdate:modelValue":e=>u.visible=e,size:u.size,showClose:!1,beforeClose:h}),{header:()=>e.createVNode(e.Fragment,null,[e.createVNode("div",{class:"fa-drawer__header-title"},[r.title,i.header&&i.header({loading:u.loading,close:b})]),r.showRefresh&&e.createVNode("div",{title:"刷新",class:["fa-drawer__header-icon",u.loading?"fa__click__disabled fa__click__disabled__cursor ":"fa__hover__twinkle"],onClick:p},[e.createVNode(o.ElIcon,{class:"icon"},{default:()=>[e.createVNode(l.Refresh,null,null)]})]),r.showFullscreen&&e.createVNode("div",{title:u.fullscreen?"关闭全屏显示":"全屏显示",class:["fa-drawer__header-icon",u.loading?"fa__click__disabled fa__click__disabled__cursor ":"fa__hover__twinkle"],onClick:w},[e.createVNode(o.ElIcon,null,{default:()=>[u.fullscreen?e.createVNode(a.FullScreenExit,null,null):e.createVNode(a.FullScreen,null,null)]})]),r.showClose&&e.createVNode("div",{title:"关闭",class:["fa-drawer__header-icon",u.loading?"fa__click__disabled fa__click__disabled__cursor ":"fa__hover__twinkle"],onClick:b},[e.createVNode(o.ElIcon,{class:"icon"},{default:()=>[e.createVNode(l.Close,null,null)]})])]),default:()=>e.createVNode(e.Fragment,null,[r.draggable&&e.createVNode("div",{class:"fa-drawer__draggable",onmousedown:B},null),e.withDirectives(e.createVNode(o.ElScrollbar,{"element-loading-text":"加载中..."},{default:()=>[!u.refreshing&&i.default&&i.default(u)]}),[[e.resolveDirective("loading"),u.loading]])]),...!r.hideFooter&&{footer:()=>e.createVNode(e.Fragment,null,[i.footer&&i.footer({loading:u.loading,close:b}),r.showCloseButton&&e.createVNode(o.ElButton,{disabled:u.loading,onClick:b},{default:()=>[r.closeButtonText]}),r.showConfirmButton&&e.createVNode(o.ElButton,{loading:u.loading,loadingIcon:l.Eleme,disabled:r.disabledConfirmButton,type:"primary",onClick:v},{default:()=>[u.loading?"加载中...":r.confirmButtonText]})])}})),t.useExpose(d,{handleClose:e.computed(()=>f.value?.handleClose),afterEnter:e.computed(()=>f.value?.afterEnter),afterLeave:e.computed(()=>f.value?.afterLeave),loading:e.computed(()=>u.loading),visible:e.computed(()=>u.visible),open:g,close:m,refresh:p,doLoading:e=>{u.loading=!0,t.execFunction(e).then().catch(e=>{t.consoleError("FaDrawer",e)}).finally(()=>{u.loading=!1})}})}});exports.default=s,exports.faDrawerEmits=i,exports.faDrawerProps=n;
//# sourceMappingURL=drawer.js.map
