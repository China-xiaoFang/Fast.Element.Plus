"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),t=require("element-plus"),a=require("@element-plus/icons-vue"),l=require("@fast-china/utils"),r=require("@vueuse/core"),d=require("lodash-unified"),o=require("./tree.props.js"),u={...o.treeProps,disabled:{type:Boolean,default:void 0},nodeKey:{type:String,default:"value"},defaultExpandAll:{type:Boolean,default:!0},checkOnClickNode:{type:Boolean,default:!0},highlightCurrent:{type:Boolean,default:!0},collapseOnClickNode:Boolean,modelValue:{type:l.definePropType([String,Number,Boolean,Object]),default:void 0},label:String,width:{type:[String,Number],default:180},defaultSelection:[String,Number],title:String,hamburger:Boolean,hideAll:Boolean,hideFilter:Boolean,allValue:{type:l.definePropType([String,Number,Boolean,Object]),default:void 0},data:{type:l.definePropType(Array),default:()=>[]},requestApi:{type:l.definePropType(Function)},initParam:l.definePropType([String,Number,Object])},n={...t.treeEmits,"update:modelValue":e=>d.isString(e)||d.isNumber(e)||d.isBoolean(e)||d.isObject(e)||d.isNull(e),"update:label":e=>d.isString(e)||d.isNull(e),dataChangeCallBack:e=>d.isArray(e),change:(e,t,a,l)=>!0},i=e.defineComponent({name:"FaTree",props:u,emits:n,slots:l.makeSlots(),setup(d,{attrs:u,slots:n,emit:i,expose:s}){const c=r.useVModel(d,"label",i,{passive:!0}),p=t.useGlobalSize(),h=e.reactive({value:l.withDefineType(),loading:!1,searchValue:l.withDefineType(),orgTreeData:l.withDefineType([]),treeData:l.withDefineType([]),hamburger:d.hamburger||!1,width:e.computed(()=>{if(h.hamburger)return"130px";{const e=l.addUnit(d.width);return"small"===p.value?`calc(${e} * 0.9)`:e}})}),f=e.computed(()=>0===[...h.orgTreeData].filter(e=>e[d.props.children]?.length>0).length),m=e.ref(),g=async()=>{let t;d.nodeKey&&(t=m.value.getCurrentKey());let a=[];if(d.requestApi){h.loading=!0;const e={...d.initParam??{},searchValue:h.searchValue};try{a=await d.requestApi(e)}catch(r){l.consoleError("FaTree",r)}finally{h.loading=!1}}else a=d.data;d.hideAll||a.unshift({[d.nodeKey]:d.allValue,label:"全部",value:null,all:!0}),h.orgTreeData=a,h.treeData=a,i("dataChangeCallBack",h.treeData),d.nodeKey&&t?e.nextTick(()=>{m.value.setCurrentKey(t)}):d.defaultSelection&&e.nextTick(()=>{m.value.setCurrentKey(d.defaultSelection)})},y=()=>{h.hamburger?h.treeData=h.orgTreeData:h.treeData=h.orgTreeData.map(e=>({...e,[d.props.children]:[]})),h.hamburger=!h.hamburger},v=(e,t,a)=>{if(!e)return!0;let l=a.parent,r=t.all?[t.label]:[a.label],o=1;for(;o<a.level;)r=[...r,l.label],l=l.parent,o++;const u=r.some(t=>-1!==t.indexOf(e));return d.filterNodeMethod?u&&d.filterNodeMethod(e,t,a):u},N=(e,t,a,l)=>{d.expandOnClickNode&&(t.expanded?t.expanded&&d.collapseOnClickNode&&t.collapse():t.expand()),h.value=t.key,c.value=t.label,i("update:modelValue",h.value),i("change",e,t,a,l),i("node-click",e,t,a,l)};e.onMounted(async()=>{await g(),e.watch(()=>d.data,async()=>{d.requestApi||await g()},{deep:!0})});const b=l.useProps(d,o.treeProps,["data","expandOnClickNode","filterNodeMethod"]),C=l.useEmits(t.treeEmits,i,["node-click"]);return l.useRender(()=>e.withDirectives(e.createVNode("div",{class:["el-card fa-tree",`fa-tree-${p.value}`,{"fa-tree__fold":h.hamburger||f.value}],style:{width:h.width}},[(d.title||d.hamburger)&&e.createVNode("div",{class:"fa-tree__title"},[d.title&&e.createVNode("h4",null,[d.title]),d.hamburger&&(h.hamburger?e.createVNode(t.ElIcon,{onClick:y,title:"展开"},{default:()=>[e.createVNode(a.Expand,null,null)]}):e.createVNode(t.ElIcon,{onClick:y,title:"折叠"},{default:()=>[e.createVNode(a.Fold,null,null)]}))]),!d.hideFilter&&e.createVNode(t.ElInput,{class:"fa-tree__search-input",modelValue:h.searchValue,modelModifiers:{trim:!0},"onUpdate:modelValue":e=>h.searchValue=e,placeholder:h.hamburger?"关键字过滤":"输入关键字进行过滤",clearable:!0,onInput:e=>m.value.filter(e)},null),e.createVNode(t.ElScrollbar,{class:"fa-tree__scrollbar"},{default:()=>[e.createVNode(t.ElTree,e.mergeProps(b.value,C.value,{ref:m,data:h.treeData,expandOnClickNode:!d.checkOnClickNode&&d.expandOnClickNode,filterNodeMethod:v,onNodeClick:N}),{default:({node:t,data:a})=>e.createVNode("span",{class:"el-tree-node__label",title:a?.all?a.label:t.label,style:{paddingLeft:f.value?"3px":""}},[e.createVNode("div",null,[a?.all?a.label:n.label?n.label({node:t,data:a}):t.label]),t.key&&a.showQuantity?e.createVNode("span",null,[e.createTextVNode("["),a.quantity,e.createTextVNode("]")]):null,!a?.all&&n.default&&e.createVNode("span",null,[n.default({node:t,data:a})])]),...n.empty&&{empty:()=>n.empty()}})]})]),[[e.resolveDirective("loading"),h.loading]])),l.useExpose(s,{filter:e.computed(()=>m.value?.filter),updateKeyChildren:e.computed(()=>m.value?.updateKeyChildren),getCheckedNodes:e.computed(()=>m.value?.getCheckedNodes),setCheckedNodes:e.computed(()=>m.value?.setCheckedNodes),getCheckedKeys:e.computed(()=>m.value?.getCheckedKeys),setCheckedKeys:e.computed(()=>m.value?.setCheckedKeys),setChecked:e.computed(()=>m.value?.setChecked),getHalfCheckedNodes:e.computed(()=>m.value?.getHalfCheckedNodes),getHalfCheckedKeys:e.computed(()=>m.value?.getHalfCheckedKeys),getCurrentKey:e.computed(()=>m.value?.getCurrentKey),getCurrentNode:e.computed(()=>m.value?.getCurrentNode),setCurrentKey:e.computed(()=>m.value?.setCurrentKey),setCurrentNode:e.computed(()=>m.value?.setCurrentNode),getNode:e.computed(()=>m.value?.getNode),remove:e.computed(()=>m.value?.remove),append:e.computed(()=>m.value?.append),insertBefore:e.computed(()=>m.value?.insertBefore),insertAfter:e.computed(()=>m.value?.insertAfter),loading:e.computed(()=>h.loading),refresh:g})}});exports.default=i,exports.faTreeEmits=n,exports.faTreeProps=u;
//# sourceMappingURL=tree.js.map
