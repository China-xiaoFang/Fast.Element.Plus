"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),t=require("element-plus"),a=require("@element-plus/icons-vue"),r=require("@fast-china/utils"),l=require("@vueuse/core"),o=require("lodash-unified"),n=require("./tree.props.js"),d={...n.treeProps,nodeKey:{type:String,default:"value"},defaultExpandAll:{type:Boolean,default:!0},checkOnClickNode:{type:Boolean,default:!0},highlightCurrent:{type:Boolean,default:!0},collapseOnClickNode:Boolean,modelValue:{type:r.definePropType([String,Number,Boolean,Object]),default:void 0},label:String,width:{type:[String,Number],default:180},defaultSelection:[String,Number],title:String,hamburger:Boolean,hideAll:Boolean,hideFilter:Boolean,allValue:{type:r.definePropType([String,Number,Boolean,Object]),default:void 0},data:{type:r.definePropType(Array),default:()=>[]},requestApi:{type:r.definePropType(Function)},initParam:r.definePropType([String,Number,Object])},i={"update:modelValue":e=>o.isString(e)||o.isNumber(e)||o.isBoolean(e)||o.isObject(e)||o.isNull(e),"update:label":e=>o.isString(e)||o.isNull(e),dataChangeCallBack:(e,t)=>o.isArray(e)&&o.isArray(t),change:(e,t,a,r)=>o.isObject(e)&&o.isObject(t)&&o.isObject(a)&&r instanceof MouseEvent,nodeClick:(e,t,a,r)=>o.isObject(e)&&o.isObject(t)&&o.isObject(a)&&r instanceof MouseEvent,nodeContextmenu:(e,t,a,r)=>e instanceof Event&&o.isObject(t)&&o.isObject(a)&&o.isObject(r),checkChange:(e,t,a)=>o.isObject(e)&&o.isBoolean(t)&&o.isBoolean(a),check:(e,t)=>o.isObject(e)&&o.isObject(t),currentChange:(e,t)=>o.isObject(e)&&o.isObject(t),nodeExpand:(e,t,a)=>o.isObject(e)&&o.isObject(t)&&o.isObject(a),nodeCollapse:(e,t,a)=>o.isObject(e)&&o.isObject(t)&&o.isObject(a),nodeDragStart:(e,t)=>o.isObject(e)&&t instanceof DragEvent,nodeDragEnter:(e,t,a)=>o.isObject(e)&&o.isObject(t)&&a instanceof DragEvent,nodeDragLeave:(e,t,a)=>o.isObject(e)&&o.isObject(t)&&a instanceof DragEvent,nodeDragOver:(e,t,a)=>o.isObject(e)&&o.isObject(t)&&a instanceof DragEvent,nodeDragEnd:(e,t,a,r)=>o.isObject(e)&&o.isObject(t)&&o.isString(a)&&r instanceof DragEvent,nodeDrop:(e,t,a,r)=>o.isObject(e)&&o.isObject(t)&&o.isString(a)&&r instanceof DragEvent},u=e.defineComponent({name:"FaTree",props:d,emits:i,slots:r.makeSlots(),setup(o,{attrs:d,slots:i,emit:u,expose:c}){const s=l.useVModel(o,"label",u,{passive:!0}),p=t.useGlobalSize(),g=e.reactive({value:r.withDefineType(),loading:!1,searchValue:r.withDefineType(),orgTreeData:r.withDefineType([]),treeData:r.withDefineType([]),hamburger:!1,width:e.computed(()=>{if(o.hamburger||g.hamburger)return"130px";{const e=r.addUnit(o.width);return"small"===p.value?`calc(${e} * 0.9)`:e}})}),h=e.computed(()=>0===[...g.orgTreeData].filter(e=>e[o.props.children]?.length>0).length),f=e.ref(),b=e=>{o.hideAll||e.unshift({[o.nodeKey]:o.allValue,label:"全部",all:!0}),g.treeData=e},m=async()=>{let t;if(o.nodeKey&&(t=f.value.getCurrentKey()),o.requestApi){g.loading=!0;const e={...o.initParam??{},searchValue:g.searchValue};try{const t=await o.requestApi(e);g.orgTreeData=t,b(t)}catch(a){r.consoleError("FaTree",a),g.orgTreeData=[],b([]),u("dataChangeCallBack",g.treeData,g.orgTreeData)}finally{g.loading=!1}}else g.orgTreeData=o.data,b(o.data);o.nodeKey&&t?e.nextTick(()=>{f.value.setCurrentKey(t)}):o.defaultSelection&&e.nextTick(()=>{f.value.setCurrentKey(o.defaultSelection)})},v=()=>{o.hamburger||g.hamburger?b(g.orgTreeData):g.treeData=g.orgTreeData.map(e=>({...e,[o.props.children]:[]})),g.hamburger=!g.hamburger},C=(e,t,a)=>{if(!e)return!0;let r=a.parent,l=t.all?[t.label]:[a.label],n=1;for(;n<a.level;)l=[...l,r.label],r=r.parent,n++;const d=l.some(t=>-1!==t.indexOf(e));return o.filterNodeMethod?d&&o.filterNodeMethod(e,t,a):d},N=(e,t,a,r)=>{o.expandOnClickNode&&(t.expanded?t.expanded&&o.collapseOnClickNode&&t.collapse():t.expand()),g.value=t.key,s.value=t.label,u("update:modelValue",g.value),u("change",e,t,a,r),u("nodeClick",e,t,a,r)};e.onMounted(async()=>{await m(),e.watch(()=>o.data,async()=>{o.requestApi||await m()},{deep:!0})});const y=r.useProps(o,n.treeProps,["data","expandOnClickNode","filterNodeMethod"]);return r.useRender(()=>e.withDirectives(e.createVNode("div",{class:["el-card fa-tree",`fa-tree-${p.value}`,{"fa-tree__fold":o.hamburger&&g.hamburger||h.value}],style:{width:g.width}},[(o.title||o.hamburger)&&e.createVNode("div",{class:"fa-tree__title"},[o.title&&e.createVNode("h4",null,[o.title]),o.hamburger&&(g.hamburger?e.createVNode(t.ElIcon,{onClick:v,title:"展开"},{default:()=>[e.createVNode(a.Expand,null,null)]}):e.createVNode(t.ElIcon,{onClick:v,title:"折叠"},{default:()=>[e.createVNode(a.Fold,null,null)]}))]),!o.hideFilter&&e.createVNode(t.ElInput,{class:"fa-tree__search-input",modelValue:g.searchValue,modelModifiers:{trim:!0},"onUpdate:modelValue":e=>g.searchValue=e,placeholder:o.hamburger||g.hamburger?"关键字过滤":"输入关键字进行过滤",clearable:!0,onInput:e=>f.value.filter(e)},null),e.createVNode(t.ElScrollbar,{class:"fa-tree__scrollbar"},{default:()=>[e.createVNode(t.ElTree,e.mergeProps(y.value,{ref:f,data:g.treeData,expandOnClickNode:!o.checkOnClickNode&&o.expandOnClickNode,filterNodeMethod:C,onNodeClick:N,onNodeContextmenu:(e,t,a,r)=>u("nodeContextmenu",e,t,a,r),onCheckChange:(e,t,a)=>u("checkChange",e,t,a),onCheck:(e,t)=>u("check",e,t),onCurrentChange:(e,t)=>u("currentChange",e,t),onNodeExpand:(e,t,a)=>u("nodeExpand",e,t,a),onNodeCollapse:(e,t,a)=>u("nodeCollapse",e,t,a),onNodeDragStart:(e,t)=>u("nodeDragStart",e,t),onNodeDragEnter:(e,t,a)=>u("nodeDragEnter",e,t,a),onNodeDragLeave:(e,t,a)=>u("nodeDragLeave",e,t,a),onNodeDragOver:(e,t,a)=>u("nodeDragOver",e,t,a),onNodeDragEnd:(e,t,a,r)=>u("nodeDragEnd",e,t,a,r),onNodeDrop:(e,t,a,r)=>u("nodeDrop",e,t,a,r)}),{default:({node:t,data:a})=>e.createVNode("span",{class:"el-tree-node__label",title:a?.all?a.label:t.label,style:{paddingLeft:h.value?"3px":""}},[e.createVNode("span",null,[i.label?i.label({node:t,data:a}):a?.all?a.label:t.label]),t.key&&a.showNum?e.createVNode("span",null,[e.createTextVNode("["),a.quantity,e.createTextVNode("]")]):null,i.default&&e.createVNode("span",null,[i.default({node:t,data:a})])]),...i.empty&&{empty:()=>i.empty()}})]})]),[[e.resolveDirective("loading"),g.loading]])),r.useExpose(c,{filter:e.computed(()=>f.value?.filter),updateKeyChildren:e.computed(()=>f.value?.updateKeyChildren),getCheckedNodes:e.computed(()=>f.value?.getCheckedNodes),setCheckedNodes:e.computed(()=>f.value?.setCheckedNodes),getCheckedKeys:e.computed(()=>f.value?.getCheckedKeys),setCheckedKeys:e.computed(()=>f.value?.setCheckedKeys),setChecked:e.computed(()=>f.value?.setChecked),getHalfCheckedNodes:e.computed(()=>f.value?.getHalfCheckedNodes),getHalfCheckedKeys:e.computed(()=>f.value?.getHalfCheckedKeys),getCurrentKey:e.computed(()=>f.value?.getCurrentKey),getCurrentNode:e.computed(()=>f.value?.getCurrentNode),setCurrentKey:e.computed(()=>f.value?.setCurrentKey),setCurrentNode:e.computed(()=>f.value?.setCurrentNode),getNode:e.computed(()=>f.value?.getNode),remove:e.computed(()=>f.value?.remove),append:e.computed(()=>f.value?.append),insertBefore:e.computed(()=>f.value?.insertBefore),insertAfter:e.computed(()=>f.value?.insertAfter),loading:e.computed(()=>g.loading),refresh:m})}});exports.default=u,exports.faTreeEmits=i,exports.faTreeProps=d;
//# sourceMappingURL=tree.js.map
