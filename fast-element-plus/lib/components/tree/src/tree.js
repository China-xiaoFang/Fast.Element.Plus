"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),t=require("element-plus"),a=require("@element-plus/icons-vue"),r=require("@fast-china/utils"),l=require("@vueuse/core"),n=require("lodash-unified"),o=require("./tree.props.js"),d={...o.treeProps,nodeKey:{type:String,default:"value"},defaultExpandAll:{type:Boolean,default:!0},checkOnClickNode:{type:Boolean,default:!0},highlightCurrent:{type:Boolean,default:!0},collapseOnClickNode:Boolean,modelValue:{type:r.definePropType([String,Number,Boolean,Object]),default:void 0},label:String,width:{type:[String,Number],default:180},defaultSelection:[String,Number],title:String,hamburger:Boolean,hideAll:Boolean,hideFilter:Boolean,allValue:{type:r.definePropType([String,Number,Boolean,Object]),default:void 0},data:{type:r.definePropType(Array),default:()=>[]},requestApi:{type:r.definePropType(Function)},initParam:r.definePropType([String,Number,Object])},u={"update:modelValue":e=>n.isString(e)||n.isNumber(e)||n.isBoolean(e)||n.isObject(e)||n.isNull(e),"update:label":e=>n.isString(e)||n.isNull(e),dataChangeCallBack:(e,t)=>n.isArray(e)&&n.isArray(t),change:(e,t,a,r)=>n.isObject(e)&&n.isObject(t)&&n.isObject(a)&&r instanceof MouseEvent,nodeClick:(e,t,a,r)=>n.isObject(e)&&n.isObject(t)&&n.isObject(a)&&r instanceof MouseEvent,nodeContextmenu:(e,t,a,r)=>e instanceof Event&&n.isObject(t)&&n.isObject(a)&&n.isObject(r),checkChange:(e,t,a)=>n.isObject(e)&&n.isBoolean(t)&&n.isBoolean(a),check:(e,t)=>n.isObject(e)&&n.isObject(t),currentChange:(e,t)=>n.isObject(e)&&n.isObject(t),nodeExpand:(e,t,a)=>n.isObject(e)&&n.isObject(t)&&n.isObject(a),nodeCollapse:(e,t,a)=>n.isObject(e)&&n.isObject(t)&&n.isObject(a),nodeDragStart:(e,t)=>n.isObject(e)&&t instanceof DragEvent,nodeDragEnter:(e,t,a)=>n.isObject(e)&&n.isObject(t)&&a instanceof DragEvent,nodeDragLeave:(e,t,a)=>n.isObject(e)&&n.isObject(t)&&a instanceof DragEvent,nodeDragOver:(e,t,a)=>n.isObject(e)&&n.isObject(t)&&a instanceof DragEvent,nodeDragEnd:(e,t,a,r)=>n.isObject(e)&&n.isObject(t)&&n.isString(a)&&r instanceof DragEvent,nodeDrop:(e,t,a,r)=>n.isObject(e)&&n.isObject(t)&&n.isString(a)&&r instanceof DragEvent},i=e.defineComponent({name:"FaTree",props:d,emits:u,slots:r.makeSlots(),setup(n,{attrs:d,slots:u,emit:i,expose:c}){const s=l.useVModel(n,"label",i,{passive:!0}),p=t.useGlobalSize(),v=e.reactive({value:r.withDefineType(),loading:!1,searchValue:r.withDefineType(),orgTreeData:r.withDefineType([]),treeData:r.withDefineType([]),hamburger:!1,width:e.computed(()=>{if(n.hamburger||v.hamburger)return"130px";{const e=r.addUnit(n.width);return"small"===p.value?`calc(${e} * 0.9)`:e}})}),g=e.computed(()=>0===[...v.orgTreeData].filter(e=>{var t;return(null==(t=e[n.props.children])?void 0:t.length)>0}).length),h=e.ref(),f=e=>{n.hideAll||e.unshift({[n.nodeKey]:n.allValue,label:"全部",all:!0}),v.treeData=e},b=async()=>{let t;if(n.nodeKey&&(t=h.value.getCurrentKey()),n.requestApi){v.loading=!0;const e={...n.initParam??{},searchValue:v.searchValue};try{const t=await n.requestApi(e);v.orgTreeData=t,f(t)}catch(a){r.consoleError("FaTree",a),v.orgTreeData=[],f([]),i("dataChangeCallBack",v.treeData,v.orgTreeData)}finally{v.loading=!1}}else v.orgTreeData=n.data,f(n.data);n.nodeKey&&t?e.nextTick(()=>{h.value.setCurrentKey(t)}):n.defaultSelection&&e.nextTick(()=>{h.value.setCurrentKey(n.defaultSelection)})},m=()=>{n.hamburger||v.hamburger?f(v.orgTreeData):v.treeData=v.orgTreeData.map(e=>({...e,[n.props.children]:[]})),v.hamburger=!v.hamburger},C=(e,t,a)=>{if(!e)return!0;let r=a.parent,l=t.all?[t.label]:[a.label],o=1;for(;o<a.level;)l=[...l,r.label],r=r.parent,o++;const d=l.some(t=>-1!==t.indexOf(e));return n.filterNodeMethod?d&&n.filterNodeMethod(e,t,a):d},N=(e,t,a,r)=>{n.expandOnClickNode&&(t.expanded?t.expanded&&n.collapseOnClickNode&&t.collapse():t.expand()),v.value=t.key,s.value=t.label,i("update:modelValue",v.value),i("change",e,t,a,r),i("nodeClick",e,t,a,r)};e.onMounted(async()=>{await b(),e.watch(()=>n.data,async()=>{n.requestApi||await b()},{deep:!0})});const y=r.useProps(n,o.treeProps,["data","expandOnClickNode","filterNodeMethod"]);return r.useRender(()=>e.withDirectives(e.createVNode("div",{class:["el-card fa-tree",`fa-tree-${p.value}`,{"fa-tree__fold":n.hamburger&&v.hamburger||g.value}],style:{width:v.width}},[(n.title||n.hamburger)&&e.createVNode("div",{class:"fa-tree__title"},[n.title&&e.createVNode("h4",null,[n.title]),n.hamburger&&(v.hamburger?e.createVNode(t.ElIcon,{onClick:m,title:"展开"},{default:()=>[e.createVNode(a.Expand,null,null)]}):e.createVNode(t.ElIcon,{onClick:m,title:"折叠"},{default:()=>[e.createVNode(a.Fold,null,null)]}))]),!n.hideFilter&&e.createVNode(t.ElInput,{class:"fa-tree__search-input",modelValue:v.searchValue,modelModifiers:{trim:!0},"onUpdate:modelValue":e=>v.searchValue=e,placeholder:n.hamburger||v.hamburger?"关键字过滤":"输入关键字进行过滤",clearable:!0,onInput:e=>h.value.filter(e)},null),e.createVNode(t.ElScrollbar,{class:"fa-tree__scrollbar"},{default:()=>[e.createVNode(t.ElTree,e.mergeProps(y.value,{ref:h,data:v.treeData,expandOnClickNode:!n.checkOnClickNode&&n.expandOnClickNode,filterNodeMethod:C,onNodeClick:N,onNodeContextmenu:(e,t,a,r)=>i("nodeContextmenu",e,t,a,r),onCheckChange:(e,t,a)=>i("checkChange",e,t,a),onCheck:(e,t)=>i("check",e,t),onCurrentChange:(e,t)=>i("currentChange",e,t),onNodeExpand:(e,t,a)=>i("nodeExpand",e,t,a),onNodeCollapse:(e,t,a)=>i("nodeCollapse",e,t,a),onNodeDragStart:(e,t)=>i("nodeDragStart",e,t),onNodeDragEnter:(e,t,a)=>i("nodeDragEnter",e,t,a),onNodeDragLeave:(e,t,a)=>i("nodeDragLeave",e,t,a),onNodeDragOver:(e,t,a)=>i("nodeDragOver",e,t,a),onNodeDragEnd:(e,t,a,r)=>i("nodeDragEnd",e,t,a,r),onNodeDrop:(e,t,a,r)=>i("nodeDrop",e,t,a,r)}),{default:({node:t,data:a})=>e.createVNode("span",{class:"el-tree-node__label",title:(null==a?void 0:a.all)?a.label:t.label,style:{paddingLeft:g.value?"3px":""}},[e.createVNode("span",null,[u.label?u.label({node:t,data:a}):(null==a?void 0:a.all)?a.label:t.label]),t.key&&a.showNum?e.createVNode("span",null,[e.createTextVNode("["),a.quantity,e.createTextVNode("]")]):null,u.default&&e.createVNode("span",null,[u.default({node:t,data:a})])]),...u.empty&&{empty:()=>u.empty()}})]})]),[[e.resolveDirective("loading"),v.loading]])),r.useExpose(c,{filter:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.filter}),updateKeyChildren:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.updateKeyChildren}),getCheckedNodes:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.getCheckedNodes}),setCheckedNodes:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.setCheckedNodes}),getCheckedKeys:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.getCheckedKeys}),setCheckedKeys:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.setCheckedKeys}),setChecked:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.setChecked}),getHalfCheckedNodes:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.getHalfCheckedNodes}),getHalfCheckedKeys:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.getHalfCheckedKeys}),getCurrentKey:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.getCurrentKey}),getCurrentNode:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.getCurrentNode}),setCurrentKey:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.setCurrentKey}),setCurrentNode:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.setCurrentNode}),getNode:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.getNode}),remove:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.remove}),append:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.append}),insertBefore:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.insertBefore}),insertAfter:e.computed(()=>{var e;return null==(e=h.value)?void 0:e.insertAfter}),loading:e.computed(()=>v.loading),refresh:b})}});exports.default=i,exports.faTreeEmits=u,exports.faTreeProps=d;
//# sourceMappingURL=tree.js.map
