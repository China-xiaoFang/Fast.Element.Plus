{"version":3,"file":"carNumber.js","sources":["../../../../../packages/components/carNumber/src/carNumber.tsx"],"sourcesContent":["import { Fragment, computed, defineComponent, inject, reactive, ref, watch } from \"vue\";\nimport { ElButton, ElInput, ElMessage, ElPopover, formContextKey, formItemContextKey, inputProps } from \"element-plus\";\nimport { Back } from \"@element-plus/icons-vue\";\nimport { RegExps } from \"@fast-element-plus/constants\";\nimport { useProps, useRender, withDefineType } from \"@fast-china/utils\";\nimport { isNull, isString } from \"lodash-unified\";\nimport { CarNumberArea, CarNumberDigit, CarNumberLetter } from \"./common\";\nimport type { PopoverInstance } from \"element-plus\";\n\nexport default defineComponent({\n\tname: \"FaCarNumber\",\n\tprops: {\n\t\t...inputProps,\n\t\t/** @description placeholder */\n\t\tplaceholder: {\n\t\t\ttype: String,\n\t\t\tdefault: \"请选择\",\n\t\t},\n\t},\n\temits: {\n\t\t/** @description v-model 回调 */\n\t\t\"update:modelValue\": (value: string) => isString(value) || isNull(value),\n\t\t/** @description 改变 */\n\t\tchange: (value: string) => isString(value) || isNull(value),\n\t},\n\tsetup(props, { attrs, emit }) {\n\t\tconst state = reactive({\n\t\t\tvalue: withDefineType<string>(),\n\t\t\tswitchLetter: computed(() => {\n\t\t\t\tif (state.value?.length >= 1) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}),\n\t\t\tdisabledButton: computed(() => {\n\t\t\t\tif (state.value?.length >= 8) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}),\n\t\t});\n\n\t\tconst popoverRef = ref<PopoverInstance>();\n\t\t// 获取 el-form 组件上下文\n\t\tconst formContext = inject(formContextKey, undefined);\n\t\t// 获取 el-form-item 组件上下文\n\t\tconst formItemContext = inject(formItemContextKey, undefined);\n\n\t\tconst handleInputFormatter = (value: string): string => {\n\t\t\tif (value.length === 2) {\n\t\t\t\treturn `${value} ● `;\n\t\t\t} else if (value.length > 2) {\n\t\t\t\treturn `${value.slice(0, 2)} ● ${value.slice(2)}`;\n\t\t\t} else {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t};\n\n\t\tconst handleSelectCarNumber = (value: string): void => {\n\t\t\tstate.value ??= \"\";\n\t\t\tstate.value += value;\n\t\t};\n\n\t\tconst handleBackClick = (): void => {\n\t\t\tif (state.value?.length === 0) return;\n\t\t\tstate.value = state.value.substring(0, state.value.length - 1);\n\t\t};\n\n\t\tconst handleConfirmClick = (): void => {\n\t\t\tlet success = false;\n\t\t\tif (state.value.length === 7) {\n\t\t\t\tsuccess = RegExps.CarNumber.test(state.value);\n\t\t\t} else if (state.value.length === 8) {\n\t\t\t\tsuccess = RegExps.NewEnergyCarNumber.test(state.value);\n\t\t\t}\n\t\t\tif (success) {\n\t\t\t\temit(\"update:modelValue\", state.value);\n\t\t\t\temit(\"change\", state.value);\n\t\t\t\t// 调用 el-form 内部的校验方法（可自动校验）\n\t\t\t\tformItemContext?.prop && formContext?.validateField([formItemContext.prop]);\n\t\t\t} else {\n\t\t\t\tif (formItemContext?.prop && formContext) {\n\t\t\t\t\temit(\"update:modelValue\", state.value);\n\t\t\t\t\temit(\"change\", state.value);\n\t\t\t\t\t// 调用 el-form 内部的校验方法（可自动校验）\n\t\t\t\t\tformContext.validateField([formItemContext.prop]);\n\t\t\t\t} else {\n\t\t\t\t\tElMessage.error(\"车牌号格式不正确\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tpopoverRef.value?.hide();\n\t\t};\n\n\t\tconst handleClearClick = (): void => {\n\t\t\tstate.value = null;\n\t\t\temit(\"update:modelValue\", null);\n\t\t\temit(\"change\", null);\n\t\t\t// 调用 el-form 内部的校验方法（可自动校验）\n\t\t\tformItemContext?.prop && formContext?.validateField([formItemContext.prop]);\n\t\t};\n\n\t\twatch(\n\t\t\t() => props.modelValue,\n\t\t\t(newValue) => {\n\t\t\t\tstate.value = newValue.toString();\n\t\t\t},\n\t\t\t{\n\t\t\t\timmediate: true,\n\t\t\t}\n\t\t);\n\n\t\tconst elInputProps = useProps(props, inputProps, [\"modelValue\", \"readonly\", \"formatter\"]);\n\n\t\tuseRender(() => (\n\t\t\t<ElPopover\n\t\t\t\tref={popoverRef}\n\t\t\t\twidth=\"auto\"\n\t\t\t\tpopperClass=\"fa-car-number__popover\"\n\t\t\t\ttrigger=\"click\"\n\t\t\t\tshowArrow={false}\n\t\t\t\tshowAfter={0}\n\t\t\t\thideAfter={0}\n\t\t\t>\n\t\t\t\t{{\n\t\t\t\t\treference: () => (\n\t\t\t\t\t\t<ElInput\n\t\t\t\t\t\t\t{...elInputProps.value}\n\t\t\t\t\t\t\tclass=\"fa-car-number__input\"\n\t\t\t\t\t\t\tvModel={state.value}\n\t\t\t\t\t\t\treadonly\n\t\t\t\t\t\t\tformatter={handleInputFormatter}\n\t\t\t\t\t\t/>\n\t\t\t\t\t),\n\t\t\t\t\tdefault: () => (\n\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t<div class={[\"fa-car-number__popover__area\", state.switchLetter ? \"fa-car-number__popover__hide\" : \"\"]}>\n\t\t\t\t\t\t\t\t{CarNumberArea.map((area) => (\n\t\t\t\t\t\t\t\t\t<ElButton disabled={state.disabledButton} onClick={() => handleSelectCarNumber(area)}>\n\t\t\t\t\t\t\t\t\t\t{area}\n\t\t\t\t\t\t\t\t\t</ElButton>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class={[\"fa-car-number__popover__digit-letter\", state.switchLetter ? \"\" : \"fa-car-number__popover__hide\"]}>\n\t\t\t\t\t\t\t\t{CarNumberDigit.map((digit) => (\n\t\t\t\t\t\t\t\t\t<ElButton disabled={state.disabledButton} onClick={() => handleSelectCarNumber(digit)}>\n\t\t\t\t\t\t\t\t\t\t{digit}\n\t\t\t\t\t\t\t\t\t</ElButton>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t{CarNumberLetter.map((letter) => (\n\t\t\t\t\t\t\t\t\t<ElButton disabled={state.disabledButton} onClick={() => handleSelectCarNumber(letter)}>\n\t\t\t\t\t\t\t\t\t\t{letter}\n\t\t\t\t\t\t\t\t\t</ElButton>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"fa-car-number__popover__btn\">\n\t\t\t\t\t\t\t\t<ElButton\n\t\t\t\t\t\t\t\t\tclass=\"fa-car-number__popover__btn__clear\"\n\t\t\t\t\t\t\t\t\tdisabled={state.value === null || state.value.length === 0}\n\t\t\t\t\t\t\t\t\tonClick={handleClearClick}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t清除\n\t\t\t\t\t\t\t\t</ElButton>\n\t\t\t\t\t\t\t\t<ElButton\n\t\t\t\t\t\t\t\t\tclass=\"fa-car-number__popover__btn__back\"\n\t\t\t\t\t\t\t\t\ttype=\"danger\"\n\t\t\t\t\t\t\t\t\ticon={Back}\n\t\t\t\t\t\t\t\t\tdisabled={state.value === null || state.value.length === 0}\n\t\t\t\t\t\t\t\t\tonClick={handleBackClick}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<ElButton\n\t\t\t\t\t\t\t\t\tclass=\"fa-car-number__popover__btn__confirm\"\n\t\t\t\t\t\t\t\t\ttype=\"primary\"\n\t\t\t\t\t\t\t\t\tdisabled={state.value === null || state.value.length < 7}\n\t\t\t\t\t\t\t\t\tonClick={handleConfirmClick}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t确认\n\t\t\t\t\t\t\t\t</ElButton>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t),\n\t\t\t\t}}\n\t\t\t</ElPopover>\n\t\t));\n\t},\n});\n"],"names":["_isSlot","s","Object","prototype","toString","call","_isVNode","CarNumber","name","props","inputProps","placeholder","type","String","default","emits","isString","value","isNull","change","setup","attrs","emit","state","reactive","withDefineType","switchLetter","computed","length","disabledButton","popoverRef","ref","formContext","inject","formContextKey","undefined","formItemContext","formItemContextKey","handleInputFormatter","slice","handleSelectCarNumber","handleBackClick","substring","handleConfirmClick","success","RegExps","test","NewEnergyCarNumber","prop","validateField","ElMessage","error","hide","handleClearClick","watch","modelValue","newValue","immediate","elInputProps","useProps","useRender","_createVNode","ElPopover","width","popperClass","trigger","showArrow","showAfter","hideAfter","reference","ElInput","_mergeProps","class","$event","readonly","formatter","_Fragment","CarNumberArea","map","area","ElButton","disabled","onClick","CarNumberDigit","digit","CarNumberLetter","letter","_createTextVNode","icon","Back"],"mappings":"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"}