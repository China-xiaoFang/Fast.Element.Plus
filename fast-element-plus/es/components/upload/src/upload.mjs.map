{"version":3,"file":"upload.mjs","sources":["../../../../../packages/components/upload/src/upload.tsx"],"sourcesContent":["import type { VNode } from \"vue\";\nimport { Fragment, computed, defineComponent, ref } from \"vue\";\nimport { UploadFilled } from \"@element-plus/icons-vue\";\nimport { FastApp } from \"@fast-element-plus/settings\";\nimport { definePropType, makeSlots, useExpose, useProps, useRender } from \"@fast-element-plus/utils\";\nimport type { UploadFile, UploadInstance, UploadProps, UploadUserFile } from \"element-plus\";\nimport { ElIcon, ElUpload, uploadProps } from \"element-plus\";\nimport { isArray, isString } from \"lodash-unified\";\nimport { useUpload } from \"./useUpload\";\n\nexport const faUploadProps = {\n\t...uploadProps,\n\t/** @description whether to activate drag and drop mode */\n\tdrag: {\n\t\ttype: Boolean,\n\t\tdefault: true,\n\t},\n\t/** @description maximum number of uploads allowed */\n\tlimit: {\n\t\ttype: Number,\n\t\tdefault: 1,\n\t},\n\t/** @description v-model绑定值 */\n\tmodelValue: definePropType<string | string[]>([String, Array]),\n\t/** @description 大小限制，单位kb */\n\tmaxSize: {\n\t\ttype: definePropType<string | number>([String, Number]),\n\t\tdefault: 5120,\n\t},\n\t/** @description 图片上传地址 */\n\tuploadUrl: {\n\t\ttype: String,\n\t\tdefault: (): string => FastApp.state.upload.url,\n\t},\n\t/** @description 文件类型 */\n\tfileType: Number,\n};\n\nexport const faUploadEmits = {\n\t/** @description v-model 回调 */\n\t\"update:modelValue\": (value: string | string[]): boolean => isString(value) || isArray(value),\n\t/** @description v-model:fileList 回调 */\n\t\"update:fileList\": (value: UploadUserFile[]): boolean => isArray(value),\n\t/** @description 改变 */\n\tchange: (value: string | string[]): boolean => isString(value) || isArray(value),\n};\n\ntype FaUploadSlots = {\n\t/** @description 默认内容插槽 */\n\tdefault: never;\n\t/** @description 触发文件选择框的内容 */\n\ttrigger: never;\n\t/** @description 提示说明文字 */\n\ttip: never;\n\t/** @description 缩略图模板的内容 */\n\tfile: { file: UploadFile; index: number };\n};\n\nexport default defineComponent({\n\tname: \"FaUpload\",\n\tprops: faUploadProps,\n\temits: faUploadEmits,\n\tslots: makeSlots<FaUploadSlots>(),\n\tsetup(props, { attrs, slots, emit, expose }) {\n\t\tconst { fileList, loading, formContext, maxSizeMB, handleHttpRequest, handleOnSuccess, handleOnError, handleOnExceed, handleOnUpload } =\n\t\t\tuseUpload(\"FaUpload\", \"文件\", props, emit, {\n\t\t\t\tmaxSize: props.maxSize,\n\t\t\t\tuploadUrl: props.uploadUrl,\n\t\t\t});\n\n\t\tconst disabled = computed(() => {\n\t\t\treturn props.disabled || formContext?.disabled;\n\t\t});\n\n\t\tconst uploadRef = ref<UploadInstance>();\n\n\t\tconst handleOnChange: UploadProps[\"onChange\"] = (uploadFile, uploadFiles) => {\n\t\t\tif (uploadFile.status !== \"ready\") return;\n\n\t\t\tif (!handleOnUpload(uploadFile)) {\n\t\t\t\tfileList.value = fileList.value.slice(0, -1);\n\t\t\t} else {\n\t\t\t\tprops.onChange && props.onChange(uploadFile, uploadFiles);\n\t\t\t}\n\t\t};\n\n\t\tconst elUploadProps = useProps(props, uploadProps, [\"fileList\", \"disabled\", \"httpRequest\", \"onExceed\", \"onSuccess\", \"onError\", \"onChange\"]);\n\n\t\tuseRender(() => (\n\t\t\t<ElUpload\n\t\t\t\t{...elUploadProps.value}\n\t\t\t\tref={uploadRef}\n\t\t\t\tclass=\"fa-upload\"\n\t\t\t\tvLoading={loading.value}\n\t\t\t\tvModel:fileList={fileList.value}\n\t\t\t\tdisabled={disabled.value}\n\t\t\t\thttpRequest={handleHttpRequest}\n\t\t\t\tonExceed={handleOnExceed}\n\t\t\t\tonSuccess={handleOnSuccess}\n\t\t\t\tonError={handleOnError}\n\t\t\t\tonChange={handleOnChange}\n\t\t\t>\n\t\t\t\t{{\n\t\t\t\t\tdefault: () =>\n\t\t\t\t\t\tslots.default ? (\n\t\t\t\t\t\t\tslots.default()\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t<ElIcon class=\"el-icon--upload\">\n\t\t\t\t\t\t\t\t\t<UploadFilled />\n\t\t\t\t\t\t\t\t</ElIcon>\n\t\t\t\t\t\t\t\t<div class=\"el-upload__text\">\n\t\t\t\t\t\t\t\t\tDrop file here or <em>click to upload</em>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t),\n\t\t\t\t\t...(slots.trigger && { trigger: (): VNode | VNode[] => slots.trigger() }),\n\t\t\t\t\ttip: () =>\n\t\t\t\t\t\tslots.tip ? (\n\t\t\t\t\t\t\tslots.tip()\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t<div class=\"el-upload__tip\">files with a size less than {maxSizeMB.toString()}MB</div>\n\t\t\t\t\t\t\t\t{!props.showFileList && fileList.value.length > 0 && (\n\t\t\t\t\t\t\t\t\t<div class=\"el-upload__tip\">\n\t\t\t\t\t\t\t\t\t\t{fileList.value.map((item, index) => (\n\t\t\t\t\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t\t\t\t\t{item.name}\n\t\t\t\t\t\t\t\t\t\t\t\t{fileList.value.length <= index && <br />}\n\t\t\t\t\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t),\n\t\t\t\t\t...(slots.file && {\n\t\t\t\t\t\tfile: ({ file, index }: { file: UploadFile; index: number }): VNode | VNode[] => slots.file({ file, index }),\n\t\t\t\t\t}),\n\t\t\t\t}}\n\t\t\t</ElUpload>\n\t\t));\n\n\t\treturn useExpose(expose, {\n\t\t\t...computed(() => ({\n\t\t\t\t/** @description cancel upload request */\n\t\t\t\tabort: uploadRef.value?.abort,\n\t\t\t\t/** @description upload the file list manually */\n\t\t\t\tsubmit: uploadRef.value?.submit,\n\t\t\t\t/** @description clear the file list  */\n\t\t\t\tclearFiles: uploadRef.value?.clearFiles,\n\t\t\t\t/** @description select the file manually */\n\t\t\t\thandleStart: uploadRef.value?.handleStart,\n\t\t\t\t/** @description remove the file manually */\n\t\t\t\thandleRemove: uploadRef.value?.handleRemove,\n\t\t\t})).value,\n\t\t\t/** @description 加载状态 */\n\t\t\tloading,\n\t\t\t/** @description 文件集合 */\n\t\t\tfileList,\n\t\t});\n\t},\n});\n"],"names":["faUploadProps","uploadProps","drag","type","Boolean","default","limit","Number","modelValue","definePropType","String","Array","maxSize","uploadUrl","FastApp","state","upload","url","fileType","faUploadEmits","value","isString","isArray","change","defineComponent","name","props","emits","slots","makeSlots","setup","attrs","emit","expose","fileList","loading","formContext","maxSizeMB","handleHttpRequest","handleOnSuccess","handleOnError","handleOnExceed","handleOnUpload","useUpload","disabled","computed","uploadRef","ref","handleOnChange","uploadFile","uploadFiles","status","slice","onChange","elUploadProps","useProps","useRender","_withDirectives","_createVNode","ElUpload","_mergeProps","$event","_Fragment","ElIcon","UploadFilled","_createTextVNode","trigger","tip","toString","showFileList","length","map","item","index","file","_resolveDirective","useExpose","abort","submit","clearFiles","handleStart","handleRemove"],"mappings":"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"}