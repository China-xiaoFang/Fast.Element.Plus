{"version":3,"file":"form.mjs","sources":["../../../../../packages/components/form/src/form.tsx"],"sourcesContent":["import { computed, defineComponent, provide, reactive, ref } from \"vue\";\nimport { ElForm, formProps, useGlobalSize } from \"element-plus\";\nimport { FaLayoutGrid } from \"@fast-element-plus/components/layoutGrid\";\nimport { definePropType, makeSlots, useExpose, useProps, useRender } from \"@fast-china/utils\";\nimport { isNumber, isObject } from \"lodash-unified\";\nimport { formUtil } from \"../utils/form\";\nimport type { FaLayoutGridBreakPoint } from \"@fast-element-plus/components/layoutGrid\";\nimport type { FormInstance, FormItemContext, FormValidationResult } from \"element-plus\";\n\nexport const faFormProps = {\n\t...formProps,\n\t/** @description Width of label, e.g. `'50px'`. All its direct child form items will inherit this value. `auto` is supported. */\n\tlabelWidth: {\n\t\ttype: [String, Number],\n\t\tdefault: \"auto\",\n\t},\n\t/** @description Suffix of the label. */\n\tlabelSuffix: {\n\t\ttype: String,\n\t\tdefault: \"：\",\n\t},\n\t/** @description When validation fails, scroll to the first error form entry. */\n\tscrollToError: {\n\t\ttype: Boolean,\n\t\tdefault: true,\n\t},\n\t/** @description 详情From，会删除 FormItem 的 paddinfa-bottom */\n\tdetailForm: Boolean,\n\t/** @description Grid布局*/\n\tgrid: {\n\t\ttype: Boolean,\n\t\tdefault: true,\n\t},\n\t/** @description Grid布局列配置 */\n\tcols: {\n\t\ttype: definePropType<string | number | Record<FaLayoutGridBreakPoint, number>>([String, Number, Object]),\n\t\tdefault: (): Record<FaLayoutGridBreakPoint, number> => ({ xs: 1, sm: 2, md: 3, lg: 4, xl: 5 }),\n\t},\n};\n\ntype FaFormSlots = {\n\t/** @description 默认内容插槽 */\n\tdefault: unknown;\n};\n\nexport default defineComponent({\n\tname: \"FaForm\",\n\tprops: faFormProps,\n\tslots: makeSlots<FaFormSlots>(),\n\tsetup(props, { attrs, slots, expose }) {\n\t\tconst _globalSize = useGlobalSize();\n\n\t\tconst state = reactive({\n\t\t\tcols: computed(() => {\n\t\t\t\tif (isObject(props.cols)) {\n\t\t\t\t\treturn props.cols;\n\t\t\t\t} else {\n\t\t\t\t\tconst colsNumber = isNumber(props.cols) ? props.cols : Number(props.cols);\n\t\t\t\t\treturn { xs: 1, sm: colsNumber, md: colsNumber, lg: colsNumber, xl: colsNumber };\n\t\t\t\t}\n\t\t\t}),\n\t\t\tgap: computed(() => (_globalSize.value === \"small\" ? [15, 0] : [20, 0])),\n\t\t});\n\n\t\tconst formRef = ref<FormInstance>();\n\n\t\t// 注入 cols\n\t\tprovide(\"faFormCols\", state.cols);\n\n\t\tconst elFormProps = useProps(props, formProps);\n\n\t\tuseRender(() => (\n\t\t\t<ElForm\n\t\t\t\t{...elFormProps.value}\n\t\t\t\tref={formRef}\n\t\t\t\tclass={[\"fa-form\", `fa-form-${_globalSize.value}`, { [`fa-form-detail fa-form-detail_${_globalSize.value}`]: props.detailForm }]}\n\t\t\t>\n\t\t\t\t{{\n\t\t\t\t\tdefault: () =>\n\t\t\t\t\t\tprops.grid ? (\n\t\t\t\t\t\t\t<FaLayoutGrid collapsed gap={state.gap} cols={state.cols}>\n\t\t\t\t\t\t\t\t{slots.default && slots.default(state)}\n\t\t\t\t\t\t\t</FaLayoutGrid>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\tslots.default && slots.default(state)\n\t\t\t\t\t\t),\n\t\t\t\t}}\n\t\t\t</ElForm>\n\t\t));\n\n\t\treturn useExpose(expose, {\n\t\t\t/** @description 对整个表单的内容进行验证。 接收一个回调函数，或返回 Promise。 */\n\t\t\tvalidate: (): FormValidationResult => formUtil.validate(formRef),\n\t\t\t/** @description 验证具体的某个字段。 */\n\t\t\tvalidateField: computed(() => formRef.value?.validateField),\n\t\t\t/** @description 重置该表单项，将其值重置为初始值，并移除校验结果 */\n\t\t\tresetFields: computed(() => formRef.value?.resetFields),\n\t\t\t/** @description 清理某个字段的表单验证信息。 */\n\t\t\tclearValidate: computed(() => formRef.value?.clearValidate),\n\t\t\t/** @description 滚动到指定的字段 */\n\t\t\tscrollToField: computed(() => formRef.value?.scrollToField),\n\t\t\t/** @description 获取所有字段的 context */\n\t\t\tfields: computed(() => formRef.value?.fields as FormItemContext[]),\n\t\t\t/** @description 对整个表单的内容进行验证，带滚动。 接收一个回调函数，或返回 Promise。 */\n\t\t\tvalidateScrollToField: (): FormValidationResult => formUtil.validateScrollToField(formRef),\n\t\t});\n\t},\n});\n"],"names":["faFormProps","formProps","labelWidth","type","String","Number","default","labelSuffix","scrollToError","Boolean","detailForm","grid","cols","definePropType","Object","xs","sm","md","lg","xl","name","props","slots","makeSlots","setup","attrs","expose","_globalSize","useGlobalSize","state","reactive","computed","isObject","colsNumber","isNumber","gap","value","formRef","ref","provide","elFormProps","useProps","useRender","_createVNode","ElForm","_mergeProps","FaLayoutGrid","useExpose","validate","formUtil","validateField","resetFields","clearValidate","scrollToField","fields","validateScrollToField"],"mappings":"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"}