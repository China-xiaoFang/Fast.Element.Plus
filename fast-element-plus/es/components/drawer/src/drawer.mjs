import{defineComponent as e,reactive as l,ref as o,nextTick as a,watch as n,createVNode as t,mergeProps as i,Fragment as d,withDirectives as s,resolveDirective as r,computed as u}from"vue";import{drawerProps as c,drawerEmits as f,useGlobalSize as _,ElMessage as m,ElMessageBox as g,ElDrawer as h,ElButton as p,ElScrollbar as w,ElIcon as v}from"element-plus";import{Eleme as b,Refresh as C,Close as B}from"@element-plus/icons-vue";import{FullScreenExit as y,FullScreen as k}from"@fast-element-plus/icons-vue";import{definePropType as F,execFunction as x,consoleError as z,useProps as T,useEmits as V,useRender as D,useExpose as L,makeSlots as O}from"@fast-china/utils";import{isBoolean as S}from"lodash-unified";const W={...c,appendToBody:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},destroyOnClose:{type:Boolean,default:!0},showRefresh:{type:Boolean,default:!0},showFullscreen:{type:Boolean,default:!0},showCloseButton:{type:Boolean,default:!0},showConfirmButton:{type:Boolean,default:!0},disabledConfirmButton:Boolean,closeButtonText:{type:String,default:"取消"},confirmButtonText:{type:String,default:"确认"},hideFooter:Boolean,showBeforeClose:Boolean,afterOpen:{type:F(Function)}},E={...f,"update:modelValue":e=>S(e),confirmClick:()=>!0},R=/* @__PURE__ */e({name:"FaDrawer",props:W,emits:E,slots:O(),setup(e,{attrs:F,slots:O,emit:S,expose:W}){const E=_(),R=l({loading:!1,visible:!1,fullscreen:!1,size:e.size??"30%",dragging:!1,refreshing:!1}),$=o();let q;const I=l=>{R.visible=!0,q=l,a(()=>{R.loading=!0,x(e.afterOpen??l).then(()=>{S("open")}).catch(e=>{z("FaDrawer",e),R.visible=!1}).finally(()=>{R.loading=!1})})},U=e=>{R.loading=!0,x(e).then(()=>{S("close"),R.visible=!1}).catch(e=>{z("FaDrawer",e)}).finally(()=>{R.loading=!1})},X=()=>{R.refreshing=!0,R.loading=!0,setTimeout(()=>{R.refreshing=!1,I(q),m.success("刷新成功")},500)},j=l=>{if(R.loading)return;if(document.querySelector(".el-image-viewer__wrapper"))return;const o=()=>{x(e.beforeClose).then(()=>{S("close"),l()}).catch(e=>{z("FaDialog",e)})};e.showBeforeClose?g.confirm("确定关闭？",{type:"warning"}).then(()=>{o()}):o()},A=()=>{R.loading||(R.fullscreen=!R.fullscreen)},G=()=>{R.loading||S("confirmClick")},H=()=>{R.loading||U()};n(()=>R.visible,e=>{S("update:modelValue",e)});const J=()=>{document.onmousemove=e=>{let l=document.body.clientWidth-e.pageX;const o=.2*document.body.clientWidth,a=.95*document.body.clientWidth;l=l>a?a:l<o?o:l,R.size=`${l}px`},document.onmouseup=()=>{document.onmousemove=document.onmouseup=null}},K=T(e,c,["modelValue","size","showClose","beforeClose"]),M=V(f,S,["update:modelValue"]);return D(()=>t(h,i(K.value,M.value,{ref:$,class:["fa-drawer",`fa-drawer-${E.value}`,{"fa-drawer__fullscreen":R.fullscreen}],modelValue:R.visible,"onUpdate:modelValue":e=>R.visible=e,size:R.size,showClose:!1,beforeClose:j}),{header:()=>t(d,null,[t("div",{class:"fa-drawer__header-title"},[e.title,O.header&&O.header({loading:R.loading,close:H})]),e.showRefresh&&t("div",{title:"刷新",class:["fa-drawer__header-icon",R.loading?"fa__click__disabled fa__click__disabled__cursor ":"fa__hover__twinkle"],onClick:X},[t(v,{class:"icon"},{default:()=>[t(C,null,null)]})]),e.showFullscreen&&t("div",{title:R.fullscreen?"关闭全屏显示":"全屏显示",class:["fa-drawer__header-icon",R.loading?"fa__click__disabled fa__click__disabled__cursor ":"fa__hover__twinkle"],onClick:A},[t(v,null,{default:()=>[R.fullscreen?t(y,null,null):t(k,null,null)]})]),e.showClose&&t("div",{title:"关闭",class:["fa-drawer__header-icon",R.loading?"fa__click__disabled fa__click__disabled__cursor ":"fa__hover__twinkle"],onClick:H},[t(v,{class:"icon"},{default:()=>[t(B,null,null)]})])]),default:()=>t(d,null,[e.draggable&&t("div",{class:"fa-drawer__draggable",onmousedown:J},null),s(t(w,{"element-loading-text":"加载中..."},{default:()=>[!R.refreshing&&O.default&&O.default(R)]}),[[r("loading"),R.loading]])]),...!e.hideFooter&&{footer:()=>t(d,null,[O.footer&&O.footer({loading:R.loading,close:H}),e.showCloseButton&&t(p,{disabled:R.loading,onClick:H},{default:()=>[e.closeButtonText]}),e.showConfirmButton&&t(p,{loading:R.loading,loadingIcon:b,disabled:e.disabledConfirmButton,type:"primary",onClick:G},{default:()=>[R.loading?"加载中...":e.confirmButtonText]})])}})),L(W,{handleClose:u(()=>$.value?.handleClose),afterEnter:u(()=>$.value?.afterEnter),afterLeave:u(()=>$.value?.afterLeave),loading:u(()=>R.loading),visible:u(()=>R.visible),open:I,close:U,refresh:X,doLoading:e=>{R.loading=!0,x(e).then().catch(e=>{z("FaDrawer",e)}).finally(()=>{R.loading=!1})}})}});export{R as default,E as faDrawerEmits,W as faDrawerProps};
//# sourceMappingURL=drawer.mjs.map
