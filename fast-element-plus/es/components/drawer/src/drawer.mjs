import{defineComponent as e,reactive as l,ref as o,nextTick as a,watch as n,createVNode as t,mergeProps as i,Fragment as s,withDirectives as d,resolveDirective as r,computed as u}from"vue";import{drawerProps as c,drawerEmits as f,useGlobalSize as _,ElMessage as m,ElMessageBox as g,ElDrawer as h,ElButton as p,ElScrollbar as w,ElIcon as v}from"element-plus";import{Eleme as b,Refresh as C,Close as B}from"@element-plus/icons-vue";import{FullScreenExit as y,FullScreen as k}from"@fast-element-plus/icons-vue";import{definePropType as F,execFunction as x,consoleError as z,useProps as T,useRender as D,useExpose as O,makeSlots as V}from"@fast-china/utils";import{isBoolean as A}from"lodash-unified";const L={...c,appendToBody:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},destroyOnClose:{type:Boolean,default:!0},showRefresh:{type:Boolean,default:!0},showFullscreen:{type:Boolean,default:!0},showCloseButton:{type:Boolean,default:!0},showConfirmButton:{type:Boolean,default:!0},disabledConfirmButton:Boolean,closeButtonText:{type:String,default:"取消"},confirmButtonText:{type:String,default:"确认"},hideFooter:Boolean,showBeforeClose:Boolean,afterOpen:{type:F(Function)}},S={...f,"update:modelValue":e=>A(e),confirmClick:()=>!0},W=/* @__PURE__ */e({name:"FaDrawer",props:L,emits:S,slots:V(),setup(e,{attrs:f,slots:F,emit:V,expose:A}){const L=_(),S=l({loading:!1,visible:!1,fullscreen:!1,size:e.size??"30%",dragging:!1,refreshing:!1}),W=o();let E;const R=l=>{S.visible=!0,E=l,a(()=>{S.loading=!0,x(e.afterOpen??l).then(()=>{V("open")}).catch(e=>{z("FaDrawer",e),S.visible=!1}).finally(()=>{S.loading=!1})})},$=e=>{S.loading=!0,x(e).then(()=>{V("close"),S.visible=!1}).catch(e=>{z("FaDrawer",e)}).finally(()=>{S.loading=!1})},q=()=>{S.refreshing=!0,S.loading=!0,setTimeout(()=>{S.refreshing=!1,R(E),m.success("刷新成功")},500)},I=l=>{if(S.loading)return;if(document.querySelector(".el-image-viewer__wrapper"))return;const o=()=>{x(e.beforeClose).then(()=>{V("close"),l()}).catch(e=>{z("FaDialog",e)})};e.showBeforeClose?g.confirm("确定关闭？",{type:"warning"}).then(()=>{o()}):o()},U=()=>{S.loading||(S.fullscreen=!S.fullscreen)},X=()=>{S.loading||V("confirmClick")},j=()=>{S.loading||$()};n(()=>S.visible,e=>{V("update:modelValue",e)});const G=()=>{document.onmousemove=e=>{let l=document.body.clientWidth-e.pageX;const o=.2*document.body.clientWidth,a=.95*document.body.clientWidth;l=l>a?a:l<o?o:l,S.size=`${l}px`},document.onmouseup=()=>{document.onmousemove=document.onmouseup=null}},H=T(e,c,["modelValue","size","showClose","beforeClose"]);return D(()=>t(h,i(H.value,{ref:W,class:["fa-drawer",`fa-drawer-${L.value}`,{"fa-drawer__fullscreen":S.fullscreen}],modelValue:S.visible,"onUpdate:modelValue":e=>S.visible=e,size:S.size,showClose:!1,beforeClose:I,onOpened:()=>V("opened"),onClosed:()=>V("closed"),onOpenAutoFocus:()=>V("openAutoFocus"),onCloseAutoFocus:()=>V("closeAutoFocus")}),{header:()=>t(s,null,[t("div",{class:"fa-drawer__header-title"},[e.title,F.header&&F.header({loading:S.loading,close:j})]),e.showRefresh&&t("div",{title:"刷新",class:["fa-drawer__header-icon",S.loading?"fa__click__disabled fa__click__disabled__cursor ":"fa__hover__twinkle"],onClick:q},[t(v,{class:"icon"},{default:()=>[t(C,null,null)]})]),e.showFullscreen&&t("div",{title:S.fullscreen?"关闭全屏显示":"全屏显示",class:["fa-drawer__header-icon",S.loading?"fa__click__disabled fa__click__disabled__cursor ":"fa__hover__twinkle"],onClick:U},[t(v,null,{default:()=>[S.fullscreen?t(y,null,null):t(k,null,null)]})]),e.showClose&&t("div",{title:"关闭",class:["fa-drawer__header-icon",S.loading?"fa__click__disabled fa__click__disabled__cursor ":"fa__hover__twinkle"],onClick:j},[t(v,{class:"icon"},{default:()=>[t(B,null,null)]})])]),default:()=>t(s,null,[e.draggable&&t("div",{class:"fa-drawer__draggable",onmousedown:G},null),d(t(w,{"element-loading-text":"加载中..."},{default:()=>[!S.refreshing&&F.default&&F.default(S)]}),[[r("loading"),S.loading]])]),...!e.hideFooter&&{footer:()=>t(s,null,[F.footer&&F.footer({loading:S.loading,close:j}),e.showCloseButton&&t(p,{disabled:S.loading,onClick:j},{default:()=>[e.closeButtonText]}),e.showConfirmButton&&t(p,{loading:S.loading,loadingIcon:b,disabled:e.disabledConfirmButton,type:"primary",onClick:X},{default:()=>[S.loading?"加载中...":e.confirmButtonText]})])}})),O(A,{handleClose:u(()=>W.value?.handleClose),afterEnter:u(()=>W.value?.afterEnter),afterLeave:u(()=>W.value?.afterLeave),loading:u(()=>S.loading),visible:u(()=>S.visible),open:R,close:$,refresh:q,doLoading:e=>{S.loading=!0,x(e).then().catch(e=>{z("FaDrawer",e)}).finally(()=>{S.loading=!1})}})}});export{W as default,S as faDrawerEmits,L as faDrawerProps};
//# sourceMappingURL=drawer.mjs.map
