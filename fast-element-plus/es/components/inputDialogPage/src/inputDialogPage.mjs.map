{"version":3,"file":"inputDialogPage.mjs","sources":["../../../../../packages/components/inputDialogPage/src/inputDialogPage.tsx"],"sourcesContent":["import { computed, defineComponent, reactive, ref } from \"vue\";\nimport { ElButton, ElButtonGroup, ElInput } from \"element-plus\";\nimport { Delete, Search } from \"@element-plus/icons-vue\";\nimport { definePropType, makeSlots, useExpose, useRender, withDefineType } from \"@fast-china/utils\";\nimport { isFunction, isNull, isNumber, isString } from \"lodash-unified\";\nimport type { TableProps } from \"element-plus\";\nimport type { PropType } from \"vue\";\nimport { FaTable, type FaTableInstance, type PagedInput, type PagedResult } from \"@fast-element-plus/components/table\";\nimport { useVModel } from \"@vueuse/core\";\nimport FaDialog, { FaDialogInstance } from \"@fast-element-plus/components/dialog\";\n\nexport const faInputDialogPageProps = {\n\t/** @description key of row data, used for optimizing rendering. Required if `reserve-selection` is on or display tree data. When its type is String, multi-level access is supported, e.g. `user.info.id`, but `user.info[0].id` is not supported, in which case `Function` should be used */\n\trowKey: {\n\t\ttype: [String, Function] as PropType<TableProps<any>[\"rowKey\"]>,\n\t\tdefault: \"id\",\n\t},\n\t/** @description v-model绑定值 */\n\tmodelValue: [String, Number],\n\t/** @description v-model:label绑定值 */\n\tlabel: String,\n\t/** @description 输入框占位文本 */\n\tplaceholder: {\n\t\ttype: String,\n\t\tdefault: \"请选择\",\n\t},\n\t/** @description 禁用 */\n\tdisabled: Boolean,\n\t/** @description 标题 */\n\ttitle: String,\n\t/** @description 请求api */\n\trequestApi: {\n\t\ttype: definePropType<(params?: PagedInput) => Promise<PagedResult | any[]>>(Function),\n\t},\n\t/** 初始化参数 */\n\tinitParam: definePropType<string | number | any>([String, Number, Object]),\n\t/** @description 显示文本 Key */\n\tlabelKey: {\n\t\ttype: String,\n\t\tdefault: \"name\",\n\t},\n};\n\nexport const faInputDialogPageEmits = {\n\t/** @description v-model 回调 */\n\t\"update:modelValue\": (value: string | number) => isString(value) || isNumber(value) || isNull(value),\n\t/** @description v-model:label 回调 */\n\t\"update:label\": (value: string) => isString(value) || isNull(value),\n\t/** @description 改变 */\n\tchange: (value: string | number) => isString(value) || isNumber(value) || isNull(value),\n};\n\ntype FaInputDialogPageSlots = {\n\t/** @description 默认内容插槽 */\n\tdefault: never;\n};\n\nexport default defineComponent({\n\tname: \"FaInputDialogPage\",\n\tprops: faInputDialogPageProps,\n\temits: faInputDialogPageEmits,\n\tslots: makeSlots<FaInputDialogPageSlots>(),\n\tsetup(props, { attrs, slots, emit, expose }) {\n\t\tconst modelValue = useVModel(props, \"modelValue\", emit);\n\t\tconst selectedLabel = useVModel(props, \"label\", emit);\n\n\t\tconst state = reactive({\n\t\t\tselectionRow: withDefineType<unknown>(),\n\t\t});\n\n\t\tconst faDialogRef = ref<FaDialogInstance>();\n\t\tconst faTableRef = ref<FaTableInstance>();\n\n\t\tconst handleDeleteClick = (): void => {\n\t\t\tmodelValue.value = null;\n\t\t\tselectedLabel.value = null;\n\t\t\temit(\"change\", null);\n\t\t};\n\n\t\tconst handleSearchClick = (): void => {\n\t\t\tfaDialogRef.value.open(() => {\n\t\t\t\tif (state.selectionRow) {\n\t\t\t\t\t// 判断当前行是否选中\n\t\t\t\t\tconst rowSelected = faTableRef.value.selectedListIds.includes(\n\t\t\t\t\t\tisFunction(props.rowKey) ? props.rowKey(state.selectionRow) : state.selectionRow[props.rowKey]\n\t\t\t\t\t);\n\t\t\t\t\tif (!rowSelected) {\n\t\t\t\t\t\tfaTableRef.value.toggleRowSelection(state.selectionRow);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tconst handleConfirmClick = (): void => {\n\t\t\tfaDialogRef.value.close(() => {\n\t\t\t\tif (faTableRef.value.selected) {\n\t\t\t\t\tconst selectedData = faTableRef.value.selectedList[0];\n\t\t\t\t\tmodelValue.value = selectedData[isFunction(props.rowKey) ? props.rowKey(selectedData) : selectedData[props.rowKey]];\n\t\t\t\t\tselectedLabel.value = selectedData[props.labelKey];\n\t\t\t\t\temit(\"change\", selectedData);\n\t\t\t\t} else {\n\t\t\t\t\tmodelValue.value = null;\n\t\t\t\t\tselectedLabel.value = null;\n\t\t\t\t\temit(\"change\", null);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tconst handleTableRowDblclick = (row: any): void => {\n\t\t\tfaTableRef.value.clearSelection();\n\t\t\tfaTableRef.value.toggleRowSelection(row);\n\t\t\tstate.selectionRow = row;\n\t\t\thandleConfirmClick();\n\t\t};\n\n\t\tuseRender(() => (\n\t\t\t<div class=\"fa-input-dialog-page\">\n\t\t\t\t<ElInput vModel={selectedLabel.value} placeholder={props.placeholder} disabled={props.disabled} readonly>\n\t\t\t\t\t{{\n\t\t\t\t\t\tappend: () => (\n\t\t\t\t\t\t\t<ElButtonGroup>\n\t\t\t\t\t\t\t\t<ElButton disabled={props.disabled} icon={Delete} onClick={handleDeleteClick} />\n\t\t\t\t\t\t\t\t<ElButton disabled={props.disabled} icon={Search} onClick={handleSearchClick} />\n\t\t\t\t\t\t\t</ElButtonGroup>\n\t\t\t\t\t\t),\n\t\t\t\t\t}}\n\t\t\t\t</ElInput>\n\t\t\t\t<FaDialog\n\t\t\t\t\tref={faDialogRef}\n\t\t\t\t\tstyle=\"--height: 70%;\"\n\t\t\t\t\twidth=\"50%\"\n\t\t\t\t\ttitle={props.title}\n\t\t\t\t\tfillHeight\n\t\t\t\t\tdisabledConfirmButton={!faTableRef.value?.selected}\n\t\t\t\t\tonConfirmClick={handleConfirmClick}\n\t\t\t\t>\n\t\t\t\t\t<FaTable\n\t\t\t\t\t\tref={faTableRef}\n\t\t\t\t\t\trowKey={props.rowKey}\n\t\t\t\t\t\trequestApi={props.requestApi}\n\t\t\t\t\t\tinitParam={props.initParam}\n\t\t\t\t\t\tsingle\n\t\t\t\t\t\trowClickSelection\n\t\t\t\t\t\thideSearchTime\n\t\t\t\t\t\texportBtn={false}\n\t\t\t\t\t\tonRowDblclick={handleTableRowDblclick}\n\t\t\t\t\t>\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tdefault: () => slots.default && slots.default(),\n\t\t\t\t\t\t}}\n\t\t\t\t\t</FaTable>\n\t\t\t\t</FaDialog>\n\t\t\t</div>\n\t\t));\n\n\t\treturn useExpose(expose, {\n\t\t\t/** @description 选择行数据 */\n\t\t\tselectionRow: computed(() => state.selectionRow),\n\t\t\t/** @description 打开选择器弹窗 */\n\t\t\topen: handleSearchClick,\n\t\t\t/** @description 清除选择 */\n\t\t\tclear: handleDeleteClick,\n\t\t});\n\t},\n});\n"],"names":["faInputDialogPageProps","rowKey","type","String","Function","default","modelValue","Number","label","placeholder","disabled","Boolean","title","requestApi","definePropType","initParam","Object","labelKey","faInputDialogPageEmits","isString","value","isNumber","isNull","change","InputDialogPage","name","props","emits","slots","makeSlots","setup","attrs","emit","expose","useVModel","selectedLabel","state","reactive","selectionRow","withDefineType","faDialogRef","ref","faTableRef","handleDeleteClick","handleSearchClick","open","selectedListIds","includes","isFunction","toggleRowSelection","handleConfirmClick","close","selected","selectedData","selectedList","handleTableRowDblclick","row","clearSelection","useRender","_createVNode","class","ElInput","$event","readonly","append","ElButtonGroup","ElButton","icon","Delete","onClick","Search","FaDialog","style","width","fillHeight","disabledConfirmButton","onConfirmClick","FaTable","single","rowClickSelection","hideSearchTime","exportBtn","onRowDblclick","useExpose","computed","clear"],"mappings":"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"}