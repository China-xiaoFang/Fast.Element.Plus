{"version":3,"file":"tableSearchFormItem.mjs","sources":["../../../../../packages/components/table/src/tableSearchFormItem.tsx"],"sourcesContent":["import { Fragment, defineComponent, h, inject, reactive, resolveComponent } from \"vue\";\nimport { ElOption } from \"element-plus\";\nimport { dateUtil, definePropType, makeSlots, useRender, withDefineType } from \"@fast-china/utils\";\nimport { isString } from \"lodash-unified\";\nimport { getTableDefaultSlots } from \"./table.type\";\nimport { enumMapKey, tableStateKey } from \"./useTable\";\nimport type { FaTableColumnCtx, FaTableDefaultSlotsResult, FaTableEnumColumnCtx } from \"./table.type\";\n\n/**\n * 已知默认支持的el组件：\n * \tel-input\n * \tel-input-number\n * \tel-select\n * \tel-select-v2\n * \tel-tree-select\n * \tel-cascader\n * \tel-date-picker\n * \tel-time-picker\n * \tel-time-select,\n * \tel-switch\n * 已知组件的默认props\n * clearable：el-input，el-input-number，el-select，el-select-v2，el-tree-select，el-cascader，el-date-picker，el-time-picker，el-time-select\n * filterable：el-select，el-select-v2，el-tree-select\n * placeholder-请输入：el-input，el-input-number\n * placeholder-请选择：el-select，el-select-v2，el-tree-select，el-cascader\n * defaultTime：el-date-picker\n * shortcuts：el-date-picker\n * options：el-select-v2，el-cascader\n * data：el-tree-select\n * startPlaceholder：\n * \t\tel-date-picker type in [\"datetimerange\", \"daterange\", \"monthrange\", \"yearrange\"]\n * \t\tel-time-picker isRange is true\n * endPlaceholder：\n * \t\tel-date-picker type in [\"datetimerange\", \"daterange\", \"monthrange\", \"yearrange\"]\n * \t\tel-time-picker isRange is true\n * rangeSeparator：\n * \t\tel-date-picker type in [\"datetimerange\", \"daterange\", \"monthrange\", \"yearrange\"]\n * \t\tel-time-picker isRange is true\n * unlinkPanels：el-date-picker type in [\"datetimerange\", \"daterange\", \"monthrange\", \"yearrange\"]\n * 后缀 -select Select -page Page -cascader Cascader 结尾的\n * \tplaceholder：请选择\n * 后缀 -input Input 结尾的\n * \tplaceholder：请输入\n */\n\nconst clearableEls = [\n\t\"el-input\",\n\t\"ELInput\",\n\t\"el-input-number\",\n\t\"ELInputNumber\",\n\t\"el-select\",\n\t\"ElSelect\",\n\t\"el-select-v2\",\n\t\"ElSelectV2\",\n\t\"el-tree-select\",\n\t\"ElTreeSelect\",\n\t\"el-cascader\",\n\t\"ElCascader\",\n\t\"el-date-picker\",\n\t\"ElDatePicker\",\n\t\"el-time-picker\",\n\t\"ElTimePicker\",\n\t\"el-time-select\",\n\t\"ElTimeSelect\",\n];\n\ntype FaTableSearchFormItemSlots = {\n\t[key: string]: FaTableDefaultSlotsResult & {\n\t\tcolumn?: FaTableColumnCtx;\n\t\tsearch?: () => void;\n\t};\n};\n\nconst filterableEls = [\"el-select\", \"ElSelect\", \"el-select-v2\", \"ElSelectV2\", \"el-tree-select\", \"ElTreeSelect\"];\n\nconst inputPlaceholderEls = [\"el-input\", \"ELInput\", \"el-input-number\", \"ELInputNumber\"];\n\nconst selectPlaceholderEls = [\"el-select\", \"ElSelect\", \"el-select-v2\", \"ElSelectV2\", \"el-tree-select\", \"ElTreeSelect\", \"el-cascader\", \"ElCascader\"];\n\nexport default defineComponent({\n\tname: \"FaTableSearchFormItem\",\n\tprops: {\n\t\t/** @description 列配置 */\n\t\tcolumn: {\n\t\t\ttype: definePropType<FaTableColumnCtx>(Object),\n\t\t\trequired: true,\n\t\t\t/** 这里的 default 不知道为什么，不写识别不出来类型 */\n\t\t\tdefault: {} as FaTableColumnCtx,\n\t\t},\n\t\t/** @description 搜索 */\n\t\tsearch: {\n\t\t\ttype: definePropType<() => void>(Function),\n\t\t\trequired: true,\n\t\t},\n\t},\n\tslots: makeSlots<FaTableSearchFormItemSlots>(),\n\tsetup(props, { slots }) {\n\t\tconst tableState = inject(tableStateKey);\n\t\tconst enumMap = inject(enumMapKey);\n\n\t\tconst state = reactive({\n\t\t\tenumDict: withDefineType<FaTableEnumColumnCtx[]>([]),\n\t\t\toldValue: undefined,\n\t\t});\n\n\t\tconst handleUpdateModelValue = (value: any): void => {\n\t\t\tif (isString(value)) {\n\t\t\t\t// 如果是字符串，则去除前后空格\n\t\t\t\tvalue = value.trim();\n\t\t\t}\n\t\t\tstate.oldValue = tableState.searchParam[props.column?.search?.key ?? props.column.prop];\n\t\t\ttableState.searchParam[props.column?.search?.key ?? props.column.prop] = value;\n\t\t};\n\n\t\tconst handleChange = (value: any): void => {\n\t\t\t// 改变触发的时候只有不等于的时候才会去刷新\n\t\t\t// if (!isEqual(value, state.oldValue)) {\n\t\t\tprops.search();\n\t\t\t// }\n\t\t};\n\n\t\tconst handleDefaultProps = (): any => {\n\t\t\tconst search = props.column.search;\n\t\t\tconst defaultProps: any = {};\n\t\t\tif (clearableEls.includes(search?.el)) {\n\t\t\t\tdefaultProps.clearable = true;\n\t\t\t}\n\t\t\tif (filterableEls.includes(search?.el)) {\n\t\t\t\tdefaultProps.filterable = true;\n\t\t\t}\n\t\t\tif (inputPlaceholderEls.includes(search?.el)) {\n\t\t\t\tdefaultProps.placeholder = \"请输入\";\n\t\t\t}\n\t\t\tif (selectPlaceholderEls.includes(search?.el)) {\n\t\t\t\tdefaultProps.placeholder = \"请选择\";\n\t\t\t}\n\t\t\tif ([\"el-date-picker\", \"ElDatePicker\"].includes(search?.el)) {\n\t\t\t\tdefaultProps.unlinkPanels = true;\n\t\t\t\tif ([\"datetimerange\", \"daterange\", \"monthrange\", \"yearrange\"].includes(search?.props?.type)) {\n\t\t\t\t\tdefaultProps.defaultTime = dateUtil.getDefaultTime();\n\t\t\t\t\tdefaultProps.shortcuts = dateUtil.getShortcuts();\n\t\t\t\t\tdefaultProps.rangeSeparator = \"至\";\n\t\t\t\t\tdefaultProps.startPlaceholder = \"开始时间\";\n\t\t\t\t\tdefaultProps.endPlaceholder = \"结束时间\";\n\t\t\t\t} else {\n\t\t\t\t\tdefaultProps.defaultTime = dateUtil.getSimpleTime();\n\t\t\t\t\tdefaultProps.shortcuts = dateUtil.getSimpleShortcuts();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ([\"el-time-picker\", \"ElTimePicker\"].includes(search?.el) && search?.props?.isRange) {\n\t\t\t\tdefaultProps.rangeSeparator = \"至\";\n\t\t\t\tdefaultProps.startPlaceholder = \"开始时间\";\n\t\t\t\tdefaultProps.endPlaceholder = \"结束时间\";\n\t\t\t}\n\t\t\tif (\n\t\t\t\t[\"el-select\", \"ElSelect\", \"el-select-v2\", \"ElSelectV2\", \"el-cascader\", \"ElCascader\", \"el-tree-select\", \"ElTreeSelect\"].includes(\n\t\t\t\t\tsearch?.el\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tlet enumData;\n\t\t\t\tif (props.column.enum && isString(props.column.enum)) {\n\t\t\t\t\tenumData = enumMap.get(props.column.enum);\n\t\t\t\t} else {\n\t\t\t\t\tenumData = enumMap.get(props.column.prop ?? props.column.search?.key);\n\t\t\t\t}\n\t\t\t\tenumData = enumData.filter((f: any) => f?.show !== false);\n\t\t\t\tstate.enumDict = enumData ?? [];\n\t\t\t}\n\t\t\tif ([\"el-select-v2\", \"ElSelectV2\", \"el-cascader\", \"ElCascader\"].includes(search?.el)) {\n\t\t\t\tdefaultProps.options = state.enumDict;\n\t\t\t}\n\t\t\tif ([\"el-tree-select\", \"ElTreeSelect\"].includes(search?.el)) {\n\t\t\t\tdefaultProps.data = state.enumDict;\n\t\t\t}\n\n\t\t\treturn defaultProps;\n\t\t};\n\n\t\tuseRender(() => (\n\t\t\t<Fragment>\n\t\t\t\t{props.column.search?.el &&\n\t\t\t\t\th(\n\t\t\t\t\t\tresolveComponent(props.column.search.el),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t...handleDefaultProps(),\n\t\t\t\t\t\t\t...props.column.search.props,\n\t\t\t\t\t\t\tmodelValue: tableState.searchParam[props.column?.search?.key ?? props.column.prop],\n\t\t\t\t\t\t\t\"onUpdate:modelValue\": handleUpdateModelValue,\n\t\t\t\t\t\t\tonChange: handleChange,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdefault: () =>\n\t\t\t\t\t\t\t\t[\"el-select\", \"ElSelect\"].includes(props.column.search.el)\n\t\t\t\t\t\t\t\t\t? state.enumDict.map((selData: any, index: number) =>\n\t\t\t\t\t\t\t\t\t\t\th(ElOption, {\n\t\t\t\t\t\t\t\t\t\t\t\tkey: index,\n\t\t\t\t\t\t\t\t\t\t\t\tlabel: selData[props.column.search.props?.label ?? \"label\"],\n\t\t\t\t\t\t\t\t\t\t\t\tvalue: selData[props.column.search.props?.value ?? \"value\"],\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled: selData[props.column.search.props?.disabled ?? \"disabled\"],\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t: slots.default &&\n\t\t\t\t\t\t\t\t\t\tslots.default({\n\t\t\t\t\t\t\t\t\t\t\tcolumn: props.column,\n\t\t\t\t\t\t\t\t\t\t\tsearch: props.search,\n\t\t\t\t\t\t\t\t\t\t\t...getTableDefaultSlots(tableState),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t}\n\t\t\t\t\t)}\n\t\t\t</Fragment>\n\t\t));\n\t},\n});\n"],"names":["clearableEls","filterableEls","inputPlaceholderEls","selectPlaceholderEls","name","props","column","type","definePropType","Object","required","default","search","Function","slots","makeSlots","setup","tableState","inject","tableStateKey","enumMap","enumMapKey","state","reactive","enumDict","withDefineType","oldValue","undefined","handleUpdateModelValue","value","isString","trim","searchParam","key","prop","handleChange","handleDefaultProps","defaultProps","includes","el","clearable","filterable","placeholder","unlinkPanels","defaultTime","dateUtil","getDefaultTime","shortcuts","getShortcuts","rangeSeparator","startPlaceholder","endPlaceholder","getSimpleTime","getSimpleShortcuts","isRange","enumData","enum","get","filter","f","show","options","data","useRender","_createVNode","_Fragment","h","resolveComponent","modelValue","onChange","map","selData","index","ElOption","label","disabled","getTableDefaultSlots"],"mappings":"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"}