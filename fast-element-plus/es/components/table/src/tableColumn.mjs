import{isVNode as e,defineComponent as t,inject as l,computed as r,createVNode as n,Fragment as o,watch as a,mergeProps as i,h as d,resolveComponent as u}from"vue";import{useGlobalSize as s,ElIcon as m,ElMessage as c,ElTag as p,dayjs as f,ElText as g,ElTableColumn as h,ElImage as y}from"element-plus";import{CopyDocument as w}from"@element-plus/icons-vue";import{FaImage as b}from"../../image/index.mjs";import{stringUtil as x,consoleError as S,dateUtil as _,useProps as v,useRender as F,makeSlots as $,definePropType as O}from"@fast-china/utils";import{isString as k,isArray as T,isFunction as N,isNumber as W,isNil as B,isObject as z}from"lodash-unified";import C from"../images/artwork.png.mjs";import I from"../images/notImage.png.mjs";import{tableUtil as j}from"../utils/table.mjs";import{getTableDefaultSlots as A}from"./table.type.mjs";import{tableStateKey as D,enumMapKey as M}from"./useTable.mjs";function Y(t){return"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!e(t)}const P={type:{type:String,default:"default"},label:String,className:String,labelClassName:String,property:String,prop:String,width:{type:[String,Number],default:""},minWidth:{type:[String,Number],default:""},renderHeader:Function,sortable:{type:[Boolean,String],default:!1},sortMethod:Function,sortBy:[String,Function,Array],resizable:{type:Boolean,default:!0},columnKey:String,align:String,headerAlign:String,showOverflowTooltip:{type:[Boolean,Object],default:void 0},fixed:[Boolean,String],formatter:Function,selectable:Function,reserveSelection:Boolean,filterMethod:Function,filteredValue:Array,filters:Array,filterPlacement:String,filterMultiple:{type:Boolean,default:!0},filterClassName:String,index:[Number,Function],sortOrders:{type:Array,default:()=>["ascending","descending",null],validator:e=>e.every(e=>["ascending","descending",null].includes(e))}},E=/* @__PURE__ */t({name:"FaTableColumn",props:{...P,type:{type:O(String),default:"default"},width:{type:[String,Number],default:"auto"},align:{type:String,default:"left"},headerAlign:{type:String,default:"left"},show:Boolean,smallWidth:{type:[String,Number]},autoWidth:Boolean,slot:String,headerSlot:String,headerRender:{type:O(Function)},render:{type:O(Function)},_children:{type:O(Array)},hideImage:Boolean,copy:Boolean,link:Boolean,spanProp:String,click:{type:O(Function)},clickEmit:String,originalImage:Boolean,dateFix:Boolean,dateFormat:{type:O(String)},tag:Boolean,enum:{type:O([String,Array,Function])},dataDeleteField:String,timeInfoField:{type:O(Object),default:()=>({userName:"createdUserName",time:"createdTime"})}},emits:{imagePreview:e=>k(e),customCellClick:(e,{row:t,column:l,$index:r})=>(B(e)||k(e))&&z(t)&&z(l)&&W(r)},slots:$(),setup(e,{slots:t,emit:$}){const O=s(),B=l(D),z=l(M),E=r(()=>e),H=()=>{let t="";return"timeInfo"===e.type&&(t+="fa-table__line-height-normal-column"),"date"!==e.type&&"time"!==e.type&&"dateTime"!==e.type||e.dateFix&&(t+="fa-table__line-height-normal-column"),e.className?`${t} ${e.className}`:t||void 0},R=t=>e.autoWidth?r(()=>{const t=B.autoColumnWidth.find(t=>t.prop===e.prop);return t?`${t.width}px`:"auto"}).value:"small"===O.value?e.smallWidth??e.width??e.minWidth??t??"auto":e.width??e.minWidth??t??"auto",L=t=>e.autoWidth?n("div",{class:["fa-table__auto-width-column__cell-header",`__fa-table__auto-width-column__cell-header__${e.prop}`]},[t]):t,U=t=>e.autoWidth?n("div",{class:["fa-table__auto-width-column__cell",`__fa-table__auto-width-column__cell__${e.prop}`]},[t]):t,V=({column:l,$index:r})=>e.headerRender?L(e.headerRender({column:l,$index:r,...A(B)})):e.headerSlot?L(t[e.headerSlot]&&t[e.headerSlot]({column:l,$index:r,...A(B)})):L(n("span",null,[e.label])),G=(t,l)=>(e.copy||l)&&t&&n(m,{class:"fa__copy-icon",title:"复制",onClick:async()=>{try{await x.copy(String(t)),c({type:"success",message:"复制成功"})}catch(e){S("FaTableColumn",e),c({type:"error",message:"复制失败"})}}},{default:()=>[n(w,null,null)]}),K=(e,t,l,r)=>t.formatter?t.formatter(e,t,l,r):l,q=(t,l,r)=>{const a=K(t,l,(({row:t})=>{const l=j.handleRowAccordingToProp(t,e.prop);let r,n=e.prop;return k(e.enum)?(n=e.enum,r=z.get(n)):T(e.enum)?r=e.enum:N(e.enum)&&(r=e.enum({row:t})),r?j.filterEnum(l,r):j.formatValue(l)})({row:t}),r);let i,d=e.prop;k(e.enum)?(d=e.enum,i=z.get(d)):T(e.enum)?i=e.enum:N(e.enum)&&(i=e.enum({row:t}));const u=j.filterEnum(j.handleRowAccordingToProp(t,e.prop),i,null,"tag");return n(o,null,[G(a),a?n(p,{type:u},Y(a)?a:{default:()=>[a]}):null])},J=({row:l,column:r,$index:a})=>{if("timeInfo"===e.type)return(t=>{let l;const r=t[e.timeInfoField?.userName??"createdUserName"],a=t[e.timeInfoField?.time??"createdTime"];return n(o,null,[n("div",{style:"white-space: nowrap; overflow: hidden; text-overflow:  ellipsis;",title:a},[r&&n("span",{style:"margin-right: 5px;"},[r]),n("span",null,[a])]),a&&n(p,{type:"info",round:!0,effect:"light",size:"small"},Y(l=_.dateTimeFix(String(a)))?l:{default:()=>[l]})])})(l);if(e.tag)return q(l,r,a);if("date"===e.type||"time"===e.type||"dateTime"===e.type)return((t,l,r)=>{let a,i;switch(e.type){case"date":i="YYYY-MM-DD";break;case"time":i="HH:mm:ss";break;case"dateTime":i="YYYY-MM-DD HH:mm:ss"}const d=t[e.prop]?K(t,l,f(t[e.prop]).format(e.dateFormat??i),r):null;return n(o,null,[G(d),d,e.dateFix&&d&&n(o,null,[n("br",null,null),n(p,{type:"info",round:!0,effect:"light",size:"small"},Y(a=_.dateTimeFix(String(d)))?a:{default:()=>[a]})])])})(l,r,a);if("d2"===e.type||"d4"===e.type||"d6"===e.type||"gd2"===e.type||"gd4"===e.type||"gd6"===e.type)return((t,l,r)=>{const n=t[e.prop];if(!n||!W(n))return K(t,l,n,r);let o,a=!1;switch(e.type){case"d2":o=2;break;case"d4":o=4;break;case"d6":o=6;break;case"gd2":o=2,a=!0;break;case"gd4":o=4,a=!0;break;case"gd6":o=6,a=!0}return K(t,l,n.toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:o,useGrouping:a}),r)})(l,r,a);if(e.link)return((t,l,r)=>{const a=K(t,l,t[e.prop],r);return U(n(o,null,[G(a),a&&n(g,{class:"el-link is-hover-underline fa-table__link-column__text",onClick:()=>{e.dataDeleteField&&!0===t[e.dataDeleteField]||(e.click?e.click({row:t,$index:r}):$("customCellClick",e.clickEmit,{row:t,column:E.value,$index:r}))}},Y(a)?a:{default:()=>[a]})]))})(l,r,a);if(e.render)return U(e.render({row:l,column:E.value,$index:a,...A(B)}));if(e.slot)return U(t[e.slot]&&t[e.slot]({row:l,column:E.value,$index:a,...A(B)}));const i=K(l,r,l[e.prop],a);return U(n(o,null,[G(i),i]))};let Q=v(e,P,["type","width","minWidth","sortable","sortOrders","resizable","showOverflowTooltip"]);a(()=>e,()=>{Q=v(e,P,["type","className","minWidth","sortable","sortOrders","resizable","showOverflowTooltip"])}),F(()=>n(o,null,[e._children?.length?n(h,i(Q.value,{className:H(),minWidth:R("auto"),sortable:!!e.sortable&&"custom",sortOrders:e.sortOrders??["descending","ascending",null],resizable:e.resizable&&!e.autoWidth,showOverflowTooltip:(e.showOverflowTooltip??!0)&&!e.autoWidth&&"default"==e.type}),{header:({column:e,$index:t})=>V({column:e,$index:t}),default:()=>e._children.map(e=>d(u("FaTableColumn"),{...e},t))}):"image"===e.type?n(h,i(Q.value,{align:"center",className:"fa-table__image-column",minWidth:"50px",sortable:!1,resizable:!1,showOverflowTooltip:!1}),{header:({column:e,$index:t})=>V({column:e,$index:t}),default:({row:t})=>t[e.prop]?e.hideImage?n(y,{class:"fa-image",lazy:!0,src:C,fit:"cover",previewSrcList:[t[e.prop]],closeOnPressEscape:!0,hideOnClickModal:!0,previewTeleported:!0},null):n(b,{lazy:!0,src:t[e.prop],fit:"cover",original:e.originalImage,thumb:!0},null):n(y,{class:"fa-image",lazy:!0,src:I,fit:"cover"},null)}):n(h,i(Q.value,{className:H(),minWidth:R("auto"),sortable:!!e.sortable&&"custom",sortOrders:e.sortOrders??["descending","ascending",null],resizable:e.resizable&&!e.autoWidth,showOverflowTooltip:(e.showOverflowTooltip??!0)&&!e.autoWidth&&"default"==e.type}),{header:({column:e,$index:l})=>t.header?t.header({column:E.value,$index:l,...A(B)}):V({column:e,$index:l}),default:({row:e,column:l,$index:r})=>t.default?t.default({row:e,column:E.value,$index:r,...A(B)}):J({row:e,column:l,$index:r}),filterIcon:({filterOpened:e})=>t.filterIcon&&t.filterIcon({filterOpened:e,...A(B)}),expand:({expanded:e})=>t.expand&&t.expand({expanded:e,...A(B)})})]))}});export{E as default,P as tableColumnProps};
//# sourceMappingURL=tableColumn.mjs.map
