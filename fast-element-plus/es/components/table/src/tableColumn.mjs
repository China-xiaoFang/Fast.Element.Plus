import{isVNode as e,defineComponent as t,inject as l,computed as r,createVNode as o,Fragment as i,watch as n,mergeProps as a,h as d,resolveComponent as u}from"vue";import{useGlobalSize as s,ElMessage as c,ElIcon as m,ElTag as p,dayjs as f,ElText as g,ElTableColumn as h,ElImage as y}from"element-plus";import{CopyDocument as w}from"@element-plus/icons-vue";import{FaImage as b}from"../../image/index.mjs";import{stringUtil as x,consoleError as S,dateUtil as v,useProps as _,useRender as F,makeSlots as O,definePropType as k}from"@fast-china/utils";import{isString as T,isNumber as $,isNil as W,isObject as B}from"lodash-unified";import z from"../images/artwork.png.mjs";import C from"../images/notImage.png.mjs";import{tableUtil as N}from"../utils/table.mjs";import{getTableDefaultSlots as I}from"./table.type.mjs";import{tableStateKey as j,enumMapKey as A}from"./useTable.mjs";function D(t){return"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!e(t)}const M={type:{type:String,default:"default"},label:String,className:String,labelClassName:String,property:String,prop:String,width:{type:[String,Number],default:""},minWidth:{type:[String,Number],default:""},renderHeader:Function,sortable:{type:[Boolean,String],default:!1},sortMethod:Function,sortBy:[String,Function,Array],resizable:{type:Boolean,default:!0},columnKey:String,align:String,headerAlign:String,showOverflowTooltip:{type:[Boolean,Object],default:void 0},fixed:[Boolean,String],formatter:Function,selectable:Function,reserveSelection:Boolean,filterMethod:Function,filteredValue:Array,filters:Array,filterPlacement:String,filterMultiple:{type:Boolean,default:!0},filterClassName:String,index:[Number,Function],sortOrders:{type:Array,default:()=>["ascending","descending",null],validator:e=>e.every(e=>["ascending","descending",null].includes(e))}},Y=/* @__PURE__ */t({name:"FaTableColumn",props:{...M,type:{type:k(String),default:"default"},width:{type:[String,Number],default:"auto"},align:{type:String,default:"left"},headerAlign:{type:String,default:"left"},show:Boolean,smallWidth:{type:[String,Number]},autoWidth:Boolean,slot:String,headerSlot:String,headerRender:{type:k(Function)},render:{type:k(Function)},_children:{type:k(Array)},hideImage:Boolean,copy:Boolean,link:Boolean,spanProp:String,click:{type:k(Function)},clickEmit:String,originalImage:Boolean,dateFix:Boolean,dateFormat:{type:k(String)},tag:Boolean,enum:{type:k([Array,Function])},dataDeleteField:String,timeInfoField:{type:k(Object),default:()=>({userName:"createdUserName",time:"createdTime"})}},emits:{imagePreview:e=>T(e),customCellClick:(e,{row:t,column:l,$index:r})=>(W(e)||T(e))&&B(t)&&B(l)&&$(r)},slots:O(),setup(e,{slots:t,emit:O}){const k=s(),W=l(j),B=l(A),Y=r(()=>e),P=({row:t})=>{let l=e.prop;T(e.enum)&&(l=e.enum);const r=B.get(l);return N.filterEnum(N.handleRowAccordingToProp(t,e.prop),r,null,"tag")},R=t=>e.autoWidth?r(()=>{const t=W.autoColumnWidth.find(t=>t.prop===e.prop);return t?`${t.width}px`:"auto"}).value:"small"===k.value?e.smallWidth??e.width??e.minWidth??t??"auto":e.width??e.minWidth??t??"auto",E=t=>e.autoWidth?o("div",{class:["fa-table__auto-width-column__cell-header",`__fa-table__auto-width-column__cell-header__${e.prop}`]},[t]):t,H=({column:l,$index:r})=>e.headerRender?E(e.headerRender({column:l,$index:r,...I(W)})):e.headerSlot?E(t[e.headerSlot]&&t[e.headerSlot]({column:l,$index:r,...I(W)})):E(o("span",null,[e.label])),L=t=>e.autoWidth?o("div",{class:["fa-table__auto-width-column__cell",`__fa-table__auto-width-column__cell__${e.prop}`]},[t]):t,U=(t,l)=>(e.copy||l)&&t&&o(m,{class:"fa__copy-icon",title:"复制",onClick:()=>(async e=>{try{await x.copy(String(e)),c({type:"success",message:"复制成功"})}catch(t){S("FaTableColumn",t),c({type:"error",message:"复制失败"})}})(t)},{default:()=>[o(w,null,null)]}),V=(e,t,l,r)=>t.formatter?t.formatter(e,t,l,r):l,G=({row:l,column:r,$index:n})=>{if("timeInfo"===e.type){let t;const r=l[e.timeInfoField?.userName??"createdUserName"],n=l[e.timeInfoField?.time??"createdTime"];return o(i,null,[o("div",{style:"white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",title:n},[r&&o("span",{style:"margin-right: 5px;"},[r]),o("span",null,[n])]),n&&o(p,{type:"info",round:!0,effect:"light",size:"small"},D(t=v.dateTimeFix(String(n)))?t:{default:()=>[t]})])}if(e.tag){const t=V(l,r,(({row:t})=>{let l=e.prop;T(e.enum)&&(l=e.enum);const r=B.get(l);return r?N.filterEnum(N.handleRowAccordingToProp(t,e.prop),r):N.formatValue(N.handleRowAccordingToProp(t,e.prop))})({row:l}),n);return o(i,null,[U(t),t?o(p,{type:P({row:l})},D(t)?t:{default:()=>[t]}):null])}if("date"===e.type||"time"===e.type||"dateTime"===e.type){let t,a;switch(e.type){case"date":a="YYYY-MM-DD";break;case"time":a="HH:mm:ss";break;case"dateTime":a="YYYY-MM-DD HH:mm:ss"}const d=l[e.prop]?V(l,r,f(l[e.prop]).format(e.dateFormat??a),n):null;return o(i,null,[U(d),d,e.dateFix&&d&&o(i,null,[o("br",null,null),o(p,{type:"info",round:!0,effect:"light",size:"small"},D(t=v.dateTimeFix(String(d)))?t:{default:()=>[t]})])])}if("d2"===e.type||"d4"===e.type||"d6"===e.type||"gd2"===e.type||"gd4"===e.type||"gd6"===e.type){const t=l[e.prop];if(t&&$(t)){let l,r=!1;switch(e.type){case"d2":l=2;break;case"d4":l=4;break;case"d6":l=6;break;case"gd2":l=2,r=!0;break;case"gd4":l=4,r=!0;break;case"gd6":l=6,r=!0}return t.toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:l,useGrouping:r})}return t}if(e.link){const t=V(l,r,l[e.prop],n);return L(o(i,null,[U(t),t&&o(g,{class:"el-link is-hover-underline fa-table__link-column__text",onClick:()=>{e.dataDeleteField&&!0===l[e.dataDeleteField]||(e.click?e.click({row:l,$index:n}):O("customCellClick",e.clickEmit,{row:l,column:Y.value,$index:n}))}},D(t)?t:{default:()=>[t]})]))}if(e.render)return L(e.render({row:l,column:Y.value,$index:n,...I(W)}));if(e.slot)return L(t[e.slot]&&t[e.slot]({row:l,column:Y.value,$index:n,...I(W)}));{const t=V(l,r,l[e.prop],n);return L(o(i,null,[U(t),t]))}};let K=_(e,M,["type","width","minWidth","sortable","sortOrders","resizable","showOverflowTooltip"]);n(()=>e,()=>{K=_(e,M,["type","minWidth","sortable","sortOrders","resizable","showOverflowTooltip"])}),F(()=>o(i,null,[e._children?.length?o(h,a(K.value,{minWidth:R("auto"),sortable:!!e.sortable&&"custom",sortOrders:e.sortOrders??["descending","ascending",null],resizable:e.resizable&&!e.autoWidth,showOverflowTooltip:(e.showOverflowTooltip??!0)&&!e.autoWidth&&"default"==e.type}),{header:({column:e,$index:t})=>H({column:e,$index:t}),default:()=>e._children.map(e=>d(u("FaTableColumn"),{...e},t))}):"image"===e.type?o(h,a(K.value,{align:"center",className:"fa-table__image-column",minWidth:"50px",sortable:!1,resizable:!1,showOverflowTooltip:!1}),{header:({column:e,$index:t})=>H({column:e,$index:t}),default:({row:t})=>t[e.prop]?e.hideImage?o(y,{class:"fa-image",lazy:!0,src:z,fit:"cover",previewSrcList:[t[e.prop]],closeOnPressEscape:!0,hideOnClickModal:!0,previewTeleported:!0},null):o(b,{lazy:!0,src:t[e.prop],fit:"cover",original:e.originalImage,thumb:!0},null):o(y,{class:"fa-image",lazy:!0,src:C,fit:"cover"},null)}):o(h,a(K.value,{minWidth:R("auto"),sortable:!!e.sortable&&"custom",sortOrders:e.sortOrders??["descending","ascending",null],resizable:e.resizable&&!e.autoWidth,showOverflowTooltip:(e.showOverflowTooltip??!0)&&!e.autoWidth&&"default"==e.type}),{header:({column:e,$index:l})=>t.header?t.header({column:Y.value,$index:l,...I(W)}):H({column:e,$index:l}),default:({row:e,column:l,$index:r})=>t.default?t.default({row:e,column:Y.value,$index:r,...I(W)}):G({row:e,column:l,$index:r}),filterIcon:({filterOpened:e})=>t.filterIcon&&t.filterIcon({filterOpened:e,...I(W)}),expand:({expanded:e})=>t.expand&&t.expand({expanded:e,...I(W)})})]))}});export{Y as default,M as tableColumnProps};
//# sourceMappingURL=tableColumn.mjs.map
