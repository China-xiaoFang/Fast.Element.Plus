import{isVNode as e,defineComponent as l,ref as a,inject as o,computed as s,reactive as r,watch as t,createVNode as c,mergeProps as n,createTextVNode as i}from"vue";import{useGlobalSize as m,ElButton as d,ElIcon as h}from"element-plus";import{Refresh as u,Eleme as f,Search as p,ArrowDown as b,ArrowUp as g}from"@element-plus/icons-vue";import{FaDrawer as v}from"../../drawer/index.mjs";import{FaLayoutGrid as C,FaLayoutGridItem as y}from"../../layoutGrid/index.mjs";import{Brush as k}from"@fast-element-plus/icons-vue";import{withDefineType as _,useRender as S,makeSlots as w,definePropType as x}from"@fast-china/utils";import{getTableDefaultSlots as P}from"./table.type.mjs";import j from"./tableSearchFormItem.mjs";import{tableStateKey as B}from"./useTable.mjs";const F=/* @__PURE__ */l({name:"FaTableSearchForm",props:{show:{type:Boolean,required:!0},collapsedSearch:{type:Boolean,default:!0},advancedSearchDrawer:{type:Boolean,default:!1},cols:{type:x([String,Number,Object]),default:()=>({xs:2,sm:3,md:4,lg:5,xl:6})},search:{type:x(Function),required:!0},reset:{type:x(Function),required:!0}},slots:w(),setup(l,{slots:w,expose:x}){const F=m(),D=a(),I=o(B),T=s(()=>D.value?.breakPoint),q=r({refreshing:!1,height:"auto",collapsed:!0,showCollapsed:s(()=>{let e=!1;return I.searchColumns.reduce((a,o)=>(a+=(o.search[T.value]?.span??o.search?.span??1)+(o.search[T.value]?.offset??o.search?.offset??0),"number"!=typeof l.cols?a>=l.cols[T.value]&&(e=!0):a>=l.cols&&(e=!0),a),0),e}),searchColumns:_([]),advancedSearchColumns:_([]),breakPoint:void 0}),O=a(),z=a(),G=e=>({span:e?.span,offset:e?.offset??0,xs:e?.xs,sm:e?.sm,md:e?.md,lg:e?.lg,xl:e?.xl}),N=({breakPoint:e})=>{q.breakPoint=l.cols[e]-1,q.searchColumns=I.searchColumns.filter(e=>e?.show).slice(0,q.breakPoint),q.advancedSearchColumns=I.searchColumns.filter(e=>e?.show).slice(q.breakPoint)};t(()=>I.searchColumns,()=>{q.breakPoint&&(q.searchColumns=I.searchColumns.filter(e=>e?.show).slice(0,q.breakPoint),q.advancedSearchColumns=I.searchColumns.filter(e=>e?.show).slice(q.breakPoint))});const R=s(()=>l.advancedSearchDrawer?q.searchColumns:I.searchColumns);t(()=>l.advancedSearchDrawer,e=>{q.collapsed=!!e||l.collapsedSearch,q.refreshing=!0,setTimeout(()=>{q.refreshing=!1},1)}),t(()=>l.collapsedSearch,e=>{l.collapsedSearch?q.collapsed=!0:q.collapsed=e},{immediate:!0}),S(()=>{let a;return I.searchColumns.length>0&&c("div",{ref:O,class:["el-card fa-table__search",{"fa-table__search-hidden":!l.show,"fa-table__search__disable":I.loading}]},[c("form",{class:"el-form el-form--default el-form--label-right"},[!q.refreshing&&c(C,{ref:D,collapsed:q.collapsed,gap:"small"===F.value?[20,0]:[20,10],cols:l.cols,onBreakPointChange:N},{default:()=>[R.value.map((e,a)=>c(y,n({key:e?.search?.key??e.prop},G(e.search),{index:a}),{default:()=>[c("div",{class:"el-form-item el-form-item--default el-form-item--label-right"},[c("label",{class:"el-form-item__label"},[e.search.label]),c("div",{class:"el-form-item__content"},[e.search?.slot?w[e.search.slot]&&w[e.search.slot]({column:e,search:l.search,...P(I)}):c(j,{column:e,search:l.search},null)])])]})),c(y,{suffix:!0},{default:()=>[c("div",{class:"fa-table__search-operation"},[c(d,{loading:I.loading,loadingIcon:f,title:"搜索",type:"primary",plain:!0,icon:u,onClick:()=>l.search()},{default:()=>[i("搜索")]}),c(d,{loading:I.loading,loadingIcon:f,title:"重置",icon:k,onClick:()=>l.reset()},{default:()=>[i("重置")]}),l.advancedSearchDrawer?q.advancedSearchColumns.length>0&&c(d,{loading:I.loading,loadingIcon:f,title:"高级搜索",type:"info",plain:!0,icon:p,onClick:()=>z.value.open()},{default:()=>[i("高级搜索")]}):q.showCollapsed&&c(d,{loading:I.loading,loadingIcon:f,title:q.collapsed?"展开":"折叠",link:!0,type:"primary",onClick:()=>{q.collapsed=!q.collapsed}},{default:()=>[q.collapsed?"展开":"折叠",c(h,null,{default:()=>[q.collapsed?c(b,null,null):c(g,null,null)]})]})])]})]})]),l.advancedSearchDrawer&&q.advancedSearchColumns.length>0&&c(v,{ref:z,class:"fa-table__search-advanced",size:"20%",title:"高级搜索",appendToBody:!1,showCloseButton:!1,showConfirmButton:!1,showFullscreen:!1,showRefresh:!1,onConfirmClick:()=>l.search()},{default:()=>{return[c("form",{class:"el-form el-form--default el-form--label-top"},[c(C,{gap:[20,0],cols:{xs:2,sm:3,md:4,lg:5,xl:6}},(o=a=q.advancedSearchColumns.map((e,a)=>c(y,n({key:e.prop??e?.search?.key},G(e.search),{index:a}),{default:()=>[c("div",{class:"el-form-item el-form-item--default el-form-item--label-top"},[c("label",{class:"el-form-item__label"},[e.search.label]),c("div",{class:"el-form-item__content"},[e.search.slot?w[e.search.slot]&&w[e.search.slot]({column:e,search:l.search,...P(I)}):c(j,{column:e,search:l.search},null)])])]})),"function"==typeof o||"[object Object]"===Object.prototype.toString.call(o)&&!e(o)?a:{default:()=>[a]}))])];var o}})])})}});export{F as default};
//# sourceMappingURL=tableSearchForm.mjs.map
