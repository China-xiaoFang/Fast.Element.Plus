import{isVNode as e,defineComponent as a,ref as t,onMounted as l,watch as n,watchEffect as o,onActivated as i,computed as r,createVNode as s,withDirectives as c,Fragment as d,createTextVNode as u,mergeProps as m,resolveDirective as h}from"vue";import{useSizeProp as g,ElInput as p,ElDatePicker as f,ElButton as b,ElDropdown as C,ElDropdownMenu as w,ElDropdownItem as S,ElTable as _,ElTableColumn as y,ElIcon as v,ElPagination as x,ElImageViewer as P}from"element-plus";import{Search as I,Refresh as L,Eleme as B,Setting as F,More as R}from"@element-plus/icons-vue";import{NotData as O}from"@fast-element-plus/icons-vue";import{definePropType as T,stringUtil as k,consoleWarn as D,clickUtil as N,useProps as E,useRender as j,dateUtil as M,useExpose as z,makeSlots as K}from"@fast-china/utils";import{isString as A,isObject as H,isNumber as $,isBoolean as V,isArray as W,isNull as U,isFunction as Y,pick as q,omit as G}from"lodash-unified";import{getTableDefaultSlots as J}from"./table.type.mjs";import Q from"./tableColumn.mjs";import X from"./tableColumnSettingDialog.mjs";import Z from"./tablePagination.mjs";import ee from"./tableSearchForm.mjs";import{useTable as ae}from"./useTable.mjs";const te={data:{type:Array,default:()=>[]},size:g,width:[String,Number],height:[String,Number],maxHeight:[String,Number],fit:{type:Boolean,default:!0},stripe:Boolean,border:Boolean,rowKey:[String,Function],showHeader:{type:Boolean,default:!0},showSummary:Boolean,sumText:String,summaryMethod:Function,rowClassName:[String,Function],rowStyle:[Object,Function],cellClassName:[String,Function],cellStyle:[Object,Function],headerRowClassName:[String,Function],headerRowStyle:[Object,Function],headerCellClassName:[String,Function],headerCellStyle:[Object,Function],highlightCurrentRow:Boolean,currentRowKey:[String,Number],emptyText:String,expandRowKeys:Array,defaultExpandAll:Boolean,defaultSort:Object,tooltipEffect:String,tooltipOptions:Object,spanMethod:Function,selectOnIndeterminate:{type:Boolean,default:!0},indent:{type:Number,default:16},treeProps:{type:Object,default:()=>({hasChildren:"hasChildren",children:"children",checkStrictly:!1})},lazy:Boolean,load:Function,style:{type:Object,default:()=>({})},className:{type:String,default:""},tableLayout:{type:String,default:"fixed"},scrollbarAlwaysOn:Boolean,flexible:Boolean,showOverflowTooltip:[Boolean,Object],scrollbarTabindex:{type:[Number,String],default:void 0}},le={...te,border:{type:Boolean,default:!0},highlightCurrentRow:{type:Boolean,default:!0},rowKey:{type:[String,Function],default:"id"},spanMethod:{type:Function,validator:()=>(D("FaTable","'spanMethod' 属性，组件已经封装，外部使用会失效。"),!1)},tableKey:{type:String,default:()=>k.generateRandomString(8)},data:{type:T(Array),default:()=>[]},requestApi:{type:T(Function)},dataCallback:{type:T(Function)},initParam:T([String,Number,Object]),columns:{type:T([Array,Boolean]),default:()=>!1},columnsChange:{type:T(Function)},searchFormCols:{type:T([String,Number,Object]),default:()=>({xs:3,sm:3,md:4,lg:5,xl:6})},collapsedSearch:{type:Boolean,default:!0},advancedSearchDrawer:{type:Boolean,default:!1},searchForm:{type:Boolean,default:!0},headerCard:{type:Boolean,default:!0},refreshBtn:{type:Boolean,default:!0},searchBtn:{type:Boolean,default:!0},columnSettingBtn:{type:Boolean,default:!0},toolBtn:{type:Boolean,default:!0},hideSearchTime:Boolean,dataSearchRange:{type:T(String),default:"Past3D"},pagination:{type:Boolean,default:!0},hideImage:Boolean,single:Boolean,rowClickSelection:Boolean,treeData:Boolean,props:{type:T(Object),default:()=>({span:void 0,children:"children"})},autoRefresh:{type:Boolean,default:!0},rowSelectable:Function},ne={select:(e,a)=>W(e)&&H(a),selectAll:e=>W(e),selectionChange:e=>W(e),cellMouseEnter:(e,a,t,l)=>H(e)&&H(a)&&t instanceof HTMLTableCellElement&&l instanceof Event,cellMouseLeave:(e,a,t,l)=>H(e)&&H(a)&&t instanceof HTMLTableCellElement&&l instanceof Event,cellClick:(e,a,t,l)=>H(e)&&H(a)&&t instanceof HTMLTableCellElement&&l instanceof Event,cellDblclick:(e,a,t,l)=>H(e)&&H(a)&&t instanceof HTMLTableCellElement&&l instanceof Event,cellContextmenu:(e,a,t,l)=>H(e)&&H(a)&&t instanceof HTMLTableCellElement&&l instanceof Event,rowClick:(e,a,t)=>H(e)&&H(a)&&t instanceof Event,rowContextmenu:(e,a,t)=>H(e)&&H(a)&&t instanceof Event,rowDblclick:(e,a,t)=>H(e)&&H(a)&&t instanceof Event,headerClick:(e,a)=>H(e)&&a instanceof Event,headerContextmenu:(e,a)=>H(e)&&a instanceof Event,sortChange:e=>H(e),filterChange:e=>A(e)||$(e)||V(e)||H(e),currentChange:(e,a)=>H(e)&&(U(a)||H(a)),headerDragend:(e,a,t,l)=>$(e)&&$(a)&&H(t)&&l instanceof MouseEvent,expandChange:(e,a)=>H(e)&&(V(a)||W(a)),refresh:e=>H(e),reset:e=>H(e),sizeChange:e=>$(e),paginationChange:(e,a)=>$(e)&&$(a),customCellClick:(e,{row:a,column:t,$index:l})=>A(e)&&H(a)&&H(t)&&$(l)},oe=/* @__PURE__ */a({name:"FaTable",props:le,emits:ne,slots:K(),setup(a,{attrs:g,slots:T,emit:k,expose:D}){const{_globalSize:K,state:H,elementRef:$,tableRef:V,handleTableColumnAutoWidth:W,loadTableColumns:U,handleSizeChange:le,handlePaginationChange:ne,defaultSearchTime:oe,tableSearch:ie,tableReset:re,doRender:se,doLoading:ce,handleCustomCellClick:de}=ae(a,T,k),ue=t();let me=0;const he=e=>{if(0===e&&(me=0),H.spanColumns?.length>0){return 0===Number(H.tableSpanData["__table-index"][e])?me+(H.tablePagination.pageIndex-1)*H.tablePagination.pageSize+1:(me++,me+(H.tablePagination.pageIndex-1)*H.tablePagination.pageSize)}return e+(H.tablePagination.pageIndex-1)*H.tablePagination.pageSize+1},ge=(e,t)=>{a.single&&(V.value.clearSelection(),e.length>0&&t&&V.value.toggleRowSelection(t)),k("select",e,t)},pe=e=>{a.single&&(H.selected?H.tableData.length>0&&(V.value.clearSelection(),V.value.toggleRowSelection(H.tableData[0])):V.value.clearSelection()),k("selectAll",e)},fe=e=>{0===e.length?H.selected=!1:H.selected=!0,a.single&&e.length>0?H.selectedList=[e[e.length-1]]:H.selectedList=e,H.indeterminateSelectedListIds=H.indeterminateSelectedListIds.filter(e=>H.selectedListIds.some(a=>a===e)),k("selectionChange",H.selectedList)},be=({column:e,prop:t,order:l})=>{e.multiOrder?"descending"===e.multiOrder?e.multiOrder="ascending":e.multiOrder=null:e.multiOrder="descending",H.searchParam.sortList=[.../* @__PURE__ */new Set([...a.initParam?.sortList??[],...H.searchParam?.sortList??[]])];const n=H.orgColumns.find(e=>e.prop===t),o=n.sortableField??n.prop??n.property,i=H.searchParam.sortList.findIndex(e=>e.enField===o);e.multiOrder?-1===i?H.searchParam.sortList.push({enField:o,cnField:n.label,mode:e.multiOrder}):H.searchParam.sortList[i].mode=e.multiOrder:H.searchParam.sortList.splice(i,1),0===H.searchParam.sortList.length&&delete H.searchParam.sortList,k("sortChange",{column:e,prop:t,order:e.multiOrder}),ie()},Ce=(e,t)=>{e&&(a.rowClickSelection&&(a.single&&t&&V.value.toggleRowSelection(t),V.value.toggleRowSelection(e)),k("currentChange",e,t))},we=({row:e,column:t,rowIndex:l,columnIndex:n})=>{let o=null;if("selection"===t.type){const t=Y(a.rowKey)?a.rowKey(e):e[a.rowKey];H.indeterminateSelectedListIds.some(e=>e===t)&&(o="fa-table__selection-column__indeterminate")}const i=H.tableColumns.find(e=>e.prop===t.property);if(i?.dataDeleteField&&e&&!0===e[i.dataDeleteField]&&(o?o+=" fa-table__data-delete-column":o="fa-table__data-delete-column"),"submitInfo"===i?.type&&(o?o+=" fa-table__line-height-normal-column":o="fa-table__line-height-normal-column"),"date"!==i?.type&&"time"!==i?.type&&"dateTime"!==i?.type||i?.dateFix&&(o?o+=" fa-table__line-height-normal-column":o="fa-table__line-height-normal-column"),a.cellClassName){let i=null;return i=A(a.cellClassName)?a.cellClassName:a.cellClassName({row:e,column:t,rowIndex:l,columnIndex:n}),i?o?`${o} ${i}`:i:o}return o},Se=({row:e,column:t,rowIndex:l,columnIndex:n})=>(t.order=t.multiOrder,a.headerCellClassName?Y(a.headerCellClassName)?a.headerCellClassName({row:e,column:t,rowIndex:l,columnIndex:n}):a.headerCellClassName:null),_e=({row:e,column:a,rowIndex:t,columnIndex:l})=>{const n=a.property??a.columnKey;if(-1!==H.spanColumns.findIndex(e=>e.prop===n)){const e=Number(H.tableSpanData[n][t]);return e>0?{rowspan:e,colspan:1}:{rowspan:0,colspan:0}}return{rowspan:1,colspan:1}},ye=async(e,a,t,l)=>{H.orgColumns.forEach(a=>{t.property===a.prop&&(a.width=e,a.smallWidth=e)}),k("headerDragend",e,a,t,l),await N.debounceAsync(ue.value.change,500)},ve=e=>{H.previewList=[e],H.imagePreview=!0};l(async()=>{H.initParam=a.initParam,oe(),Object.keys(a.initParam??{}).forEach(e=>{H.searchParam[e]=a.initParam[e]}),await ie(),n(()=>a.columns,async()=>{U()},{deep:!0,immediate:!0}),n(()=>a.initParam,()=>{Object.keys(a.initParam??{}).forEach(e=>{H.searchParam[e]=a.initParam[e]})},{deep:!0}),n(()=>a.data,async()=>{!a.requestApi&&a.autoRefresh&&await ie()},{deep:!0,immediate:!0}),o(async()=>{const e=$.value;if(e){const a=new ResizeObserver(e=>{for(const a of e){const{width:e,height:t}=a.contentRect;H.tableWidth=e,H.tableHeight=t}N.debounceAsync(async()=>{await W()},100)});return a.observe(e),()=>{a.disconnect()}}})}),i(async()=>{await W()});const xe=r(()=>H.searchColumns.filter(e=>e.search.slot).map(e=>e.search.slot)),Pe=r(()=>H.tableColumns.filter(e=>e.slot).map(e=>e.slot)),Ie=["multiOrder","columnId","order","sortableField","disabledSortable","spanProp","pureSearch","search"],Le=E(a,te,["data","spanMethod","headerCellClassName","cellClassName"]);return j(()=>s("div",{ref:$,class:["fa-table",`fa-table-${K.value}`,`fa-table__${a.tableKey??"notFound"}`,{fa__click__disabled:H.loading}],style:{"--fa-table-width":""+(H.tableWidth?`${H.tableWidth}px`:""),"--fa-table-height":""+(H.tableHeight?`${H.tableHeight}px`:"")}},[s(ee,{show:a.searchForm&&H.searchForm,collapsedSearch:a.collapsedSearch,advancedSearchDrawer:a.advancedSearchDrawer,cols:a.searchFormCols,search:ie,reset:re},q(T,xe.value)),T.topHeader&&s("div",{class:"el-card fa-table__header"},[T.topHeader({search:ie,...J(H)})]),s("div",{class:"el-card fa-table__main"},[a.headerCard&&s("div",{class:"fa-table__main-header"},[s("div",{class:"fa-table__main-header-left"},[T.header&&T.header({search:ie,...J(H)})]),s("div",{class:"fa-table__main-header-right"},[a.toolBtn&&s(d,null,[s("div",{class:"fa-table__main-header-right__div-search"},[s(p,{class:"fa-table__main-header-right__input-search",disabled:H.loading,prefixIcon:I,placeholder:"关键字搜索",modelValue:H.searchParam.searchValue,modelModifiers:{trim:!0},"onUpdate:modelValue":e=>H.searchParam.searchValue=e,clearable:!0,onCompositionupdate:e=>{H.searchValueUpdate=e.data},onCompositionend:e=>{H.searchValueUpdate=""},onChange:()=>ie()},null),s("div",{class:"fa-table__main-header-right__div-search__hidden"},[H.searchParam.searchValue,H.searchValueUpdate])]),a.requestApi&&!a.hideSearchTime&&s(f,{class:"fa-table__main-header-right__data-search",popperClass:"fa-table__main-header-right__data-search__popper",disabled:H.loading,type:"daterange",modelValue:H.searchParam.searchTimeList,"onUpdate:modelValue":e=>H.searchParam.searchTimeList=e,defaultTime:M.getDefaultTime(),shortcuts:M.getShortcuts(),valueFormat:"YYYY-MM-DD HH:mm:ss",disabledDate:M.getDisabledDate,clearable:!1,teleported:!1,unlinkPanels:!0,onChange:()=>ie()},null),a.refreshBtn&&s(b,{loading:H.loading,loadingIcon:B,title:"刷新",circle:!0,icon:L,onClick:()=>ie()},null),a.searchBtn&&H.searchColumns.length>0&&s(b,{loading:H.loading,loadingIcon:B,title:H.searchForm?"隐藏搜索栏":"显示搜索栏",circle:!0,icon:I,onClick:()=>H.searchForm=!H.searchForm},null),a.columnSettingBtn&&a.columns&&s(C,{title:"表格列配置",trigger:"click"},{default:()=>s(b,{loading:H.loading,loadingIcon:B,circle:!0,icon:F},null),dropdown:()=>s(w,null,{default:()=>[T.columnSetting&&T.columnSetting(),s(S,{title:"表格列配置",divided:!0,onClick:()=>ue.value.open()},{default:()=>[u("表格列配置")]})]})}),T.toolButton&&T.toolButton({search:ie,...J(H)}),T.toolButtonAdv&&s(C,{title:"高级操作",trigger:"click"},{default:()=>s(b,{loading:H.loading,loadingIcon:B,circle:!0,icon:R},null),dropdown:()=>{let a;return s(w,null,"function"==typeof(t=a=T.toolButtonAdv({search:ie,...J(H)}))||"[object Object]"===Object.prototype.toString.call(t)&&!e(t)?a:{default:()=>[a]});var t}})])])]),c(s(_,m(Le.value,{ref:V,"element-loading-text":H.loadingText,data:H.tableData,spanMethod:_e,headerCellClassName:Se,cellClassName:we,onSelectionChange:fe,onSortChange:be,onSelect:ge,onSelectAll:pe,onCurrentChange:Ce,onHeaderDragend:ye,onCellMouseEnter:(e,a,t,l)=>k("cellMouseEnter",e,a,t,l),onCellMouseLeave:(e,a,t,l)=>k("cellMouseLeave",e,a,t,l),onCellClick:(e,a,t,l)=>k("cellClick",e,a,t,l),onCellDblclick:(e,a,t,l)=>k("cellDblclick",e,a,t,l),onCellContextmenu:(e,a,t,l)=>k("cellContextmenu",e,a,t,l),onRowClick:(e,a,t)=>k("rowClick",e,a,t),onRowContextmenu:(e,a,t)=>k("rowContextmenu",e,a,t),onRowDblclick:(e,a,t)=>k("rowDblclick",e,a,t),onHeaderClick:(e,a)=>k("headerClick",e,a),onHeaderContextmenu:(e,a)=>k("headerContextmenu",e,a),onFilterChange:e=>k("filterChange",e),onExpandChange:(e,a)=>k("expandChange",e,a)}),{append:()=>T.append&&T.append(),empty:()=>s("div",{class:"fa-table__empty"},[T.empty?T.empty():s(d,null,[s(v,null,{default:()=>[s(O,null,null)]}),s("div",null,[u("暂无数据")])])]),default:()=>s(d,null,[s(y,{className:"fa-table__index-column",type:"index",fixed:"left",width:H.tablePagination.pageIndex*H.tablePagination.pageSize>=100?H.tablePagination.pageIndex*H.tablePagination.pageSize>=1e3?50:40:30,align:"center",index:he,showOverflowTooltip:!1,resizable:!1,columnKey:"__table-index"},null),s(y,{className:"fa-table__selection-column",type:"selection",fixed:"left",width:35,align:"center",reserveSelection:!0,showOverflowTooltip:!1,resizable:!1,columnKey:"__table-selection",selectable:a.rowSelectable},null),T.operation&&s(y,{fixed:"right",width:H.operationColumnWidth,headerAlign:"center",align:"left",showOverflowTooltip:!1,className:"fa-table__operation-column",resizable:!1,columnKey:"__table-operation"},{header:()=>s("div",{class:"fa-table__auto-width-column__cell-header __fa-table__auto-width-column__cell-header____table-operation"},[s("span",null,[u("操作")])]),default:({row:e,column:a,$index:t})=>s("div",{class:"fa-table__auto-width-column__cell __fa-table__auto-width-column__cell____table-operation"},[T.operation({row:e,column:a,$index:t,search:ie,...J(H)})])}),0===H.tableColumns?.length?T.default&&T.default():H.tableColumns.map(e=>e.show&&("expand"===e.type?s(y,m(e,{width:35,fixed:e.fixed??"left",resizable:!1}),{default:({row:a,column:t,$index:l})=>s(d,null,[e.render&&e.render({row:a,column:t,$index:l,...J(H)}),e.slot&&T[e.slot]&&T[e.slot]({row:a,column:t,$index:l,...J(H)})])}):e.prop&&s(Q,m(G(e,Ie),{hideImage:a.hideImage,resizable:!0,onImagePreview:ve,onCustomCellClick:de}),q(T,Pe.value))))])}),[[h("loading"),H.loading]]),s("div",{class:"fa-table__main-footer"},[s("div",{class:"fa-table__main-footer__left"},[T.footer&&T.footer({search:ie,...J(H)})]),T.pagination?T.pagination({pageIndex:H.tablePagination.pageIndex,pageSize:H.tablePagination.pageSize,totalRows:H.tablePagination.totalRows,handleSizeChange:le,handlePaginationChange:ne}):s(d,null,[a.pagination?s(Z,{onSizeChange:le,onCurrentChange:ne},null):s(x,{class:"fa-table-pagination",size:"small",layout:"total",total:H.tableData.length},null)])])]),H.imagePreview&&s(P,{closeOnPressEscape:!0,hideOnClickModal:!0,teleported:!0,onClose:()=>H.imagePreview=!1,urlList:H.previewList},null),a.columnSettingBtn&&s(X,{ref:ue,change:a.columnsChange},null)])),z(D,{clearSelection:r(()=>V.value?.clearSelection),getSelectionRows:r(()=>V.value?.getSelectionRows),toggleRowSelection:r(()=>V.value?.toggleRowSelection),toggleAllSelection:r(()=>V.value?.toggleAllSelection),toggleRowExpansion:r(()=>V.value?.toggleRowExpansion),setCurrentRow:r(()=>V.value?.setCurrentRow),clearSort:r(()=>V.value?.clearSort),clearFilter:r(()=>V.value?.clearFilter),doLayout:r(()=>V.value?.doLayout),sort:r(()=>V.value?.sort),scrollTo:r(()=>V.value?.scrollTo),setScrollTop:r(()=>V.value?.setScrollTop),setScrollLeft:r(()=>V.value?.setScrollLeft),columns:r(()=>V.value?.columns),updateKeyChildren:r(()=>V.value?.updateKeyChildren),loading:r(()=>H.loading),tableData:r(()=>H.tableData),tablePagination:r(()=>H.tablePagination),searchParam:r(()=>H.searchParam),selected:r(()=>H.selected),selectedList:r(()=>H.selectedList),selectedListIds:r(()=>H.selectedListIds),indeterminateSelectedListIds:r(()=>H.indeterminateSelectedListIds),tableWidth:r(()=>H.tableWidth),tableHeight:r(()=>H.tableHeight),toggleRowIndeterminateSelection:(e,t)=>{const l=Y(a.rowKey)?a.rowKey(e):e[a.rowKey],n=H.tableData.find(e=>Y(a.rowKey)?a.rowKey(e):e[a.rowKey]===l);if(!0===t)H.indeterminateSelectedListIds.some(e=>e===l)||H.indeterminateSelectedListIds.push(l),V.value.toggleRowSelection(n,!0);else if(!1===t){const e=H.indeterminateSelectedListIds.findIndex(e=>e===l);e>=0&&H.indeterminateSelectedListIds.splice(e,1),V.value.toggleRowSelection(n,!1)}else{const e=H.indeterminateSelectedListIds.findIndex(e=>e===l);e>=0?H.indeterminateSelectedListIds.splice(e,1):H.indeterminateSelectedListIds.push(l),V.value.toggleRowSelection(n)}},refresh:ie,reset:re,doRender:se,doLoading:ce})}});export{oe as default,ne as faTableEmits,le as faTableProps,te as tableProps};
//# sourceMappingURL=table.mjs.map
