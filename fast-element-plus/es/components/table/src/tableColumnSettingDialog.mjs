import{defineComponent as e,inject as l,reactive as a,ref as o,createVNode as t,Fragment as d,mergeProps as n,createTextVNode as r,resolveComponent as i}from"vue";import{ElNotification as s,ElMessage as c,ElTable as u,ElTableColumn as m,ElInput as h,ElRadioGroup as p,ElRadio as b,ElInputNumber as f,ElSwitch as g}from"element-plus";import{FaDialog as w}from"../../dialog/index.mjs";import{stringUtil as y,useRender as V,useExpose as x,definePropType as C}from"@fast-china/utils";import v from"sortablejs";import{tableStateKey as S}from"./useTable.mjs";const T=/* @__PURE__ */e({name:"FaTableColumnsSettingDialog",props:{change:{type:C(Function)}},setup(e,{expose:C}){const T=l(S),U=a({tableKey:y.generateRandomString(8),sortableInstance:void 0,change:!1}),_=o(),I=e=>e+1,W=async()=>{U.change?e.change&&await e.change(T.orgColumns):c.info("列配置未发生变化")},k=()=>{_.value.close(async()=>{await W()})},K=()=>{U.change=!0;let e=T.orgColumns.filter(e=>!e?.pureSearch);e=e.sort((l,a)=>l.order!==a.order?l.order-a.order:e.indexOf(a)-e.indexOf(l)),T.orgColumns=[...e,...T.orgColumns.filter(e=>e?.pureSearch)],T.orgColumns.forEach((e,l)=>{e.order=l+1})},P=()=>{U.change=!0},j=(e,l=!1)=>{const a={modelValue:void 0,disabled:!1,placeholder:void 0};if(e?.type)switch(e?.type){case"expand":a.disabled=!0,a.placeholder="暂不支持宽度配置";break;case"image":a.disabled=!0,a.placeholder="图片列无需配置";break;case"date":case"time":case"dateTime":a.disabled=!0,a.placeholder="时间/日期列无需配置";break;case"submitInfo":a.disabled=!0,a.placeholder="当前列无需配置"}else e?.tag?(a.disabled=!0,a.placeholder="标签列无需配置"):e?.autoWidth&&(a.disabled=!0,a.placeholder="自动列宽无需配置");return a.disabled||(delete a.disabled,delete a.modelValue,delete a.placeholder),l&&delete a.placeholder,a},F=(e,l=!1,a=!1,o=!1)=>{const t={modelValue:void 0,disabled:!1,placeholder:void 0};return e?.pureSearch&&(t.disabled=!0,t.placeholder="搜索列无需配置"),t.disabled?o&&delete t.modelValue:(delete t.disabled,delete t.modelValue,delete t.placeholder),l&&delete t.placeholder,a&&(t.placeholder="999"),t};return V(()=>t(w,{ref:_,class:"fa-table__column-setting-dialog",onConfirmClick:k,showFullscreen:!1,confirmButtonText:U.change?"保存更改":"确认",fillHeight:!0},{header:()=>t(d,null,[r("列表配置（留空则恢复默认配置）"),t(i("el-text"),{type:"info"},{default:()=>[r("点击保存才会进行数据缓存，点击取消为本此生效")]})]),default:()=>t(u,{class:["fa-table__column-setting",`fa-table__column-setting-${U.tableKey}`],data:T.orgColumns,rowKey:"prop",border:!0},{default:()=>t(d,null,[t(m,{type:"index",fixed:"left",align:"center",width:45,index:I},null),t(m,{label:"列显示名称",minWidth:200},{default:({row:e})=>"image"===e.type?t(h,{disabled:!0,readonly:!0,modelValue:e.label,"onUpdate:modelValue":l=>e.label=l,placeholder:"请输入列显示名称",onChange:P},null):t(h,n({modelValue:e.label,"onUpdate:modelValue":l=>e.label=l,placeholder:"请输入列显示名称"},F(e),{onChange:P}),null)}),t(m,{label:"固定",width:230},{default:({row:e})=>t(p,n({modelValue:e.fixed,"onUpdate:modelValue":l=>e.fixed=l},F(e,!1,!1,!0),{onChange:P}),{default:()=>[t(b,{value:!1},{default:()=>[r("无")]}),t(b,{value:"left"},{default:()=>[r("左侧")]}),t(b,{value:"right"},{default:()=>[r("右侧")]})]})}),t(m,{label:"宽度",width:200},{default:({row:e})=>t(f,n({modelValue:e.width,"onUpdate:modelValue":l=>e.width=l,min:1,max:999,stepStrictly:!0,controls:!1,clearable:!0,placeholder:"请输入宽度"},j(e),F(e),{onChange:P}),null)}),t(m,{label:"小的宽度",width:200},{default:({row:e})=>t(f,n({modelValue:e.smallWidth,"onUpdate:modelValue":l=>e.smallWidth=l,min:1,max:999,stepStrictly:!0,controls:!1,clearable:!0,placeholder:"请输入小的宽度"},j(e),F(e),{onChange:P}),null)}),t(m,{label:"顺序",width:100},{default:({row:e})=>t(f,n({modelValue:e.order,"onUpdate:modelValue":l=>e.order=l,min:1,max:999,stepStrictly:!0,controls:!1,clearable:!0,placeholder:"请输入顺序"},F(e,!1,!0),{onChange:K}),null)}),t(m,{label:"排序",width:65},{default:({row:e})=>t(g,n({modelValue:e.sortable,"onUpdate:modelValue":l=>e.sortable=l,inlinePrompt:!0,activeText:"是",inactiveText:"否",disabled:e.disabledSortable||"image"===e?.type},F(e,!0),{onChange:P}),null)}),t(m,{label:"复制",width:65},{default:({row:e})=>t(g,n({modelValue:e.copy,"onUpdate:modelValue":l=>e.copy=l,inlinePrompt:!0,activeText:"是",inactiveText:"否",disabled:!!e?.type||!!e?.slot},F(e,!0),{onChange:P}),null)}),t(m,{label:"自动宽度",width:85},{default:({row:e})=>t(g,n({modelValue:e.autoWidth,"onUpdate:modelValue":l=>e.autoWidth=l,inlinePrompt:!0,activeText:"是",inactiveText:"否",disabled:!!e?.type},F(e,!0),{onChange:P}),null)}),t(m,{label:"显示",width:75},{default:({row:e})=>t(g,{modelValue:e.show,"onUpdate:modelValue":l=>e.show=l,inlinePrompt:!0,activeText:"显示",inactiveText:"隐藏",onChange:P},null)}),t(m,{label:"搜索框名称",minWidth:200},{default:({row:e})=>e.search?t(h,{modelValue:e.search.label,"onUpdate:modelValue":l=>e.search.label=l,placeholder:"请输入搜索框名称",onChange:P},null):t(h,{disabled:!0,placeholder:"当前列暂无搜索项配置"},null)}),t(m,{label:"搜索框顺序",width:200},{default:({row:e})=>e.search?t(f,{modelValue:e.search.order,"onUpdate:modelValue":l=>e.search.order=l,min:1,max:999,stepStrictly:!0,controls:!1,clearable:!0,placeholder:"请输入搜索框顺序",onChange:P},null):t(f,{disabled:!0,min:1,max:999,stepStrictly:!0,controls:!1,clearable:!0,placeholder:"当前列暂无搜索项配置"},null)})])})})),x(C,{open:()=>{_.value.open(()=>{(()=>{const e=document.querySelector(`.fa-table__column-setting-${U.tableKey} .el-table__body-wrapper tbody`);U.sortableInstance&&U.sortableInstance.destroy(),U.sortableInstance=new v(e,{animation:150,delay:0,onEnd(e){const{newIndex:l,oldIndex:a}=e;if(l!==a){U.change=!0;const e=T.orgColumns.splice(a,1)[0];T.orgColumns.splice(l,0,e),T.orgColumns=T.orgColumns.map((e,l)=>({...e,order:l+1}))}}})})(),s({message:"点击保存才会进行数据缓存，点击取消为本此生效",type:"info"})})},change:W})}});export{T as default};
//# sourceMappingURL=tableColumnSettingDialog.mjs.map
