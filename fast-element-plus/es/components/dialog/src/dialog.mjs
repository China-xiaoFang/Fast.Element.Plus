import{defineComponent as e,reactive as l,ref as o,nextTick as a,watch as n,createVNode as i,mergeProps as t,Fragment as s,withDirectives as d,resolveDirective as r,computed as u}from"vue";import{dialogProps as f,dialogEmits as c,useGlobalSize as g,ElMessage as _,ElMessageBox as h,ElDialog as p,ElButton as m,ElScrollbar as C,ElIcon as v}from"element-plus";import{Eleme as B,Refresh as b,FullScreen as y,Close as w}from"@element-plus/icons-vue";import{FullScreenExit as k}from"@fast-element-plus/icons-vue";import{definePropType as F,execFunction as x,consoleError as T,useProps as D,useRender as O,useExpose as S,makeSlots as V}from"@fast-china/utils";import{isBoolean as A}from"lodash-unified";const R={...f,alignCenter:{type:Boolean,default:!0},appendToBody:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},destroyOnClose:{type:Boolean,default:!0},overflow:{type:Boolean,default:!0},top:{type:String,default:"5vh"},width:{type:[String,Number],default:"90%"},showRefresh:{type:Boolean,default:!0},showFullscreen:{type:Boolean,default:!0},showCloseButton:{type:Boolean,default:!0},showConfirmButton:{type:Boolean,default:!0},disabledConfirmButton:Boolean,closeButtonText:{type:String,default:"取消"},confirmButtonText:{type:String,default:"确认"},hideFooter:Boolean,fillHeight:Boolean,showBeforeClose:Boolean,afterOpen:{type:F(Function)}},H={...c,"update:modelValue":e=>A(e),confirmClick:()=>!0},P=/* @__PURE__ */e({name:"FaDialog",props:R,emits:H,slots:V(),setup(e,{attrs:c,slots:F,emit:V,expose:A}){const R=g(),H=l({loading:!1,visible:!1,fullscreen:!1,refreshing:!1}),P=o();let q;const I=l=>{H.visible=!0,q=l,a(()=>{H.loading=!0,x(e.afterOpen??l).then(()=>{V("open")}).catch(e=>{T("FaDialog",e),H.visible=!1}).finally(()=>{H.loading=!1})})},L=e=>{H.loading=!0,x(e).then(()=>{V("close"),H.visible=!1}).catch(e=>{T("FaDialog",e)}).finally(()=>{H.loading=!1})},N=()=>{H.loading||(H.refreshing=!0,H.loading=!0,setTimeout(()=>{H.refreshing=!1,I(q),_.success("刷新成功")},500))},U=l=>{if(H.loading)return;if(document.querySelector(".el-image-viewer__wrapper"))return;const o=()=>{x(e.beforeClose).then(()=>{V("close"),l()}).catch(e=>{T("FaDialog",e)})};e.showBeforeClose?h.confirm("确定关闭？",{type:"warning"}).then(()=>{o()}):o()},$=()=>{H.loading||(H.fullscreen=!H.fullscreen)},j=()=>{H.loading||V("confirmClick")},z=()=>{H.loading||L()};n(()=>H.visible,e=>{V("update:modelValue",e)});const E=D(e,f,["modelValue","fullscreen","showClose","beforeClose"]);return O(()=>i(p,t(E.value,{ref:P,class:["fa-dialog",`fa-dialog-${R.value}`,{"fa-dialog__fill-height":e.fillHeight,"fa-dialog__fullscreen":H.fullscreen}],modelValue:H.visible,"onUpdate:modelValue":e=>H.visible=e,fullscreen:H.fullscreen,showClose:!1,beforeClose:U,onOpened:()=>V("opened"),onClosed:()=>V("closed"),onOpenAutoFocus:()=>V("openAutoFocus"),onCloseAutoFocus:()=>V("closeAutoFocus")}),{header:()=>i(s,null,[i("div",{class:"fa-dialog__header-title"},[e.title,F.header&&F.header({loading:H.loading,close:z})]),e.showRefresh&&i("div",{title:"刷新",class:["fa-dialog__header-icon",H.loading?"fa__click__disabled fa__click__disabled__cursor ":"fa__hover__twinkle"],onClick:N},[i(v,null,{default:()=>[i(b,null,null)]})]),e.showFullscreen&&i("div",{title:H.fullscreen?"关闭全屏显示":"全屏显示",class:["fa-dialog__header-icon",H.loading?"fa__click__disabled fa__click__disabled__cursor ":"fa__hover__twinkle"],onClick:$},[i(v,null,{default:()=>[H.fullscreen?i(k,null,null):i(y,null,null)]})]),e.showClose&&i("div",{title:"关闭",class:["fa-dialog__header-icon",H.loading?"fa__click__disabled fa__click__disabled__cursor ":"fa__hover__twinkle"],onClick:z},[i(v,null,{default:()=>[i(w,null,null)]})])]),default:()=>d(i(C,{"element-loading-text":"加载中..."},{default:()=>[!H.refreshing&&F.default&&F.default(H)]}),[[r("loading"),H.loading]]),...!e.hideFooter&&{footer:()=>i(s,null,[F.footer&&F.footer({loading:H.loading,close:z}),e.showCloseButton&&i(m,{disabled:H.loading,onClick:z},{default:()=>[e.closeButtonText]}),e.showConfirmButton&&i(m,{loading:H.loading,loadingIcon:B,disabled:e.disabledConfirmButton,type:"primary",onClick:j},{default:()=>[H.loading?"加载中...":e.confirmButtonText]})])}})),S(A,{dialogContentRef:u(()=>P.value?.dialogContentRef),resetPosition:u(()=>P.value?.resetPosition),loading:u(()=>H.loading),visible:u(()=>H.visible),open:I,close:L,refresh:N,doLoading:e=>{H.loading=!0,x(e).then().catch(e=>{T("FaDialog",e)}).finally(()=>{H.loading=!1})}})}});export{P as default,H as faDialogEmits,R as faDialogProps};
//# sourceMappingURL=dialog.mjs.map
