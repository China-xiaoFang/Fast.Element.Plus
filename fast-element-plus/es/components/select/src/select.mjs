import{defineComponent as e,reactive as l,ref as a,watch as t,onMounted as o,createVNode as i,mergeProps as r,computed as n}from"vue";import{useAriaProps as u,useEmptyValuesProps as d,tagProps as p,useTooltipContentProps as s,useSizeProp as c,ElSelect as f}from"element-plus";import{ArrowDown as m,CircleClose as g}from"@element-plus/icons-vue";import{definePropType as b,withDefineType as h,consoleError as v,useProps as y,useRender as S,addUnit as B,useExpose as D,makeSlots as x}from"@fast-china/utils";import{useVModel as T}from"@vueuse/core";import{isString as V,isNumber as w,isBoolean as C,isObject as F,isArray as A,isNull as O,isFunction as j,isNil as L,isEqual as N}from"lodash-unified";import q from"./selectOption.mjs";const R={name:String,id:String,modelValue:{type:[Array,String,Number,Boolean,Object],default:void 0},autocomplete:{type:String,default:"off"},automaticDropdown:Boolean,size:c,effect:{type:b(String),default:"light"},disabled:Boolean,clearable:Boolean,filterable:Boolean,allowCreate:Boolean,loading:Boolean,popperClass:{type:String,default:""},popperOptions:{type:b(Object),default:()=>({})},remote:Boolean,loadingText:String,noMatchText:String,noDataText:String,remoteMethod:Function,filterMethod:Function,multiple:Boolean,multipleLimit:{type:Number,default:0},placeholder:{type:String},defaultFirstOption:Boolean,reserveKeyword:{type:Boolean,default:!0},valueKey:{type:String,default:"value"},collapseTags:Boolean,collapseTagsTooltip:Boolean,maxCollapseTags:{type:Number,default:1},teleported:s.teleported,persistent:{type:Boolean,default:!0},clearIcon:{type:b([String,Object,Function]),default:g},fitInputWidth:Boolean,suffixIcon:{type:b([String,Object,Function]),default:m},tagType:{...p.type,default:"info"},tagEffect:{...p.effect,default:"light"},validateEvent:{type:Boolean,default:!0},remoteShowSuffix:Boolean,placement:{type:b(String),default:"bottom-start"},fallbackPlacements:{type:b(Array),default:["bottom-start","top-start","right","left"]},...d,...u(["ariaLabel"])},z={...R,loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},modelValue:{type:b([String,Number,Boolean,Object,Array]),default:void 0},label:b([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,lazy:{type:Boolean,default:!0},defaultSelected:Boolean,props:{type:b(Object),default:()=>({label:"label",hide:"hide",disabled:"disabled",children:"children"})},data:{type:b(Array),default:()=>[]},requestApi:{type:b(Function)},initParam:b([String,Number,Object])},E={"update:modelValue":e=>V(e)||w(e)||C(e)||F(e)||A(e)||O(e),"update:label":e=>V(e)||A(e)||O(e),dataChangeCallBack:e=>A(e),change:(e,l)=>(F(e)||A(e)||O(e))&&(V(l)||w(l)||C(l)||F(l)||A(l)||O(l)),visibleChange:e=>C(e),removeTag:e=>V(e)||w(e)||C(e)||F(e)||A(e),clear:()=>!0,blur:e=>e instanceof FocusEvent,focus:e=>e instanceof FocusEvent},M=/* @__PURE__ */e({name:"FaSelect",props:z,emits:E,slots:x(),setup(e,{attrs:u,slots:d,emit:p,expose:s}){const c=T(e,"label",p,{passive:!0}),m=l({value:h(),loading:!1,selectorData:h([]),debut:!0,echo:!(e.data?.length>0),nextRefresh:!1}),g=a(),b=l=>l?.map(l=>({...l,value:l[e.valueKey],label:j(e.props.label)?e.props.label(l):l[e.props.label??"label"],hide:j(e.props.hide)?e.props.hide(l):l[e.props.hide??"hide"],disabled:j(e.props.disabled)?e.props.disabled(l):l[e.props.disabled??"disabled"],children:j(e.props.children)?b(e.props.children(l)):b(l[e.props.children??"children"])})).filter(e=>!e.hide),x=async()=>{if(e.requestApi){m.loading=!0;const a=e.initParam??{};try{const l=await e.requestApi(a);m.echo=!1,m.selectorData=b(l),p("dataChangeCallBack",m.selectorData)}catch(l){v("FaSelect",l),m.selectorData=[]}finally{m.loading=!1}}else m.echo=!1,m.selectorData=b(e.data)},V=l=>{if(e.multiple){const e=l;if(0===e?.length)return m.value=null,c.value=null,p("update:modelValue",null),void p("change",null,null);const a=m.selectorData.filter(l=>e.includes(l.value));m.value=l,c.value=a.map(e=>e.label),p("update:modelValue",l),p("change",a,l)}else{if(L(l))return m.value=null,c.value=null,p("update:modelValue",null),void p("change",null,null);const e=m.selectorData.find(e=>e.value===l);m.value=l,c.value=e.label,p("update:modelValue",l),p("change",e,l)}},w=()=>{m.value=null,c.value=null,p("clear")},C=async l=>{l&&(m.debut?(m.debut=!1,!e.defaultSelected&&e.lazy&&await x()):m.nextRefresh&&(m.nextRefresh=!1,await x())),p("visibleChange",l)};t(()=>e.modelValue,l=>{if(m.echo&&!L(l)){const a=!L(e.label);if(e.multiple){if(!A(l))return void v("FaSelect","当启用 multiple 时，传入的 modelValue 必须是Array。");if(a&&!A(e.label))return void v("FaSelect","当启用 multiple 时，传入的 modelValue:label 必须是Array。");m.selectorData=l.slice(0,e.multipleLimit>0?e.multipleLimit:l.length).map((l,t)=>({value:l,label:a?e.label[t]:void 0}))}else{if(A(l))return void v("FaSelect","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(a&&A(e.label))return void v("FaSelect","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");m.selectorData=[{value:l,label:e.label}]}}m.value=l},{immediate:!0}),o(async()=>{e.defaultSelected?(await x(),m.selectorData.length>0&&V(e.multiple?[m.selectorData[0].value]:m.selectorData[0].value)):!e.requestApi&&e.data?.length>0?(m.debut=!1,await x()):e.lazy||await x(),t(()=>e.initParam,(e,l)=>{N(e,l)||(m.nextRefresh=!0,L(m.value)||V())}),t(()=>e.data,async()=>{e.requestApi||await x()},{deep:!0})});const F=y(e,R,["modelValue","popperClass","loading"]);return S(()=>i(f,r(F.value,{ref:g,class:"fa-select",popperClass:`fa-select-dropdown ${e.popperClass}`,style:{width:B(e.width)},modelValue:m.value,"onUpdate:modelValue":e=>m.value=e,loading:m.loading,onChange:V,onClear:w,onVisibleChange:C,onRemoveTag:e=>p("removeTag",e),onBlur:e=>p("blur",e),onFocus:e=>p("focus",e)}),{default:()=>m.selectorData.map(l=>i(q,{data:l,moreDetail:e.moreDetail},{default:d.default})),...d.header&&{header:()=>d.header()},...d.footer&&{footer:()=>d.footer()},...d.prefix&&{prefix:()=>d.prefix()},...d.empty&&{empty:()=>d.empty()},...d.tag&&{tag:()=>d.tag()},...d.loading&&{loading:()=>d.loading()},...d.label&&{label:({label:e,value:l})=>d.label({label:e,value:l})}})),D(s,{focus:n(()=>g.value?.focus),blur:n(()=>g.value?.blur),selectedLabel:n(()=>g.value?.selectedLabel),loading:n(()=>m.loading),refresh:x,setSelection:e=>V(e),clearSelection:()=>V(null)})}});export{R as SelectProps,M as default,E as faSelectEmits,z as faSelectProps};
//# sourceMappingURL=select.mjs.map
