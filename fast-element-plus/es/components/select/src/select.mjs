import{defineComponent as e,reactive as l,ref as a,watch as t,onMounted as o,computed as i,createVNode as r,mergeProps as n}from"vue";import{useAriaProps as u,useEmptyValuesProps as d,tagProps as p,useTooltipContentProps as s,useSizeProp as c,selectEmits as f,useGlobalSize as m,ElSelect as b}from"element-plus";import{ArrowDown as g,CircleClose as h}from"@element-plus/icons-vue";import{definePropType as y,withDefineType as v,consoleError as S,useProps as B,useEmits as D,useRender as x,addUnit as V,useExpose as w,makeSlots as A}from"@fast-china/utils";import{useVModel as T}from"@vueuse/core";import{isArray as C,isString as F,isNull as O,isNumber as j,isBoolean as L,isObject as N,isFunction as q,isNil as z,isEqual as M}from"lodash-unified";import P from"./selectOption.mjs";const R={name:String,id:String,modelValue:{type:[Array,String,Number,Boolean,Object],default:void 0},autocomplete:{type:String,default:"off"},automaticDropdown:Boolean,size:c,effect:{type:y(String),default:"light"},disabled:Boolean,clearable:Boolean,filterable:Boolean,allowCreate:Boolean,loading:Boolean,popperClass:{type:String,default:""},popperOptions:{type:y(Object),default:()=>({})},remote:Boolean,loadingText:String,noMatchText:String,noDataText:String,remoteMethod:Function,filterMethod:Function,multiple:Boolean,multipleLimit:{type:Number,default:0},placeholder:{type:String},defaultFirstOption:Boolean,reserveKeyword:{type:Boolean,default:!0},valueKey:{type:String,default:"value"},collapseTags:Boolean,collapseTagsTooltip:Boolean,maxCollapseTags:{type:Number,default:1},teleported:s.teleported,persistent:{type:Boolean,default:!0},clearIcon:{type:y([String,Object,Function]),default:h},fitInputWidth:Boolean,suffixIcon:{type:y([String,Object,Function]),default:g},tagType:{...p.type,default:"info"},tagEffect:{...p.effect,default:"light"},validateEvent:{type:Boolean,default:!0},remoteShowSuffix:Boolean,placement:{type:y(String),default:"bottom-start"},fallbackPlacements:{type:y(Array),default:["bottom-start","top-start","right","left"]},...d,...u(["ariaLabel"])},_={...R,disabled:{type:Boolean,default:void 0},loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},modelValue:{type:y([String,Number,Boolean,Object,Array]),default:void 0},label:y([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,lazy:{type:Boolean,default:!0},defaultSelected:Boolean,props:{type:y(Object),default:()=>({label:"label",hide:"hide",disabled:"disabled",children:"children"})},data:{type:y(Array),default:()=>[]},requestApi:{type:y(Function)},initParam:y([String,Number,Object])},k={...f,"update:modelValue":e=>F(e)||j(e)||L(e)||N(e)||C(e)||O(e),"update:label":e=>F(e)||C(e)||O(e),dataChangeCallBack:e=>C(e),change:(e,l)=>!0},I=/* @__PURE__ */e({name:"FaSelect",props:_,emits:k,slots:A(),setup(e,{attrs:u,slots:d,emit:p,expose:s}){const c=T(e,"label",p),g=m(),h=l({value:v(),loading:!1,selectorData:v([]),debut:!0,echo:!(e.data?.length>0),nextRefresh:!1}),y=a(),A=l=>l?.map(l=>({...l,value:l[e.valueKey],label:q(e.props.label)?e.props.label(l):l[e.props.label??"label"],hide:q(e.props.hide)?e.props.hide(l):l[e.props.hide??"hide"],disabled:q(e.props.disabled)?e.props.disabled(l):l[e.props.disabled??"disabled"],children:q(e.props.children)?A(e.props.children(l)):A(l[e.props.children??"children"])})).filter(e=>!e.hide),F=async()=>{if(e.requestApi){h.loading=!0;const a=e.initParam??{};try{const l=await e.requestApi(a);h.echo=!1,h.selectorData=A(l),p("dataChangeCallBack",h.selectorData)}catch(l){S("FaSelect",l),h.selectorData=[]}finally{h.loading=!1}}else h.echo=!1,h.selectorData=A(e.data)},O=l=>{if(e.multiple){const e=l;if(0===e?.length)return h.value=null,c.value=null,p("update:modelValue",null),void p("change",null,null);const a=h.selectorData.filter(l=>e.includes(l.value));h.value=l,c.value=a.map(e=>e.label),p("update:modelValue",l),p("change",a,l)}else{if(z(l))return h.value=null,c.value=null,p("update:modelValue",null),void p("change",null,null);const e=h.selectorData.find(e=>e.value===l);h.value=l,c.value=e.label,p("update:modelValue",l),p("change",e,l)}},j=()=>{h.value=null,c.value=null,p("update:modelValue",null),p("clear")},L=async l=>{l&&(h.debut?(h.debut=!1,!e.defaultSelected&&e.lazy&&await F()):h.nextRefresh&&(h.nextRefresh=!1,await F())),p("visible-change",l)};t(()=>e.modelValue,l=>{if(h.echo&&!z(l)){const a=!z(e.label);if(e.multiple){if(!C(l))return void S("FaSelect","当启用 multiple 时，传入的 modelValue 必须是Array。");if(a&&!C(e.label))return void S("FaSelect","当启用 multiple 时，传入的 modelValue:label 必须是Array。");h.selectorData=l.slice(0,e.multipleLimit>0?e.multipleLimit:l.length).map((l,t)=>({value:l,label:a?e.label[t]:void 0}))}else{if(C(l))return void S("FaSelect","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(a&&C(e.label))return void S("FaSelect","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");h.selectorData=[{value:l,label:e.label}]}}h.value=l},{immediate:!0}),o(async()=>{e.defaultSelected?(await F(),h.selectorData.length>0&&O(e.multiple?[h.selectorData[0].value]:h.selectorData[0].value)):!e.requestApi&&e.data?.length>0?(h.debut=!1,await F()):e.lazy||await F(),t(()=>e.initParam,(e,l)=>{M(e,l)||(h.nextRefresh=!0,z(h.value)||O())}),t(()=>e.data,async()=>{e.requestApi||await F()},{deep:!0})});const N=B(e,R,["modelValue","popperClass","loading"]),_=D(f,p,["update:modelValue","change","clear","visible-change"]),k=i(()=>{let l=`fa-select-dropdown ${e.popperClass}`;return e.moreDetail&&(l+=` fa-select-dropdown__more-detail fa-select-dropdown__more-detail-${g.value}`),l});return x(()=>r(b,n(N.value,_.value,{ref:y,class:"fa-select",popperClass:k.value,style:{width:V(e.width)},modelValue:h.value,"onUpdate:modelValue":e=>h.value=e,loading:h.loading,onChange:O,onClear:j,onVisibleChange:L}),{default:()=>h.selectorData.map(l=>r(P,{data:l,moreDetail:e.moreDetail},{default:d.default})),...d.header&&{header:()=>d.header()},...d.footer&&{footer:()=>d.footer()},...d.prefix&&{prefix:()=>d.prefix()},...d.empty&&{empty:()=>d.empty()},...d.tag&&{tag:()=>d.tag()},...d.loading&&{loading:()=>d.loading()},...d.label&&{label:({label:e,value:l})=>d.label({label:e,value:l})}})),w(s,{focus:i(()=>y.value?.focus),blur:i(()=>y.value?.blur),selectedLabel:i(()=>y.value?.selectedLabel),loading:i(()=>h.loading),refresh:F,setSelection:e=>O(e),clearSelection:()=>O(null)})}});export{R as SelectProps,I as default,k as faSelectEmits,_ as faSelectProps};
//# sourceMappingURL=select.mjs.map
