import{defineComponent as e,reactive as l,ref as a,watch as t,onMounted as o,computed as d,createVNode as i,mergeProps as r,Fragment as u,createTextVNode as s}from"vue";import{selectEmits as n,useGlobalSize as p,ElSelect as c,ElPagination as m,ElOption as f,ElInput as g,ElButton as b}from"element-plus";import{Search as v}from"@element-plus/icons-vue";import{FaSelectOption as h}from"../../select/index.mjs";import{definePropType as y,withDefineType as S,consoleError as V,useProps as x,useEmits as w,useRender as D,addUnit as L,useExpose as C,makeSlots as _}from"@fast-china/utils";import{useVModel as P}from"@vueuse/core";import{isArray as R,isString as A,isNull as B,isNumber as F,isBoolean as I,isObject as z,isFunction as T,isNil as j,isEqual as k}from"lodash-unified";import{SelectProps as N}from"../../select/src/select.mjs";const O={...N,disabled:{type:Boolean,default:void 0},loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},modelValue:{type:y([String,Number,Boolean,Object,Array]),default:void 0},label:y([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,props:{type:y(Object),default:()=>({label:"label",hide:"hide",disabled:"disabled",children:"children"})},requestApi:{type:y(Function)},initParam:y([String,Number,Object])},$={...n,"update:modelValue":e=>A(e)||F(e)||I(e)||z(e)||R(e)||B(e),"update:label":e=>A(e)||R(e)||B(e),dataChangeCallBack:e=>R(e),change:(e,l)=>!0},q=/* @__PURE__ */e({name:"FaSelectPage",props:O,emits:$,slots:_(),setup(e,{attrs:y,slots:_,emit:A,expose:B}){const F=P(e,"label",A),I=p(),z=l({value:S(),loading:!1,selectorData:S([]),selectedList:S([]),debut:!0,echo:!0,nextRefresh:!1,pageIndex:1,pageSize:15,totalRows:0,searchValue:void 0,defaultSelectorData:S()}),O=a(),$=l=>l?.map(l=>({...l,value:l[e.valueKey],label:T(e.props.label)?e.props.label(l):l[e.props.label??"label"],hide:T(e.props.hide)?e.props.hide(l):l[e.props.hide??"hide"],disabled:T(e.props.disabled)?e.props.disabled(l):l[e.props.disabled??"disabled"],children:T(e.props.children)?$(e.props.children(l)):$(l[e.props.children??"children"])})).filter(e=>!e.hide),q=async l=>{z.loading=!0,z.pageIndex=l??z.pageIndex;const a={...e.initParam??{},pageIndex:z.pageIndex,pageSize:z.pageSize,searchValue:z.searchValue};try{const l=await e.requestApi(a);z.echo=!1,z.totalRows=l.totalRows,z.selectorData=$(l.rows),A("dataChangeCallBack",z.selectorData)}catch(t){V("FaSelectPage",t),z.pageIndex=1,z.totalRows=0,z.selectorData=[]}finally{z.loading=!1}},K=l=>{if(e.multiple){const e=l;if(0===e?.length)return z.value=null,F.value=null,z.selectedList=[],A("update:modelValue",null),void A("change",null,null);const a=z.selectorData.filter(l=>e.includes(l.value));z.value=l,F.value=a.map(e=>e.label),z.selectedList=[...z.selectedList.filter(e=>!a.some(l=>l.value===e.value)),...a].filter(l=>e.includes(l.value)),A("update:modelValue",l),A("change",a,l)}else{if(j(l))return z.value=null,F.value=null,z.selectedList=[],A("update:modelValue",null),void A("change",null,null);const e=z.selectorData.find(e=>e.value===l);z.value=l,F.value=e.label,z.selectedList.some(e=>e.value===l)||(z.selectedList=[e]),A("update:modelValue",l),A("change",e,l)}},M=()=>{z.value=null,F.value=null,z.selectedList=[],A("update:modelValue",null),A("clear")},U=async e=>{e&&(z.debut?(z.debut=!1,await q()):z.nextRefresh&&(z.nextRefresh=!1,await q())),A("visible-change",e)};t(()=>e.modelValue,l=>{if(z.echo&&!j(l)){const a=!j(e.label);if(e.multiple){if(!R(l))return void V("FaSelectPage","当启用 multiple 时，传入的 modelValue 必须是Array。");if(a&&!R(e.label))return void V("FaSelectPage","当启用 multiple 时，传入的 modelValue:label 必须是Array。");z.selectedList=l.slice(0,e.multipleLimit>0?e.multipleLimit:l.length).map((l,t)=>({value:l,label:a?e.label[t]:void 0}))}else{if(R(l))return void V("FaSelectPage","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(a&&R(e.label))return void V("FaSelectPage","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");z.defaultSelectorData={value:l,label:e.label}}}z.value=l},{immediate:!0}),o(()=>{t(()=>e.initParam,(e,l)=>{k(e,l)||(z.nextRefresh=!0,j(z.value)||K())})});const E=x(e,N,["modelValue","popperClass","loading"]),G=w(n,A,["update:modelValue","change","clear","visible-change"]),H=d(()=>{let l=`fa-select-page-dropdown fa-select-page-dropdown-${I.value} ${e.popperClass}`;return e.moreDetail&&(l+=` fa-select-dropdown__more-detail fa-select-dropdown__more-detail-${I.value}`),l});return D(()=>i(c,r(E.value,G.value,{ref:O,class:"fa-select-page",popperClass:H.value,style:{width:L(e.width)},modelValue:z.value,"onUpdate:modelValue":e=>z.value=e,loading:z.loading,onChange:K,onClear:M,onVisibleChange:U}),{default:()=>z.selectorData.map(l=>i(h,{data:l,moreDetail:e.moreDetail},{default:_.default})),header:()=>i(u,null,[z.defaultSelectorData&&i(f,{class:"fa-select-page-dropdown__default-selector",value:z.defaultSelectorData.value,label:z.defaultSelectorData.label,disabled:!0},{default:()=>[i("span",null,[z.defaultSelectorData.label]),i("span",null,[s("Default")])]}),i(g,{class:"fa-select-page-dropdown__search-input",clearable:!0,placeholder:"请输入关键字搜索",modelValue:z.searchValue,modelModifiers:{trim:!0},"onUpdate:modelValue":e=>z.searchValue=e,onKeyup:e=>{"Enter"===e.key&&q(1)}},{append:()=>i(b,{loading:z.loading,icon:v,onClick:()=>q(1)},null)}),_.header&&_.header()]),footer:()=>i(u,null,[i(m,{class:"fa-select-page-dropdown__pagination",size:"small",currentPage:z.pageIndex,pageSize:z.pageSize,total:z.totalRows,layout:"prev, pager, next, total",pagerCount:5,onCurrentChange:q},null),_.footer&&_.footer()]),..._.prefix&&{prefix:()=>_.prefix()},..._.empty&&{empty:()=>_.empty()},..._.tag&&{tag:()=>_.tag()},..._.loading&&{loading:()=>_.loading()},...e.multiple?{label:({label:e,value:l})=>{const a=z.selectedList.find(e=>e.value===l);return _.label?_.label({label:a?.label,value:j(a)?l:a?.value}):a&&i("span",{class:"el-select__tags-text"},[a.label])}}:_.label&&{label:({label:e,value:l})=>_.label({label:e,value:l})}})),C(B,{focus:d(()=>O.value?.focus),blur:d(()=>O.value?.blur),selectedLabel:d(()=>O.value?.selectedLabel),loading:d(()=>z.loading),selectedList:d(()=>z.selectedList),refresh:q,setSelection:e=>K(e),clearSelection:()=>K(null)})}});export{q as default,$ as faSelectPageEmits,O as faSelectPageProps};
//# sourceMappingURL=selectPage.mjs.map
