import{defineComponent as e,reactive as l,ref as a,watch as t,onMounted as o,createVNode as s,mergeProps as i,Fragment as r,createTextVNode as u,computed as d}from"vue";import{useGlobalSize as n,ElSelect as p,ElPagination as c,ElOption as m,ElInput as f,ElButton as g}from"element-plus";import{Search as b}from"@element-plus/icons-vue";import{FaSelectOption as v}from"../../select/index.mjs";import{definePropType as h,withDefineType as y,consoleError as S,useProps as x,useRender as V,addUnit as D,useExpose as w,makeSlots as C}from"@fast-china/utils";import{useVModel as L}from"@vueuse/core";import{isString as F,isNumber as P,isBoolean as R,isObject as T,isArray as A,isNull as _,isFunction as B,isNil as I,isEqual as z}from"lodash-unified";import{SelectProps as j}from"../../select/src/select.mjs";const k={...j,loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},modelValue:{type:h([String,Number,Boolean,Object,Array]),default:void 0},label:h([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,props:{type:h(Object),default:()=>({label:"label",hide:"hide",disabled:"disabled",children:"children"})},requestApi:{type:h(Function)},initParam:h([String,Number,Object])},E={"update:modelValue":e=>F(e)||P(e)||R(e)||T(e)||A(e)||_(e),"update:label":e=>F(e)||A(e)||_(e),dataChangeCallBack:e=>A(e),change:(e,l)=>(T(e)||A(e)||_(e))&&(F(l)||P(l)||R(l)||T(l)||A(l)||_(l)),visibleChange:e=>R(e),removeTag:e=>F(e)||P(e)||R(e)||T(e)||A(e),clear:()=>!0,blur:e=>e instanceof FocusEvent,focus:e=>e instanceof FocusEvent},N=/* @__PURE__ */e({name:"FaSelectPage",props:k,emits:E,slots:C(),setup(e,{attrs:h,slots:C,emit:F,expose:P}){const R=L(e,"label",F,{passive:!0}),T=n(),_=l({value:y(),loading:!1,selectorData:y([]),selectedList:y([]),debut:!0,echo:!0,nextRefresh:!1,pageIndex:1,pageSize:15,totalRows:0,searchValue:void 0,defaultSelectorData:y()}),k=a(),E=l=>l?.map(l=>({...l,value:l[e.valueKey],label:B(e.props.label)?e.props.label(l):l[e.props.label??"label"],hide:B(e.props.hide)?e.props.hide(l):l[e.props.hide??"hide"],disabled:B(e.props.disabled)?e.props.disabled(l):l[e.props.disabled??"disabled"],children:B(e.props.children)?E(e.props.children(l)):E(l[e.props.children??"children"])})).filter(e=>!e.hide),N=async l=>{_.loading=!0,_.pageIndex=l??_.pageIndex;const a={...e.initParam??{},pageIndex:_.pageIndex,pageSize:_.pageSize,searchValue:_.searchValue};try{const l=await e.requestApi(a);_.echo=!1,_.totalRows=l.totalRows,_.selectorData=E(l.rows),F("dataChangeCallBack",_.selectorData)}catch(t){S("FaSelectPage",t),_.pageIndex=1,_.totalRows=0,_.selectorData=[]}finally{_.loading=!1}},O=l=>{if(e.multiple){const e=l;if(0===e?.length)return _.value=null,R.value=null,_.selectedList=[],F("update:modelValue",null),void F("change",null,null);const a=_.selectorData.filter(l=>e.includes(l.value));_.value=l,R.value=a.map(e=>e.label),_.selectedList=[..._.selectedList.filter(e=>!a.some(l=>l.value===e.value)),...a].filter(l=>e.includes(l.value)),F("update:modelValue",l),F("change",a,l)}else{if(I(l))return _.value=null,R.value=null,_.selectedList=[],F("update:modelValue",null),void F("change",null,null);const e=_.selectorData.find(e=>e.value===l);_.value=l,R.value=e.label,_.selectedList.some(e=>e.value===l)||(_.selectedList=[e]),F("update:modelValue",l),F("change",e,l)}},q=()=>{_.value=null,R.value=null,_.selectedList=[],F("clear")},K=async e=>{e&&(_.debut?(_.debut=!1,await N()):_.nextRefresh&&(_.nextRefresh=!1,await N())),F("visibleChange",e)};t(()=>e.modelValue,l=>{if(_.echo&&!I(l)){const a=!I(e.label);if(e.multiple){if(!A(l))return void S("FaSelectPage","当启用 multiple 时，传入的 modelValue 必须是Array。");if(a&&!A(e.label))return void S("FaSelectPage","当启用 multiple 时，传入的 modelValue:label 必须是Array。");_.selectedList=l.slice(0,e.multipleLimit>0?e.multipleLimit:l.length).map((l,t)=>({value:l,label:a?e.label[t]:void 0}))}else{if(A(l))return void S("FaSelectPage","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(a&&A(e.label))return void S("FaSelectPage","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");_.defaultSelectorData={value:l,label:e.label}}}_.value=l},{immediate:!0}),o(()=>{t(()=>e.initParam,(e,l)=>{z(e,l)||(_.nextRefresh=!0,I(_.value)||O())})});const M=x(e,j,["modelValue","popperClass","loading"]);return V(()=>s(p,i(M.value,{ref:k,class:"fa-select-page",popperClass:`fa-select-page-dropdown fa-select-page-dropdown-${T.value} ${e.popperClass}`,style:{width:D(e.width)},modelValue:_.value,"onUpdate:modelValue":e=>_.value=e,loading:_.loading,onChange:O,onClear:q,onVisibleChange:K,onRemoveTag:e=>F("removeTag",e),onBlur:e=>F("blur",e),onFocus:e=>F("focus",e)}),{default:()=>_.selectorData.map(l=>s(v,{data:l,moreDetail:e.moreDetail},{default:C.default})),header:()=>s(r,null,[_.defaultSelectorData&&s(m,{class:"fa-select-page-dropdown__default-selector",value:_.defaultSelectorData.value,label:_.defaultSelectorData.label,disabled:!0},{default:()=>[s("span",null,[_.defaultSelectorData.label]),s("span",null,[u("Default")])]}),s(f,{class:"fa-select-page-dropdown__search-input",clearable:!0,placeholder:"请输入关键字搜索",modelValue:_.searchValue,modelModifiers:{trim:!0},"onUpdate:modelValue":e=>_.searchValue=e,onKeyup:e=>{"Enter"===e.key&&N(1)}},{append:()=>s(g,{loading:_.loading,icon:b,onClick:()=>N(1)},null)}),C.header&&C.header()]),footer:()=>s(r,null,[s(c,{class:"fa-select-page-dropdown__pagination",size:"small",currentPage:_.pageIndex,pageSize:_.pageSize,total:_.totalRows,layout:"prev, pager, next, total",pagerCount:5,onCurrentChange:N},null),C.footer&&C.footer()]),...C.prefix&&{prefix:()=>C.prefix()},...C.empty&&{empty:()=>C.empty()},...C.tag&&{tag:()=>C.tag()},...C.loading&&{loading:()=>C.loading()},...e.multiple?{label:({label:e,value:l})=>{const a=_.selectedList.find(e=>e.value===l);return C.label?C.label({label:a?.label,value:I(a)?l:a?.value}):a&&s("span",{class:"el-select__tags-text"},[a.label])}}:C.label&&{label:({label:e,value:l})=>C.label({label:e,value:l})}})),w(P,{focus:d(()=>k.value?.focus),blur:d(()=>k.value?.blur),selectedLabel:d(()=>k.value?.selectedLabel),loading:d(()=>_.loading),selectedList:d(()=>_.selectedList),refresh:N,setSelection:e=>O(e),clearSelection:()=>O(null)})}});export{N as default,E as faSelectPageEmits,k as faSelectPageProps};
//# sourceMappingURL=selectPage.mjs.map
