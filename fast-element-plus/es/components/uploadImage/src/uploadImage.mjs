import{defineComponent as e,computed as l,reactive as t,ref as a,createVNode as i,Fragment as o,withDirectives as u,mergeProps as s,createTextVNode as n,withModifiers as d,resolveDirective as p}from"vue";import{uploadProps as r,ElUpload as m,ElIcon as c,ElImageViewer as f}from"element-plus";import{ZoomIn as v,Edit as h,Delete as g,UploadFilled as S}from"@element-plus/icons-vue";import{useUpload as _}from"../../upload/src/useUpload.mjs";import"../../../constants/index.mjs";import{definePropType as b,stringUtil as w,useProps as y,useRender as L,addUnit as x,useExpose as U,makeSlots as E}from"@fast-china/utils";import{isString as k,isArray as C,isNull as F}from"lodash-unified";import{FaMimeType as O}from"../../../constants/mime.mjs";const R={...r,drag:{type:Boolean,default:!0},accept:{type:String,default:()=>O.Image},listType:{type:b(String),default:"picture"},showFileList:{type:Boolean,default:!1},modelValue:b([String,Array]),maxSize:{type:[String,Number],default:2048},uploadApi:{type:b(Function)},uploadUrl:String,width:{type:[String,Number],default:150},height:{type:[String,Number],default:150}},z={"update:modelValue":e=>k(e)||C(e)||F(e),"update:fileList":e=>C(e),change:e=>k(e)||C(e)||F(e)},q=/* @__PURE__ */e({name:"FaUploadImage",props:R,emits:z,slots:E(),setup(e,{attrs:b,slots:E,emit:k,expose:C}){const{fileList:F,loading:O,formContext:R,maxSizeMB:z,handleValue:q,handleHttpRequest:A,handleOnSuccess:B,handleOnError:M,handleOnExceed:j,handleOnUpload:I}=_("FaUploadImage","图片",e,k,{maxSize:e.maxSize,uploadApi:e.uploadApi,uploadUrl:e.uploadUrl}),K=l(()=>e.disabled||R?.disabled),N=t({uploadKey:`fa-upload-image__${w.generateRandomString(8)}`,preview:!1,previewList:[]}),V=a(),$=()=>{const e=document.querySelector(`.${N.uploadKey} .el-upload__input`);e&&e.dispatchEvent(new MouseEvent("click"))},D=l=>!!I(l)&&(!e.beforeUpload||e.beforeUpload(l)),H=y(e,r,["fileList","disabled","httpRequest","beforeUpload","onExceed","onSuccess","onError"]);return L(()=>i(o,null,[u(i(m,s(H.value,{ref:V,class:["fa-upload-image",N.uploadKey],style:{"--width":x(e.width),"--height":x(e.height)},fileList:F.value,"onUpdate:fileList":e=>F.value=e,disabled:K.value,httpRequest:A,beforeUpload:D,onExceed:j,onSuccess:B,onError:M}),{default:()=>F.value.length>0?i(o,null,[i("img",{class:"el-upload-list__item-thumbnail",src:F.value[0].url},null),i("span",{class:"el-upload-list__item-actions",onClick:d(()=>{},["stop"])},[i("span",{class:"el-upload-list__item-icon",onClick:()=>(N.previewList=[F.value[0].url],void(N.preview=!0)),title:"查看"},[i(c,null,{default:()=>[i(v,null,null)]})]),!K.value&&i(o,null,[i("span",{class:"el-upload-list__item-icon",onClick:$,title:"编辑"},[i(c,null,{default:()=>[i(h,null,null)]})]),i("span",{class:"el-upload-list__item-icon",onClick:()=>(F.value=[],void q()),title:"删除"},[i(c,null,{default:()=>[i(g,null,null)]})])])])]):E.default?E.default():i(o,null,[i(c,{class:"el-icon--upload"},{default:()=>[i(S,null,null)]}),i("div",{class:"el-upload__text"},[n("Drop file here "),i("br",null,null),i("em",null,[n("click to upload")])])]),tip:()=>i("div",{class:"el-upload__tip"},[n("file with a size less than "),z.toString(),n("MB")])}),[[p("loading"),O.value]]),N.preview&&i(f,{closeOnPressEscape:!0,hideOnClickModal:!0,teleported:!0,onClose:()=>N.preview=!1,urlList:N.previewList},null)])),U(C,{abort:l(()=>V.value?.abort),submit:l(()=>V.value?.submit),clearFiles:l(()=>V.value?.clearFiles),handleStart:l(()=>V.value?.handleStart),handleRemove:l(()=>V.value?.handleRemove),loading:O,fileList:F,preview:l(()=>N.preview),previewList:l(()=>N.previewList)})}});export{q as default,z as faUploadImageEmits,R as faUploadImageProps};
//# sourceMappingURL=uploadImage.mjs.map
