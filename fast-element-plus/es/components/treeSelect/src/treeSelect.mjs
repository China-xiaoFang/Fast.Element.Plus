import{defineComponent as e,reactive as l,ref as a,watch as t,onMounted as o,createVNode as d,mergeProps as r,computed as i}from"vue";import{treeEmits as n,selectEmits as u,ElTreeSelect as p}from"element-plus";import{SelectProps as s}from"../../select/src/select.mjs";import{treeProps as c}from"../../tree/src/tree.props.mjs";import{definePropType as f,withDefineType as m,consoleError as h,useProps as b,useEmits as v,useRender as y,addUnit as g,useExpose as x,makeSlots as C}from"@fast-china/utils";import{useVModel as S}from"@vueuse/core";import{isArray as k,isString as D,isNull as N,isNumber as V,isBoolean as A,isObject as B,isFunction as O,isNil as T,isEqual as w}from"lodash-unified";const F={...s,...c,cacheData:{type:f(Array),default:[]},disabled:{type:Boolean,default:void 0},loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},nodeKey:{type:String,default:"value"},defaultExpandAll:{type:Boolean,default:!0},checkOnClickNode:{type:Boolean,default:!0},highlightCurrent:{type:Boolean,default:!0},expandOnClickNode:Boolean,collapseOnClickNode:Boolean,modelValue:{type:f([String,Number,Boolean,Object,Array]),default:void 0},label:f([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,lazy:{type:Boolean,default:!0},defaultSelected:Boolean,props:{type:f(Object),default:()=>({label:"label",hide:"hide",disabled:"disabled",children:"children"})},data:{type:f(Array),default:()=>[]},requestApi:{type:f(Function)},initParam:f([String,Number,Object])},j={...u,...n,"update:modelValue":e=>D(e)||V(e)||A(e)||B(e)||k(e)||N(e),"update:label":e=>D(e)||k(e)||N(e),dataChangeCallBack:e=>k(e),change:(e,l)=>!0},q=/* @__PURE__ */e({name:"FaTreeSelect",props:F,emits:j,slots:C(),setup(e,{attrs:f,slots:C,emit:D,expose:N}){const V=S(e,"label",D,{passive:!0}),A=l({value:m(),loading:!1,selectorData:m([]),debut:!0,echo:!(e.data?.length>0),nextRefresh:!1}),B=a(),F=l=>l?.map(l=>({...l,value:l[e.nodeKey],label:O(e.props.label)?e.props.label(l):l[e.props.label??"label"],hide:O(e.props.hide)?e.props.hide(l):l[e.props.hide??"hide"],disabled:O(e.props.disabled)?e.props.disabled(l):l[e.props.disabled??"disabled"],children:O(e.props.children)?F(e.props.children(l)):F(l[e.props.children??"children"])})).filter(e=>!e.hide),j=async()=>{if(e.requestApi){A.loading=!0;const a=e.initParam??{};try{const l=await e.requestApi(a);A.echo=!1,A.selectorData=F(l),D("dataChangeCallBack",A.selectorData)}catch(l){h("FaTreeSelect",l),A.selectorData=[]}finally{A.loading=!1}}else A.echo=!1,A.selectorData=F(e.data)},q=(l,a,t)=>{if(!l)return!0;let o=t.parent,d=[t.label],r=1;for(;r<t.level;)d=[...d,o.label],o=o.parent,r++;const i=d.some(e=>-1!==e.indexOf(l));return e.filterNodeMethod?i&&e.filterNodeMethod(l,a,t):i},z=(l,a)=>{if(e.multiple){const e=l;if(0===e?.length)return A.value=null,V.value=null,D("update:modelValue",null),void D("change",null,null);const a=A.selectorData.filter(l=>e.includes(l.value));A.value=l,V.value=a.map(e=>e.label),D("update:modelValue",l),D("change",a,l)}else{if(T(l))return A.value=null,V.value=null,D("update:modelValue",null),void D("change",null,null);a??=A.selectorData.find(e=>e.value===l),A.value=l,V.value=a.label,D("update:modelValue",l),D("change",a,l)}},M=()=>{A.value=null,V.value=null,D("update:modelValue",null),D("clear")},R=(l,a,t,o)=>{e.expandOnClickNode&&(a.expanded?a.expanded&&e.collapseOnClickNode&&a.collapse():a.expand()),(e.checkStrictly||a.isLeaf)&&z(l.value,l),D("node-click",l,a,t,o)},L=async l=>{l&&(A.debut?(A.debut=!1,e.lazy&&await j()):A.nextRefresh&&(A.nextRefresh=!1,await j())),D("visible-change",l)};t(()=>e.modelValue,l=>{if(A.echo&&!T(l)){const a=!T(e.label);if(e.multiple){if(!k(l))return void h("FaTreeSelect","当启用 multiple 时，传入的 modelValue 必须是Array。");if(a&&!k(e.label))return void h("FaTreeSelect","当启用 multiple 时，传入的 modelValue:label 必须是Array。");A.selectorData=l.slice(0,e.multipleLimit>0?e.multipleLimit:l.length).map((l,t)=>({value:l,label:a?e.label[t]:void 0}))}else{if(k(l))return void h("FaTreeSelect","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(a&&k(e.label))return void h("FaTreeSelect","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");A.selectorData=[{value:l,label:e.label}]}}A.value=l},{immediate:!0}),o(async()=>{e.defaultSelected?(await j(),A.selectorData.length>0&&(e.multiple?z([A.selectorData[0].value]):z(A.selectorData[0].value,A.selectorData[0]))):!e.requestApi&&e.data?.length>0?(A.debut=!1,await j()):e.lazy||await j(),t(()=>e.initParam,(e,l)=>{w(e,l)||(A.nextRefresh=!0,T(A.value)||z())}),t(()=>e.data,async()=>{e.requestApi||await j()},{deep:!0})});const P=b(e,{...s,...c},["modelValue","popperClass","lazy","loading","expandOnClickNode","filterNodeMethod"]),K=v({...u,...n},D,["update:modelValue","clear","visible-change","node-click"]);return y(()=>d(p,r(P.value,K.value,{ref:B,class:"fa-tree-select",popperClass:`fa-tree-select-dropdown ${e.popperClass}`,style:{width:g(e.width)},modelValue:A.value,"onUpdate:modelValue":e=>A.value=e,lazy:!1,loading:A.loading,data:A.selectorData,expandOnClickNode:!e.checkOnClickNode&&e.expandOnClickNode,filterNodeMethod:q,onNodeClick:R,onClear:M,onVisibleChange:L}),{...C.default&&{default:({node:e,data:l})=>C.default({node:e,data:l})},...C.header&&{header:()=>C.header()},...C.footer&&{footer:()=>C.footer()},...C.prefix&&{prefix:()=>C.prefix()},...C.empty&&{empty:()=>C.empty()},...C.tag&&{tag:()=>C.tag()},...C.loading&&{loading:()=>C.loading()},...C.label&&{label:({label:e,value:l})=>C.label({label:e,value:l})}})),x(N,{loading:i(()=>A.loading),refresh:j,setSelection:e=>z(e),clearSelection:()=>z(null)})}});export{q as default,j as faTreeSelectEmits,F as faTreeSelectProps};
//# sourceMappingURL=treeSelect.mjs.map
