import{defineComponent as e,reactive as a,ref as l,watch as t,onMounted as o,createVNode as n,mergeProps as r,computed as d}from"vue";import{ElTreeSelect as u}from"element-plus";import{SelectProps as i}from"../../select/src/select.mjs";import{treeProps as s}from"../../tree/src/tree.props.mjs";import{definePropType as c,withDefineType as p,consoleError as f,useProps as h,useRender as g,addUnit as v,useExpose as m,makeSlots as C}from"@fast-china/utils";import{useVModel as b}from"@vueuse/core";import{isObject as y,isString as D,isBoolean as N,isNumber as k,isArray as x,isNull as S,isFunction as E,isNil as A,isEqual as B}from"lodash-unified";const O={...i,...s,loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},nodeKey:{type:String,default:"value"},defaultExpandAll:{type:Boolean,default:!0},checkOnClickNode:{type:Boolean,default:!0},highlightCurrent:{type:Boolean,default:!0},expandOnClickNode:Boolean,collapseOnClickNode:Boolean,cacheData:{type:Array,default:()=>[]},modelValue:{type:c([String,Number,Boolean,Object,Array]),default:void 0},label:c([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,lazy:{type:Boolean,default:!0},defaultSelected:Boolean,props:{type:c(Object),default:()=>({label:"label",hide:"hide",disabled:"disabled",children:"children"})},data:{type:c(Array),default:()=>[]},requestApi:{type:c(Function)},initParam:c([String,Number,Object])},T={"update:modelValue":e=>D(e)||k(e)||N(e)||y(e)||x(e)||S(e),"update:label":e=>D(e)||x(e)||S(e),dataChangeCallBack:e=>x(e),change:(e,a)=>(y(e)||x(e)||S(e))&&(D(a)||k(a)||N(a)||y(a)||x(a)||S(a)),visibleChange:e=>N(e),removeTag:e=>D(e)||k(e)||N(e)||y(e)||x(e),clear:()=>!0,blur:e=>e instanceof FocusEvent,focus:e=>e instanceof FocusEvent,nodeClick:(e,a,l)=>y(e)&&y(a)&&y(l),nodeContextmenu:(e,a,l,t)=>e instanceof Event&&y(a)&&y(l)&&y(t),checkChange:(e,a,l)=>y(e)&&N(a)&&N(l),check:(e,a)=>y(e)&&y(a),currentChange:(e,a)=>y(e)&&y(a),nodeExpand:(e,a,l)=>y(e)&&y(a)&&y(l),nodeCollapse:(e,a,l)=>y(e)&&y(a)&&y(l),nodeDragStart:(e,a)=>y(e)&&a instanceof DragEvent,nodeDragEnter:(e,a,l)=>y(e)&&y(a)&&l instanceof DragEvent,nodeDragLeave:(e,a,l)=>y(e)&&y(a)&&l instanceof DragEvent,nodeDragOver:(e,a,l)=>y(e)&&y(a)&&l instanceof DragEvent,nodeDragEnd:(e,a,l,t)=>y(e)&&y(a)&&D(l)&&t instanceof DragEvent,nodeDrop:(e,a,l,t)=>y(e)&&y(a)&&D(l)&&t instanceof DragEvent},V=/* @__PURE__ */e({name:"FaTreeSelect",props:O,emits:T,slots:C(),setup(e,{attrs:c,slots:C,emit:y,expose:D}){const N=b(e,"label",y,{passive:!0}),k=a({value:p(),loading:!1,selectorData:p([]),debut:!0,echo:!(e.data?.length>0),nextRefresh:!1}),S=l(),O=a=>a?.map(a=>({...a,value:a[e.nodeKey],label:E(e.props.label)?e.props.label(a):a[e.props.label??"label"],hide:E(e.props.hide)?e.props.hide(a):a[e.props.hide??"hide"],disabled:E(e.props.disabled)?e.props.disabled(a):a[e.props.disabled??"disabled"],children:E(e.props.children)?O(e.props.children(a)):O(a[e.props.children??"children"])})).filter(e=>!e.hide),T=async()=>{if(e.requestApi){k.loading=!0;const l=e.initParam??{};try{const a=await e.requestApi(l);k.echo=!1,k.selectorData=O(a),y("dataChangeCallBack",k.selectorData)}catch(a){f("FaTreeSelect",a),k.selectorData=[]}finally{k.loading=!1}}else k.echo=!1,k.selectorData=O(e.data)},V=(a,l,t)=>{if(!a)return!0;let o=t.parent,n=[t.label],r=1;for(;r<t.level;)n=[...n,o.label],o=o.parent,r++;const d=n.some(e=>-1!==e.indexOf(a));return e.filterNodeMethod?d&&e.filterNodeMethod(a,l,t):d},K=(a,l)=>{if(e.multiple){const e=a;if(0===e?.length)return k.value=null,N.value=null,y("update:modelValue",null),void y("change",null,null);const l=k.selectorData.filter(a=>e.includes(a.value));k.value=a,N.value=l.map(e=>e.label),y("update:modelValue",a),y("change",l,a)}else{if(A(a))return k.value=null,N.value=null,y("update:modelValue",null),void y("change",null,null);l??=k.selectorData.find(e=>e.value===a),k.value=a,N.value=l.label,y("update:modelValue",a),y("change",l,a)}},w=()=>{k.value=null,N.value=null,y("clear")},F=(a,l,t,o)=>{e.expandOnClickNode&&(l.expanded?l.expanded&&e.collapseOnClickNode&&l.collapse():l.expand()),(e.checkStrictly||l.isLeaf)&&K(a.value,a),y("nodeClick",a,l,t)},L=async a=>{a&&(k.debut?(k.debut=!1,e.lazy&&await T()):k.nextRefresh&&(k.nextRefresh=!1,await T())),y("visibleChange",a)};t(()=>e.modelValue,a=>{if(k.echo&&!A(a)){const l=!A(e.label);if(e.multiple){if(!x(a))return void f("FaTreeSelect","当启用 multiple 时，传入的 modelValue 必须是Array。");if(l&&!x(e.label))return void f("FaTreeSelect","当启用 multiple 时，传入的 modelValue:label 必须是Array。");k.selectorData=a.slice(0,e.multipleLimit>0?e.multipleLimit:a.length).map((a,t)=>({value:a,label:l?e.label[t]:void 0}))}else{if(x(a))return void f("FaTreeSelect","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(l&&x(e.label))return void f("FaTreeSelect","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");k.selectorData=[{value:a,label:e.label}]}}k.value=a},{immediate:!0}),o(async()=>{e.defaultSelected?(await T(),k.selectorData.length>0&&(e.multiple?K([k.selectorData[0].value]):K(k.selectorData[0].value,k.selectorData[0]))):!e.requestApi&&e.data?.length>0?(k.debut=!1,await T()):e.lazy||await T(),t(()=>e.initParam,(e,a)=>{B(e,a)||(k.nextRefresh=!0,A(k.value)||K())}),t(()=>e.data,async()=>{e.requestApi||await T()},{deep:!0})});const j=h(e,{...i,...s},["modelValue","popperClass","loading","expandOnClickNode","filterNodeMethod"]);return g(()=>n(u,r(j.value,{ref:S,class:"fa-tree-select",popperClass:`fa-tree-select-dropdown ${e.popperClass}`,style:{width:v(e.width)},modelValue:k.value,"onUpdate:modelValue":e=>k.value=e,loading:k.loading,data:k.selectorData,expandOnClickNode:!e.checkOnClickNode&&e.expandOnClickNode,filterNodeMethod:V,onNodeClick:F,onClear:w,onVisibleChange:L,onRemoveTag:e=>y("removeTag",e),onBlur:e=>y("blur",e),onFocus:e=>y("focus",e),onNodeContextmenu:(e,a,l,t)=>y("nodeContextmenu",e,a,l,t),onCheckChange:(e,a,l)=>y("checkChange",e,a,l),onCheck:(e,a)=>y("check",e,a),onCurrentChange:(e,a)=>y("currentChange",e,a),onNodeExpand:(e,a,l)=>y("nodeExpand",e,a,l),onNodeCollapse:(e,a,l)=>y("nodeCollapse",e,a,l),onNodeDragStart:(e,a)=>y("nodeDragStart",e,a),onNodeDragEnter:(e,a,l)=>y("nodeDragEnter",e,a,l),onNodeDragLeave:(e,a,l)=>y("nodeDragLeave",e,a,l),onNodeDragOver:(e,a,l)=>y("nodeDragOver",e,a,l),onNodeDragEnd:(e,a,l,t)=>y("nodeDragEnd",e,a,l,t),onNodeDrop:(e,a,l,t)=>y("nodeDrop",e,a,l,t)}),{...C.default&&{default:({node:e,data:a})=>C.default({node:e,data:a})},...C.header&&{header:()=>C.header()},...C.footer&&{footer:()=>C.footer()},...C.prefix&&{prefix:()=>C.prefix()},...C.empty&&{empty:()=>C.empty()},...C.tag&&{tag:()=>C.tag()},...C.loading&&{loading:()=>C.loading()},...C.label&&{label:({label:e,value:a})=>C.label({label:e,value:a})}})),m(D,{focus:d(()=>S.value?.focus),blur:d(()=>S.value?.blur),selectedLabel:d(()=>S.value?.selectedLabel),filter:d(()=>S.value?.filter),updateKeyChildren:d(()=>S.value?.updateKeyChildren),getCheckedNodes:d(()=>S.value?.getCheckedNodes),setCheckedNodes:d(()=>S.value?.setCheckedNodes),getCheckedKeys:d(()=>S.value?.getCheckedKeys),setCheckedKeys:d(()=>S.value?.setCheckedKeys),setChecked:d(()=>S.value?.setChecked),getHalfCheckedNodes:d(()=>S.value?.getHalfCheckedNodes),getHalfCheckedKeys:d(()=>S.value?.getHalfCheckedKeys),getCurrentKey:d(()=>S.value?.getCurrentKey),getCurrentNode:d(()=>S.value?.getCurrentNode),setCurrentKey:d(()=>S.value?.setCurrentKey),setCurrentNode:d(()=>S.value?.setCurrentNode),getNode:d(()=>S.value?.getNode),remove:d(()=>S.value?.remove),append:d(()=>S.value?.append),insertBefore:d(()=>S.value?.insertBefore),insertAfter:d(()=>S.value?.insertAfter),loading:d(()=>k.loading),refresh:T,setSelection:e=>K(e),clearSelection:()=>K(null)})}});export{V as default,T as faTreeSelectEmits,O as faTreeSelectProps};
//# sourceMappingURL=treeSelect.mjs.map
