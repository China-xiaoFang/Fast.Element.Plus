import{defineComponent as e,reactive as l,computed as a,ref as t,nextTick as r,onMounted as d,watch as n,withDirectives as u,createVNode as o,mergeProps as i,createTextVNode as s,resolveDirective as c}from"vue";import{treeEmits as p,useGlobalSize as h,ElIcon as f,ElInput as g,ElScrollbar as m,ElTree as v}from"element-plus";import{Expand as y,Fold as C}from"@element-plus/icons-vue";import{definePropType as b,addUnit as k,withDefineType as N,consoleError as K,useProps as B,useEmits as x,useRender as O,useExpose as V,makeSlots as D}from"@fast-china/utils";import{useVModel as S}from"@vueuse/core";import{isArray as A,isString as _,isNull as w,isNumber as T,isBoolean as q,isObject as F}from"lodash-unified";import{treeProps as M}from"./tree.props.mjs";const j={...M,disabled:{type:Boolean,default:void 0},nodeKey:{type:String,default:"value"},defaultExpandAll:{type:Boolean,default:!0},checkOnClickNode:{type:Boolean,default:!0},highlightCurrent:{type:Boolean,default:!0},collapseOnClickNode:Boolean,modelValue:{type:b([String,Number,Boolean,Object]),default:void 0},label:String,width:{type:[String,Number],default:180},defaultSelection:[String,Number],title:String,hamburger:Boolean,hideAll:Boolean,hideFilter:Boolean,allValue:{type:b([String,Number,Boolean,Object]),default:void 0},data:{type:b(Array),default:()=>[]},requestApi:{type:b(Function)},initParam:b([String,Number,Object])},H={...p,"update:modelValue":e=>_(e)||T(e)||q(e)||F(e)||w(e),"update:label":e=>_(e)||w(e),dataChangeCallBack:e=>A(e),change:(e,l,a,t)=>!0},P=/* @__PURE__ */e({name:"FaTree",props:j,emits:H,slots:D(),setup(e,{attrs:b,slots:D,emit:A,expose:_}){const w=S(e,"label",A,{passive:!0}),T=h(),q=l({value:N(),loading:!1,searchValue:N(),orgTreeData:N([]),treeData:N([]),hamburger:e.hamburger||!1,width:a(()=>{if(q.hamburger)return"130px";{const l=k(e.width);return"small"===T.value?`calc(${l} * 0.9)`:l}})}),F=a(()=>0===[...q.orgTreeData].filter(l=>l[e.props.children]?.length>0).length),j=t(),H=async()=>{let l;e.nodeKey&&(l=j.value.getCurrentKey());let a=[];if(e.requestApi){q.loading=!0;const l={...e.initParam??{},searchValue:q.searchValue};try{a=await e.requestApi(l)}catch(t){K("FaTree",t)}finally{q.loading=!1}}else a=e.data;e.hideAll||a.unshift({[e.nodeKey]:e.allValue,label:"全部",value:null,all:!0}),q.orgTreeData=a,q.treeData=a,A("dataChangeCallBack",q.treeData),e.nodeKey&&l?r(()=>{j.value.setCurrentKey(l)}):e.defaultSelection&&r(()=>{j.value.setCurrentKey(e.defaultSelection)})},P=()=>{q.hamburger?q.treeData=q.orgTreeData:q.treeData=q.orgTreeData.map(l=>({...l,[e.props.children]:[]})),q.hamburger=!q.hamburger},$=(l,a,t)=>{if(!l)return!0;let r=t.parent,d=a.all?[a.label]:[t.label],n=1;for(;n<t.level;)d=[...d,r.label],r=r.parent,n++;const u=d.some(e=>-1!==e.indexOf(l));return e.filterNodeMethod?u&&e.filterNodeMethod(l,a,t):u},E=(l,a,t,r)=>{e.expandOnClickNode&&(a.expanded?a.expanded&&e.collapseOnClickNode&&a.collapse():a.expand()),q.value=a.key,w.value=a.label,A("update:modelValue",q.value),A("change",l,a,t,r),A("node-click",l,a,t,r)};d(async()=>{await H(),n(()=>e.data,async()=>{e.requestApi||await H()},{deep:!0})});const I=B(e,M,["data","expandOnClickNode","filterNodeMethod"]),L=x(p,A,["node-click"]);return O(()=>u(o("div",{class:["el-card fa-tree",`fa-tree-${T.value}`,{"fa-tree__fold":q.hamburger||F.value}],style:{width:q.width}},[(e.title||e.hamburger)&&o("div",{class:"fa-tree__title"},[e.title&&o("h4",null,[e.title]),e.hamburger&&(q.hamburger?o(f,{onClick:P,title:"展开"},{default:()=>[o(y,null,null)]}):o(f,{onClick:P,title:"折叠"},{default:()=>[o(C,null,null)]}))]),!e.hideFilter&&o(g,{class:"fa-tree__search-input",modelValue:q.searchValue,modelModifiers:{trim:!0},"onUpdate:modelValue":e=>q.searchValue=e,placeholder:q.hamburger?"关键字过滤":"输入关键字进行过滤",clearable:!0,onInput:e=>j.value.filter(e)},null),o(m,{class:"fa-tree__scrollbar"},{default:()=>[o(v,i(I.value,L.value,{ref:j,data:q.treeData,expandOnClickNode:!e.checkOnClickNode&&e.expandOnClickNode,filterNodeMethod:$,onNodeClick:E}),{default:({node:e,data:l})=>o("span",{class:"el-tree-node__label",title:l?.all?l.label:e.label,style:{paddingLeft:F.value?"3px":""}},[o("div",null,[l?.all?l.label:D.label?D.label({node:e,data:l}):e.label]),e.key&&l.showQuantity?o("span",null,[s("["),l.quantity,s("]")]):null,!l?.all&&D.default&&o("span",null,[D.default({node:e,data:l})])]),...D.empty&&{empty:()=>D.empty()}})]})]),[[c("loading"),q.loading]])),V(_,{filter:a(()=>j.value?.filter),updateKeyChildren:a(()=>j.value?.updateKeyChildren),getCheckedNodes:a(()=>j.value?.getCheckedNodes),setCheckedNodes:a(()=>j.value?.setCheckedNodes),getCheckedKeys:a(()=>j.value?.getCheckedKeys),setCheckedKeys:a(()=>j.value?.setCheckedKeys),setChecked:a(()=>j.value?.setChecked),getHalfCheckedNodes:a(()=>j.value?.getHalfCheckedNodes),getHalfCheckedKeys:a(()=>j.value?.getHalfCheckedKeys),getCurrentKey:a(()=>j.value?.getCurrentKey),getCurrentNode:a(()=>j.value?.getCurrentNode),setCurrentKey:a(()=>j.value?.setCurrentKey),setCurrentNode:a(()=>j.value?.setCurrentNode),getNode:a(()=>j.value?.getNode),remove:a(()=>j.value?.remove),append:a(()=>j.value?.append),insertBefore:a(()=>j.value?.insertBefore),insertAfter:a(()=>j.value?.insertAfter),loading:a(()=>q.loading),refresh:H})}});export{P as default,H as faTreeEmits,j as faTreeProps};
//# sourceMappingURL=tree.mjs.map
