import{defineComponent as e,reactive as a,computed as t,ref as l,nextTick as r,onMounted as n,watch as o,withDirectives as d,createVNode as u,mergeProps as i,createTextVNode as s,resolveDirective as c}from"vue";import{useGlobalSize as g,ElIcon as h,ElInput as p,ElScrollbar as f,ElTree as m}from"element-plus";import{Expand as C,Fold as v}from"@element-plus/icons-vue";import{definePropType as y,addUnit as b,withDefineType as k,consoleError as N,useProps as D,useRender as x,useExpose as E,makeSlots as K}from"@fast-china/utils";import{useVModel as O}from"@vueuse/core";import{isObject as S,isString as B,isBoolean as V,isArray as A,isNull as T,isNumber as _}from"lodash-unified";import{treeProps as w}from"./tree.props.mjs";const M={...w,nodeKey:{type:String,default:"value"},defaultExpandAll:{type:Boolean,default:!0},checkOnClickNode:{type:Boolean,default:!0},highlightCurrent:{type:Boolean,default:!0},collapseOnClickNode:Boolean,modelValue:{type:y([String,Number,Boolean,Object]),default:void 0},label:String,width:{type:[String,Number],default:180},defaultSelection:[String,Number],title:String,hamburger:Boolean,hideAll:Boolean,hideFilter:Boolean,allValue:{type:y([String,Number,Boolean,Object]),default:void 0},data:{type:y(Array),default:()=>[]},requestApi:{type:y(Function)},initParam:y([String,Number,Object])},q={"update:modelValue":e=>B(e)||_(e)||V(e)||S(e)||T(e),"update:label":e=>B(e)||T(e),dataChangeCallBack:(e,a)=>A(e)&&A(a),change:(e,a,t,l)=>S(e)&&S(a)&&S(t)&&l instanceof MouseEvent,nodeClick:(e,a,t,l)=>S(e)&&S(a)&&S(t)&&l instanceof MouseEvent,nodeContextmenu:(e,a,t,l)=>e instanceof Event&&S(a)&&S(t)&&S(l),checkChange:(e,a,t)=>S(e)&&V(a)&&V(t),check:(e,a)=>S(e)&&S(a),currentChange:(e,a)=>S(e)&&S(a),nodeExpand:(e,a,t)=>S(e)&&S(a)&&S(t),nodeCollapse:(e,a,t)=>S(e)&&S(a)&&S(t),nodeDragStart:(e,a)=>S(e)&&a instanceof DragEvent,nodeDragEnter:(e,a,t)=>S(e)&&S(a)&&t instanceof DragEvent,nodeDragLeave:(e,a,t)=>S(e)&&S(a)&&t instanceof DragEvent,nodeDragOver:(e,a,t)=>S(e)&&S(a)&&t instanceof DragEvent,nodeDragEnd:(e,a,t,l)=>S(e)&&S(a)&&B(t)&&l instanceof DragEvent,nodeDrop:(e,a,t,l)=>S(e)&&S(a)&&B(t)&&l instanceof DragEvent},F=/* @__PURE__ */e({name:"FaTree",props:M,emits:q,slots:K(),setup(e,{attrs:y,slots:K,emit:S,expose:B}){const V=O(e,"label",S,{passive:!0}),A=g(),T=a({value:k(),loading:!1,searchValue:k(),orgTreeData:k([]),treeData:k([]),hamburger:!1,width:t(()=>{if(e.hamburger||T.hamburger)return"130px";{const a=b(e.width);return"small"===A.value?`calc(${a} * 0.9)`:a}})}),_=t(()=>0===[...T.orgTreeData].filter(a=>a[e.props.children]?.length>0).length),M=l(),q=a=>{e.hideAll||a.unshift({[e.nodeKey]:e.allValue,label:"全部",all:!0}),T.treeData=a},F=async()=>{let a;if(e.nodeKey&&(a=M.value.getCurrentKey()),e.requestApi){T.loading=!0;const a={...e.initParam??{},searchValue:T.searchValue};try{const t=await e.requestApi(a);T.orgTreeData=t,q(t)}catch(t){N("FaTree",t),T.orgTreeData=[],q([]),S("dataChangeCallBack",T.treeData,T.orgTreeData)}finally{T.loading=!1}}else T.orgTreeData=e.data,q(e.data);e.nodeKey&&a?r(()=>{M.value.setCurrentKey(a)}):e.defaultSelection&&r(()=>{M.value.setCurrentKey(e.defaultSelection)})},j=()=>{e.hamburger||T.hamburger?q(T.orgTreeData):T.treeData=T.orgTreeData.map(a=>({...a,[e.props.children]:[]})),T.hamburger=!T.hamburger},H=(a,t,l)=>{if(!a)return!0;let r=l.parent,n=t.all?[t.label]:[l.label],o=1;for(;o<l.level;)n=[...n,r.label],r=r.parent,o++;const d=n.some(e=>-1!==e.indexOf(a));return e.filterNodeMethod?d&&e.filterNodeMethod(a,t,l):d},L=(a,t,l,r)=>{e.expandOnClickNode&&(t.expanded?t.expanded&&e.collapseOnClickNode&&t.collapse():t.expand()),T.value=t.key,V.value=t.label,S("update:modelValue",T.value),S("change",a,t,l,r),S("nodeClick",a,t,l,r)};n(async()=>{await F(),o(()=>e.data,async()=>{e.requestApi||await F()},{deep:!0})});const P=D(e,w,["data","expandOnClickNode","filterNodeMethod"]);return x(()=>d(u("div",{class:["el-card fa-tree",`fa-tree-${A.value}`,{"fa-tree__fold":e.hamburger&&T.hamburger||_.value}],style:{width:T.width}},[(e.title||e.hamburger)&&u("div",{class:"fa-tree__title"},[e.title&&u("h4",null,[e.title]),e.hamburger&&(T.hamburger?u(h,{onClick:j,title:"展开"},{default:()=>[u(C,null,null)]}):u(h,{onClick:j,title:"折叠"},{default:()=>[u(v,null,null)]}))]),!e.hideFilter&&u(p,{class:"fa-tree__search-input",modelValue:T.searchValue,modelModifiers:{trim:!0},"onUpdate:modelValue":e=>T.searchValue=e,placeholder:e.hamburger||T.hamburger?"关键字过滤":"输入关键字进行过滤",clearable:!0,onInput:e=>M.value.filter(e)},null),u(f,{class:"fa-tree__scrollbar"},{default:()=>[u(m,i(P.value,{ref:M,data:T.treeData,expandOnClickNode:!e.checkOnClickNode&&e.expandOnClickNode,filterNodeMethod:H,onNodeClick:L,onNodeContextmenu:(e,a,t,l)=>S("nodeContextmenu",e,a,t,l),onCheckChange:(e,a,t)=>S("checkChange",e,a,t),onCheck:(e,a)=>S("check",e,a),onCurrentChange:(e,a)=>S("currentChange",e,a),onNodeExpand:(e,a,t)=>S("nodeExpand",e,a,t),onNodeCollapse:(e,a,t)=>S("nodeCollapse",e,a,t),onNodeDragStart:(e,a)=>S("nodeDragStart",e,a),onNodeDragEnter:(e,a,t)=>S("nodeDragEnter",e,a,t),onNodeDragLeave:(e,a,t)=>S("nodeDragLeave",e,a,t),onNodeDragOver:(e,a,t)=>S("nodeDragOver",e,a,t),onNodeDragEnd:(e,a,t,l)=>S("nodeDragEnd",e,a,t,l),onNodeDrop:(e,a,t,l)=>S("nodeDrop",e,a,t,l)}),{default:({node:e,data:a})=>u("span",{class:"el-tree-node__label",title:a?.all?a.label:e.label,style:{paddingLeft:_.value?"3px":""}},[u("span",null,[K.label?K.label({node:e,data:a}):a?.all?a.label:e.label]),e.key&&a.showQuantity?u("span",null,[s("["),a.quantity,s("]")]):null,K.default&&u("span",null,[K.default({node:e,data:a})])]),...K.empty&&{empty:()=>K.empty()}})]})]),[[c("loading"),T.loading]])),E(B,{filter:t(()=>M.value?.filter),updateKeyChildren:t(()=>M.value?.updateKeyChildren),getCheckedNodes:t(()=>M.value?.getCheckedNodes),setCheckedNodes:t(()=>M.value?.setCheckedNodes),getCheckedKeys:t(()=>M.value?.getCheckedKeys),setCheckedKeys:t(()=>M.value?.setCheckedKeys),setChecked:t(()=>M.value?.setChecked),getHalfCheckedNodes:t(()=>M.value?.getHalfCheckedNodes),getHalfCheckedKeys:t(()=>M.value?.getHalfCheckedKeys),getCurrentKey:t(()=>M.value?.getCurrentKey),getCurrentNode:t(()=>M.value?.getCurrentNode),setCurrentKey:t(()=>M.value?.setCurrentKey),setCurrentNode:t(()=>M.value?.setCurrentNode),getNode:t(()=>M.value?.getNode),remove:t(()=>M.value?.remove),append:t(()=>M.value?.append),insertBefore:t(()=>M.value?.insertBefore),insertAfter:t(()=>M.value?.insertAfter),loading:t(()=>T.loading),refresh:F})}});export{F as default,q as faTreeEmits,M as faTreeProps};
//# sourceMappingURL=tree.mjs.map
