import{defineComponent as e,reactive as l,ref as a,watch as t,onMounted as o,computed as i,createVNode as u,mergeProps as n}from"vue";import{useAriaProps as r,useEmptyValuesProps as d,tagProps as p,useSizeProp as s,useTooltipContentProps as c,useGlobalSize as f,ElSelectV2 as m}from"element-plus";import{CircleClose as g}from"@element-plus/icons-vue";import{definePropType as b,withDefineType as y,consoleError as v,useProps as h,useEmits as S,useRender as B,addUnit as V,useExpose as w,makeSlots as x}from"@fast-china/utils";import{useVModel as D}from"@vueuse/core";import{isArray as A,isString as T,isNull as C,isNumber as F,isBoolean as N,isObject as O,isNil as j,isEqual as L}from"lodash-unified";const R={allowCreate:Boolean,autocomplete:{type:b(String),default:"none"},automaticDropdown:Boolean,clearable:Boolean,clearIcon:{type:b([String,Object,Function]),default:g},effect:{type:b(String),default:"light"},collapseTags:Boolean,collapseTagsTooltip:Boolean,maxCollapseTags:{type:Number,default:1},defaultFirstOption:Boolean,disabled:Boolean,estimatedOptionHeight:{type:Number,default:void 0},filterable:Boolean,filterMethod:Function,height:{type:Number,default:274},itemHeight:{type:Number,default:34},id:String,loading:Boolean,loadingText:String,modelValue:{type:b([Array,String,Number,Boolean,Object])},multiple:Boolean,multipleLimit:{type:Number,default:0},name:String,noDataText:String,noMatchText:String,remoteMethod:Function,reserveKeyword:{type:Boolean,default:!0},options:{type:b(Array)},placeholder:{type:String},teleported:c.teleported,persistent:{type:Boolean,default:!0},popperClass:{type:String,default:""},popperOptions:{type:b(Object),default:()=>({})},remote:Boolean,size:s,props:{type:b(Object),default:()=>({label:"label",value:"value",disabled:"disabled",options:"options"})},valueKey:{type:String,default:"value"},scrollbarAlwaysOn:Boolean,validateEvent:{type:Boolean,default:!0},offset:{type:Number,default:12},showArrow:{type:Boolean,default:!0},placement:{type:b(String),default:"bottom-start"},fallbackPlacements:{type:b(Array),default:["bottom-start","top-start","right","left"]},tagType:{...p.type,default:"info"},tagEffect:{...p.effect,default:"light"},tabindex:{type:[String,Number],default:0},appendTo:String,...d,...r(["ariaLabel"])},q={"update:modelValue":e=>!0,change:e=>!0,"remove-tag":e=>!0,"visible-change":e=>!0,focus:e=>!0,blur:e=>!0,clear:()=>!0},H={...R,disabled:{type:Boolean,default:void 0},loadingText:{type:String,default:"加载中..."},noMatchText:{type:String,default:"暂无匹配的数据"},noDataText:{type:String,default:"暂无数据"},collapseTags:{type:Boolean,default:!0},collapseTagsTooltip:{type:Boolean,default:!0},modelValue:{type:b([String,Number,Boolean,Object,Array]),default:void 0},label:b([String,Array]),width:{type:[String,Number],default:"100%"},moreDetail:Boolean,lazy:{type:Boolean,default:!0},defaultSelected:Boolean,data:{type:b(Array),default:()=>[]},pageResult:Boolean,requestApi:{type:b(Function)},initParam:b([String,Number,Object])},z={...q,"update:modelValue":e=>T(e)||F(e)||N(e)||O(e)||A(e)||C(e),"update:label":e=>T(e)||A(e)||C(e),dataChangeCallBack:e=>A(e),change:(e,l)=>!0},M=/* @__PURE__ */e({name:"FaSelectV2",props:H,emits:z,slots:x(),setup(e,{attrs:r,slots:d,emit:p,expose:s}){const c=D(e,"label",p,{passive:!0}),g=f(),b=l({value:y(),loading:!1,selectorData:y([]),debut:!0,echo:!(e.data?.length>0),nextRefresh:!1}),x=a(),T=async()=>{if(e.requestApi){b.loading=!0;const a=e.initParam??{};try{const l=await e.requestApi(a);b.echo=!1,e.pageResult?b.selectorData=l.rows:b.selectorData=l,p("dataChangeCallBack",b.selectorData)}catch(l){v("FaSelect",l),b.selectorData=[]}finally{b.loading=!1}}else b.echo=!1,b.selectorData=e.data},C=l=>{if(e.multiple){const e=l;if(0===e?.length)return b.value=null,c.value=null,p("update:modelValue",null),void p("change",null,null);const a=b.selectorData.filter(l=>e.includes(l.value));b.value=l,c.value=a.map(e=>e.label),p("update:modelValue",l),p("change",a,l)}else{if(j(l))return b.value=null,c.value=null,p("update:modelValue",null),void p("change",null,null);const e=b.selectorData.find(e=>e.value===l);b.value=l,c.value=e.label,p("update:modelValue",l),p("change",e,l)}},F=()=>{b.value=null,c.value=null,p("update:modelValue",null),p("clear")},N=async l=>{l&&(b.debut?(b.debut=!1,!e.defaultSelected&&e.lazy&&await T()):b.nextRefresh&&(b.nextRefresh=!1,await T())),p("visible-change",l)};t(()=>e.modelValue,l=>{if(b.echo&&!j(l)){const a=!j(e.label);if(e.multiple){if(!A(l))return void v("FaSelectV2","当启用 multiple 时，传入的 modelValue 必须是Array。");if(a&&!A(e.label))return void v("FaSelectV2","当启用 multiple 时，传入的 modelValue:label 必须是Array。");b.selectorData=l.slice(0,e.multipleLimit>0?e.multipleLimit:l.length).map((l,t)=>({value:l,label:a?e.label[t]:void 0}))}else{if(A(l))return void v("FaSelectV2","当禁用 multiple 时，传入的 modelValue 不能是Array。");if(a&&A(e.label))return void v("FaSelectV2","当禁用 multiple 时，传入的 modelValue:label 不能是Array。");b.selectorData=[{value:l,label:e.label}]}}b.value=l},{immediate:!0}),o(async()=>{e.defaultSelected?(await T(),b.selectorData.length>0&&C(e.multiple?[b.selectorData[0].value]:b.selectorData[0].value)):!e.requestApi&&e.data?.length>0?(b.debut=!1,await T()):e.lazy||await T(),t(()=>e.initParam,(e,l)=>{L(e,l)||(b.nextRefresh=!0,j(b.value)||C())}),t(()=>e.data,async()=>{e.requestApi||await T()},{deep:!0})});const O=h(e,R,["modelValue","popperClass","loading","options","itemHeight"]),q=S(z,p,["update:modelValue","change","clear","visible-change"]),H=i(()=>{let l=`fa-select-v2-dropdown ${e.popperClass}`;return e.moreDetail&&(l+=` fa-select-dropdown__more-detail fa-select-dropdown__more-detail-${g.value}`),l});return B(()=>u(m,n(O.value,q.value,{ref:x,class:"fa-select-v2",popperClass:H.value,style:{width:V(e.width)},modelValue:b.value,"onUpdate:modelValue":e=>b.value=e,loading:b.loading,options:b.selectorData,itemHeight:e.itemHeight+("small"===g.value?0:8),onChange:C,onClear:F,onVisibleChange:N}),{...d.default&&{default:({item:e,index:l,disabled:a})=>d.default({item:e,index:l,disabled:a})},...d.header&&{header:()=>d.header()},...d.footer&&{footer:()=>d.footer()},...d.prefix&&{prefix:()=>d.prefix()},...d.empty&&{empty:()=>d.empty()},...d.tag&&{tag:()=>d.tag()},...d.loading&&{loading:()=>d.loading()},...d.label&&{label:({label:e,value:l})=>d.label({label:e,value:l})}})),w(s,{focus:i(()=>x.value?.focus),blur:i(()=>x.value?.blur),selectedLabel:i(()=>x.value?.selectedLabel),loading:i(()=>b.loading),refresh:T,setSelection:e=>C(e),clearSelection:()=>C(null)})}});export{R as SelectV2Props,M as default,z as faSelectV2Emits,H as faSelectV2Props,q as selectV2Emits};
//# sourceMappingURL=selectV2.mjs.map
