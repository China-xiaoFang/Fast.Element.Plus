import{defineComponent as e,computed as l,reactive as a,ref as t,createVNode as i,Fragment as u,withDirectives as o,mergeProps as s,createTextVNode as n,resolveDirective as d}from"vue";import{uploadProps as p,ElUpload as r,ElIcon as m,ElImageViewer as c}from"element-plus";import{ZoomIn as f,Edit as v,Delete as h,Plus as g}from"@element-plus/icons-vue";import{useUpload as _}from"../../upload/src/useUpload.mjs";import"../../../constants/index.mjs";import{definePropType as w,stringUtil as S,useProps as b,useRender as x,useExpose as y,makeSlots as L}from"@fast-china/utils";import{isArray as U,isNull as E}from"lodash-unified";import{FaMimeType as C}from"../../../constants/mime.mjs";const I={...p,accept:{type:String,default:()=>C.Image},listType:{type:w(String),default:"picture-card"},multiple:{type:Boolean,default:!0},limit:{type:Number,default:9},modelValue:w([Array]),maxSize:{type:[String,Number],default:2048},uploadApi:{type:w(Function)},uploadUrl:String},O={"update:modelValue":e=>U(e)||E(e),"update:fileList":e=>U(e),change:e=>U(e)||E(e)},R=/* @__PURE__ */e({name:"FaUploadImages",props:I,emits:O,slots:L(),setup(e,{attrs:w,slots:L,emit:U,expose:E}){const{fileList:C,loading:I,formContext:O,maxSizeMB:R,handleValue:k,handleHttpRequest:z,handleOnSuccess:F,handleOnError:q,handleOnExceed:A,handleOnUpload:M}=_("FaUploadImages","图片",e,U,{maxSize:e.maxSize,uploadApi:e.uploadApi,uploadUrl:e.uploadUrl}),j=l(()=>e.disabled||O?.disabled),B=a({uploadKey:`fa-upload-images__${S.generateRandomString(8)}`,preview:!1,previewIndex:-1,previewList:[]}),K=t(),V=()=>{const e=document.querySelector(`.${B.uploadKey} .el-upload__input`);e&&e.dispatchEvent(new MouseEvent("click"))},N=l=>!!M(l)&&(!e.beforeUpload||e.beforeUpload(l)),$=b(e,p,["fileList","disabled","httpRequest","beforeUpload","onExceed","onSuccess","onError"]);return x(()=>i(u,null,[o(i(r,s($.value,{ref:K,class:["fa-upload-images",B.uploadKey,{"fa-upload-images__hidden-upload":C.value.length>=e.limit}],fileList:C.value,"onUpdate:fileList":e=>C.value=e,disabled:j.value,httpRequest:z,beforeUpload:N,onExceed:A,onSuccess:F,onError:q}),{default:()=>C.value.length<e.limit&&L.default?L.default():i(m,null,{default:()=>[i(g,null,null)]}),tip:()=>i("div",{class:"el-upload__tip"},[n("files with a size less than "),R.toString(),n("MB")]),file:({file:e,index:l})=>i("div",null,[i("img",{class:"el-upload-list__item-thumbnail",src:e.url},null),i("span",{class:"el-upload-list__item-actions"},[i("span",{class:"el-upload-list__item-preview",onClick:()=>{return l=e,B.previewIndex=C.value.findIndex(e=>e.url===l.url),B.previewList=C.value.map(e=>e.url),void(B.preview=!0);var l},title:"查看"},[i(m,null,{default:()=>[i(f,null,null)]})]),!j.value&&i(u,null,[i("span",{class:"el-upload-list__item-icon",onClick:V,title:"编辑"},[i(m,null,{default:()=>[i(v,null,null)]})]),i("span",{class:"el-upload-list__item-icon",onClick:()=>(e=>{C.value.splice(e,1),k()})(l),title:"删除"},[i(m,null,{default:()=>[i(h,null,null)]})])])])])}),[[d("loading"),I.value]]),B.preview&&i(c,{closeOnPressEscape:!0,hideOnClickModal:!0,teleported:!0,onClose:()=>B.preview=!1,urlList:B.previewList},null)])),y(E,{abort:l(()=>K.value?.abort),submit:l(()=>K.value?.submit),clearFiles:l(()=>K.value?.clearFiles),handleStart:l(()=>K.value?.handleStart),handleRemove:l(()=>K.value?.handleRemove),loading:I,fileList:C,preview:l(()=>B.preview),previewList:l(()=>B.previewList)})}});export{R as default,O as faUploadImagesEmits,I as faUploadImagesProps};
//# sourceMappingURL=uploadImages.mjs.map
