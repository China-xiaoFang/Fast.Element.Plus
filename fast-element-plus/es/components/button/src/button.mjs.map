{"version":3,"file":"button.mjs","sources":["../../../../../packages/components/button/src/button.tsx"],"sourcesContent":["import { computed, defineComponent, reactive, ref, watch, withModifiers } from \"vue\";\nimport { ElButton, buttonEmits, buttonProps } from \"element-plus\";\nimport { Eleme } from \"@element-plus/icons-vue\";\nimport { useOverlay } from \"@fast-element-plus/hooks\";\nimport { consoleError, definePropType, execFunction, makeSlots, useExpose, useProps, useRender } from \"@fast-china/utils\";\nimport { isFunction } from \"lodash-unified\";\nimport type { ButtonInstance } from \"element-plus\";\nimport type { Component, VNode } from \"vue\";\n\nexport const faButtonProps = {\n\t...buttonProps,\n\t/**\n\t * @description customize loading icon component\n\t * @default Eleme\n\t */\n\tloadingIcon: {\n\t\ttype: definePropType<string | Component>([String, Object, Function]),\n\t\tdefault: (): string | Component => Eleme,\n\t},\n\t/** @description 禁用加载 */\n\tdisabledLoading: Boolean,\n};\n\nexport const faButtonEmits = {\n\t...buttonEmits,\n\t/**\n\t * @description 点击事件\n\t * @param done 需要手动隐藏Loading\n\t */\n\t// eslint-disable-next-line @typescript-eslint/no-empty-function\n\tclick: (event: MouseEvent, done: () => void = () => {}): boolean => event instanceof MouseEvent && isFunction(done),\n};\n\ntype FaButtonSlots = {\n\t/** @description 默认内容插槽 */\n\tdefault: never;\n\t/** @description 自定义加载中组件 */\n\tloading: never;\n\t/** @description 自定义图标组件 */\n\ticon: never;\n};\n\nexport default defineComponent({\n\tname: \"FaButton\",\n\tprops: faButtonProps,\n\temits: faButtonEmits,\n\tslots: makeSlots<FaButtonSlots>(),\n\tsetup(props, { attrs, slots, emit, expose }) {\n\t\tconst state = reactive({\n\t\t\tloading: false,\n\t\t});\n\n\t\tconst buttonRef = ref<ButtonInstance>();\n\n\t\tconst showLoading = (): void => {\n\t\t\tstate.loading = true;\n\t\t\t// 这里默认透明\n\t\t\tuseOverlay.show(0);\n\t\t};\n\n\t\tconst hideLoading = (): void => {\n\t\t\tstate.loading = false;\n\t\t\tuseOverlay.hide();\n\t\t};\n\n\t\tconst handleLoading = (loadingFunction: () => void | Promise<void>): void => {\n\t\t\tstate.loading = true;\n\t\t\texecFunction(loadingFunction)\n\t\t\t\t.then()\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsoleError(\"FaButton\", error);\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tstate.loading = false;\n\t\t\t\t});\n\t\t};\n\n\t\tconst handleClick = (event: MouseEvent): void => {\n\t\t\tif (props.disabledLoading) {\n\t\t\t\t// 回调点击事件\n\t\t\t\temit(\"click\", event);\n\t\t\t} else {\n\t\t\t\tshowLoading();\n\t\t\t\t// 回调点击事件\n\t\t\t\temit(\"click\", event, hideLoading);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * 监听外部 loading 的值\n\t\t */\n\t\twatch(\n\t\t\t() => props.loading,\n\t\t\t(newValue) => {\n\t\t\t\tif (props.disabledLoading) return;\n\t\t\t\tif (newValue) {\n\t\t\t\t\tshowLoading();\n\t\t\t\t} else {\n\t\t\t\t\thideLoading();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\timmediate: true,\n\t\t\t}\n\t\t);\n\n\t\tconst elButtonProps = useProps(props, buttonProps, [\"loading\"]);\n\n\t\tuseRender(() => (\n\t\t\t<ElButton\n\t\t\t\t{...elButtonProps.value}\n\t\t\t\tref={buttonRef}\n\t\t\t\tclass=\"fa-button\"\n\t\t\t\tloading={state.loading}\n\t\t\t\tonClick={withModifiers((event: Event) => handleClick(event as MouseEvent), [\"prevent\"])}\n\t\t\t>\n\t\t\t\t{{\n\t\t\t\t\tdefault: () => slots.default && slots.default(),\n\t\t\t\t\t...(slots.loading && { loading: (): VNode[] => slots.loading() }),\n\t\t\t\t\t...(slots.icon && { icon: (): VNode[] => slots.icon() }),\n\t\t\t\t}}\n\t\t\t</ElButton>\n\t\t));\n\n\t\treturn useExpose(expose, {\n\t\t\t/** @description 按钮 html 元素 */\n\t\t\tref: computed(() => buttonRef.value?.ref),\n\t\t\t/** @description 按钮尺寸 */\n\t\t\tsize: computed(() => buttonRef.value?.size),\n\t\t\t/** @description 按钮类型 */\n\t\t\ttype: computed(() => buttonRef.value?.type),\n\t\t\t/** @description 按钮已禁用 */\n\t\t\tdisabled: computed(() => buttonRef.value?.disabled),\n\t\t\t/** @description 是否在两个字符之间插入空格 */\n\t\t\tshouldAddSpace: computed(() => buttonRef.value?.shouldAddSpace),\n\t\t\t/** @description 加载状态 */\n\t\t\tloading: computed(() => state.loading),\n\t\t\t/** @description 按钮加载 */\n\t\t\tdoLoading: handleLoading,\n\t\t});\n\t},\n});\n"],"names":["faButtonProps","buttonProps","loadingIcon","type","definePropType","String","Object","Function","default","Eleme","disabledLoading","Boolean","faButtonEmits","buttonEmits","click","event","done","MouseEvent","isFunction","name","props","emits","slots","makeSlots","setup","attrs","emit","expose","state","reactive","loading","buttonRef","ref","showLoading","useOverlay","show","hideLoading","hide","handleLoading","loadingFunction","execFunction","then","catch","error","consoleError","finally","handleClick","watch","newValue","immediate","elButtonProps","useProps","useRender","_createVNode","ElButton","_mergeProps","value","withModifiers","icon","useExpose","computed","size","disabled","shouldAddSpace","doLoading"],"mappings":"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"}