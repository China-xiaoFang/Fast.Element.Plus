{"version":3,"file":"layoutGrid.mjs","sources":["../../../../../packages/components/layoutGrid/src/layoutGrid.tsx"],"sourcesContent":["import type { VNode, VNodeArrayChildren } from \"vue\";\nimport { computed, defineComponent, nextTick, onActivated, onDeactivated, onMounted, onUnmounted, provide, ref, watch } from \"vue\";\nimport { consoleWarn, definePropType, makeSlots, useRender } from \"@fast-element-plus/utils\";\nimport { isArray, isNumber, isObject } from \"lodash-unified\";\nimport type { FaLayoutGridBreakPoint } from \"./layoutGrid.type\";\n\ntype FaLayoutGridSlots = {\n\t/** @description 默认内容插槽 */\n\tdefault: never;\n};\n\nexport default defineComponent({\n\tname: \"FaLayoutGrid\",\n\tprops: {\n\t\t/** @description Grid布局列配置 */\n\t\tcols: {\n\t\t\ttype: definePropType<string | number | Record<FaLayoutGridBreakPoint, number>>([String, Number, Object]),\n\t\t\tdefault: (): Record<FaLayoutGridBreakPoint, number> => ({ xs: 1, sm: 2, md: 3, lg: 4, xl: 5 }),\n\t\t},\n\t\t/** @description 折叠 */\n\t\tcollapsed: Boolean,\n\t\t/** @description 折叠行数 */\n\t\tcollapsedRows: {\n\t\t\ttype: [String, Number],\n\t\t\tdefault: 1,\n\t\t},\n\t\t/** @description 间距，偏移 */\n\t\tgap: {\n\t\t\ttype: definePropType<number | [number, number]>([Number, Array]),\n\t\t\tdefault: 0,\n\t\t},\n\t},\n\temits: {\n\t\t/** @description 断点变化事件 */\n\t\tbreakPointChange: ({ breakPoint }: { breakPoint: FaLayoutGridBreakPoint }) => true,\n\t},\n\tslots: makeSlots<FaLayoutGridSlots>(),\n\tsetup(props, { slots, emit, expose }) {\n\t\tconst divElRef = ref<HTMLElement>();\n\n\t\t// 注入 gap 间距\n\t\tprovide(\"gap\", isArray(props.gap) ? props.gap[0] : props.gap);\n\n\t\t// 注入响应式断点\n\t\tconst breakPoint = ref<FaLayoutGridBreakPoint>(\"xl\");\n\t\tprovide(\"breakPoint\", breakPoint);\n\n\t\t// 注入要开始折叠的 index\n\t\tconst hiddenIndex = ref(-1);\n\t\tprovide(\"shouldHiddenIndex\", hiddenIndex);\n\n\t\t// 注入 cols\n\t\tconst cols = computed(() => {\n\t\t\tif (isObject(props.cols)) return props.cols[breakPoint.value] ?? props.cols;\n\t\t\treturn props.cols;\n\t\t});\n\t\tprovide(\"cols\", cols);\n\n\t\tconst collapsedRows = isNumber(props.collapsedRows) ? props.collapsedRows : Number(props.collapsedRows);\n\n\t\t// 断点映射\n\t\tconst breakpoints = {\n\t\t\t// 小于480屏幕（如手机）\n\t\t\txs: { min: 0, max: 479 },\n\t\t\t// 平板竖屏\n\t\t\tsm: { min: 480, max: 768 },\n\t\t\t// 平板横屏\n\t\t\tmd: { min: 768, max: 1024 },\n\t\t\t// 小型桌面\n\t\t\tlg: { min: 1024, max: 1440 },\n\t\t\t// 大型桌面\n\t\t\txl: { min: 1440, max: Infinity },\n\t\t};\n\n\t\t// 监听屏幕变化\n\t\tconst resize = (e: ResizeObserverEntry[]): void => {\n\t\t\t// 这里肯定只有一个\n\t\t\tif (e.length !== 1) throw new Error(\"未知的多个El\");\n\t\t\tconst curEl = e[0];\n\t\t\tconst width = curEl.target.scrollWidth;\n\n\t\t\tfor (const [key, { min, max }] of Object.entries(breakpoints)) {\n\t\t\t\tif (width >= min && width <= max) {\n\t\t\t\t\tbreakPoint.value = key as FaLayoutGridBreakPoint;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst findIndex = (): void => {\n\t\t\tconst fields: VNodeArrayChildren = [];\n\t\t\tlet suffix: VNode = null;\n\t\t\tconst slotContent = divElRef.value?.children;\n\t\t\tif (slotContent) {\n\t\t\t\tfor (let i = 0; i < slotContent.length; i++) {\n\t\t\t\t\tconst slotNode = slotContent[i][\"__vueParentComponent\"]?.vnode;\n\t\t\t\t\tif (typeof slotNode?.type === \"object\" && slotNode?.type.name === \"FaLayoutGridItem\" && slotNode?.props?.suffix !== undefined)\n\t\t\t\t\t\tsuffix = slotNode;\n\t\t\t\t\tif (typeof slotNode?.type === \"symbol\" && Array.isArray(slotNode?.children))\n\t\t\t\t\t\tslotNode?.children.forEach((child: VNode) => fields.push(child));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// 计算 suffix 所占用的列\n\t\t\tlet suffixCols = 0;\n\t\t\tif (suffix) {\n\t\t\t\tsuffixCols =\n\t\t\t\t\t(suffix.props[breakPoint.value]?.span ?? suffix.props?.span ?? 1) +\n\t\t\t\t\t(suffix.props[breakPoint.value]?.offset ?? suffix.props?.offset ?? 0);\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tlet find = false;\n\t\t\t\tfields.reduce((prev = 0, current, index) => {\n\t\t\t\t\tprev +=\n\t\t\t\t\t\t((current as VNode).props[breakPoint.value]?.span ?? (current as VNode).props?.span ?? 1) +\n\t\t\t\t\t\t((current as VNode).props[breakPoint.value]?.offset ?? (current as VNode).props?.offset ?? 0);\n\t\t\t\t\tif ((prev as number) > collapsedRows * (cols.value as number) - suffixCols) {\n\t\t\t\t\t\thiddenIndex.value = index;\n\t\t\t\t\t\tfind = true;\n\t\t\t\t\t\t// throw \"find it\";\n\t\t\t\t\t}\n\t\t\t\t\treturn prev;\n\t\t\t\t}, 0);\n\t\t\t\tif (!find) hiddenIndex.value = -1;\n\t\t\t} catch (error) {\n\t\t\t\tconsoleWarn(\"FaLayoutGrid\", error);\n\t\t\t}\n\t\t};\n\n\t\tlet resizeObserver: ResizeObserver = null;\n\n\t\tonMounted(() => {\n\t\t\tnextTick(() => {\n\t\t\t\tresizeObserver = new ResizeObserver(resize);\n\t\t\t\tresizeObserver.observe(divElRef.value);\n\t\t\t});\n\t\t});\n\n\t\tonActivated(() => {\n\t\t\tnextTick(() => {\n\t\t\t\tresizeObserver = new ResizeObserver(resize);\n\t\t\t\tresizeObserver.observe(divElRef.value);\n\t\t\t});\n\t\t});\n\n\t\tonUnmounted(() => {\n\t\t\tresizeObserver?.disconnect();\n\t\t});\n\n\t\tonDeactivated(() => {\n\t\t\tresizeObserver?.disconnect();\n\t\t});\n\n\t\tonMounted(() => {\n\t\t\t// 断点变化时 执行 findIndex\n\t\t\twatch(\n\t\t\t\t() => breakPoint.value,\n\t\t\t\t() => {\n\t\t\t\t\tif (props.collapsed) {\n\t\t\t\t\t\temit(\"breakPointChange\", { breakPoint: breakPoint.value });\n\t\t\t\t\t\tfindIndex();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\timmediate: true,\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t\t// 监听 collapsed\n\t\twatch(\n\t\t\t() => props.collapsed,\n\t\t\t(value) => {\n\t\t\t\tif (value) return findIndex();\n\t\t\t\thiddenIndex.value = -1;\n\t\t\t}\n\t\t);\n\n\t\t// 设置间距\n\t\tconst gap = computed(() => {\n\t\t\tif (isNumber(props.gap)) return `${props.gap}px`;\n\t\t\tif (isArray(props.gap)) return `${props.gap[1]}px ${props.gap[0]}px`;\n\t\t\treturn \"unset\";\n\t\t});\n\n\t\t// 设置 style\n\t\tconst style = computed(() => {\n\t\t\treturn {\n\t\t\t\tdisplay: \"grid\",\n\t\t\t\tgridGap: gap.value,\n\t\t\t\tgridTemplateColumns: `repeat(${cols.value}, minmax(0, 1fr))`,\n\t\t\t};\n\t\t});\n\n\t\tuseRender(() => (\n\t\t\t<div ref={divElRef} style={style.value}>\n\t\t\t\t{slots.default && slots.default()}\n\t\t\t</div>\n\t\t));\n\t},\n});\n"],"names":["defineComponent","name","props","cols","type","definePropType","String","Number","Object","default","xs","sm","md","lg","xl","collapsed","Boolean","collapsedRows","gap","Array","emits","breakPointChange","breakPoint","slots","makeSlots","setup","emit","expose","divElRef","ref","provide","isArray","hiddenIndex","computed","isObject","value","isNumber","breakpoints","min","max","Infinity","resize","e","length","Error","curEl","width","target","scrollWidth","key","entries","findIndex","fields","suffix","slotContent","children","i","slotNode","vnode","undefined","forEach","child","push","suffixCols","span","offset","find","reduce","prev","current","index","error","consoleWarn","resizeObserver","onMounted","nextTick","ResizeObserver","observe","onActivated","onUnmounted","disconnect","onDeactivated","watch","immediate","style","display","gridGap","gridTemplateColumns","useRender","_createVNode"],"mappings":"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"}