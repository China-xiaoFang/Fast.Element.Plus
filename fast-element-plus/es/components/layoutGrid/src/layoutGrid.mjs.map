{"version":3,"file":"layoutGrid.mjs","sources":["../../../../../packages/components/layoutGrid/src/layoutGrid.tsx"],"sourcesContent":["import { computed, defineComponent, nextTick, onActivated, onDeactivated, onMounted, onUnmounted, provide, ref, watch } from \"vue\";\nimport { definePropType, makeSlots, useExpose, useRender } from \"@fast-china/utils\";\nimport { isArray, isNumber, isObject } from \"lodash-unified\";\nimport type { FaLayoutGridBreakPoint } from \"./layoutGrid.type\";\nimport type { VNode, VNodeArrayChildren } from \"vue\";\n\ntype FaLayoutGridSlots = {\n\t/** @description 默认内容插槽 */\n\tdefault: never;\n};\n\nexport default defineComponent({\n\tname: \"FaLayoutGrid\",\n\tprops: {\n\t\t/** @description Grid布局列配置 */\n\t\tcols: {\n\t\t\ttype: definePropType<string | number | Record<FaLayoutGridBreakPoint, number>>([String, Number, Object]),\n\t\t\tdefault: (): Record<FaLayoutGridBreakPoint, number> => ({ xs: 1, sm: 2, md: 3, lg: 4, xl: 5 }),\n\t\t},\n\t\t/** @description 折叠 */\n\t\tcollapsed: Boolean,\n\t\t/** @description 折叠行数 */\n\t\tcollapsedRows: {\n\t\t\ttype: [String, Number],\n\t\t\tdefault: 1,\n\t\t},\n\t\t/** @description 间距，偏移 */\n\t\tgap: {\n\t\t\ttype: definePropType<number | [number, number]>([Number, Array]),\n\t\t\tdefault: 0,\n\t\t},\n\t},\n\temits: {\n\t\t/** @description 断点变化事件 */\n\t\tbreakPointChange: ({ breakPoint }: { breakPoint: FaLayoutGridBreakPoint }) => true,\n\t},\n\tslots: makeSlots<FaLayoutGridSlots>(),\n\tsetup(props, { slots, emit, expose }) {\n\t\tconst divElRef = ref<HTMLElement>();\n\n\t\t// 注入 gap 间距\n\t\tprovide(\"gap\", isArray(props.gap) ? props.gap[0] : props.gap);\n\n\t\t// 注入响应式断点\n\t\tconst breakPoint = ref<FaLayoutGridBreakPoint>(\"xl\");\n\t\tprovide(\"breakPoint\", breakPoint);\n\n\t\t// 注入要开始折叠的 index\n\t\tconst hiddenIndex = ref(-1);\n\t\tprovide(\"shouldHiddenIndex\", hiddenIndex);\n\n\t\t// 注入 cols\n\t\tconst cols = computed(() => {\n\t\t\tif (isObject(props.cols)) return props.cols[breakPoint.value] ?? props.cols;\n\t\t\treturn props.cols;\n\t\t});\n\t\tprovide(\"cols\", cols);\n\n\t\tconst collapsedRows = isNumber(props.collapsedRows) ? props.collapsedRows : Number(props.collapsedRows);\n\n\t\t// 断点映射\n\t\tconst breakpoints = {\n\t\t\t// 小于480屏幕（如手机）\n\t\t\txs: { min: 0, max: 479 },\n\t\t\t// 平板竖屏\n\t\t\tsm: { min: 480, max: 768 },\n\t\t\t// 平板横屏\n\t\t\tmd: { min: 768, max: 1024 },\n\t\t\t// 小型桌面\n\t\t\tlg: { min: 1024, max: 1440 },\n\t\t\t// 大型桌面\n\t\t\txl: { min: 1440, max: Infinity },\n\t\t};\n\n\t\t// 监听屏幕变化\n\t\tconst resize = (e: ResizeObserverEntry[]): void => {\n\t\t\t// 这里肯定只有一个\n\t\t\tif (e.length !== 1) throw new Error(\"未知的多个El\");\n\t\t\tconst curEl = e[0];\n\t\t\tconst width = curEl.target.scrollWidth;\n\n\t\t\tfor (const [key, { min, max }] of Object.entries(breakpoints)) {\n\t\t\t\tif (width >= min && width <= max) {\n\t\t\t\t\tbreakPoint.value = key as FaLayoutGridBreakPoint;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tlet resizeObserver: ResizeObserver = null;\n\n\t\tonMounted(() => {\n\t\t\tnextTick(() => {\n\t\t\t\tresizeObserver = new ResizeObserver(resize);\n\t\t\t\tresizeObserver.observe(divElRef.value);\n\t\t\t});\n\n\t\t\t// 断点变化时 执行 findIndex\n\t\t\twatch(\n\t\t\t\t() => breakPoint.value,\n\t\t\t\t(newValue) => {\n\t\t\t\t\temit(\"breakPointChange\", { breakPoint: newValue });\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\timmediate: true,\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t\tonActivated(() => {\n\t\t\tnextTick(() => {\n\t\t\t\tresizeObserver = new ResizeObserver(resize);\n\t\t\t\tresizeObserver.observe(divElRef.value);\n\t\t\t});\n\t\t});\n\n\t\tonUnmounted(() => {\n\t\t\tresizeObserver?.disconnect();\n\t\t});\n\n\t\tonDeactivated(() => {\n\t\t\tresizeObserver?.disconnect();\n\t\t});\n\n\t\t// 设置间距\n\t\tconst gap = computed(() => {\n\t\t\tif (isNumber(props.gap)) return `${props.gap}px`;\n\t\t\tif (isArray(props.gap)) return `${props.gap[1]}px ${props.gap[0]}px`;\n\t\t\treturn \"unset\";\n\t\t});\n\n\t\t// 设置 style\n\t\tconst style = computed(() => {\n\t\t\treturn {\n\t\t\t\tdisplay: \"grid\",\n\t\t\t\tgridGap: gap.value,\n\t\t\t\tgridTemplateColumns: `repeat(${cols.value}, minmax(0, 1fr))`,\n\t\t\t};\n\t\t});\n\n\t\tuseRender(() => {\n\t\t\tconst defaultSlot = slots?.default() ?? [];\n\n\t\t\tif (props.collapsed) {\n\t\t\t\tconst fields: VNodeArrayChildren = [];\n\t\t\t\tlet suffix: VNode = null;\n\n\t\t\t\tdefaultSlot.forEach((slot: any) => {\n\t\t\t\t\t// suffix\n\t\t\t\t\tif (typeof slot.type === \"object\" && slot.type.name === \"FaLayoutGridItem\" && slot.props?.suffix !== undefined) suffix = slot;\n\t\t\t\t\t// slot children\n\t\t\t\t\tif (typeof slot.type === \"symbol\" && Array.isArray(slot?.children)) fields.push(...slot.children);\n\t\t\t\t});\n\n\t\t\t\t// 计算 suffix 所占用的列\n\t\t\t\tlet suffixCols = 0;\n\t\t\t\tif (suffix) {\n\t\t\t\t\tsuffixCols =\n\t\t\t\t\t\t(suffix.props[breakPoint.value]?.span ?? suffix.props?.span ?? 1) +\n\t\t\t\t\t\t(suffix.props[breakPoint.value]?.offset ?? suffix.props?.offset ?? 0);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tlet find = false;\n\t\t\t\t\tfields.reduce((prev = 0, current, index) => {\n\t\t\t\t\t\tprev +=\n\t\t\t\t\t\t\t((current as VNode).props[breakPoint.value]?.span ?? (current as VNode).props?.span ?? 1) +\n\t\t\t\t\t\t\t((current as VNode).props[breakPoint.value]?.offset ?? (current as VNode).props?.offset ?? 0);\n\t\t\t\t\t\tif (Number(prev) > collapsedRows * Number(cols.value) - suffixCols) {\n\t\t\t\t\t\t\thiddenIndex.value = index;\n\t\t\t\t\t\t\tfind = true;\n\t\t\t\t\t\t\tthrow \"find it\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn prev;\n\t\t\t\t\t}, 0);\n\t\t\t\t\tif (!find) hiddenIndex.value = -1;\n\t\t\t\t} catch {}\n\t\t\t} else {\n\t\t\t\thiddenIndex.value = -1;\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t<div ref={divElRef} style={style.value}>\n\t\t\t\t\t{defaultSlot}\n\t\t\t\t</div>\n\t\t\t);\n\t\t});\n\n\t\treturn useExpose(expose, {\n\t\t\t/** @description 响应式断点 */\n\t\t\tbreakPoint,\n\t\t});\n\t},\n});\n"],"names":["name","props","cols","type","definePropType","String","Number","Object","default","xs","sm","md","lg","xl","collapsed","Boolean","collapsedRows","gap","Array","emits","breakPointChange","breakPoint","slots","makeSlots","setup","emit","expose","divElRef","ref","provide","isArray","hiddenIndex","computed","isObject","value","isNumber","breakpoints","min","max","Infinity","resize","e","length","Error","curEl","width","target","scrollWidth","key","entries","resizeObserver","onMounted","nextTick","ResizeObserver","observe","watch","newValue","immediate","onActivated","onUnmounted","disconnect","onDeactivated","style","display","gridGap","gridTemplateColumns","useRender","defaultSlot","fields","suffix","forEach","slot","undefined","children","push","suffixCols","span","offset","find","reduce","prev","current","index","_createVNode","useExpose"],"mappings":"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"}