import{isVNode as e,defineComponent as l,reactive as a,computed as t,ref as r,inject as o,watch as u,createVNode as n,Fragment as i,createTextVNode as d,mergeProps as p}from"vue";import{formContextKey as s,formItemContextKey as m,ElMessage as c,inputProps as v,ElPopover as _,ElButton as f,ElInput as b}from"element-plus";import{Back as h}from"@element-plus/icons-vue";import"../../../constants/index.mjs";import{withDefineType as g,useProps as C,useRender as y}from"@fast-china/utils";import{isString as k,isNull as w}from"lodash-unified";import{CarNumberArea as V,CarNumberDigit as j,CarNumberLetter as B}from"./common.mjs";import{RegExps as F}from"../../../constants/regex.mjs";function N(l){return"function"==typeof l||"[object Object]"===Object.prototype.toString.call(l)&&!e(l)}const x=/* @__PURE__ */l({name:"FaCarNumber",props:{...v,placeholder:{type:String,default:"请选择"}},emits:{"update:modelValue":e=>k(e)||w(e),change:e=>k(e)||w(e)},setup(e,{attrs:l,emit:k}){const w=a({value:g(),switchLetter:t(()=>w.value?.length>=1),disabledButton:t(()=>w.value?.length>=8)}),x=r(),A=o(s,void 0),L=o(m,void 0),S=e=>2===e.length?`${e} ● `:e.length>2?`${e.slice(0,2)} ● ${e.slice(2)}`:e,$=e=>{w.value??="",w.value+=e},O=()=>{0!==w.value?.length&&(w.value=w.value.substring(0,w.value.length-1))},E=()=>{let e=!1;7===w.value.length?e=F.CarNumber.test(w.value):8===w.value.length&&(e=F.NewEnergyCarNumber.test(w.value)),e?(k("update:modelValue",w.value),k("change",w.value),L?.prop&&A?.validateField([L.prop])):L?.prop&&A?(k("update:modelValue",w.value),k("change",w.value),A.validateField([L.prop])):c.error("车牌号格式不正确"),x.value?.hide()},U=()=>{w.value=null,k("update:modelValue",null),k("change",null),L?.prop&&A?.validateField([L.prop])};u(()=>e.modelValue,e=>{w.value=e.toString()},{immediate:!0});const q=C(e,v,["modelValue","readonly","formatter"]);y(()=>n(_,{ref:x,width:"auto",popperClass:"fa-car-number__popover",trigger:"click",showArrow:!1,showAfter:0,hideAfter:0},{reference:()=>n(b,p(q.value,{class:"fa-car-number__input",modelValue:w.value,"onUpdate:modelValue":e=>w.value=e,readonly:!0,formatter:S}),null),default:()=>n(i,null,[n("div",{class:["fa-car-number__popover__area",w.switchLetter?"fa-car-number__popover__hide":""]},[V.map(e=>n(f,{disabled:w.disabledButton,onClick:()=>$(e)},N(e)?e:{default:()=>[e]}))]),n("div",{class:["fa-car-number__popover__digit-letter",w.switchLetter?"":"fa-car-number__popover__hide"]},[j.map(e=>n(f,{disabled:w.disabledButton,onClick:()=>$(e)},N(e)?e:{default:()=>[e]})),B.map(e=>n(f,{disabled:w.disabledButton,onClick:()=>$(e)},N(e)?e:{default:()=>[e]}))]),n("div",{class:"fa-car-number__popover__btn"},[n(f,{class:"fa-car-number__popover__btn__clear",disabled:null===w.value||0===w.value.length,onClick:U},{default:()=>[d("清除")]}),n(f,{class:"fa-car-number__popover__btn__back",type:"danger",icon:h,disabled:null===w.value||0===w.value.length,onClick:O},null),n(f,{class:"fa-car-number__popover__btn__confirm",type:"primary",disabled:null===w.value||w.value.length<7,onClick:E},{default:()=>[d("确认")]})])])}))}});export{x as default};
//# sourceMappingURL=carNumber.mjs.map
