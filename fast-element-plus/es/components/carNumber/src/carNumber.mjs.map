{"version":3,"file":"carNumber.mjs","sources":["../../../../../packages/components/carNumber/src/carNumber.tsx"],"sourcesContent":["import { Fragment, computed, defineComponent, inject, reactive, ref, watch } from \"vue\";\nimport { ElButton, ElInput, ElMessage, ElPopover, formContextKey, formItemContextKey, inputProps } from \"element-plus\";\nimport { Back } from \"@element-plus/icons-vue\";\nimport { RegExps } from \"@fast-element-plus/constants\";\nimport { useProps, useRender, withDefineType } from \"@fast-china/utils\";\nimport { isNull, isString } from \"lodash-unified\";\nimport { CarNumberArea, CarNumberDigit, CarNumberLetter } from \"./common\";\nimport type { PopoverInstance } from \"element-plus\";\n\nexport default defineComponent({\n\tname: \"FaCarNumber\",\n\tprops: {\n\t\t...inputProps,\n\t\t/** @description placeholder */\n\t\tplaceholder: {\n\t\t\ttype: String,\n\t\t\tdefault: \"请选择\",\n\t\t},\n\t},\n\temits: {\n\t\t/** @description v-model 回调 */\n\t\t\"update:modelValue\": (value: string) => isString(value) || isNull(value),\n\t\t/** @description 改变 */\n\t\tchange: (value: string) => isString(value) || isNull(value),\n\t},\n\tsetup(props, { attrs, emit }) {\n\t\tconst state = reactive({\n\t\t\tvalue: withDefineType<string>(),\n\t\t\tswitchLetter: computed(() => {\n\t\t\t\tif (state.value?.length >= 1) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}),\n\t\t\tdisabledButton: computed(() => {\n\t\t\t\tif (state.value?.length >= 8) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}),\n\t\t});\n\n\t\tconst popoverRef = ref<PopoverInstance>();\n\t\t// 获取 el-form 组件上下文\n\t\tconst formContext = inject(formContextKey, undefined);\n\t\t// 获取 el-form-item 组件上下文\n\t\tconst formItemContext = inject(formItemContextKey, undefined);\n\n\t\tconst handleInputFormatter = (value: string): string => {\n\t\t\tif (value.length === 2) {\n\t\t\t\treturn `${value} ● `;\n\t\t\t} else if (value.length > 2) {\n\t\t\t\treturn `${value.slice(0, 2)} ● ${value.slice(2)}`;\n\t\t\t} else {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t};\n\n\t\tconst handleSelectCarNumber = (value: string): void => {\n\t\t\tstate.value ??= \"\";\n\t\t\tstate.value += value;\n\t\t};\n\n\t\tconst handleBackClick = (): void => {\n\t\t\tif (state.value?.length === 0) return;\n\t\t\tstate.value = state.value.substring(0, state.value.length - 1);\n\t\t};\n\n\t\tconst handleConfirmClick = (): void => {\n\t\t\tlet success = false;\n\t\t\tif (state.value.length === 7) {\n\t\t\t\tsuccess = RegExps.CarNumber.test(state.value);\n\t\t\t} else if (state.value.length === 8) {\n\t\t\t\tsuccess = RegExps.NewEnergyCarNumber.test(state.value);\n\t\t\t}\n\t\t\tif (success) {\n\t\t\t\temit(\"update:modelValue\", state.value);\n\t\t\t\temit(\"change\", state.value);\n\t\t\t\t// 调用 el-form 内部的校验方法（可自动校验）\n\t\t\t\tformItemContext?.prop && formContext?.validateField([formItemContext.prop]);\n\t\t\t} else {\n\t\t\t\tif (formItemContext?.prop && formContext) {\n\t\t\t\t\temit(\"update:modelValue\", state.value);\n\t\t\t\t\temit(\"change\", state.value);\n\t\t\t\t\t// 调用 el-form 内部的校验方法（可自动校验）\n\t\t\t\t\tformContext.validateField([formItemContext.prop]);\n\t\t\t\t} else {\n\t\t\t\t\tElMessage.error(\"车牌号格式不正确\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tpopoverRef.value?.hide();\n\t\t};\n\n\t\tconst handleClearClick = (): void => {\n\t\t\tstate.value = null;\n\t\t\temit(\"update:modelValue\", null);\n\t\t\temit(\"change\", null);\n\t\t\t// 调用 el-form 内部的校验方法（可自动校验）\n\t\t\tformItemContext?.prop && formContext?.validateField([formItemContext.prop]);\n\t\t};\n\n\t\twatch(\n\t\t\t() => props.modelValue,\n\t\t\t(newValue) => {\n\t\t\t\tstate.value = newValue.toString();\n\t\t\t},\n\t\t\t{\n\t\t\t\timmediate: true,\n\t\t\t}\n\t\t);\n\n\t\tconst elInputProps = useProps(props, inputProps, [\"modelValue\", \"readonly\", \"formatter\"]);\n\n\t\tuseRender(() => (\n\t\t\t<ElPopover\n\t\t\t\tref={popoverRef}\n\t\t\t\twidth=\"auto\"\n\t\t\t\tpopperClass=\"fa-car-number__popover\"\n\t\t\t\ttrigger=\"click\"\n\t\t\t\tshowArrow={false}\n\t\t\t\tshowAfter={0}\n\t\t\t\thideAfter={0}\n\t\t\t>\n\t\t\t\t{{\n\t\t\t\t\treference: () => (\n\t\t\t\t\t\t<ElInput\n\t\t\t\t\t\t\t{...elInputProps.value}\n\t\t\t\t\t\t\tclass=\"fa-car-number__input\"\n\t\t\t\t\t\t\tvModel={state.value}\n\t\t\t\t\t\t\treadonly\n\t\t\t\t\t\t\tformatter={handleInputFormatter}\n\t\t\t\t\t\t/>\n\t\t\t\t\t),\n\t\t\t\t\tdefault: () => (\n\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t<div class={[\"fa-car-number__popover__area\", state.switchLetter ? \"fa-car-number__popover__hide\" : \"\"]}>\n\t\t\t\t\t\t\t\t{CarNumberArea.map((area) => (\n\t\t\t\t\t\t\t\t\t<ElButton disabled={state.disabledButton} onClick={() => handleSelectCarNumber(area)}>\n\t\t\t\t\t\t\t\t\t\t{area}\n\t\t\t\t\t\t\t\t\t</ElButton>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class={[\"fa-car-number__popover__digit-letter\", state.switchLetter ? \"\" : \"fa-car-number__popover__hide\"]}>\n\t\t\t\t\t\t\t\t{CarNumberDigit.map((digit) => (\n\t\t\t\t\t\t\t\t\t<ElButton disabled={state.disabledButton} onClick={() => handleSelectCarNumber(digit)}>\n\t\t\t\t\t\t\t\t\t\t{digit}\n\t\t\t\t\t\t\t\t\t</ElButton>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t{CarNumberLetter.map((letter) => (\n\t\t\t\t\t\t\t\t\t<ElButton disabled={state.disabledButton} onClick={() => handleSelectCarNumber(letter)}>\n\t\t\t\t\t\t\t\t\t\t{letter}\n\t\t\t\t\t\t\t\t\t</ElButton>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"fa-car-number__popover__btn\">\n\t\t\t\t\t\t\t\t<ElButton\n\t\t\t\t\t\t\t\t\tclass=\"fa-car-number__popover__btn__clear\"\n\t\t\t\t\t\t\t\t\tdisabled={state.value === null || state.value.length === 0}\n\t\t\t\t\t\t\t\t\tonClick={handleClearClick}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t清除\n\t\t\t\t\t\t\t\t</ElButton>\n\t\t\t\t\t\t\t\t<ElButton\n\t\t\t\t\t\t\t\t\tclass=\"fa-car-number__popover__btn__back\"\n\t\t\t\t\t\t\t\t\ttype=\"danger\"\n\t\t\t\t\t\t\t\t\ticon={Back}\n\t\t\t\t\t\t\t\t\tdisabled={state.value === null || state.value.length === 0}\n\t\t\t\t\t\t\t\t\tonClick={handleBackClick}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<ElButton\n\t\t\t\t\t\t\t\t\tclass=\"fa-car-number__popover__btn__confirm\"\n\t\t\t\t\t\t\t\t\ttype=\"primary\"\n\t\t\t\t\t\t\t\t\tdisabled={state.value === null || state.value.length < 7}\n\t\t\t\t\t\t\t\t\tonClick={handleConfirmClick}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t确认\n\t\t\t\t\t\t\t\t</ElButton>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t),\n\t\t\t\t}}\n\t\t\t</ElPopover>\n\t\t));\n\t},\n});\n"],"names":["_isSlot","s","Object","prototype","toString","call","_isVNode","name","props","inputProps","placeholder","type","String","default","emits","value","isString","isNull","change","setup","attrs","emit","state","reactive","withDefineType","switchLetter","computed","length","disabledButton","popoverRef","ref","formContext","inject","formContextKey","undefined","formItemContext","formItemContextKey","handleInputFormatter","slice","handleSelectCarNumber","handleBackClick","substring","handleConfirmClick","success","RegExps","CarNumber","test","NewEnergyCarNumber","prop","validateField","ElMessage","error","hide","handleClearClick","watch","modelValue","newValue","immediate","elInputProps","useProps","useRender","_createVNode","ElPopover","reference","ElInput","_mergeProps","$event","_Fragment","CarNumberArea","map","area","ElButton","onClick","CarNumberDigit","digit","CarNumberLetter","letter","_createTextVNode","Back"],"mappings":"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"}